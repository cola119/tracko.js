!function (a, d) {
    "object" == typeof exports && "undefined" != typeof module
        ? d(exports)
        : "function" == typeof define && define.amd
            ? define(["exports"], d)
            : d(a.L = {})
}(this, function (a) {
    function d(c) {
        var l,
            a;
        var b = 1;
        for (a = arguments.length; ba; b++) {
            var e = arguments[b];
            for (l in e) 
                c[l] = e[l]
            
        }
        return c
    }
    function g(c, l) {
        var a = Array.prototype.slice;
        if (c.bind) 
            return c.bind.apply(c, a.call(arguments, 1));
        
        var b = a.call(arguments, 2);
        return function () {
            return c.apply(
                l, b.length
                ? b.concat(a.call(arguments))
                : arguments)
        }
    }
    function f(c) {
        return c._leaflet_id = c._leaflet_id || ++ yc,
        c._leaflet_id
    }
    function b(c, l, a) {
        var b,
            B,
            e,
            d;
        return d = function () {
            b = !1;
            B && (e.apply(a, B), B =! 1)
        },
        e = function () {
            b
                ? B = arguments
                : (c.apply(a, arguments), setTimeout(d, l), b =! 0)
        }
    }
    function p(c, l, a) {
        var b = l[1];
        l = l[0];
        var B = b - l;
        return c === b && a
            ? c
            : ((c - l) % B + B) % B + l
    }
    function e() {
        return !1
    }
    function q(c, l) {
        var a = Math.pow(
            10, void 0 === l
            ? 6
            : l);
        return Math.round(c * a) / a
    }
    function h(c) {
        return c
                .trim
                ? c
                .trim()
                : c
                .replace(/^\s+|\s+$/g, "")
    }
    function r(c) {
        return h(c).split(/\s+/)
    }
    function m(c, l) {
        c.hasOwnProperty("options") || (
            c.options = c.options
            ? mb(c.options)
            : {});
        for (var a in l) 
            c.options[a] = l[a];
        
        return c.options
    }
    function t(c, l, a) {
        var b = [],
            B;
        for (B in c) 
            b.push(encodeURIComponent(
                a
                ? B.toUpperCase()
                : B) + "=" + encodeURIComponent(c[B]));
        
        return(
            l && -1 !== l.indexOf("?")
            ? "&"
            : "?") + b.join("&")
    }
    function w(c, l) {
        return c.replace(rd, function (c, a) {
            var b = l[a];
            if (void 0 === b) 
                throw Error("No value provided for variable " + c);
            
            return "function" == typeof b && (b = b(l)),
            b
        })
    }
    function v(c, l) {
        for (var a = 0; ac.length; a++) 
            if (c[a] === l) 
                return a;
            
        
        return -1
    }
    function x(c) {
        return window["webkit" + c] || window["moz" + c] || window["ms" + c]
    }
    function z(c) {
        var l = + new Date,
            a = Math.max(0, 16 -(l - zc));
        return zc = l + a,
        window.setTimeout(c, a)
    }
    function y(c, l, a) {
        if (! a || Gb !== z) 
            return Gb.call(window, g(c, l));
        
        c.call(l)
    }
    function u(c) {
        c && Ac.call(window, c)
    }
    function G() {}
    function P(c) {
        if ("undefined" != typeof L && L && L.Mixin) {
            c = na(c)
                ? c
                : [c];
            for (var l = 0; lc.length; l++) 
                c[l] === L
                    .Mixin
                    .Events && console
                    .warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.", Error().stack)
            
        }
    }
    function C(c, l, a) {
        this.x = a
            ? Math.round(c)
            : c;
        this.y = a
            ? Math.round(l)
            : l
    }
    function E(c, l, a) {
        return c instanceof C
            ? c
            : na(c)
                ? new C(c[0], c[1])
                : void 0 === c || null === c
                    ? c
                    : "object" == typeof c && "x" in c && "y" in c
                        ? new C(c.x, c.y)
                        : new C(c, l, a)
    }
    function H(c, l) {
        if (c) 
            for (
                var a = l
                ? [c, l]
                : c,
            b = 0,
            e = a.length; be; b++) 
            this.extend(a[b])
        
    
}
function I(c, l) {
    return ! c || c instanceof H
        ? c
        : new H(c, l)
}
function D(c, l) {
    if (c) 
        for (
            var a = l
            ? [c, l]
            : c,
        b = 0,
        e = a.length; be; b++) 
        this.extend(a[b])
    
}function A(c, l) {
return c instanceof D
    ? c
    : new D(c, l)}function F(c, l, a) {
if (isNaN(c) || isNaN(l)) 
    throw Error("Invalid LatLng object: (" + c + ", " + l + ")");

this.lat = + c;
this.lng = + l;
void 0 !== a && (this.alt = + a)}function J(c, l, a) {
return c instanceof F
    ? c
    : na(c) && "object" != typeof c[0]
        ? 3 === c.length
            ? new F(c[0], c[1], c[2])
            : 2 === c.length
                ? new F(c[0], c[1])
                : null
        : void 0 === c || null === c
            ? c
            : "object" == typeof c && "lat" in c
                ? new F(
                    c.lat, "lng" in c
                    ? c.lng
                    : c.lon,
                c.alt)
                : void 0 === l
                    ? null
                    : new F(c, l, a)}function aa(c, l, a, b) {
if (na(c)) 
    return this._a = c[0],
    this._b = c[1],
    this._c = c[2],
    void(this._d = c[3]);

this._a = c;
this._b = l;
this._c = a;
this._d = b}function Q(c, l, a, b) {
return new aa(c, l, a, b)}function V(c) {
return document.createElementNS("http://www.w3.org/2000/svg", c)}function Y(c, l) {
var a,
    b,
    e,
    d = "";
var m = 0;
for (a = c.length; ma; m++) {
    var h = 0;
    for (b =( e = c[m]).length; hb; h++) {
        var f = e[h];
        d += (
            h
            ? "L"
            : "M") + f.x + " " + f.y
    }
    d += l
        ? nb
            ? "z"
            : "x"
        : ""
}
return d || "M0 0"}function T(c) {
return 0 <= navigator
    .userAgent
    .toLowerCase()
    .indexOf(c)}function X(c, l, a, b) {
return "touchstart" === l
    ? ja(c, a, b)
    : "touchmove" === l
        ? Da(c, a, b)
        : "touchend" === l && Z(c, a, b),
this}function ca(c, l, a) {
a = c["_leaflet_" + l + a];
return "touchstart" === l
    ? c.removeEventListener(Hb, a, !1)
    : "touchmove" === l
        ? c.removeEventListener(Ib, a, !1)
        : "touchend" === l && (c.removeEventListener(Jb, a, !1), c.removeEventListener(Kb, a, !1)),
this}function ja(c, l, a) {
var b = g(function (c) {
    if ("mouse" !== c
        .pointerType && c
        .MSPOINTER_TYPE_MOUSE && c
        .pointerType !== c
        .MSPOINTER_TYPE_MOUSE) {
        if (!(0 > sd.indexOf(c.target.tagName))) 
            return;
        
        ea(c)
    }
    ya(c, l)
});
c["_leaflet_touchstart" + a] = b;
c.addEventListener(Hb, b, !1);
Bc || (document.documentElement.addEventListener(Hb, ba, !0), document.documentElement.addEventListener(Ib, Ea, !0), document.documentElement.addEventListener(Jb, sa, !0), document.documentElement.addEventListener(Kb, sa, !0), Bc =! 0)}function ba(c) {
La[c.pointerId] = c;
Lb ++}function Ea(c) {
La[c.pointerId] && (La[c.pointerId] = c)}function sa(c) {
delete La[c.pointerId];
Lb --}function ya(c, l) {
c.touches = [];
for (var a in La) 
    c.touches.push(La[a]);

c.changedTouches = [c];
l(c)}function Da(c, l, a) {
var b = function (c) {
    (c
        .pointerType !== c
        .MSPOINTER_TYPE_MOUSE && "mouse" !== c
        .pointerType || 0 !== c
        .buttons) && ya(c, l)
};
c["_leaflet_touchmove" + a] = b;
c.addEventListener(Ib, b, !1)}function Z(c, l, a) {
var b = function (c) {
    ya(c, l)
};
c["_leaflet_touchend" + a] = b;
c.addEventListener(Jb, b, !1);
c.addEventListener(Kb, b, !1)}function Cc(c, l, a) {
function b(c) {
    if (ka) {
        if (!Za || "mouse" === c.pointerType) 
            return;
        
        var l = Lb
    } else 
        l = c.touches.length;
    
    if (!(1l)) {
        l = Date.now();
        var a = l - (B || l);
        d = c.touches
            ? c.touches[0]
            : c;
        m = 0a && a <= h;
        B = l
    }
}
function e(c) {
    if (m && ! d.cancelBubble) {
        if (ka) {
            if (!Za || "mouse" === c.pointerType) 
                return;
            
            var a,
                b = {};
            for (a in d) 
                c = d[a],
                b[a] = c && c.bind
                    ? c.bind(d)
                    : c;
            
            d = b
        }
        d.type = "dblclick";
        l(d);
        B = null
    }
}
var B,
    d,
    m = !1,
    h = 250;
return c[Ma + ob + a] = b,
c[Ma + pb + a] = e,
c[Ma + "dblclick" + a] = l,
c.addEventListener(ob, b, !1),
c.addEventListener(pb, e, !1),
c.addEventListener("dblclick", l, !1),
this}function Dc(c, l) {
var a = c[Ma + pb + l],
    b = c[Ma + "dblclick" + l];
return c.removeEventListener(ob, c[Ma + ob + l], !1),
c.removeEventListener(pb, a, !1),
Za || c.removeEventListener("dblclick", b, !1),
this}function K(c, l, a, b) {
if ("object" == typeof l) 
    for (var e in l) 
        qb(c, e, l[e], a);
    
 else {
    e = 0;
    for (var B =( l = r(l)).length; eB; e++) 
        qb(c, l[e], a, b)
    
}
return this}function U(c, l, a, b) {
if ("object" == typeof l) 
    for (var e in l) 
        Mb(c, e, l[e], a);
    
 else if (l) {
    e = 0;
    for (var B =( l = r(l)).length; eB; e++) 
        Mb(c, l[e], a, b)
    
} else {
    for (B in c[la]) 
        Mb(c, B, c[la][B]);
    
    delete c[la]
}
return this}function qb(c, l, a, b) {
var e = l + f(a) + (
    b
    ? "_" + f(b)
    : "");
if (c[la] && c[la][e]) 
    return this;

var B = function (l) {
        return a.call(b || c, l || window.event)
    },
    d = B;
ka && 0 === l.indexOf("touch")
    ? X(c, l, B, e)
    : !oa || "dblclick" !== l || ! Cc || ka && $a
        ? "addEventListener" in c
            ? "mousewheel" === l
                ? c.addEventListener(
                    "onwheel" in c
                    ? "wheel"
                    : "mousewheel",
                B,
                !1)
                : "mouseenter" === l || "mouseleave" === l
                    ? (B = function (l) {
                        l = l || window.event;
                        rb(c, l) && d(l)
                    }, c.addEventListener(
                        "mouseenter" === l
                        ? "mouseover"
                        : "mouseout",
                    B,
                    !1))
                    : ("click" === l && Na && (B = function (c) {
                        var l = c
                                .timeStamp || c
                                .originalEvent && c
                                .originalEvent
                                .timeStamp,
                            a = Nb && l - Nb;
                        a && 100a && 500 > a || c
                            .target
                            ._simulatedClick && ! c
                            ._simulated
                                ? pa(c)
                                : (Nb = l, d(c))
                    }), c.addEventListener(l, B, !1))
            : "attachEvent" in c && c.attachEvent("on" + l, B)
        : Cc(c, B, e);
c[la] = c[la] || {};
c[la][e] = B}function Mb(c, l, a, b) {
a = l + f(a) + (
    b
    ? "_" + f(b)
    : "");
b = c[la] && c[la][a];
if (! b) 
    return this;

ka && 0 === l.indexOf("touch")
    ? ca(c, l, a)
    : !oa || "dblclick" !== l || ! Dc || ka && $a
        ? "removeEventListener" in c
            ? "mousewheel" === l
                ? c.removeEventListener(
                    "onwheel" in c
                    ? "wheel"
                    : "mousewheel",
                b,
                !1)
                : c.removeEventListener(
                    "mouseenter" === l
                    ? "mouseover"
                    : "mouseleave" === l
                        ? "mouseout"
                        : l,
                b,
                !1)
            : "detachEvent" in c && c.detachEvent("on" + l, b)
        : Dc(c, a);
c[la][a] = null}function Fa(c) {
return c
        .stopPropagation
        ? c
        .stopPropagation()
        : c
        .originalEvent
            ? c
                .originalEvent
                ._stopped = !0
            : c
                .cancelBubble = !0,
Ob(c),
this}function Pb(c) {
return qb(c, "mousewheel", Fa),
this}function ab(c) {
return K(c, "mousedown touchstart dblclick", Fa),
qb(c, "click", Qb),
this}function ea(c) {
return c
        .preventDefault
        ? c
        .preventDefault()
        : c
        .returnValue = !1,
this}function pa(c) {
return ea(c),
Fa(c),
this}function Ec(c, l) {
if (! l) 
    return new C(c.clientX, c.clientY);

var a = l.getBoundingClientRect();
return new C(c
    .clientX / (a.width / l.offsetWidth || 1) - a
    .left - l
    .clientLeft, c
    .clientY / (a.height / l.offsetHeight || 1) - a
    .top - l
    .clientTop)}function Fc(c) {
return Za
    ? c
        .wheelDeltaY / 2
        : c
        .deltaY && 0 === c
        .deltaMode
            ? - c
                .deltaY / td
            : c
                .deltaY && 1 === c
                .deltaMode
                    ? 20 * - c
                        .deltaY
                    : c
                        .deltaY && 2 === c
                        .deltaMode
                            ? 60 * - c
                                .deltaY
                            : c
                                .deltaX || c
                                .deltaZ
                                    ? 0
                                    : c
                                        .wheelDelta
                                            ? (c.wheelDeltaY || c.wheelDelta) / 2
                                            : c
                                                .detail && 32765 > Math
                                                .abs(c.detail)
                                                    ? 20 * - c
                                                        .detail
                                                    : c
                                                        .detail
                                                            ? c
                                                                .detail / -32765 * 60
                                                            : 0}function Qb(c) {
Rb[c.type] = !0}function Ob(c) {
var l = Rb[c.type];
return Rb[c.type] = !1,
l}function rb(c, l) {
var a = l.relatedTarget;
if (! a) 
    return !0;

try {
    for (; a && a !== c;) 
        a = a.parentNode
    
} catch (Ld) {
    return !1
}
return a !== c}function Gc(c) {
return "string" == typeof c
    ? document.getElementById(c)
    : c}function bb(c, l) {
var a = c
    .style[l] || c
    .currentStyle && c
    .currentStyle[l];
a && "auto" !== a || !document.defaultView || (
    a =( a = document.defaultView.getComputedStyle(c, null))
    ? a[l]
    : null);
return "auto" === a
    ? null
    : a}function O(c, l, a) {
c = document.createElement(c);
return c.className = l || "",
a && a.appendChild(c),
c}function R(c) {
var l = c.parentNode;
l && l.removeChild(c)}function Sb(c) {
for (; c.firstChild;) 
    c.removeChild(c.firstChild)
}function Oa(c) {
var l = c.parentNode;
l.lastChild !== c && l.appendChild(c)}function Pa(c) {
var l = c.parentNode;
l.firstChild !== c && l.insertBefore(c, l.firstChild)}function Tb(c, l) {
if (void 0 !== c.classList) 
    return c.classList.contains(l);

var a = sb(c);
return 0a.length && (new RegExp("(^|\\s)" + l + "(\\s|$)")).test(a)}function M(c, l) {
if (void 0 !== c.classList) 
    for (var a = r(l), b = 0, e = a.length; be; b++) 
    c.classList.add(a[b]);
 else 
Tb(c, l) || (a = sb(c), Ub(c, (
    a
    ? a + " "
    : "") + l))}function S(c, l) {void 0 !== c
    .classList
    ? c
    .classList
    .remove(l)
: Ub(c, h((" " + sb(c) + " ").replace(" " + l + " ", " ")))}function Ub(c, l) {void 0 === c
    .className
    .baseVal
    ? c
    .className = l
: c
    .className
    .baseVal = l}function sb(c) {return void 0 === c
    .className
    .baseVal
    ? c
    .className
: c
    .className
    .baseVal}function fa(c, l) {if ("opacity" in c.style) 
c.style.opacity = l; else if ("filter" in c.style) 
a: {
    var a = l,
        b = !1;
    try {
        b = c.filters.item("DXImageTransform.Microsoft.Alpha")
    } catch (Md) {
        if (1 === a) 
            break a
        
    }
    a = Math.round(100 * a);
    b
        ? (b.Enabled = 100 !== a, b.Opacity = a)
        : c.style.filter += " progid:DXImageTransform.Microsoft.Alpha(opacity=" + a + ")"
}}function tb(c) {for (var l = document.documentElement.style, a = 0; ac.length; a++) if (c[a] in l) 
return c[a];return !1}function Ga(c, l, a) {l = l || new C(0, 0);c.style[Vb] = (Wb? "translate(" + l.x + "px," + l.y + "px)": "translate3d(" + l.x + "px," + l
.y + "px,0)") + (a? " scale(" + a + ")": "")}function W(c, l) {c._leaflet_pos = l;ha? Ga(c, l): (c.style.left = l
.x + "px", c.style.top = l
.y + "px")}function Ha(c) {return c._leaflet_pos || new C(0, 0)}function Xb() {K(window, "dragstart", ea)}function Yb() {U(window, "dragstart", ea)}function Zb(c) {for (; -1 === c.tabIndex;) c = c.parentNode;c.style && (ub(), vb = c, $b = c.style.outline, c.style.outline = "none", K(window, "keydown", ub))}function ub() {vb && (vb.style.outline = $b, vb = void 0, $b = void 0, U(window, "keydown", ub))}function Hc(c, l) {if (! l || ! c.length) return c.slice();for (var a = l * l, b = c, e =[b[0]], d = 1, m = 0, h = b.length; dh; d++) {var f = b[d],p = b[m],q = p.x - f.x;f = p.y - f.y;q * q + f * f > a && (e.push(b[d]), m = d)}b = c = (mh - 1 && e.push(b[h - 1]), e);e = b.length;d = new("undefined" != typeof Uint8Array? Uint8Array: Array)(e);d[0] = d[e - 1] = 1;ac(b, d, a, 0, e - 1);m = [];for (a = 0; ae; a++) d[a] && m.push(b[a]);return m}function Ic(c, l, a) {return Math.sqrt(cb(c, l, a, !0))}function ac(c, l, a, b, e) {var d,B,m,h = 0;for (B = b + 1; B <= e - 1; B++) (m = cb(c[B], c[b], c[e], !0)) > h && (d = B, h = m);h > a && (l[d] = 1, ac(c, l, a, b, d), ac(c, l, a, d, e))}function Jc(c, l, a, b, e) {var d,B = b? Kc: Ia(c, a),m = Ia(l, a);for (Kc = m;;) {if (!(B | m)) return [c, l];if (B & m) return !1;var h = Ia(d = wb(c, l, b = B || m, a, e), a);b === B? (c = d, B = h): (l = d, m = h)}}function wb(c, l, a, b, e) {var d,B,m = l.x - c.x;l = l.y - c.y;var h = b.min;b = b.max;return 8 & a? (d = c.x + m * (b.y - c.y) / l, B = b.y): 4 & a? (d = c.x + m * (h.y - c.y) / l, B = h.y): 2 & a
? (d = b.x, B = c.y + l * (b.x - c.x) / m)
: 1 & a && (d = h.x, B = c.y + l * (h.x - c.x) / m),new C(d, B, e)}function Ia(c, l) {var a = 0;return c.x l.min.x? a |= 1: c.x > l.max.x && (a |= 2),c.y l.min.y? a |= 4: c.y > l.max.y && (a |= 8),a}function cb(c, l, a, b) {var e,d = l.x;l = l.y;var B = a.x - d,m = a.y - l,h = B * B + m * m;return 0h && (1 < (e =(( c.x - d) * B + (c.y - l) * m) / h)? (d = a.x, l = a.y): 0e && (d += B * e, l += m * e)),B = c.x - d,m = c.y - l,b? B * B + m * m: new C(d, l)}function ta(c) {return !na(c[0]) || "object" != typeof c[0][0] && void 0 !== c[0][0]}function Lc(c) {return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ta(c)}function Mc(c, l, a) {var b,e,d,B,m = [1, 4, 2, 8];var h = 0;for (d = c.length; hd; h++) c[h]._code = Ia(c[h], l);for (e = 0; 4 > e; e++) {var f = m[e];var p = [];h = 0;for (b =( d = c.length) - 1; hd; b = h++) {var q = c[h];b = c[b];q._code & f
? b._code & f || ((B = wb(b, q, f, l, a))._code = Ia(B, l), p.push(B))
: (b._code & f && ((B = wb(b, q, f, l, a))._code = Ia(B, l), p.push(B)), p.push(q))}c = p}return c}function bc(c, l) {var a,b,e = "Feature" === c.type? c.geometry: c,d = e? e.coordinates: null,m = [],h = l && l.pointToLayer,f = l && l.coordsToLatLng || cc;if (! d && ! e) return null;switch (e.type) {case "Point":return a = f(d),h
? h(c, a)
: new db(a);case "MultiPoint":var p = 0;for (b = d.length; pb; p++) 
a = f(d[p]),
m.push(
    h
    ? h(c, a)
    : new db(a));return new Ja(m);case "LineString":case "MultiLineString":return p = xb(
d, "LineString" === e.type
? 0
: 1,f),new ua(p, l);case "Polygon":case "MultiPolygon":return p = xb(
d, "Polygon" === e.type
? 1
: 2,f),new Qa(p, l);case "GeometryCollection": p = 0;for (b = e.geometries.length; pb; p++) 
(a = bc({
    geometry: e.geometries[p],
    type: "Feature",
    properties: c.properties
}, l)) && m.push(a);return new Ja(m);default:throw Error("Invalid GeoJSON object.");}}function cc(c) {return new F(c[1], c[0], c[2])}function xb(c, l, a) {for (var b, e =[], d = 0, B = c.length; dB; d++) b = l? xb(c[d], l - 1, a): (a || cc)(c[d]),e.push(b);return e}function dc(c, l) {return l = "number" == typeof l? l: 6,void 0 !== c.alt? [q(c.lng, l),q(c.lat, l),q(c.alt, l)]: [q(c.lng, l),q(c.lat, l)]}function yb(c, l, a, b) {for (var e =[], d = 0, B = c.length; dB; d++) e.push(l? yb(c[d], l - 1, a, b): dc(c[d], b));return ! l && a && e.push(e[0]),e}function Ra(c, l) {return c.feature? d({}, c.feature, {geometry: l}): zb(l)}function zb(c) {return "Feature" === c.type || "FeatureCollection" === c.type? c: {type: "Feature",properties: {},geometry: c}}function Nc(c, l) {return new va(c, l)}function Oc(c, l) {return new eb(c, l)}function ec(c) {return Pc? new fc(c): null}function gc(c) {return nb || Ab? new Sa(c): null}var Qc = Object.freeze;Object.freeze = function (c) {return c};var mb = Object.create || function () {function c() {}return function (l) {return c.prototype = l,new c}}(),yc = 0,rd = /\{ *([\w_-]+) *\}/g,na = Array.isArray || function (c) {return "[object Array]" === Object.prototype.toString.call(c)},zc = 0,Gb = window.requestAnimationFrame || x("RequestAnimationFrame") || z,Ac = window.cancelAnimationFrame || x("CancelAnimationFrame") || x("CancelRequestAnimationFrame") || function (c) {window.clearTimeout(c)},ud = (Object.freeze || Object)({freeze: Qc,extend: d,create: mb,bind: g,lastId: yc,stamp: f,throttle: b,wrapNum: p,falseFn: e,formatNum: q,trim: h,splitWords: r,setOptions: m,getParamString: t,template: w,isArray: na,indexOf: v,emptyImageUrl: "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=",requestFn: Gb,cancelFn: Ac,requestAnimFrame: y,cancelAnimFrame: u});G.extend = function (c) {var l = function () {this.initialize && this.initialize.apply(this, arguments);this.callInitHooks()},a = l.__super__ = this.prototype,b = mb(a);b.constructor = l;l.prototype = b;for (var e in this) this.hasOwnProperty(e) && "prototype" !== e && "__super__" !== e && (l[e] = this[e]);return c.statics && (d(l, c.statics), delete c.statics),c.includes && (P(c.includes), d.apply(null, [b].concat(c.includes)), delete c.includes),b.options && (c.options = d(mb(b.options), c.options)),d(b, c),b._initHooks = [],b.callInitHooks = function () {if (!this._initHooksCalled) {a.callInitHooks && a.callInitHooks.call(this);this._initHooksCalled = !0;for (var c = 0, l = b._initHooks.length; cl; c++) b._initHooks[c].call(this)}},l};G.include = function (c) {return d(this.prototype, c),this};G.mergeOptions = function (c) {return d(this.prototype.options, c),this};G.addInitHook = function (c) {var l = Array.prototype.slice.call(arguments, 1);return this.prototype._initHooks = this.prototype._initHooks || [],this.prototype._initHooks.push("function" == typeof c? c: function () {this[c].apply(this, l)}),this};var da = {on: function (c, l, a) {if ("object" == typeof c) for (var b in c) this._on(b, c[b], l); else {b = 0;for (var e =( c = r(c)).length; be; b++) this._on(c[b], l, a)}return this},off: function (c, l, a) {if (c) if ("object" == typeof c) for (var b in c) this._off(b, c[b], l); else {b = 0;for (var e =( c = r(c)).length; be; b++) this._off(c[b], l, a)} else delete this._events;return this},_on: function (c, l, a) {this._events = this._events || {};var b = this._events[c];b || (b =[], this._events[c] = b);a === this && (a = void 0);c = {fn: l,ctx: a};for (var e = 0, d = b.length; ed; e++) if (b[e].fn === l && b[e].ctx === a) return;b.push(c)},_off: function (c, l, a) {var b,d;if (this._events && (b = this._events[c])) if (l) {if (a === this && (a = void 0), b) {var m = 0;for (d = b.length; md; m++) {var B = b[m];if (B.ctx === a && B.fn === l) return B.fn = e,this._firingCount && (this._events[c] = b = b.slice()),void b.splice(m, 1)}}} else {m = 0;for (d = b.length; md; m++) b[m].fn = e;delete this._events[c]}},fire: function (c, l, a) {if (!this.listens(c, a)) return this;l = d({}, l, {type: c,target: this,sourceTarget: l && l.sourceTarget || this});if (this._events && (c = this._events[c])) {this._firingCount = this._firingCount + 1 || 1;for (var b = 0, e = c.length; be; b++) {var m = c[b];m.fn.call(m.ctx || this, l)}this._firingCount --}return a && this._propagateEvent(l),this},listens: function (c, l) {var a = this._events && this._events[c];if (a && a.length) return !0;if (l) for (var b in this._eventParents) if (this._eventParents[b].listens(c, l)) return !0;return !1},once: function (c, l, a) {if ("object" == typeof c) {for (var b in c) this.once(b, c[b], l);return this}var e = g(function () {this.off(c, l, a).off(c, e, a)}, this);return this.on(c, l, a).on(c, e, a)},addEventParent: function (c) {return this._eventParents = this._eventParents || {},this._eventParents[f(c)] = c,this},removeEventParent: function (c) {return this._eventParents && delete this._eventParents[f(c)],this},_propagateEvent: function (c) {for (var l in this._eventParents) this._eventParents[l].fire(c.type, d({layer: c.target,propagatedFrom: c.target}, c), !0)} }; da.addEventListener = da.on; da .removeEventListener = da .clearAllEventListeners = da.off; da.addOneTimeEventListener = da.once; da.fireEvent = da.fire; da.hasEventListeners = da.listens; var fb = G.extend(da),Rc = Math.trunc || function (c) {return 0c? Math.floor(c): Math.ceil(c)}; C.prototype = {clone: function () {return new C(this.x, this.y)},add: function (c) {return this.clone()._add(E(c))},_add: function (c) {return this.x += c.x,this.y += c.y,this},subtract: function (c) {return this.clone()._subtract(E(c))},_subtract: function (c) {return this.x -= c.x,this.y -= c.y,this},divideBy: function (c) {return this.clone()._divideBy(c)},_divideBy: function (c) {return this.x /= c,this.y /= c,this},multiplyBy: function (c) {return this.clone()._multiplyBy(c)},_multiplyBy: function (c) {return this.x *= c,this.y *= c,this},scaleBy: function (c) {return new C(this.x * c.x, this.y * c.y)},unscaleBy: function (c) {return new C(this.x / c.x, this.y / c.y)},round: function () {return this.clone()._round()},_round: function () {return this.x = Math.round(this.x),this.y = Math.round(this.y),this},floor: function () {return this.clone()._floor()},_floor: function () {return this.x = Math.floor(this.x),this.y = Math.floor(this.y),this},ceil: function () {return this.clone()._ceil()},_ceil: function () {return this.x = Math.ceil(this.x),this.y = Math.ceil(this.y),this},trunc: function () {return this.clone()._trunc()},_trunc: function () {return this.x = Rc(this.x),this.y = Rc(this.y),this},distanceTo: function (c) {var l = (c = E(c)).x - this.x;c = c.y - this.y;return Math.sqrt(l * l + c * c)},equals: function (c) {return(c = E(c)).x === this.x && c.y === this.y},contains: function (c) {return c = E(c),Math.abs(c.x) <= Math.abs(this.x) && Math.abs(c.y) <= Math.abs(this.y)},toString: function () {return "Point(" + q(this.x) + ", " + q(this.y) + ")"} }; H.prototype = {extend: function (c) {return c = E(c),this.min || this.max? (this.min.x = Math.min(c.x, this.min.x), this.max.x = Math.max(c.x, this.max.x), this.min.y = Math.min(c.y, this.min.y), this.max.y = Math.max(c.y, this.max.y)): (this.min = c.clone(), this.max = c.clone()),this},getCenter: function (c) {return new C((this.min.x + this.max.x) / 2, (this.min.y + this.max.y) / 2, c)},getBottomLeft: function () {return new C(this.min.x, this.max.y)},getTopRight: function () {return new C(this.max.x, this.min.y)},getTopLeft: function () {return this.min},getBottomRight: function () {return this.max},getSize: function () {return this.max.subtract(this.min)},contains: function (c) {var l,a;return(c = "number" == typeof c[0] || c instanceof C? E(c): I(c))instanceof H? (l = c.min, a = c.max): l = a = c,l.x >= this.min.x && a.x <= this.max.x && l.y >= this.min.y && a.y <= this.max.y},intersects: function (c) {c = I(c);var l = this.min,a = this.max,b = c.min;c = c.max;var e = c.y >= l.y && b.y <= a.y;return c.x >= l.x && b.x <= a.x && e},overlaps: function (c) {c = I(c);var l = this.min,a = this.max,b = c.min;c = c.max;var e = c.y > l.y && b.y a.y;return c.x > l.x && b.x a.x && e},isValid: function () {return !(!this.min || !this.max)} }; D.prototype = {extend: function (c) {var l,a = this._southWest,b = this._northEast;if (c instanceof F) var e = l = c; else {if (!(c instanceof D)) return c? this.extend(J(c) || A(c)): this;if (l = c._southWest, e = c._northEast, ! l || ! e) return this}return a || b? (a.lat = Math.min(l.lat, a.lat), a.lng = Math.min(l.lng, a.lng), b.lat = Math.max(e.lat, b.lat), b.lng = Math.max(e.lng, b.lng)): (this._southWest = new F(l.lat, l.lng), this._northEast = new F(e.lat, e.lng)),this},pad: function (c) {var l = this._southWest,a = this._northEast,b = Math.abs(l.lat - a.lat) * c;c *= Math.abs(l.lng - a.lng);return new D(new F(l.lat - b, l.lng - c), new F(a.lat + b, a.lng + c))},getCenter: function () {return new F((this._southWest.lat + this._northEast.lat) / 2, (this._southWest.lng + this._northEast.lng) / 2)},getSouthWest: function () {return this._southWest},getNorthEast: function () {return this._northEast},getNorthWest: function () {return new F(this.getNorth(), this.getWest())},getSouthEast: function () {return new F(this.getSouth(), this.getEast())},getWest: function () {return this._southWest.lng},getSouth: function () {return this._southWest.lat},getEast: function () {return this._northEast.lng},getNorth: function () {return this._northEast.lat},contains: function (c) {c = "number" == typeof c[0] || c instanceof F || "lat" in c? J(c): A(c);var l,a,b = this._southWest,e = this._northEast;return c instanceof D? (l = c.getSouthWest(), a = c.getNorthEast()): l = a = c,l.lat >= b.lat && a.lat <= e.lat && l.lng >= b.lng && a.lng <= e.lng},intersects: function (c) {c = A(c);var l = this._southWest,a = this._northEast,b = c.getSouthWest();c = c.getNorthEast();var e = c.lng >= l.lng && b.lng <= a.lng;return c.lat >= l.lat && b.lat <= a.lat && e},overlaps: function (c) {c = A(c);var l = this._southWest,a = this._northEast,b = c.getSouthWest();c = c.getNorthEast();var e = c.lng > l.lng && b.lng a.lng;return c.lat > l.lat && b.lat a.lat && e},toBBoxString: function () {return [this.getWest(), this.getSouth(), this.getEast(), this.getNorth()].join()},equals: function (c, l) {return !! c && (c = A(c), this._southWest.equals(c.getSouthWest(), l) && this._northEast.equals(c.getNorthEast(), l))},isValid: function () {return !(!this._southWest || !this._northEast)} }; F.prototype = {equals: function (c, l) {return !! c && (c = J(c), Math.max(Math.abs(this.lat - c.lat), Math.abs(this.lng - c.lng)) <= (void 0 === l? 1E-9: l))},toString: function (c) {return "LatLng(" + q(this.lat, c) + ", " + q(this.lng, c) + ")"},distanceTo: function (c) {return za.distance(this, J(c))},wrap: function () {return za.wrapLatLng(this)},toBounds: function (c) {c = 180 * c / 40075017;var l = c / Math.cos(Math.PI / 180 * this.lat);return A([this.lat - c,this.lng - l], [this.lat + c,this.lng + l])},clone: function () {return new F(this.lat, this.lng, this.alt)} }; var wa = {latLngToPoint: function (c, l) {var a = this.projection.project(c),b = this.scale(l);return this.transformation._transform(a, b)},pointToLatLng: function (c, l) {var a = this.scale(l);a = this.transformation.untransform(c, a);return this.projection.unproject(a)},project: function (c) {return this.projection.project(c)},unproject: function (c) {return this.projection.unproject(c)},scale: function (c) {return 256 * Math.pow(2, c)},zoom: function (c) {return Math.log(c / 256) / Math.LN2},getProjectedBounds: function (c) {if (this.infinite) return null;var l = this.projection.bounds;c = this.scale(c);return new H(this.transformation.transform(l.min, c), this.transformation.transform(l.max, c))},infinite: !1,wrapLatLng: function (c) {var l = this.wrapLng? p(c.lng, this.wrapLng, !0): c.lng;return new F(this.wrapLat? p(c.lat, this.wrapLat, !0): c.lat,l,c.alt)},wrapLatLngBounds: function (c) {var l = c.getCenter(),a = this.wrapLatLng(l),b = l.lat - a.lat;l = l.lng - a.lng;if (0 === b && 0 === l) return c;a = c.getSouthWest();c = c.getNorthEast();return new D(new F(a.lat - b, a.lng - l), new F(c.lat - b, c.lng - l))}},za = d({}, wa, {wrapLng: [-180, 180],R: 6371E3,distance: function (c, l) {var a = Math.PI / 180,b = Math.sin((l.lat - c.lat) * a / 2),e = Math.sin((l.lng - c.lng) * a / 2);a = b * b + Math.cos(c.lat * a) * Math.cos(l.lat * a) * e * e;return 2 * this.R * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))}}),hc = {R: 6378137,MAX_LATITUDE: 85.0511287798,project: function (c) {var l = Math.PI / 180,a = this.MAX_LATITUDE;a = Math.sin(Math.max(Math.min(a, c.lat), - a) * l);return new C(this.R * c.lng * l, this.R * Math.log((1 + a) / (1 - a)) / 2)},unproject: function (c) {var l = 180 / Math.PI;return new F((2 * Math.atan(Math.exp(c.y / this.R)) - Math.PI / 2) * l, c.x * l / this.R)},bounds: function () {var c = 6378137 * Math.PI;return new H([- c, - c], [c, c])}()}; aa.prototype = {transform: function (c, l) {return this._transform(c.clone(), l)},_transform: function (c, l) {return l = l || 1,c.x = l * (this._a * c.x + this._b),c.y = l * (this._c * c.y + this._d),c},untransform: function (c, l) {return l = l || 1,new C((c.x / l - this._b) / this._a, (c.y / l - this._d) / this._c)} }; var Nb,ic,jc = d({}, za, {code: "EPSG:3857",projection: hc,transformation: function () {var c = .5 / (Math.PI * hc.R);return Q(c, .5, - c, .5)}()}),vd = d({}, jc, {code: "EPSG:900913"}),kc = document.documentElement.style,Bb = "ActiveXObject" in window,Ta = Bb && !document.addEventListener,Za = "msLaunchUri" in navigator && !("documentMode" in document),lc = T("webkit"),Na = T("android"),gb = T("android 2") || T("android 3"),wd = parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1], 10),Sc = Na && T("Google") && 537 > wd && !("AudioNode" in window),mc = !!window.opera,$a = T("chrome"),nc = T("gecko") && ! lc && ! mc && ! Bb,Tc = ! $a && T("safari"),Uc = T("phantom"),Vc = "OTransition" in kc,Wc = 0 === navigator.platform.indexOf("Win"),Wb = Bb && "transition" in kc,oc = "WebKitCSSMatrix" in window && "m11" in new window.WebKitCSSMatrix && ! gb,Xc = "MozPerspective" in kc,ha = !window.L_DISABLE_3D && (Wb || oc || Xc) && ! Vc && ! Uc,Ua = "undefined" != typeof orientation || T("mobile"),xd = Ua && lc,yd = Ua && oc,Aa = !window.PointerEvent && window.MSPointerEvent,ka = !(!window.PointerEvent && ! Aa),oa = !window.L_NO_TOUCH && (ka || "ontouchstart" in window || window.DocumentTouch && document instanceof window.DocumentTouch),Yc = Ua && mc,zd = Ua && nc,Ba = 1 < (window.devicePixelRatio || window.screen.deviceXDPI / window.screen.logicalXDPI),Pc = !!document.createElement("canvas").getContext,nb = !(!document.createElementNS || ! V("svg").createSVGRect),Ab = ! nb && function () {try {var c = document.createElement("div");c.innerHTML = '<v:shape adj="1"/>';var l = c.firstChild;return l.style.behavior = "url(#default#VML)",l && "object" == typeof l.adj} catch (B) {return !1}}(),Ad = (Object.freeze || Object)({ie: Bb,ielt9: Ta,edge: Za,webkit: lc,android: Na,android23: gb,androidStock: Sc,opera: mc,chrome: $a,gecko: nc,safari: Tc,phantom: Uc,opera12: Vc,win: Wc,ie3d: Wb,webkit3d: oc,gecko3d: Xc,any3d: ha,mobile: Ua,mobileWebkit: xd,mobileWebkit3d: yd,msPointer: Aa,pointer: ka,touch: oa,mobileOpera: Yc,mobileGecko: zd,retina: Ba,canvas: Pc,svg: nb,vml: Ab}),Hb = Aa? "MSPointerDown": "pointerdown",Ib = Aa? "MSPointerMove": "pointermove",Jb = Aa? "MSPointerUp": "pointerup",Kb = Aa? "MSPointerCancel": "pointercancel",sd = ["INPUT", "SELECT", "OPTION"],La = {},Bc = !1,Lb = 0,ob = Aa? "MSPointerDown": ka? "pointerdown": "touchstart",pb = Aa? "MSPointerUp": ka? "pointerup": "touchend",Ma = "_leaflet_",la = "_leaflet_events",td = Wc && $a? 2 * window.devicePixelRatio: nc? window.devicePixelRatio: 1,Rb = {},Bd = (Object.freeze || Object)({on: K,off: U,stopPropagation: Fa,disableScrollPropagation: Pb,disableClickPropagation: ab,preventDefault: ea,stop: pa,getMousePosition: Ec,getWheelDelta: Fc,fakeStop: Qb,skipped: Ob,isExternalTarget: rb,addListener: K,removeListener: U}),Vb = tb(["transform", "WebkitTransform", "OTransform", "MozTransform", "msTransform"]),hb = tb(["webkitTransition", "transition", "OTransition", "MozTransition", "msTransition"]),Zc = "webkitTransition" === hb || "OTransition" === hb? hb + "End": "transitionend"; if ("onselectstart" in document) {var Cb = function () {K(window, "selectstart", ea)};var Db = function () {U(window, "selectstart", ea)} } else {var ib = tb(["userSelect", "WebkitUserSelect", "OUserSelect", "MozUserSelect", "msUserSelect"]);Cb = function () {if (ib) {var c = document.documentElement.style;ic = c[ib];c[ib] = "none"}};Db = function () {ib && (document.documentElement.style[ib] = ic, ic = void 0)} } var vb,$b,Cd = (Object.freeze || Object)({TRANSFORM: Vb,TRANSITION: hb,TRANSITION_END: Zc,get: Gc,getStyle: bb,create: O,remove: R,empty: Sb,toFront: Oa,toBack: Pa,hasClass: Tb,addClass: M,removeClass: S,setClass: Ub,getClass: sb,setOpacity: fa,testProp: tb,setTransform: Ga,setPosition: W,getPosition: Ha,disableTextSelection: Cb,enableTextSelection: Db,disableImageDrag: Xb,enableImageDrag: Yb,preventOutline: Zb,restoreOutline: ub}),$c = fb.extend({run: function (c, l, a, b) {this.stop();this._el = c;this._inProgress = !0;this._duration = a || .25;this._easeOutPower = 1 / Math.max(b || .5, .2);this._startPos = Ha(c);this._offset = l.subtract(this._startPos);this._startTime = + new Date;this.fire("start");this._animate()},stop: function () {this._inProgress && (this._step(!0), this._complete())},_animate: function () {this._animId = y(this._animate, this);this._step()},_step: function (c) {var l = + new Date - this._startTime,a = 1E3 * this._duration;la? this._runFrame(this._easeOut(l / a), c): (this._runFrame(1), this._complete())},_runFrame: function (c, l) {var a = this._startPos.add(this._offset.multiplyBy(c));l && a._round();W(this._el, a);this.fire("step")},_complete: function () {u(this._animId);this._inProgress = !1;this.fire("end")},_easeOut: function (c) {return 1 - Math.pow(1 - c, this._easeOutPower)}}),N = fb.extend({options: {crs: jc,center: void 0,zoom: void 0,minZoom: void 0,maxZoom: void 0,layers: [],maxBounds: void 0,renderer: void 0,zoomAnimation: !0,zoomAnimationThreshold: 4,fadeAnimation: !0,markerZoomAnimation: !0,transform3DLimit: 8388608,zoomSnap: 1,zoomDelta: 1,trackResize: !0},initialize: function (c, l) {l = m(this, l);this._initContainer(c);this._initLayout();this._onResize = g(this._onResize, this);this._initEvents();l.maxBounds && this.setMaxBounds(l.maxBounds);void 0 !== l.zoom && (this._zoom = this._limitZoom(l.zoom));l.center && void 0 !== l.zoom && this.setView(J(l.center), l.zoom, {reset: !0});this._handlers = [];this._layers = {};this._zoomBoundLayers = {};this._sizeChanged = !0;this.callInitHooks();(this._zoomAnimated = hb && ha && ! Yc && this.options.zoomAnimation) && (this._createAnimProxy(), K(this._proxy, Zc, this._catchTransitionEnd, this));this._addLayers(this.options.layers)},setView: function (c, l, a) {return l = void 0 === l? this._zoom: this._limitZoom(l),c = this._limitCenter(J(c), l, this.options.maxBounds),a = a || {},this._stop(),this._loaded && ! a.reset && !0 !== a && (void 0 !== a.animate && (a.zoom = d({animate: a.animate}, a.zoom), a.pan = d({animate: a.animate,duration: a.duration}, a.pan)), this._zoom !== l? this._tryAnimatedZoom && this._tryAnimatedZoom(c, l, a.zoom): this._tryAnimatedPan(c, a.pan))? (clearTimeout(this._sizeTimer), this): (this._resetView(c, l), this)},setZoom: function (c, l) {return this._loaded? this.setView(this.getCenter(), c, {zoom: l}): (this._zoom = c, this)},zoomIn: function (c, l) {return c = c || (ha? this.options.zoomDelta: 1),this.setZoom(this._zoom + c, l)},zoomOut: function (c, l) {return c = c || (ha? this.options.zoomDelta: 1),this.setZoom(this._zoom - c, l)},setZoomAround: function (c, l, a) {var b = this.getZoomScale(l),e = this.getSize().divideBy(2);c = (c instanceof C? c: this.latLngToContainerPoint(c)).subtract(e).multiplyBy(1 - 1 / b);e = this.containerPointToLatLng(e.add(c));return this.setView(e, l, {zoom: a})},_getBoundsCenterZoom: function (c, l) {l = l || {};c = c.getBounds? c.getBounds(): A(c);var a = E(l.paddingTopLeft || l.padding || [0, 0]),b = E(l.paddingBottomRight || l.padding || [0, 0]),e = this.getBoundsZoom(c, !1, a.add(b));if ((e = "number" == typeof l.maxZoom? Math.min(l.maxZoom, e): e) === 1 / 0) return {center: c.getCenter(), zoom: e};a = b.subtract(a).divideBy(2);b = this.project(c.getSouthWest(), e);var d = this.project(c.getNorthEast(), e);return {center: this.unproject(b.add(d).divideBy(2).add(a), e),zoom: e}},fitBounds: function (c, l) {if (!(c = A(c)).isValid()) throw Error("Bounds are not valid.");var a = this._getBoundsCenterZoom(c, l);return this.setView(a.center, a.zoom, l)},fitWorld: function (c) {return this.fitBounds([[-90, -180],[90, 180]], c)},panTo: function (c, l) {return this.setView(c, this._zoom, {pan: l})},panBy: function (c, l) {if (c = E(c).round(), l = l || {}, ! c.x && ! c.y) return this.fire("moveend");if (!0 !== l.animate && !this.getSize().contains(c)) return this._resetView(this.unproject(this.project(this.getCenter()).add(c)), this.getZoom()),this;if (this._panAnim || (this._panAnim = new $c, this._panAnim.on({step: this._onPanTransitionStep,end: this._onPanTransitionEnd}, this)), l.noMoveStart || this.fire("movestart"), !1 !== l.animate) {M(this._mapPane, "leaflet-pan-anim");var a = this._getMapPanePos().subtract(c).round();this._panAnim.run(this._mapPane, a, l.duration || .25, l.easeLinearity)} else this._rawPanBy(c),this.fire("move").fire("moveend");return this},flyTo: function (c, l, a) {function b(c) {c = (g * g - r * r + (c? -1: 1) * v * v * t * t) / (2 * (c? g: r) * v * t);c = Math.sqrt(c * c + 1) - c;return 1E-9 > c? -18: Math.log(c)}function e(c) {return(Math.exp(c) + Math.exp(- c)) / 2}function d(c) {return r * (e(u) / e(u + w * c))}function m(c) {var l = r,a = e(u);c = u + w * c;c = (Math.exp(c) - Math.exp(- c)) / 2 / e(c);return l * (a * c - (Math.exp(u) - Math.exp(- u)) / 2) / v}function h() {var a = (Date.now() - x) / ca,b = (1 - Math.pow(1 - a, 1.5)) * z;1 >= a? (this._flyToFrame = y(h, this), this._move(this.unproject(f.add(p.subtract(f).multiplyBy(m(b) / t)), q), this.getScaleZoom(r / d(b), q), {flyTo: !0})): this._move(c, l)._moveEnd(!0)}if (!1 === (a = a || {}).animate || ! ha) return this.setView(c, l, a);this._stop();var f = this.project(this.getCenter()),p = this.project(c),B = this.getSize(),q = this._zoom;c = J(c);l = void 0 === l? q: l;var r = Math.max(B.x, B.y),g = r * this.getZoomScale(q, l),t = p.distanceTo(f) || 1,w = 1.42,v = w * w,u = b(0),x = Date.now(),z = (b(1) - u) / w,ca = a.duration? 1E3 * a.duration: 800 * z;return this._moveStart(!0, a.noMoveStart),h.call(this),this},flyToBounds: function (c, l) {var a = this._getBoundsCenterZoom(c, l);return this.flyTo(a.center, a.zoom, l)},setMaxBounds: function (c) {return(c = A(c)).isValid()? (this.options.maxBounds && this.off("moveend", this._panInsideMaxBounds), this.options.maxBounds = c, this._loaded && this._panInsideMaxBounds(), this.on("moveend", this._panInsideMaxBounds)): (this.options.maxBounds = null, this.off("moveend", this._panInsideMaxBounds))},setMinZoom: function (c) {var l = this.options.minZoom;return this.options.minZoom = c,this._loaded && l !== c && (this.fire("zoomlevelschange"), this.getZoom()this.options.minZoom)? this.setZoom(c): this},setMaxZoom: function (c) {var l = this.options.maxZoom;return this.options.maxZoom = c,this._loaded && l !== c && (this.fire("zoomlevelschange"), this.getZoom() > this.options.maxZoom)? this.setZoom(c): this},panInsideBounds: function (c, l) {this._enforcingBounds = !0;var a = this.getCenter(),b = this._limitCenter(a, this._zoom, A(c));return a.equals(b) || this.panTo(b, l),this._enforcingBounds = !1,this},invalidateSize: function (c) {if (!this._loaded) return this;c = d({animate: !1,pan: !0}, !0 === c? {animate: !0}: c);var l = this.getSize();this._sizeChanged = !0;this._lastCenter = null;var a = this.getSize(),b = l.divideBy(2).round(),e = a.divideBy(2).round();b = b.subtract(e);return b.x || b.y? (c.animate && c.pan? this.panBy(b): (c.pan && this._rawPanBy(b), this.fire("move"), c.debounceMoveend? (clearTimeout(this._sizeTimer), this._sizeTimer = setTimeout(g(this.fire, this, "moveend"), 200)): this.fire("moveend")),this.fire("resize", {oldSize: l,newSize: a})): this},stop: function () {return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap || this.fire("viewreset"),this._stop()},locate: function (c) {if (c = this._locateOptions = d({timeout: 1E4,watch: !1}, c), !("geolocation" in navigator)) return this._handleGeolocationError({code: 0, message: "Geolocation not supported."}),this;var l = g(this._handleGeolocationResponse, this),a = g(this._handleGeolocationError, this);return c.watch? this._locationWatchId = navigator.geolocation.watchPosition(l, a, c): navigator.geolocation.getCurrentPosition(l, a, c),this},stopLocate: function () {return navigator.geolocation && navigator.geolocation.clearWatch && navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions && (this._locateOptions.setView =! 1),this},_handleGeolocationError: function (c) {var l = c.code;c = c.message || (1 === l? "permission denied": 2 === l? "position unavailable": "timeout");this._locateOptions.setView && !this._loaded && this.fitWorld();this.fire("locationerror", {code: l,message: "Geolocation error: " + c + "."})},_handleGeolocationResponse: function (c) {var l = new F(c.coords.latitude, c.coords.longitude),a = l.toBounds(c.coords.accuracy),b = this._locateOptions;if (b.setView) {var e = this.getBoundsZoom(a);this.setView(l, b.maxZoom? Math.min(e, b.maxZoom): e)}l = {latlng: l,bounds: a,timestamp: c.timestamp};for (var d in c.coords) "number" == typeof c.coords[d] && (l[d] = c.coords[d]);this.fire("locationfound", l)},addHandler: function (c, l) {if (! l) return this;var a = this[c] = new l(this);return this._handlers.push(a),this.options[c] && a.enable(),this},remove: function () {if (this._initEvents(!0), this._containerId !== this._container._leaflet_id) throw Error("Map container is being reused by another instance");try {delete this._container._leaflet_id,delete this._containerId} catch (l) {this._containerId = this._container._leaflet_id = void 0}void 0 !== this._locationWatchId && this.stopLocate();this._stop();R(this._mapPane);this._clearControlPos && this._clearControlPos();this._clearHandlers();this._loaded && this.fire("unload");for (var c in this._layers) this._layers[c].remove();for (c in this._panes) R(this._panes[c]);return this._layers = [],this._panes = [],delete this._mapPane,delete this._renderer,this},createPane: function (c, l) {var a = O("div", "leaflet-pane" + (c? " leaflet-" + c.replace("Pane", "") + "-pane": ""), l || this._mapPane);return c && (this._panes[c] = a),a},getCenter: function () {return this._checkIfLoaded(),this._lastCenter && !this._moved()? this._lastCenter: this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom: function () {return this._zoom},getBounds: function () {var c = this.getPixelBounds();return new D(this.unproject(c.getBottomLeft()), this.unproject(c.getTopRight()))},getMinZoom: function () {return void 0 === this.options.minZoom? this._layersMinZoom || 0: this.options.minZoom},getMaxZoom: function () {return void 0 === this.options.maxZoom? void 0 === this._layersMaxZoom? 1 / 0: this._layersMaxZoom: this.options.maxZoom},getBoundsZoom: function (c, l, a) {c = A(c);a = E(a || [0, 0]);var b = this.getZoom() || 0,e = this.getMinZoom(),d = this.getMaxZoom(),m = c.getNorthWest();c = c.getSouthEast();a = this.getSize().subtract(a);var h = I(this.project(c, b), this.project(m, b)).getSize();m = ha? this.options.zoomSnap: 1;c = a.x / h.x;a = a.y / h.y;return b = this.getScaleZoom(l? Math.max(c, a): Math.min(c, a),b),m && (b = m / 100 * Math.round(b / (m / 100)), b = l? Math.ceil(b / m) * m: Math.floor(b / m) * m),Math.max(e, Math.min(d, b))},getSize: function () {return this._size && !this._sizeChanged || (this._size = new C(this._container.clientWidth || 0, this._container.clientHeight || 0), this._sizeChanged =! 1),this._size.clone()},getPixelBounds: function (c, l) {var a = this._getTopLeftPoint(c, l);return new H(a, a.add(this.getSize()))},getPixelOrigin: function () {return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds: function (c) {return this.options.crs.getProjectedBounds(void 0 === c? this.getZoom(): c)},getPane: function (c) {return "string" == typeof c? this._panes[c]: c},getPanes: function () {return this._panes},getContainer: function () {return this._container},getZoomScale: function (c, l) {var a = this.options.crs;return l = void 0 === l? this._zoom: l,a.scale(c) / a.scale(l)},getScaleZoom: function (c, l) {var a = this.options.crs;l = void 0 === l? this._zoom: l;a = a.zoom(c * a.scale(l));return isNaN(a)? 1 / 0: a},project: function (c, l) {return l = void 0 === l? this._zoom: l,this.options.crs.latLngToPoint(J(c), l)},unproject: function (c, l) {return l = void 0 === l? this._zoom: l,this.options.crs.pointToLatLng(E(c), l)},layerPointToLatLng: function (c) {c = E(c).add(this.getPixelOrigin());return this.unproject(c)},latLngToLayerPoint: function (c) {return this.project(J(c))._round()._subtract(this.getPixelOrigin())},wrapLatLng: function (c) {return this.options.crs.wrapLatLng(J(c))},wrapLatLngBounds: function (c) {return this.options.crs.wrapLatLngBounds(A(c))},distance: function (c, l) {return this.options.crs.distance(J(c), J(l))},containerPointToLayerPoint: function (c) {return E(c).subtract(this._getMapPanePos())},layerPointToContainerPoint: function (c) {return E(c).add(this._getMapPanePos())},containerPointToLatLng: function (c) {c = this.containerPointToLayerPoint(E(c));return this.layerPointToLatLng(c)},latLngToContainerPoint: function (c) {return this.layerPointToContainerPoint(this.latLngToLayerPoint(J(c)))},mouseEventToContainerPoint: function (c) {return Ec(c, this._container)},mouseEventToLayerPoint: function (c) {return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(c))},mouseEventToLatLng: function (c) {return this.layerPointToLatLng(this.mouseEventToLayerPoint(c))},_initContainer: function (c) {c = this._container = Gc(c);if (! c) throw Error("Map container not found.");if (c._leaflet_id) throw Error("Map container is already initialized.");K(c, "scroll", this._onScroll, this);this._containerId = f(c)},_initLayout: function () {var c = this._container;this._fadeAnimated = this.options.fadeAnimation && ha;M(c, "leaflet-container" + (oa? " leaflet-touch": "") + (Ba? " leaflet-retina": "") + (Ta? " leaflet-oldie": "") + (Tc? " leaflet-safari": "") + (this._fadeAnimated? " leaflet-fade-anim": ""));var l = bb(c, "position");"absolute" !== l && "relative" !== l && "fixed" !== l && (c.style.position = "relative");this._initPanes();this._initControlPos && this._initControlPos()},_initPanes: function () {var c = this._panes = {};this._paneRenderers = {};this._mapPane = this.createPane("mapPane", this._container);W(this._mapPane, new C(0, 0));this.createPane("tilePane");this.createPane("shadowPane");this.createPane("overlayPane");this.createPane("markerPane");this.createPane("tooltipPane");this.createPane("popupPane");this.options.markerZoomAnimation || (M(c.markerPane, "leaflet-zoom-hide"), M(c.shadowPane, "leaflet-zoom-hide"))},_resetView: function (c, l) {W(this._mapPane, new C(0, 0));var a = !this._loaded;this._loaded = !0;l = this._limitZoom(l);this.fire("viewprereset");var b = this._zoom !== l;this._moveStart(b, !1)._move(c, l)._moveEnd(b);this.fire("viewreset");a && this.fire("load")},_moveStart: function (c, l) {return c && this.fire("zoomstart"),l || this.fire("movestart"),this},_move: function (c, l, a) {void 0 === l && (l = this._zoom);var b = this._zoom !== l;return this._zoom = l,this._lastCenter = c,this._pixelOrigin = this._getNewPixelOrigin(c),(b || a && a.pinch) && this.fire("zoom", a),this.fire("move", a)},_moveEnd: function (c) {return c && this.fire("zoomend"),this.fire("moveend")},_stop: function () {return u(this._flyToFrame),this._panAnim && this._panAnim.stop(),this},_rawPanBy: function (c) {W(this._mapPane, this._getMapPanePos().subtract(c))},_getZoomSpan: function () {return this.getMaxZoom() - this.getMinZoom()},_panInsideMaxBounds: function () {this._enforcingBounds || this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded: function () {if (!this._loaded) throw Error("Set map center and zoom first.");},_initEvents: function (c) {this._targets = {};this._targets[f(this._container)] = this;var l = c? U: K;l(this._container, "click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress", this._handleDOMEvent, this);this.options.trackResize && l(window, "resize", this._onResize, this);ha && this.options.transform3DLimit && (c? this.off: this.on).call(this, "moveend", this._onMoveEnd)},_onResize: function () {u(this._resizeRequest);this._resizeRequest = y(function () {this.invalidateSize({debounceMoveend: !0})}, this)},_onScroll: function () {this._container.scrollTop = 0;this._container.scrollLeft = 0},_onMoveEnd: function () {var c = this._getMapPanePos();Math.max(Math.abs(c.x), Math.abs(c.y)) >= this.options.transform3DLimit && this._resetView(this.getCenter(), this.getZoom())},_findEventTargets: function (c, l) {for (var a, b =[], e = "mouseout" === l || "mouseover" === l, d = c.target || c.srcElement, m =! 1; d;) {if ((a = this._targets[f(d)]) && ("click" === l || "preclick" === l) && ! c._simulated && this._draggableMoved(a)) {m = !0;break}if (a && a.listens(l, !0)) {if (e && ! rb(d, c)) break;if (b.push(a), e) break}if (d === this._container) break;d = d.parentNode}return b.length || m || e || ! rb(d, c) || (b =[this]),b }, _handleDOMEvent: function (c) {if (this._loaded && ! Ob(c)) {var l = c.type;"mousedown" !== l && "keypress" !== l || Zb(c.target || c.srcElement);this._fireDOMEvent(c, l)} }, _mouseEvents: ["click", "dblclick", "mouseover", "mouseout", "contextmenu" ], _fireDOMEvent: function (c, l, a) {if ("click" === c.type) {var b = d({}, c);b.type = "preclick";this._fireDOMEvent(b, b.type, a)}if (! c._stopped && (a =( a || []).concat(this._findEventTargets(c, l))).length) {var e = a[0];"contextmenu" === l && e.listens(l, !0) && ea(c);b = {originalEvent: c};if ("keypress" !== c.type) {var m = e.getLatLng && (! e._radius || 10 >= e._radius);b.containerPoint = m? this.latLngToContainerPoint(e.getLatLng()): this.mouseEventToContainerPoint(c);b.layerPoint = this.containerPointToLayerPoint(b.containerPoint);b.latlng = m? e.getLatLng(): this.layerPointToLatLng(b.layerPoint)}for (c = 0; ca.length && !(a[c].fire(l, b, !0), b.originalEvent._stopped || !1 === a[c].options.bubblingMouseEvents && -1 !== v(this._mouseEvents, l)); c++) ;} }, _draggableMoved: function (c) {return(c = c.dragging && c.dragging.enabled()? c: this).dragging && c.dragging.moved() || this.boxZoom && this.boxZoom.moved() }, _clearHandlers: function () {for (var c = 0, l = this._handlers.length; cl; c++) this._handlers[c].disable() },whenReady: function (c, l) { return this._loaded? c.call(l || this, {target: this}): this.on("load", c, l), this},_getMapPanePos: function () { return Ha(this._mapPane) || new C(0, 0)},_moved: function () { var c = this._getMapPanePos(); return c && ! c.equals([0, 0])},_getTopLeftPoint: function (c, l) { return(c && void 0 !== l? this._getNewPixelOrigin(c, l): this.getPixelOrigin()).subtract(this._getMapPanePos())},_getNewPixelOrigin: function (c, l) { var a = this.getSize()._divideBy(2); return this .project(c, l) ._subtract(a) ._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint: function (c, l, a) { a = this._getNewPixelOrigin(a, l); return this.project(c, l)._subtract(a)},_latLngBoundsToNewLayerBounds: function (c, a, b) { b = this._getNewPixelOrigin(b, a); return I([this.project(c.getSouthWest(), a)._subtract(b),this.project(c.getNorthWest(), a)._subtract(b),this.project(c.getSouthEast(), a)._subtract(b),this.project(c.getNorthEast(), a)._subtract(b) ])},_getCenterLayerPoint: function () { return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset: function (c) { return this.latLngToLayerPoint(c).subtract(this._getCenterLayerPoint())},_limitCenter: function (c, a, b) { if (! b) return c;  var l = this.project(c, a),e = this.getSize().divideBy(2); e = new H(l.subtract(e), l.add(e)); b = this._getBoundsOffset(e, b, a); return b.round().equals([0, 0])? c: this.unproject(l.add(b), a)},_limitOffset: function (c, a) { if (! a) return c;  var l = this.getPixelBounds(); l = new H(l.min.add(c), l.max.add(c)); return c.add(this._getBoundsOffset(l, a))},_getBoundsOffset: function (c, a, b) { b = I(this.project(a.getNorthEast(), b), this.project(a.getSouthWest(), b)); a = b.min.subtract(c.min); c = b.max.subtract(c.max); return new C(this._rebound(a.x, - c.x), this._rebound(a.y, - c.y))},_rebound: function (c, a) { return 0c + a? Math.round(c - a) / 2: Math.max(0, Math.ceil(c)) - Math.max(0, Math.floor(a))},_limitZoom: function (c) { var a = this.getMinZoom(),b = this.getMaxZoom(),e = ha? this.options.zoomSnap: 1; return e && (c = Math.round(c / e) * e), Math.max(a, Math.min(b, c))},_onPanTransitionStep: function () { this.fire("move")},_onPanTransitionEnd: function () { S(this._mapPane, "leaflet-pan-anim"); this.fire("moveend")},_tryAnimatedPan: function (c, a) { var l = this._getCenterOffset(c)._trunc(); return !(!0 !== (a && a.animate) && !this.getSize().contains(l)) && (this.panBy(l, a), !0)},_createAnimProxy: function () { var c = this._proxy = O("div", "leaflet-proxy leaflet-zoom-animated"); this ._panes .mapPane.appendChild(c); this.on("zoomanim", function (c) {var a = Vb,l = this._proxy.style[a];Ga(this._proxy, this.project(c.center, c.zoom), this.getZoomScale(c.zoom, 1));l === this._proxy.style[a] && this._animatingZoom && this._onZoomTransitionEnd() }, this); this.on("load moveend", function () {var c = this.getCenter(),a = this.getZoom();Ga(this._proxy, this.project(c, a), this.getZoomScale(a, 1)) }, this); this._on("unload", this._destroyAnimProxy, this)},_destroyAnimProxy: function () { R(this._proxy); delete this._proxy},_catchTransitionEnd: function (c) { this ._animatingZoom && 0 <= c .propertyName .indexOf("transform") && this._onZoomTransitionEnd()},_nothingToAnimate: function () { return !this ._container .getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom: function (c, a, b) { if (this._animatingZoom) return !0;  if (b = b || {}, !this ._zoomAnimated || !1 === b .animate || this ._nothingToAnimate() || Math .abs(a - this._zoom) > this .options.zoomAnimationThreshold) return !1;  var l = this.getZoomScale(a); l = this._getCenterOffset(c)._divideBy(1 - 1 / l); return !(!0 !== b .animate && !this .getSize().contains(l)) && (y(function () {this._moveStart(!0, !1)._animateZoom(c, a, !0) }, this), !0)},_animateZoom: function (c, a, b, e) { this._mapPane && (b && (this._animatingZoom =! 0, this._animateToCenter = c, this._animateToZoom = a, M(this._mapPane, "leaflet-zoom-anim")), this.fire("zoomanim", {center: c,zoom: a,noUpdate: e }), setTimeout(g(this._onZoomTransitionEnd, this), 250))},_onZoomTransitionEnd: function () { this._animatingZoom && (this._mapPane && S(this._mapPane, "leaflet-zoom-anim"), this._animatingZoom =! 1, this._move(this._animateToCenter, this._animateToZoom), y(function () {this._moveEnd(!0) }, this))}}),ma = G.extend({options: { position: "topright"},initialize: function (c) { m(this, c)},getPosition: function () { return this.options.position},setPosition: function (c) { var a = this._map; return a && a.removeControl(this), this.options.position = c, a && a.addControl(this), this},getContainer: function () { return this._container},addTo: function (c) { this.remove(); this._map = c; var a = this._container = this.onAdd(c),b = this.getPosition(); c = c._controlCorners[b]; return M(a, "leaflet-control"), -1 !== b.indexOf("bottom")? c.insertBefore(a, c.firstChild): c.appendChild(a), this},remove: function () { return this._map? (R(this._container), this.onRemove && this.onRemove(this._map), this._map = null, this): this},_refocusOnMap: function (c) { this ._map && c && 0c .screenX && 0c .screenY && this ._map .getContainer().focus()}}),jb = function (c) {return new ma(c)};N.include({addControl: function (c) {return c.addTo(this),this},removeControl: function (c) {return c.remove(),this},_initControlPos: function () {function c(c, l) { a[c + l] = O("div", b + c + " " + b + l, e)}var a = this._controlCorners = {}, b = "leaflet-", e = this._controlContainer = O("div", b + "control-container", this._container);c("top", "left");c("top", "right");c("bottom", "left");c("bottom", "right")},_clearControlPos: function () {for (var c in this._controlCorners)  R(this._controlCorners[c]);R(this._controlContainer);delete this._controlCorners;delete this._controlContainer}});var ad = ma.extend({options: { collapsed: !0, position: "topright", autoZIndex: !0, hideSingleBase: !1, sortLayers: !1, sortFunction: function (c, a, b, e) {return be? -1: eb? 1: 0 }},initialize: function (c, a, b) { m(this, b); this._layerControlInputs = []; this._layers = []; this._lastZIndex = 0; this._handlingClick = !1; for (var l in c) this._addLayer(c[l], l);  for (l in a) this._addLayer(a[l], l, !0) },onAdd: function (c) { this._initLayout(); this._update(); this._map = c; c.on("zoomend", this._checkDisabledLayers, this); for (c = 0; c this._layers.length; c++) this._layers[c].layer.on("add remove", this._onLayerChange, this);  return this._container},addTo: function (c) { return ma .prototype .addTo.call(this, c), this._expandIfNotCollapsed()},onRemove: function () { this._map.off("zoomend", this._checkDisabledLayers, this); for (var c = 0; c this._layers.length; c++) this._layers[c].layer.off("add remove", this._onLayerChange, this) },addBaseLayer: function (c, a) { return this._addLayer(c, a), this._map? this._update(): this},addOverlay: function (c, a) { return this._addLayer(c, a, !0), this._map? this._update(): this},removeLayer: function (c) { c.off("add remove", this._onLayerChange, this); c = this._getLayer(f(c)); return c && this._layers.splice(this._layers.indexOf(c), 1), this._map? this._update(): this},expand: function () { M(this._container, "leaflet-control-layers-expanded"); this ._form .style.height = null; var c = this ._map .getSize().y -(this._container.offsetTop + 50); return c this._form.clientHeight? (M(this._form, "leaflet-control-layers-scrollbar"), this._form.style.height = c + "px"): S(this._form, "leaflet-control-layers-scrollbar"), this._checkDisabledLayers(), this},collapse: function () { return S(this._container, "leaflet-control-layers-expanded"), this},_initLayout: function () { var c = this._container = O("div", "leaflet-control-layers"),a = this.options.collapsed; c.setAttribute("aria-haspopup", !0); ab(c); Pb(c); var b = this._form = O("form", "leaflet-control-layers-list"); a && (this._map.on("click", this.collapse, this), Na || K(c, {mouseenter: this.expand,mouseleave: this.collapse }, this)); var e = this._layersLink = O("a", "leaflet-control-layers-toggle", c); e.href = "#"; e.title = "Layers"; oa? (K(e, "click", pa), K(e, "click", this.expand, this)): K(e, "focus", this.expand, this); a || this.expand(); this._baseLayersList = O("div", "leaflet-control-layers-base", b); this._separator = O("div", "leaflet-control-layers-separator", b); this._overlaysList = O("div", "leaflet-control-layers-overlays", b); c.appendChild(b)},_getLayer: function (c) { for (var a = 0; a this._layers.length; a++) if (this._layers[a] && f(this._layers[a].layer) === c) return this._layers[a] },_addLayer: function (c, a, b) { this._map && c.on("add remove", this._onLayerChange, this); this._layers.push({layer: c, name: a, overlay: b}); this .options .sortLayers && this ._layers.sort(g(function (c, a) {return this.options.sortFunction(c.layer, a.layer, c.name, a.name) }, this)); this .options .autoZIndex && c.setZIndex && (this._lastZIndex ++, c.setZIndex(this._lastZIndex)); this._expandIfNotCollapsed()},_update: function () { if (!this._container) return this;  Sb(this._baseLayersList); Sb(this._overlaysList); this._layerControlInputs = []; var c,a = 0; for (c = 0; c this._layers.length; c++) {var b = this._layers[c];this._addItem(b);var e = e || b.overlay;var d = d || ! b.overlay;a += b.overlay? 0: 1 } return this.options.hideSingleBase && (d = d && 1a, this ._baseLayersList .style.display = d? "": "none"), this ._separator .style.display = e && d? "": "none", this},_onLayerChange: function (c) { this._handlingClick || this._update(); var a = this._getLayer(f(c.target)); (c = a.overlay? "add" === c.type? "overlayadd": "overlayremove": "add" === c.type? "baselayerchange": null) && this._map.fire(c, a)},_createRadioElement: function (c, a) { var l = '<input type="radio" class="leaflet-control-layers-selector" name="' + c + '"' + (a? ' checked="checked"': "") + "/>",b = document.createElement("div"); return b.innerHTML = l, b.firstChild},_addItem: function (c) { var a,b = document.createElement("label"),e = this._map.hasLayer(c.layer); c.overlay? ((a = document.createElement("input")).type = "checkbox", a.className = "leaflet-control-layers-selector", a.defaultChecked = e): a = this._createRadioElement("leaflet-base-layers", e); this._layerControlInputs.push(a); a.layerId = f(c.layer); K(a, "click", this._onInputClick, this); e = document.createElement("span"); e.innerHTML = " " + c.name; var d = document.createElement("div"); return b.appendChild(d), d.appendChild(a), d.appendChild(e), (c.overlay? this._overlaysList: this._baseLayersList).appendChild(b), this._checkDisabledLayers(), b},_onInputClick: function () { var c = this._layerControlInputs,a = [],b = []; this._handlingClick = !0; for (var e = c.length - 1; 0 <= e; e--) {var d = c[e];var m = this._getLayer(d.layerId).layer;d.checked? a.push(m): d.checked || b.push(m) } for (e = 0; eb.length; e++) this._map.hasLayer(b[e]) && this._map.removeLayer(b[e]);  for (e = 0; ea.length; e++) this._map.hasLayer(a[e]) || this._map.addLayer(a[e]);  this._handlingClick = !1; this._refocusOnMap()},_checkDisabledLayers: function () { for (var c, a, b = this._layerControlInputs, e = this._map.getZoom(), d = b.length - 1; 0 <= d; d--)  c = b[d], a = this._getLayer(c.layerId).layer, c .disabled = void 0 !== a .options.minZoom && ea .options .minZoom || void 0 !== a .options .maxZoom && e > a .options.maxZoom},_expandIfNotCollapsed: function () {return this._map && !this.options.collapsed && this .expand(),this},_expand: function () {return this.expand()},_collapse: function () {return this.collapse()}}),pc = ma.extend({options: {position: "topleft",zoomInText: "+",zoomInTitle: "Zoom in",zoomOutText: "&#x2212;",zoomOutTitle: "Zoom out"},onAdd: function (c) {var a = O("div", "leaflet-control-zoom leaflet-bar"), b = this.options;return this._zoomInButton = this._createButton(b.zoomInText, b.zoomInTitle, "leaflet-control-zoom-in", a, this._zoomIn),this._zoomOutButton = this._createButton(b.zoomOutText, b.zoomOutTitle, "leaflet-control-zoom-out", a, this._zoomOut),this._updateDisabled(),c.on("zoomend zoomlevelschange", this._updateDisabled, this),a},onRemove: function (c) {c.off("zoomend zoomlevelschange", this._updateDisabled, this)},disable: function () {return this._disabled = !0,this._updateDisabled(),this},enable: function () {return this._disabled = !1,this._updateDisabled(),this},_zoomIn: function (c) {!this._disabled && this._map ._zoom this._map.getMaxZoom() && this._map .zoomIn(this._map.options .zoomDelta * ( c.shiftKey ? 3 : 1))},_zoomOut: function (c) {!this._disabled && this._map._zoom > this._map.getMinZoom() && this._map .zoomOut(this._map.options .zoomDelta * ( c.shiftKey ? 3 : 1))},_createButton: function (c, a, b, e, d) {b = O("a", b, e);return b.innerHTML = c,b.href = "#",b.title = a,b.setAttribute("role", "button"),b.setAttribute("aria-label", a),ab(b),K(b, "click", pa),K(b, "click", d, this),K(b, "click", this._refocusOnMap, this),b},_updateDisabled: function () {var c = this._map;S(this._zoomInButton, "leaflet-disabled");S(this._zoomOutButton, "leaflet-disabled");(this._disabled || c._zoom === c .getMinZoom()) && M(this._zoomOutButton, "leaflet-disabled");(this._disabled || c._zoom === c .getMaxZoom()) && M(this._zoomInButton, "leaflet-disabled")}});N.mergeOptions({zoomControl: !0});N.addInitHook(function () {this.options.zoomControl && (this.zoomControl = new pc, this.addControl(this.zoomControl))});var bd = ma.extend({options: {position: "bottomleft",maxWidth: 100,metric: !0,imperial: !0},onAdd: function (c) {var a = O("div", "leaflet-control-scale"), b = this.options;return this._addScales(b, "leaflet-control-scale-line", a),c.on( b.updateWhenIdle ? "moveend" : "move",this._update,this),c.whenReady(this._update, this),a},onRemove: function (c) {c.off( this.options.updateWhenIdle ? "moveend" : "move",this._update,this)},_addScales: function (c, a, b) {c.metric && (this._mScale = O("div", a, b));c.imperial && (this._iScale = O("div", a, b))},_update: function () {var c = this._map, a = c.getSize().y / 2;c = c.distance(c.containerPointToLatLng([0, a]), c.containerPointToLatLng([this.options.maxWidth, a]));this._updateScales(c)},_updateScales: function (c) {this.options.metric && c && this ._updateMetric(c);this.options.imperial && c && this ._updateImperial(c)},_updateMetric: function (c) {var a = this._getRoundNum(c);this._updateScale( this._mScale, 1E3 > a ? a + " m" : a / 1E3 + " km",a / c)},_updateImperial: function (c) {var a, b, e;c *= 3.2808399;5280c ? (a = c / 5280, b = this._getRoundNum(a), this._updateScale(this._iScale, b + " mi", b / a)) : (e = this._getRoundNum(c), this._updateScale(this._iScale, e + " ft", e / c))},_updateScale: function (c, a, b) {c.style.width = Math .round(this.options.maxWidth * b) + "px";c.innerHTML = a},_getRoundNum: function (c) {var a = Math.pow(10, (Math.floor(c) + "").length - 1);c /= a;return c = 10 <= c ? 10 : 5 <= c? 5: 3 <= c? 3: 2 <= c? 2: 1,a * c}}),qc = ma.extend({options: {position: "bottomright",prefix: '<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize: function (c) {m(this, c);this._attributions = {}},onAdd: function (c) {c.attributionControl = this;this._container = O("div", "leaflet-control-attribution");ab(this._container);for (var a in c._layers)  c ._layers[a] .getAttribution && this.addAttribution(c._layers[a].getAttribution());return this._update(),this._container},setPrefix: function (c) {return this.options.prefix = c,this._update(),this},addAttribution: function (c) {return c? (this._attributions[c] || (this._attributions[c] = 0), this._attributions[c]++, this._update(), this): this},removeAttribution: function (c) {return c? (this._attributions[c] && (this._attributions[c]--, this._update()), this): this},_update: function () {if (this._map) {var c = [];for (a in this._attributions)  this._attributions[a] && c.push(a);var a = [];this.options.prefix && a .push(this.options.prefix);c.length && a.push(c.join(", "));this._container.innerHTML = a .join(" | ")}}});N.mergeOptions({attributionControl: !0});N.addInitHook(function () {this.options.attributionControl && (new qc).addTo(this)});ma.Layers = ad;ma.Zoom = pc;ma.Scale = bd;ma.Attribution = qc;jb.layers = function (c, a, b) {return new ad(c, a, b)};jb.zoom = function (c) {return new pc(c)};jb.scale = function (c) {return new bd(c)};jb.attribution = function (c) {return new qc(c)};var qa = G.extend({initialize: function (c) {this._map = c},enable: function () {return this._enabled? this: (this._enabled =! 0, this.addHooks(), this)},disable: function () {return this._enabled? (this._enabled =! 1, this.removeHooks(), this): this},enabled: function () {return !!this._enabled}});qa.addTo = function (c, a) {return c.addHandler(a, this),this};var Kc,Dd = {Events: da},cd = oa? "touchstart mousedown": "mousedown",dd = {mousedown: "mouseup",touchstart: "touchend",pointerdown: "touchend",MSPointerDown: "touchend"},rc = {mousedown: "mousemove",touchstart: "touchmove",pointerdown: "touchmove",MSPointerDown: "touchmove"},Ka = fb.extend({options: {clickTolerance: 3},initialize: function (c, a, b, e) {m(this, e);this._element = c;this._dragStartTarget = a || c;this._preventOutline = b},enable: function () {this._enabled || (K(this._dragStartTarget, cd, this._onDown, this), this._enabled =! 0)},disable: function () {this._enabled && (Ka._dragging === this && this.finishDrag(), U(this._dragStartTarget, cd, this._onDown, this), this._enabled =! 1, this._moved =! 1)},_onDown: function (c) {if (! c._simulated && this._enabled && (this._moved =! 1, !(Tb(this._element, "leaflet-zoom-anim") || Ka._dragging || c.shiftKey || 1 !== c.which && 1 !== c.button && ! c.touches || (Ka._dragging = this, this._preventOutline && Zb(this._element), Xb(), Cb(), this._moving)))) {this.fire("down");var a = c.touches ? c.touches[0] : c;this._startPoint = new C(a.clientX, a.clientY);K(document, rc[c.type], this._onMove, this);K(document, dd[c.type], this._onUp, this)}},_onMove: function (c) {if (! c._simulated && this._enabled) if (c.touches && 1c.touches .length)  this._moved = !0; else { var a = c.touches && 1 === c.touches.length? c.touches[0]: c; a = (new C(a.clientX, a.clientY)).subtract(this._startPoint); (a.x || a.y) && (Math .abs(a.x) + Math .abs(a.y)this .options.clickTolerance || (ea(c), this._moved || (this.fire("dragstart"), this._moved =! 0, this._startPos = Ha(this._element).subtract(a), M(document.body, "leaflet-dragging"), this ._lastTarget = c .target || c.srcElement, window.SVGElementInstance && this._lastTarget instanceof SVGElementInstance && (this ._lastTarget = this ._lastTarget.correspondingUseElement), M(this._lastTarget, "leaflet-drag-target")), this ._newPos = this ._startPos.add(a), this._moving =! 0, u(this._animRequest), this._lastEvent = c, this._animRequest = y(this._updatePosition, this, !0)))}},_updatePosition: function () {var c = {originalEvent: this._lastEvent};this.fire("predrag", c);W(this._element, this._newPos);this.fire("drag", c)},_onUp: function (c) {! c._simulated && this._enabled && this.finishDrag()},finishDrag: function () {S(document.body, "leaflet-dragging");this._lastTarget && (S(this._lastTarget, "leaflet-drag-target"), this._lastTarget = null);for (var c in rc) U(document, rc[c], this._onMove, this),U(document, dd[c], this._onUp, this);Yb();Db();this._moved && this._moving && (u(this._animRequest), this.fire("dragend", {distance: this._newPos.distanceTo(this._startPos)}));this._moving = !1;Ka._dragging = !1}}),Ed = (Object.freeze || Object)({simplify: Hc,pointToSegmentDistance: Ic,closestPointOnSegment: function (c, a, b) {return cb(c, a, b)},clipSegment: Jc,_getEdgeIntersection: wb,_getBitCode: Ia,_sqClosestPointOnSegment: cb,isFlat: ta,_flat: Lc}),Fd = (Object.freeze || Object)({clipPolygon: Mc}),sc = {project: function (c) {return new C(c.lng, c.lat)},unproject: function (c) {return new F(c.y, c.x)},bounds: new H([-180, -90], [180, 90])},tc = {R: 6378137,R_MINOR: 6356752.314245179,bounds: new H([-2.003750834279E7, -1.549657073972E7], [2.003750834279E7, 1.876465623138E7]),project: function (c) {var a = Math.PI / 180,b = this.R,e = c.lat * a,d = this.R_MINOR / b;d = Math.sqrt(1 - d * d);var m = d * Math.sin(e);return e = - b * Math.log(Math.max(Math.tan(Math.PI / 4 - e / 2) / Math.pow((1 - m) / (1 + m), d / 2), 1E-10)),new C(c.lng * a * b, e)},unproject: function (c) {var a,b = 180 / Math.PI,e = this.R,d = this.R_MINOR / e;d = Math.sqrt(1 - d * d);var m = Math.exp(- c.y / e),h = Math.PI / 2 - 2 * Math.atan(m),f = 0;for (a = .1; 15 > f && 1E-7 Math.abs(a); f++) a = d * Math.sin(h),a = Math.pow((1 - a) / (1 + a), d / 2),h += a = Math.PI / 2 - 2 * Math.atan(m * a) - h;return new F(h * b, c.x * b / e)}},Gd = (Object.freeze || Object)({LonLat: sc, Mercator: tc, SphericalMercator: hc}),Hd = d({}, za, {code: "EPSG:3395",projection: tc,transformation: function () {var c = .5 / (Math.PI * tc.R);return Q(c, .5, - c, .5)}()}),ed = d({}, za, {code: "EPSG:4326",projection: sc,transformation: Q(1 / 180, 1, -1 / 180, .5)}),Id = d({}, wa, {projection: sc,transformation: Q(1, 0, -1, 0),scale: function (c) {return Math.pow(2, c)},zoom: function (c) {return Math.log(c) / Math.LN2},distance: function (c, a) {var b = a.lng - c.lng,l = a.lat - c.lat;return Math.sqrt(b * b + l * l)},infinite: !0});wa.Earth = za;wa.EPSG3395 = Hd;wa.EPSG3857 = jc;wa.EPSG900913 = vd;wa.EPSG4326 = ed;wa.Simple = Id;var ia = fb.extend({options: {pane: "overlayPane",attribution: null,bubblingMouseEvents: !0},addTo: function (c) {return c.addLayer(this),this},remove: function () {return this.removeFrom(this._map || this._mapToAdd)},removeFrom: function (c) {return c && c.removeLayer(this),this},getPane: function (c) {return this._map.getPane(c? this.options[c] || c: this.options.pane)},addInteractiveTarget: function (c) {return this._map._targets[f(c)] = this,this},removeInteractiveTarget: function (c) {return delete this._map._targets[f(c)],this},getAttribution: function () {return this.options.attribution},_layerAdd: function (c) {var a = c.target;if (a.hasLayer(this)) {if (this._map = a, this._zoomAnimated = a._zoomAnimated, this.getEvents) {var b = this.getEvents();a.on(b, this);this.once("remove", function () { a.off(b, this)}, this)}this.onAdd(a);this.getAttribution && a.attributionControl && a.attributionControl.addAttribution(this.getAttribution());this.fire("add");a.fire("layeradd", {layer: this})}}});N.include({addLayer: function (c) {if (! c._layerAdd) throw Error("The provided object is not a Layer.");var a = f(c);return this._layers[a]? this: (this._layers[a] = c, c._mapToAdd = this, c.beforeAdd && c.beforeAdd(this), this.whenReady(c._layerAdd, c), this)},removeLayer: function (c) {var a = f(c);return this._layers[a]? (this._loaded && c.onRemove(this), c.getAttribution && this.attributionControl && this.attributionControl.removeAttribution(c.getAttribution()), delete this._layers[a], this._loaded && (this.fire("layerremove", {layer: c}), c.fire("remove")), c._map = c._mapToAdd = null, this): this},hasLayer: function (c) {return !! c && f(c) in this._layers},eachLayer: function (c, a) {for (var b in this._layers) c.call(a, this._layers[b]);return this},_addLayers: function (c) {for (var a = 0, b =(c = c? na(c)? c: [c]: []).length; ab; a++) this.addLayer(c[a])},_addZoomLimit: function (c) {!isNaN(c.options.maxZoom) && isNaN(c.options.minZoom) || (this._zoomBoundLayers[f(c)] = c, this._updateZoomLevels())},_removeZoomLimit: function (c) {c = f(c);this._zoomBoundLayers[c] && (delete this._zoomBoundLayers[c], this._updateZoomLevels())},_updateZoomLevels: function () {var c = 1 / 0,a = -1 / 0,b = this._getZoomSpan(),e;for (e in this._zoomBoundLayers) {var d = this._zoomBoundLayers[e].options;c = void 0 === d.minZoom? c: Math.min(c, d.minZoom);a = void 0 === d.maxZoom? a: Math.max(a, d.maxZoom)}this._layersMaxZoom = a === -1 / 0? void 0: a;this._layersMinZoom = c === 1 / 0? void 0: c;b !== this._getZoomSpan() && this.fire("zoomlevelschange");void 0 === this.options.maxZoom && this._layersMaxZoom && this.getZoom() > this._layersMaxZoom && this.setZoom(this._layersMaxZoom);void 0 === this.options.minZoom && this._layersMinZoom && this.getZoom()this._layersMinZoom && this.setZoom(this._layersMinZoom)}});var Va = ia.extend({initialize: function (c, a) {m(this, a);this._layers = {};var b;if (c) {var l = 0;for (b = c.length; lb; l++) this.addLayer(c[l])}},addLayer: function (c) {var a = this.getLayerId(c);return this._layers[a] = c,this._map && this._map.addLayer(c),this},removeLayer: function (c) {c = c in this._layers? c: this.getLayerId(c);return this._map && this._layers[c] && this._map.removeLayer(this._layers[c]),delete this._layers[c],this},hasLayer: function (c) {return !! c && (c in this._layers || this.getLayerId(c) in this._layers)},clearLayers: function () {return this.eachLayer(this.removeLayer, this)},invoke: function (c) {var a,b,e = Array.prototype.slice.call(arguments, 1);for (a in this._layers) (b = this._layers[a])[c] && b[c].apply(b, e);return this},onAdd: function (c) {this.eachLayer(c.addLayer, c)},onRemove: function (c) {this.eachLayer(c.removeLayer, c)},eachLayer: function (c, a) {for (var b in this._layers) c.call(a, this._layers[b]);return this},getLayer: function (c) {return this._layers[c]},getLayers: function () {var c = [];return this.eachLayer(c.push, c),c},setZIndex: function (c) {return this.invoke("setZIndex", c)},getLayerId: function (c) {return f(c)}}),Ja = Va.extend({addLayer: function (c) {return this.hasLayer(c)? this: (c.addEventParent(this), Va.prototype.addLayer.call(this, c), this.fire("layeradd", {layer: c}))},removeLayer: function (c) {return this.hasLayer(c)? (c in this._layers && (c = this._layers[c]), c.removeEventParent(this), Va.prototype.removeLayer.call(this, c), this.fire("layerremove", {layer: c})): this},setStyle: function (c) {return this.invoke("setStyle", c)},bringToFront: function () {return this.invoke("bringToFront")},bringToBack: function () {return this.invoke("bringToBack")},getBounds: function () {var c = new D,a;for (a in this._layers) {var b = this._layers[a];c.extend(b.getBounds? b.getBounds(): b .getLatLng())}return c}}),Wa = G.extend({options: {popupAnchor: [0, 0],tooltipAnchor: [0, 0]},initialize: function (c) {m(this, c)},createIcon: function (c) {return this._createIcon("icon", c)},createShadow: function (c) {return this._createIcon("shadow", c)},_createIcon: function (c, a) {var b = this._getIconUrl(c);if (! b) {if ("icon" === c) throw Error("iconUrl not set in Icon options (see the docs).");return null}b = this._createImg(b, a && "IMG" === a.tagName? a: null);return this._setIconStyles(b, c),b},_setIconStyles: function (c, a) {var b = this.options,l = b[a + "Size"];"number" == typeof l && (l =[l, l]);l = E(l);var e = E("shadow" === a && b.shadowAnchor || b.iconAnchor || l && l.divideBy(2, !0));c.className = "leaflet-marker-" + a + " " + (b.className || "");e && (c.style.marginLeft = - e.x + "px", c.style.marginTop = - e.y + "px");l && (c.style.width = l.x + "px", c.style.height = l.y + "px")},_createImg: function (c, a) {return a = a || document.createElement("img"),a.src = c,a},_getIconUrl: function (c) {return Ba && this.options[c + "RetinaUrl"] || this.options[c + "Url"]}}),kb = Wa.extend({options: {iconUrl: "marker-icon.png",iconRetinaUrl: "marker-icon-2x.png",shadowUrl: "marker-shadow.png",iconSize: [25, 41],iconAnchor: [12, 41],popupAnchor: [1, -34],tooltipAnchor: [16, -28],shadowSize: [41, 41]},_getIconUrl: function (c) {return kb.imagePath || (kb.imagePath = this._detectIconPath()),(this.options.imagePath || kb.imagePath) + Wa.prototype._getIconUrl.call(this, c)},_detectIconPath: function () {var c = O("div", "leaflet-default-icon-path", document.body),a = bb(c, "background-image") || bb(c, "backgroundImage");return document.body.removeChild(c),null === a || 0 !== a.indexOf("url")? "": a.replace(/^url\(["']?/, "").replace(/marker-icon\.png["']?\)$/, "")}}),fd = qa.extend({initialize: function (c) {this._marker = c},addHooks: function () {var c = this._marker._icon;this._draggable || (this._draggable = new Ka(c, c, !0));this._draggable.on({dragstart: this._onDragStart,predrag: this._onPreDrag,drag: this._onDrag,dragend: this._onDragEnd}, this).enable();M(c, "leaflet-marker-draggable")},removeHooks: function () {this._draggable.off({dragstart: this._onDragStart,predrag: this._onPreDrag,drag: this._onDrag,dragend: this._onDragEnd}, this).disable();this._marker._icon && S(this._marker._icon, "leaflet-marker-draggable")},moved: function () {return this._draggable && this._draggable._moved},_adjustPan: function (c) {var a = this._marker,b = a._map,e = this._marker.options.autoPanSpeed,d = this._marker.options.autoPanPadding,m = L.DomUtil.getPosition(a._icon),h = b.getPixelBounds(),f = b.getPixelOrigin();d = I(h.min._subtract(f).add(d), h.max._subtract(f).subtract(d));d.contains(m) || (e = E((Math.max(d.max.x, m.x) - d.max.x) / (h.max.x - d.max.x) - (Math.min(d.min.x, m.x) - d.min.x) / (h.min.x - d.min.x), (Math.max(d.max.y, m.y) - d.max.y) / (h.max.y - d.max.y) - (Math.min(d.min.y, m.y) - d.min.y) / (h.min.y - d.min.y)).multiplyBy(e), b.panBy(e, {animate: !1}), this._draggable._newPos._add(e), this._draggable._startPos._add(e), L.DomUtil.setPosition(a._icon, this._draggable._newPos), this._onDrag(c), this._panRequest = y(this._adjustPan.bind(this, c)))},_onDragStart: function () {this._oldLatLng = this._marker.getLatLng();this._marker.closePopup().fire("movestart").fire("dragstart")},_onPreDrag: function (c) {this._marker.options.autoPan && (u(this._panRequest), this._panRequest = y(this._adjustPan.bind(this, c)))},_onDrag: function (c) {var a = this._marker,b = a._shadow,e = Ha(a._icon),d = a._map.layerPointToLatLng(e);b && W(b, e);a._latlng = d;c.latlng = d;c.oldLatLng = this._oldLatLng;a.fire("move", c).fire("drag", c)},_onDragEnd: function (c) {u(this._panRequest);delete this._oldLatLng;this._marker.fire("moveend").fire("dragend", c)}}),db = ia.extend({options: {icon: new kb,interactive: !0,draggable: !1,autoPan: !1,autoPanPadding: [50, 50],autoPanSpeed: 10,keyboard: !0,title: "",alt: "",zIndexOffset: 0,opacity: 1,riseOnHover: !1,riseOffset: 250,pane: "markerPane",bubblingMouseEvents: !1},initialize: function (c, a) {m(this, a);this._latlng = J(c)},onAdd: function (c) {(this._zoomAnimated = this._zoomAnimated && c.options.markerZoomAnimation) && c.on("zoomanim", this._animateZoom, this);this._initIcon();this.update()},onRemove: function (c) {this.dragging && this.dragging.enabled() && (this.options.draggable =! 0, this.dragging.removeHooks());delete this.dragging;this._zoomAnimated && c.off("zoomanim", this._animateZoom, this);this._removeIcon();this._removeShadow()},getEvents: function () {return {zoom: this.update, viewreset: this.update}},getLatLng: function () {return this._latlng},setLatLng: function (c) {var a = this._latlng;return this._latlng = J(c),this.update(),this.fire("move", {oldLatLng: a,latlng: this._latlng})},setZIndexOffset: function (c) {return this.options.zIndexOffset = c,this.update()},setIcon: function (c) {return this.options.icon = c,this._map && (this._initIcon(), this.update()),this._popup && this.bindPopup(this._popup, this._popup.options),this},getElement: function () {return this._icon},update: function () {if (this._icon && this._map) {var c = this._map.latLngToLayerPoint(this._latlng).round();this._setPos(c)}return this},_initIcon: function () {var c = this.options,a = "leaflet-zoom-" + (this._zoomAnimated? "animated": "hide"),b = c.icon.createIcon(this._icon),e = !1;b !== this._icon && (this._icon && this._removeIcon(), e =! 0, c.title && (b.title = c.title), "IMG" === b.tagName && (b.alt = c.alt || ""));M(b, a);c.keyboard && (b.tabIndex = "0");this._icon = b;c.riseOnHover && this.on({mouseover: this._bringToFront, mouseout: this._resetZIndex});b = c.icon.createShadow(this._shadow);var d = !1;b !== this._shadow && (this._removeShadow(), d =! 0);b && (M(b, a), b.alt = "");this._shadow = b;1 > c.opacity && this._updateOpacity();e && this.getPane().appendChild(this._icon);this._initInteraction();b && d && this.getPane("shadowPane").appendChild(this._shadow)},_removeIcon: function () {this.options.riseOnHover && this.off({mouseover: this._bringToFront, mouseout: this._resetZIndex});R(this._icon);this.removeInteractiveTarget(this._icon);this._icon = null},_removeShadow: function () {this._shadow && R(this._shadow);this._shadow = null},_setPos: function (c) {W(this._icon, c);this._shadow && W(this._shadow, c);this._zIndex = c.y + this.options.zIndexOffset;this._resetZIndex()},_updateZIndex: function (c) {this._icon.style.zIndex = this._zIndex + c},_animateZoom: function (c) {c = this._map._latLngToNewLayerPoint(this._latlng, c.zoom, c.center).round();this._setPos(c)},_initInteraction: function () {if (this.options.interactive && (M(this._icon, "leaflet-interactive"), this.addInteractiveTarget(this._icon), fd)) {var c = this.options.draggable;this.dragging && (c = this.dragging.enabled(), this.dragging.disable());this.dragging = new fd(this);c && this.dragging.enable()}},setOpacity: function (c) {return this.options.opacity = c,this._map && this._updateOpacity(),this},_updateOpacity: function () {var c = this.options.opacity;fa(this._icon, c);this._shadow && fa(this._shadow, c)},_bringToFront: function () {this._updateZIndex(this.options.riseOffset)},_resetZIndex: function () {this._updateZIndex(0)},_getPopupAnchor: function () {return this.options.icon.options.popupAnchor},_getTooltipAnchor: function () {return this.options.icon.options.tooltipAnchor}}),Ca = ia.extend({options: {stroke: !0,color: "#3388ff",weight: 3,opacity: 1,lineCap: "round",lineJoin: "round",dashArray: null,dashOffset: null,fill: !1,fillColor: null,fillOpacity: .2,fillRule: "evenodd",interactive: !0,bubblingMouseEvents: !0},beforeAdd: function (c) {this._renderer = c.getRenderer(this)},onAdd: function () {this._renderer._initPath(this);this._reset();this._renderer._addPath(this)},onRemove: function () {this._renderer._removePath(this)},redraw: function () {return this._map && this._renderer._updatePath(this),this},setStyle: function (c) {return m(this, c),this._renderer && this._renderer._updateStyle(this),this},bringToFront: function () {return this._renderer && this._renderer._bringToFront(this),this},bringToBack: function () {return this._renderer && this._renderer._bringToBack(this),this},getElement: function () {return this._path},_reset: function () {this._project();this._update()},_clickTolerance: function () {return(this.options.stroke? this.options.weight / 2: 0) + this._renderer.options.tolerance}}),Eb = Ca.extend({options: {fill: !0,radius: 10},initialize: function (c, a) {m(this, a);this._latlng = J(c);this._radius = this.options.radius},setLatLng: function (c) {return this._latlng = J(c),this.redraw(),this.fire("move", {latlng: this._latlng})},getLatLng: function () {return this._latlng},setRadius: function (c) {return this.options.radius = this._radius = c,this.redraw()},getRadius: function () {return this._radius},setStyle: function (c) {var a = c && c.radius || this._radius;return Ca.prototype.setStyle.call(this, c),this.setRadius(a),this},_project: function () {this._point = this._map.latLngToLayerPoint(this._latlng);this._updateBounds()},_updateBounds: function () {var c = this._radius,a = this._radiusY || c,b = this._clickTolerance();c = [c + b,a + b];this._pxBounds = new H(this._point.subtract(c), this._point.add(c))},_update: function () {this._map && this._updatePath()},_updatePath: function () {this._renderer._updateCircle(this)},_empty: function () {return this._radius && !this._renderer._bounds.intersects(this._pxBounds)},_containsPoint: function (c) {return c.distanceTo(this._point) <= this._radius + this._clickTolerance()}}),uc = Eb.extend({initialize: function (c, a, b) {if ("number" == typeof a && (a = d({}, b, {radius: a})), m(this, a), this._latlng = J(c), isNaN(this.options.radius)) throw Error("Circle radius cannot be NaN");this._mRadius = this.options.radius},setRadius: function (c) {return this._mRadius = c,this.redraw()},getRadius: function () {return this._mRadius},getBounds: function () {var c = [this._radius, this._radiusY || this._radius];return new D(this._map.layerPointToLatLng(this._point.subtract(c)), this._map.layerPointToLatLng(this._point.add(c)))},setStyle: Ca.prototype.setStyle,_project: function () {var c = this._latlng.lng,a = this._latlng.lat,b = this._map,e = b.options.crs;if (e.distance === za.distance) {var d = Math.PI / 180;e = this._mRadius / za.R / d;var m = b.project([ a + e, c]),h = b.project([ a - e, c]);h = m.add(h).divideBy(2);var f = b.unproject(h).lat;d = Math.acos((Math.cos(e * d) - Math.sin(a * d) * Math.sin(f * d)) / (Math.cos(a * d) * Math.cos(f * d))) / d;(isNaN(d) || 0 === d) && (d = e / Math.cos(Math.PI / 180 * a));this._point = h.subtract(b.getPixelOrigin());this._radius = isNaN(d)? 0: h.x - b.project([ f, c - d]) .x;this._radiusY = h.y - m.y} else c = e.unproject(e.project(this._latlng).subtract([this._mRadius, 0])),this._point = b.latLngToLayerPoint(this._latlng),this._radius = this._point.x - b.latLngToLayerPoint(c).x;this._updateBounds()}}),ua = Ca.extend({options: {smoothFactor: 1,noClip: !1},initialize: function (c, a) {m(this, a);this._setLatLngs(c)},getLatLngs: function () {return this._latlngs},setLatLngs: function (c) {return this._setLatLngs(c),this.redraw()},isEmpty: function () {return !this._latlngs.length},closestLayerPoint: function (c) {for (var a, b, e = 1 / 0, d = null, m = cb, h = 0, f = this._parts.length; hf; h++) for (var p = this._parts[h], q = 1, r = p.length; qr; q++) {var g = m(c, a = p[q - 1], b = p[q], !0);ge && (e = g, d = m(c, a, b))}return d && (d.distance = Math.sqrt(e)),d},getCenter: function () {if (!this._map) throw Error("Must add layer to map before using getCenter()");var c,a,b,e,d,m,h,f = this._rings[0],p = f.length;if (! p) return null;for (a = c = 0; cp - 1; c++) a += f[c].distanceTo(f[c + 1]) / 2;if (0 === a) return this._map.layerPointToLatLng(f[0]);for (e = c = 0; cp - 1; c++) if (d = f[c], m = f[c + 1], b = d.distanceTo(m), (e += b) > a) return h = (e - a) / b,this._map.layerPointToLatLng([m.x - h * (m.x - d.x),m.y - h * (m.y - d.y)])},getBounds: function () {return this._bounds},addLatLng: function (c, a) {return a = a || this._defaultShape(),c = J(c),a.push(c),this._bounds.extend(c),this.redraw()},_setLatLngs: function (c) {this._bounds = new D;this._latlngs = this._convertLatLngs(c)},_defaultShape: function () {return ta(this._latlngs)? this._latlngs: this._latlngs[0]},_convertLatLngs: function (c) {for (var a =[], b = ta(c), e = 0, d = c.length; ed; e++) b? (a[e] = J(c[e]), this._bounds.extend(a[e])): a[e] = this._convertLatLngs(c[e]);return a},_project: function () {var c = new H;this._rings = [];this._projectLatlngs(this._latlngs, this._rings, c);var a = this._clickTolerance();a = new C(a, a);this._bounds.isValid() && c.isValid() && (c.min._subtract(a), c.max._add(a), this._pxBounds = c)},_projectLatlngs: function (c, a, b) {var l,e = c.length;if (c[0] instanceof F) {var d = [];for (l = 0; le; l++) d[l] = this._map.latLngToLayerPoint(c[l]),b.extend(d[l]);a.push(d)} else for (l = 0; le; l++) this._projectLatlngs(c[l], a, b)},_clipPoints: function () {var c = this._renderer._bounds;if (this._parts =[], this._pxBounds && this._pxBounds.intersects(c)) if (this.options.noClip) this._parts = this._rings; else {var a,b,e,d,m,h = this._parts;var f = a = 0;for (b = this._rings.length; ab; a++) {var p = 0;for (e =( m = this._rings[a]).length; pe - 1; p++) (d = Jc(m[p], m[p + 1], c, p, !0)) && (h[f] = h[f] || [], h[f].push(d[0]), d[1] === m[p + 1] && p !== e - 2 || (h[f].push(d[1]), f ++))}}},_simplifyPoints: function () {for (var c = this._parts, a = this.options.smoothFactor, b = 0, e = c.length; be; b++) c[b] = Hc(c[b], a)},_update: function () {this._map && (this._clipPoints(), this._simplifyPoints(), this._updatePath())},_updatePath: function () {this._renderer._updatePoly(this)},_containsPoint: function (c, a) {var b,l,e,d,m = this._clickTolerance();if (!this._pxBounds || !this._pxBounds.contains(c)) return !1;var h = 0;for (l = this._parts.length; hl; h++) {var f = 0;for (b =( e =( d = this._parts[h]).length) - 1; fe; b = f++) if ((a || 0 !== f) && Ic(c, d[b], d[f]) <= m) return !0}return !1}});ua._flat = Lc;var Qa = ua.extend({options: {fill: !0},isEmpty: function () {return !this._latlngs.length || !this._latlngs[0].length},getCenter: function () {if (!this._map) throw Error("Must add layer to map before using getCenter()");var c,a,b,e,d,m = this._rings[0],h = m.length;if (! h) return null;var f = a = b = e = 0;for (c = h - 1; fh; c = f++) {var p = m[f];c = m[c];var q = p.y * c.x - c.y * p.x;b += (p.x + c.x) * q;e += (p.y + c.y) * q;a += 3 * q}return d = 0 === a? m[0]: [b / a,e / a],this._map.layerPointToLatLng(d)},_convertLatLngs: function (c) {c = ua.prototype._convertLatLngs.call(this, c);var a = c.length;return 2 <= a && c[0] instanceof F && c[0].equals(c[a - 1]) && c.pop(),c},_setLatLngs: function (c) {ua.prototype._setLatLngs.call(this, c);ta(this._latlngs) && (this._latlngs =[this._latlngs])},_defaultShape: function () {return ta(this._latlngs[0])? this._latlngs[0]: this._latlngs[0][0]},_clipPoints: function () {var c = this._renderer._bounds,a = this.options.weight;a = new C(a, a);if (c = new H(c.min.subtract(a), c.max.add(a)), this._parts =[], this._pxBounds && this._pxBounds.intersects(c)) if (this.options.noClip) this._parts = this._rings; else {var b;a = 0;for (var e = this._rings.length; ae; a++) (b = Mc(this._rings[a], c, !0)).length && this._parts.push(b)}},_updatePath: function () {this._renderer._updatePoly(this, !0)},_containsPoint: function (c) {var a,b,e,d,m = !1;if (!this._pxBounds.contains(c)) return !1;var h = 0;for (e = this._parts.length; he; h++) {var f = 0;for (b =( d =( a = this._parts[h]).length) - 1; fd; b = f++) {var p = a[f];b = a[b];p.y > c.y != b.y > c.y && c.x < (b.x - p.x) * (c.y - p.y) / (b.y - p.y) + p.x && (m =! m)}}return m || ua.prototype._containsPoint.call(this, c, !0)}}),va = Ja.extend({initialize: function (c, a) {m(this, a);this._layers = {};c && this.addData(c)},addData: function (c) {var a,b,e = na(c)? c: c.features;if (e) {c = 0;for (a = e.length; ca; c++) ((b = e[c]).geometries || b.geometry || b.features || b.coordinates) && this.addData(b);return this}b = this.options;return b.filter && ! b.filter(c)? this: (e = bc(c, b))? (e.feature = zb(c), e.defaultOptions = e.options, this.resetStyle(e), b.onEachFeature && b.onEachFeature(c, e), this.addLayer(e)): this},resetStyle: function (c) {return c.options = d({}, c.defaultOptions),this._setLayerStyle(c, this.options.style),this},setStyle: function (c) {return this.eachLayer(function (a) {this._setLayerStyle(a, c)}, this)},_setLayerStyle: function (c, a) {"function" == typeof a && (a = a(c.feature));c.setStyle && c.setStyle(a)}}),vc = {toGeoJSON: function (c) {return Ra(this, {type: "Point",coordinates: dc(this.getLatLng(), c)})}};db.include(vc);uc.include(vc);Eb.include(vc);ua.include({toGeoJSON: function (c) {var a = ! ta(this._latlngs);c = yb(this._latlngs, a? 1: 0,!1,c);return Ra(this, {type: (a? "Multi": "") + "LineString",coordinates: c})}});Qa.include({toGeoJSON: function (c) {var a = ! ta(this._latlngs),b = a && ! ta(this._latlngs[0]);c = yb(this._latlngs, b? 2: a? 1: 0,!0,c);return a || (c =[c]),Ra(this, {type: (b? "Multi": "") + "Polygon",coordinates: c})}});Va.include({toMultiPoint: function (c) {var a = [];return this.eachLayer(function (b) {a.push(b.toGeoJSON(c).geometry.coordinates)}),Ra(this, {type: "MultiPoint",coordinates: a})},toGeoJSON: function (c) {var a = this.feature && this.feature.geometry && this.feature.geometry.type;if ("MultiPoint" === a) return this.toMultiPoint(c);var b = "GeometryCollection" === a,e = [];return this.eachLayer(function (a) {a.toGeoJSON && (a = a.toGeoJSON(c), b? e.push(a.geometry): (a = zb(a), "FeatureCollection" === a.type? e.push.apply(e, a.features): e.push(a)))}),b? Ra(this, {geometries: e,type: "GeometryCollection"}): {type: "FeatureCollection",features: e}}});var wc = ia.extend({options: {opacity: 1,alt: "",interactive: !1,crossOrigin: !1,errorOverlayUrl: "",zIndex: 1,className: ""},initialize: function (c, a, b) {this._url = c;this._bounds = A(a);m(this, b)},onAdd: function () {this._image || (this._initImage(), 1 > this.options.opacity && this._updateOpacity());this.options.interactive && (M(this._image, "leaflet-interactive"), this.addInteractiveTarget(this._image));this.getPane().appendChild(this._image);this._reset()},onRemove: function () {R(this._image);this.options.interactive && this.removeInteractiveTarget(this._image)},setOpacity: function (c) {return this.options.opacity = c,this._image && this._updateOpacity(),this},setStyle: function (c) {return c.opacity && this.setOpacity(c.opacity),this},bringToFront: function () {return this._map && Oa(this._image),this},bringToBack: function () {return this._map && Pa(this._image),this},setUrl: function (c) {return this._url = c,this._image && (this._image.src = c),this},setBounds: function (c) {return this._bounds = A(c),this._map && this._reset(),this},getEvents: function () {var c = {zoom: this._reset,viewreset: this._reset};return this._zoomAnimated && (c.zoomanim = this._animateZoom),c},setZIndex: function (c) {return this.options.zIndex = c,this._updateZIndex(),this},getBounds: function () {return this._bounds},getElement: function () {return this._image},_initImage: function () {var c = "IMG" === this._url.tagName,a = this._image = c? this._url: O("img");M(a, "leaflet-image-layer");this._zoomAnimated && M(a, "leaflet-zoom-animated");this.options.className && M(a, this.options.className);a.onselectstart = e;a.onmousemove = e;a.onload = g(this.fire, this, "load");a.onerror = g(this._overlayOnError, this, "error");this.options.crossOrigin && (a.crossOrigin = "");this.options.zIndex && this._updateZIndex();c? this._url = a.src: (a.src = this._url, a.alt = this.options.alt)},_animateZoom: function (c) {var a = this._map.getZoomScale(c.zoom);c = this._map._latLngBoundsToNewLayerBounds(this._bounds, c.zoom, c.center).min;Ga(this._image, c, a)},_reset: function () {var c = this._image,a = new H(this._map.latLngToLayerPoint(this._bounds.getNorthWest()), this._map.latLngToLayerPoint(this._bounds.getSouthEast())),b = a.getSize();W(c, a.min);c.style.width = b.x + "px";c.style.height = b.y + "px"},_updateOpacity: function () {fa(this._image, this.options.opacity)},_updateZIndex: function () {this._image && void 0 !== this.options.zIndex && null !== this.options.zIndex && (this._image.style.zIndex = this.options.zIndex)},_overlayOnError: function () {this.fire("error");var c = this.options.errorOverlayUrl;c && this._url !== c && (this._url = c, this._image.src = c)}}),gd = wc.extend({options: {autoplay: !0,loop: !0},_initImage: function () {var c = "VIDEO" === this._url.tagName,a = this._image = c? this._url: O("video");if (M(a, "leaflet-image-layer"), this._zoomAnimated && M(a, "leaflet-zoom-animated"), a.onselectstart = e, a.onmousemove = e, a.onloadeddata = g(this.fire, this, "load"), c) {c = a.getElementsByTagName("source");for (var b =[], d = 0; dc.length; d++) b.push(c[d].src);this._url = 0c.length? b: [a.src]} else for (na(this._url) || (this._url =[this._url]), a.autoplay =!! this.options.autoplay, a.loop =!! this.options.loop, c = 0; c this._url.length; c++) b = O("source"),b.src = this._url[c],a.appendChild(b)}}),xa = ia.extend({options: {offset: [0, 7],className: "",pane: "popupPane"},initialize: function (c, a) {m(this, c);this._source = a},onAdd: function (c) {this._zoomAnimated = c._zoomAnimated;this._container || this._initLayout();c._fadeAnimated && fa(this._container, 0);clearTimeout(this._removeTimeout);this.getPane().appendChild(this._container);this.update();c._fadeAnimated && fa(this._container, 1);this.bringToFront()},onRemove: function (c) {c._fadeAnimated? (fa(this._container, 0), this._removeTimeout = setTimeout(g(R, void 0, this._container), 200)): R(this._container)},getLatLng: function () {return this._latlng},setLatLng: function (c) {return this._latlng = J(c),this._map && (this._updatePosition(), this._adjustPan()),this},getContent: function () {return this._content},setContent: function (c) {return this._content = c,this.update(),this},getElement: function () {return this._container},update: function () {this._map && (this._container.style.visibility = "hidden", this._updateContent(), this._updateLayout(), this._updatePosition(), this._container.style.visibility = "", this._adjustPan())},getEvents: function () {var c = {zoom: this._updatePosition,viewreset: this._updatePosition};return this._zoomAnimated && (c.zoomanim = this._animateZoom),c},isOpen: function () {return !!this._map && this._map.hasLayer(this)},bringToFront: function () {return this._map && Oa(this._container),this},bringToBack: function () {return this._map && Pa(this._container),this},_updateContent: function () {if (this._content) {var c = this._contentNode,a = "function" == typeof this._content? this._content(this._source || this): this._content;if ("string" == typeof a) c.innerHTML = a; else {for (; c.hasChildNodes();) c.removeChild(c.firstChild);c.appendChild(a)}this.fire("contentupdate")}},_updatePosition: function () {if (this._map) {var c = this._map.latLngToLayerPoint(this._latlng),a = E(this.options.offset),b = this._getAnchor();this._zoomAnimated? W(this._container, c.add(b)): a = a.add(c).add(b);c = this._containerBottom = - a.y;a = this._containerLeft = -Math.round(this._containerWidth / 2) + a.x;this._container.style.bottom = c + "px";this._container.style.left = a + "px"}},_getAnchor: function () {return [0, 0]}}),Xa = xa.extend({options: {maxWidth: 300,minWidth: 50,maxHeight: null,autoPan: !0,autoPanPaddingTopLeft: null,autoPanPaddingBottomRight: null,autoPanPadding: [5, 5],keepInView: !1,closeButton: !0,autoClose: !0,closeOnEscapeKey: !0,className: ""},openOn: function (c) {return c.openPopup(this),this},onAdd: function (c) {xa.prototype.onAdd.call(this, c);c.fire("popupopen", {popup: this});this._source && (this._source.fire("popupopen", {popup: this}, !0), this._source instanceof Ca || this._source.on("preclick", Fa))},onRemove: function (c) {xa.prototype.onRemove.call(this, c);c.fire("popupclose", {popup: this});this._source && (this._source.fire("popupclose", {popup: this}, !0), this._source instanceof Ca || this._source.off("preclick", Fa))},getEvents: function () {var c = xa.prototype.getEvents.call(this);return(void 0 !== this.options.closeOnClick? this.options.closeOnClick: this._map.options.closePopupOnClick) && (c.preclick = this._close),this.options.keepInView && (c.moveend = this._adjustPan),c},_close: function () {this._map && this._map.closePopup(this)},_initLayout: function () {var c = this._container = O("div", "leaflet-popup " + (this.options.className || "") + " leaflet-zoom-animated"),a = this._wrapper = O("div", "leaflet-popup-content-wrapper", c);if (this._contentNode = O("div", "leaflet-popup-content", a), ab(a), Pb(this._contentNode), K(a, "contextmenu", Fa), this._tipContainer = O("div", "leaflet-popup-tip-container", c), this._tip = O("div", "leaflet-popup-tip", this._tipContainer), this.options.closeButton) c = this._closeButton = O("a", "leaflet-popup-close-button", c),c.href = "#close",c.innerHTML = "&#215;",K(c, "click", this._onCloseButtonClick, this)},_updateLayout: function () {var c = this._contentNode,a = c.style;a.width = "";a.whiteSpace = "nowrap";var b = c.offsetWidth;b = Math.min(b, this.options.maxWidth);b = Math.max(b, this.options.minWidth);a.width = b + 1 + "px";a.whiteSpace = "";a.height = "";b = c.offsetHeight;var e = this.options.maxHeight;e && b > e? (a.height = e + "px", M(c, "leaflet-popup-scrolled")): S(c, "leaflet-popup-scrolled");this._containerWidth = this._container.offsetWidth},_animateZoom: function (c) {c = this._map._latLngToNewLayerPoint(this._latlng, c.zoom, c.center);var a = this._getAnchor();W(this._container, c.add(a))},_adjustPan: function () {if (!(!this.options.autoPan || this._map._panAnim && this._map._panAnim._inProgress)) {var c = this._map,a = parseInt(bb(this._container, "marginBottom"), 10) || 0;a = this._container.offsetHeight + a;var b = this._containerWidth,e = new C(this._containerLeft, - a - this._containerBottom);e._add(Ha(this._container));e = c.layerPointToContainerPoint(e);var d = E(this.options.autoPanPadding),m = E(this.options.autoPanPaddingTopLeft || d);d = E(this.options.autoPanPaddingBottomRight || d);var h = c.getSize(),f = 0,p = 0;e.x + b + d.x > h.x && (f = e.x + b - h.x + d.x);0 > e.x - f - m.x && (f = e.x - m.x);e.y + a + d.y > h.y && (p = e.y + a - h.y + d.y);0 > e.y - p - m.y && (p = e.y - m.y);(f || p) && c.fire("autopanstart").panBy([f, p])}},_onCloseButtonClick: function (c) {this._close();pa(c)},_getAnchor: function () {return E(this._source && this._source._getPopupAnchor? this._source._getPopupAnchor(): [0, 0])}});N.mergeOptions({closePopupOnClick: !0});N.include({openPopup: function (c, a, b) {return c instanceof Xa || (c =( new Xa(b)).setContent(c)),a && c.setLatLng(a),this.hasLayer(c)? this: (this._popup && this._popup.options.autoClose && this.closePopup(), this._popup = c, this.addLayer(c))},closePopup: function (c) {return c && c !== this._popup || (c = this._popup, this._popup = null),c && this.removeLayer(c),this}});ia.include({bindPopup: function (c, a) {return c instanceof Xa? (m(c, a), this._popup = c, c._source = this): (this._popup && ! a || (this._popup = new Xa(a, this)), this._popup.setContent(c)),this._popupHandlersAdded || (this.on({click: this._openPopup, keypress: this._onKeyPress, remove: this.closePopup, move: this._movePopup}), this._popupHandlersAdded =! 0),this},unbindPopup: function () {return this._popup && (this.off({click: this._openPopup, keypress: this._onKeyPress, remove: this.closePopup, move: this._movePopup}), this._popupHandlersAdded =! 1, this._popup = null),this},openPopup: function (c, a) {if (c instanceof ia || (a = c, c = this), c instanceof Ja) for (var b in this._layers) {c = this._layers[b];break}return a || (a = c.getCenter? c.getCenter(): c.getLatLng()),this._popup && this._map && (this._popup._source = c, this._popup.update(), this._map.openPopup(this._popup, a)),this},closePopup: function () {return this._popup && this._popup._close(),this},togglePopup: function (c) {return this._popup && (this._popup._map? this.closePopup(): this.openPopup(c)),this},isPopupOpen: function () {return !!this._popup && this._popup.isOpen()},setPopupContent: function (c) {return this._popup && this._popup.setContent(c),this},getPopup: function () {return this._popup},_openPopup: function (c) {var a = c.layer || c.target;this._popup && this._map && (pa(c), a instanceof Ca? this.openPopup(c.layer || c.target, c.latlng): this._map.hasLayer(this._popup) && this._popup._source === a? this.closePopup(): this.openPopup(a, c.latlng))},_movePopup: function (c) {this._popup.setLatLng(c.latlng)},_onKeyPress: function (c) {13 === c.originalEvent.keyCode && this._openPopup(c)}});var Ya = xa.extend({options: {pane: "tooltipPane",offset: [0, 0],direction: "auto",permanent: !1,sticky: !1,interactive: !1,opacity: .9},onAdd: function (c) {xa.prototype.onAdd.call(this, c);this.setOpacity(this.options.opacity);c.fire("tooltipopen", {tooltip: this});this._source && this._source.fire("tooltipopen", {tooltip: this}, !0)},onRemove: function (c) {xa.prototype.onRemove.call(this, c);c.fire("tooltipclose", {tooltip: this});this._source && this._source.fire("tooltipclose", {tooltip: this}, !0)},getEvents: function () {var c = xa.prototype.getEvents.call(this);return oa && !this.options.permanent && (c.preclick = this._close),c},_close: function () {this._map && this._map.closeTooltip(this)},_initLayout: function () {this._contentNode = this._container = O("div", "leaflet-tooltip " + (this.options.className || "") + " leaflet-zoom-" + (this._zoomAnimated? "animated": "hide"))},_updateLayout: function () {},_adjustPan: function () {},_setPosition: function (c) {var a = this._map,b = this._container,e = a.latLngToContainerPoint(a.getCenter());a = a.layerPointToContainerPoint(c);var d = this.options.direction,m = b.offsetWidth,h = b.offsetHeight,f = E(this.options.offset),p = this._getAnchor();"top" === d? c = c.add(E(- m / 2 + f.x, - h + f.y + p.y, !0)): "bottom" === d? c = c.subtract(E(m / 2 - f.x, - f.y, !0)): "center" === d? c = c.subtract(E(m / 2 + f.x, h / 2 - p.y + f.y, !0)): "right" === d || "auto" === d && a.x e.x? (d = "right", c = c.add(E(f.x + p.x, p.y - h / 2 + f.y, !0))): (d = "left", c = c.subtract(E(m + p.x - f.x, h / 2 - p.y - f.y, !0)));S(b, "leaflet-tooltip-right");S(b, "leaflet-tooltip-left");S(b, "leaflet-tooltip-top");S(b, "leaflet-tooltip-bottom");M(b, "leaflet-tooltip-" + d);W(b, c)},_updatePosition: function () {var c = this._map.latLngToLayerPoint(this._latlng);this._setPosition(c)},setOpacity: function (c) {this.options.opacity = c;this._container && fa(this._container, c)},_animateZoom: function (c) {c = this._map._latLngToNewLayerPoint(this._latlng, c.zoom, c.center);this._setPosition(c)},_getAnchor: function () {return E(this._source && this._source._getTooltipAnchor && !this.options.sticky? this._source._getTooltipAnchor(): [0, 0])}});N.include({openTooltip: function (c, a, b) {return c instanceof Ya || (c =( new Ya(b)).setContent(c)),a && c.setLatLng(a),this.hasLayer(c)? this: this.addLayer(c)},closeTooltip: function (c) {return c && this.removeLayer(c),this}});ia.include({bindTooltip: function (c, a) {return c instanceof Ya? (m(c, a), this._tooltip = c, c._source = this): (this._tooltip && ! a || (this._tooltip = new Ya(a, this)), this._tooltip.setContent(c)),this._initTooltipInteractions(),this._tooltip.options.permanent && this._map && this._map.hasLayer(this) && this.openTooltip(),this},unbindTooltip: function () {return this._tooltip && (this._initTooltipInteractions(!0), this.closeTooltip(), this._tooltip = null),this},_initTooltipInteractions: function (c) {if (c || !this._tooltipHandlersAdded) {var a = {remove: this.closeTooltip,move: this._moveTooltip};this._tooltip.options.permanent? a.add = this._openTooltip: (a.mouseover = this._openTooltip, a.mouseout = this.closeTooltip, this._tooltip.options.sticky && (a.mousemove = this._moveTooltip), oa && (a.click = this._openTooltip));this[c? "off": "on"](a);this._tooltipHandlersAdded = ! c}},openTooltip: function (c, a) {if (c instanceof ia || (a = c, c = this), c instanceof Ja) for (var b in this._layers) {c = this._layers[b];break}return a || (a = c.getCenter? c.getCenter(): c.getLatLng()),this._tooltip && this._map && (this._tooltip._source = c, this._tooltip.update(), this._map.openTooltip(this._tooltip, a), this._tooltip.options.interactive && this._tooltip._container && (M(this._tooltip._container, "leaflet-clickable"), this.addInteractiveTarget(this._tooltip._container))),this},closeTooltip: function () {return this._tooltip && (this._tooltip._close(), this._tooltip.options.interactive && this._tooltip._container && (S(this._tooltip._container, "leaflet-clickable"), this.removeInteractiveTarget(this._tooltip._container))),this},toggleTooltip: function (c) {return this._tooltip && (this._tooltip._map? this.closeTooltip(): this.openTooltip(c)),this},isTooltipOpen: function () {return this._tooltip.isOpen()},setTooltipContent: function (c) {return this._tooltip && this._tooltip.setContent(c),this},getTooltip: function () {return this._tooltip},_openTooltip: function (c) {var a = c.layer || c.target;this._tooltip && this._map && this.openTooltip(a, this._tooltip.options.sticky? c.latlng: void 0)},_moveTooltip: function (c) {var a,b,e = c.latlng;this._tooltip.options.sticky && c.originalEvent && (a = this._map.mouseEventToContainerPoint(c.originalEvent), b = this._map.containerPointToLayerPoint(a), e = this._map.layerPointToLatLng(b));this._tooltip.setLatLng(e)}});var hd = Wa.extend({options: {iconSize: [12, 12],html: !1,bgPos: null,className: "leaflet-div-icon"},createIcon: function (c) {c = c && "DIV" === c.tagName? c: document.createElement("div");var a = this.options;if (c.innerHTML =! 1 !== a.html? a.html: "",a.bgPos) a = E(a.bgPos),c.style.backgroundPosition = - a.x + "px " + - a.y + "px";return this._setIconStyles(c, "icon"),c},createShadow: function () {return null}});Wa.Default = kb;var xc = ia.extend({options: {tileSize: 256,opacity: 1,updateWhenIdle: Ua,updateWhenZooming: !0,updateInterval: 200,zIndex: 1,bounds: null,minZoom: 0,maxZoom: void 0,maxNativeZoom: void 0,minNativeZoom: void 0,noWrap: !1,pane: "tilePane",className: "",keepBuffer: 2},initialize: function (c) {m(this, c)},onAdd: function () {this._initContainer();this._levels = {};this._tiles = {};this._resetView();this._update()},beforeAdd: function (c) {c._addZoomLimit(this)},onRemove: function (c) {this._removeAllTiles();R(this._container);c._removeZoomLimit(this);this._container = null;this._tileZoom = void 0},bringToFront: function () {return this._map && (Oa(this._container), this._setAutoZIndex(Math.max)),this},bringToBack: function () {return this._map && (Pa(this._container), this._setAutoZIndex(Math.min)),this},getContainer: function () {return this._container},setOpacity: function (c) {return this.options.opacity = c,this._updateOpacity(),this},setZIndex: function (c) {return this.options.zIndex = c,this._updateZIndex(),this},isLoading: function () {return this._loading},redraw: function () {return this._map && (this._removeAllTiles(), this._update()),this},getEvents: function () {var c = {viewprereset: this._invalidateAll,viewreset: this._resetView,zoom: this._resetView,moveend: this._onMoveEnd};return this.options.updateWhenIdle || (this._onMove || (this._onMove = b(this._onMoveEnd, this.options.updateInterval, this)), c.move = this._onMove),this._zoomAnimated && (c.zoomanim = this._animateZoom),c},createTile: function () {return document.createElement("div")},getTileSize: function () {var c = this.options.tileSize;return c instanceof C? c: new C(c, c)},_updateZIndex: function () {this._container && void 0 !== this.options.zIndex && null !== this.options.zIndex && (this._container.style.zIndex = this.options.zIndex)},_setAutoZIndex: function (c) {for (var a, b = this.getPane().children, e = - c(-1 / 0, 1 / 0), d = 0, m = b.length; dm; d++) a = b[d].style.zIndex,b[d] !== this._container && a && (e = c(e, + a));isFinite(e) && (this.options.zIndex = e + c(-1, 1), this._updateZIndex())},_updateOpacity: function () {if (this._map && ! Ta) {fa(this._container, this.options.opacity);var c = + new Date,a = !1,b = !1,e;for (e in this._tiles) {var d = this._tiles[e];if (d.current && d.loaded) {var m = Math.min(1, (c - d.loaded) / 200);fa(d.el, m);1 > m? a = !0: (d.active? b =! 0: this._onOpaqueTile(d),d.active =! 0)}}b && !this._noPrune && this._pruneTiles();a && (u(this._fadeFrame), this._fadeFrame = y(this._updateOpacity, this))}},_onOpaqueTile: e,_initContainer: function () {this._container || (this._container = O("div", "leaflet-layer " + (this.options.className || "")), this._updateZIndex(), 1 > this.options.opacity && this._updateOpacity(), this.getPane().appendChild(this._container))},_updateLevels: function () {var c = this._tileZoom,a = this.options.maxZoom;if (void 0 !== c) {for (var b in this._levels) this._levels[b].el.children.length || b === c? (this._levels[b].el.style.zIndex = a - Math.abs(c - b), this._onUpdateLevel(b)): (R(this._levels[b].el), this._removeTilesAtZoom(b), this._onRemoveLevel(b), delete this._levels[b]);b = this._levels[c];var e = this._map;return b || ((b = this._levels[c] ={}).el = O("div", "leaflet-tile-container leaflet-zoom-animated", this._container), b.el.style.zIndex = a, b.origin = e.project(e.unproject(e.getPixelOrigin()), c).round(), b.zoom = c, this._setZoomTransform(b, e.getCenter(), e.getZoom()), b.el.offsetWidth, this._onCreateLevel(b)),this._level = b,b}},_onUpdateLevel: e,_onRemoveLevel: e,_onCreateLevel: e,_pruneTiles: function () {if (this._map) {var c,a,b = this._map.getZoom();if (b > this.options.maxZoom || b this.options.minZoom) this._removeAllTiles(); else {for (c in this._tiles) (a = this._tiles[c]).retain = a.current;for (c in this._tiles) (a = this._tiles[c]).current && ! a.active && (b = a.coords, this._retainParent(b.x, b.y, b.z, b.z - 5) || this._retainChildren(b.x, b.y, b.z, b.z + 2));for (c in this._tiles) this._tiles[c].retain || this._removeTile(c)}}},_removeTilesAtZoom: function (c) {for (var a in this._tiles) this._tiles[a].coords.z === c && this._removeTile(a)},_removeAllTiles: function () {for (var c in this._tiles) this._removeTile(c)},_invalidateAll: function () {for (var c in this._levels) R(this._levels[c].el),this._onRemoveLevel(c),delete this._levels[c];this._removeAllTiles();this._tileZoom = void 0},_retainParent: function (c, a, b, e) {c = Math.floor(c / 2);a = Math.floor(a / 2);-- b;var d = new C(+ c, + a);d.z = + b;d = this._tileCoordsToKey(d);return(d = this._tiles[d]) && d.active? (d.retain =! 0, !0): (d && d.loaded && (d.retain =! 0), b > e && this._retainParent(c, a, b, e))},_retainChildren: function (c, a, b, e) {for (var d = 2 * c; d < 2 * c + 2; d++) for (var l = 2 * a; l < 2 * a + 2; l++) {var m = new C(d, l);m.z = b + 1;m = this._tileCoordsToKey(m);(m = this._tiles[m]) && m.active? m.retain = !0: (m && m.loaded && (m.retain =! 0), b + 1e && this._retainChildren(d, l, b + 1, e))}},_resetView: function (c) {c = c && (c.pinch || c.flyTo);this._setView(this._map.getCenter(), this._map.getZoom(), c, c)},_animateZoom: function (c) {this._setView(c.center, c.zoom, !0, c.noUpdate)},_clampZoom: function (c) {var a = this.options;return void 0 !== a.minNativeZoom && ca.minNativeZoom? a.minNativeZoom: void 0 !== a.maxNativeZoom && a.maxNativeZoom c? a.maxNativeZoom : c},_setView: function (c, a, b, e) {var d = this._clampZoom(Math.round(a));(void 0 !== this.options.maxZoom && d > this.options.maxZoom || void 0 !== this.options.minZoom && d this.options.minZoom) && (d = void 0);var l = this.options.updateWhenZooming && d !== this._tileZoom;e && ! l || (this._tileZoom = d, this._abortLoading && this._abortLoading(), this._updateLevels(), this._resetGrid(), void 0 !== d && this._update(c), b || this._pruneTiles(), this._noPrune =!! b);this._setZoomTransforms(c, a)},_setZoomTransforms: function (c, a) {for (var b in this._levels) this._setZoomTransform(this._levels[b], c, a)},_setZoomTransform: function (c, a, b) {var e = this._map.getZoomScale(b, c.zoom);a = c.origin.multiplyBy(e).subtract(this._map._getNewPixelOrigin(a, b)).round();ha? Ga(c.el, a, e): W(c.el, a)},_resetGrid: function () {var c = this._map,a = c.options.crs,b = this._tileSize = this.getTileSize(),e = this._tileZoom,d = this._map.getPixelWorldBounds(this._tileZoom);d && (this._globalTileRange = this._pxBoundsToTileRange(d));this._wrapX = a.wrapLng && !this.options.noWrap && [Math.floor(c.project([0, a.wrapLng[0]], e).x / b.x),Math.ceil(c.project([0, a.wrapLng[1]], e).x / b.y)];this._wrapY = a.wrapLat && !this.options.noWrap && [Math.floor(c.project([a.wrapLat[0], 0], e).y / b.x),Math.ceil(c.project([a.wrapLat[1], 0], e).y / b.y)]},_onMoveEnd: function () {this._map && !this._map._animatingZoom && this._update()},_getTiledPixelBounds: function (c) {var a = this._map,b = a._animatingZoom? Math.max(a._animateToZoom, a.getZoom()): a.getZoom();b = a.getZoomScale(b, this._tileZoom);c = a.project(c, this._tileZoom).floor();a = a.getSize().divideBy(2 * b);return new H(c.subtract(a), c.add(a))},_update: function (c) {var a = this._map;if (a) {var b = this._clampZoom(a.getZoom());if (void 0 === c && (c = a.getCenter()), void 0 !== this._tileZoom) {a = this._getTiledPixelBounds(c);var e = this._pxBoundsToTileRange(a),d = e.getCenter();a = [];var m = this.options.keepBuffer;m = new H(e.getBottomLeft().subtract([m, - m]), e.getTopRight().add([m, - m]));if (!(isFinite(e.min.x) && isFinite(e.min.y) && isFinite(e.max.x) && isFinite(e.max.y))) throw Error("Attempted to load an infinite number of tiles");for (var h in this._tiles) {var f = this._tiles[h].coords;f.z === this._tileZoom && m.contains(new C(f.x, f.y)) || (this._tiles[h].current =! 1)}if (1 Math.abs(b - this._tileZoom)) this._setView(c, b); else {for (b = e.min.y; b <= e.max.y; b++) for (c = e.min.x; c <= e.max.x; c++) if (h = new C(c, b), h.z = this._tileZoom, this._isValidTile(h)) (m = this._tiles[this._tileCoordsToKey(h)])? m.current = !0: a.push(h);if (a.sort(function (c, a) {return c.distanceTo(d) - a.distanceTo(d)}), 0 !== a.length) {this._loading || (this._loading =! 0, this.fire("loading"));e = document.createDocumentFragment();for (c = 0; ca.length; c++) this._addTile(a[c], e);this._level.el.appendChild(e)}}}}},_isValidTile: function (c) {var a = this._map.options.crs;if (! a.infinite) {var b = this._globalTileRange;if (! a.wrapLng && (c.x b.min.x || c.x > b.max.x) || ! a.wrapLat && (c.y b.min.y || c.y > b.max.y)) return !1}if (!this.options.bounds) return !0;c = this._tileCoordsToBounds(c);return A(this.options.bounds).overlaps(c)},_keyToBounds: function (c) {return this._tileCoordsToBounds(this._keyToTileCoords(c))},_tileCoordsToNwSe: function (c) {var a = this._map,b = this.getTileSize(),e = c.scaleBy(b);b = e.add(b);return [a.unproject(e, c.z),a.unproject(b, c.z)]},_tileCoordsToBounds: function (c) {c = this._tileCoordsToNwSe(c);c = new D(c[0], c[1]);return this.options.noWrap || (c = this._map.wrapLatLngBounds(c)),c},_tileCoordsToKey: function (c) {return c.x + ":" + c.y + ":" + c.z},_keyToTileCoords: function (c) {c = c.split(":");var a = new C(+ c[0], + c[1]);return a.z = + c[2],a},_removeTile: function (c) {var a = this._tiles[c];a && (Sc || a.el.setAttribute("src", "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="), R(a.el), delete this._tiles[c], this.fire("tileunload", {tile: a.el,coords: this._keyToTileCoords(c)}))},_initTile: function (c) {M(c, "leaflet-tile");var a = this.getTileSize();c.style.width = a.x + "px";c.style.height = a.y + "px";c.onselectstart = e;c.onmousemove = e;Ta && 1 > this.options.opacity && fa(c, this.options.opacity);Na && ! gb && (c.style.WebkitBackfaceVisibility = "hidden")},_addTile: function (c, a) {var b = this._getTilePos(c),e = this._tileCoordsToKey(c),d = this.createTile(this._wrapCoords(c), g(this._tileReady, this, c));this._initTile(d);2 > this.createTile.length && y(g(this._tileReady, this, c, null, d));W(d, b);this._tiles[e] = {el: d,coords: c,current: !0};a.appendChild(d);this.fire("tileloadstart", {tile: d,coords: c})},_tileReady: function (c, a, b) {if (this._map) {a && this.fire("tileerror", {error: a,tile: b,coords: c});var e = this._tileCoordsToKey(c);(b = this._tiles[e]) && (b.loaded = + new Date, this._map._fadeAnimated? (fa(b.el, 0), u(this._fadeFrame), this._fadeFrame = y(this._updateOpacity, this)): (b.active =! 0, this._pruneTiles()),a || (M(b.el, "leaflet-tile-loaded"), this.fire("tileload", {tile: b.el,coords: c})),this._noTilesToLoad() && (this._loading =! 1, this.fire("load"), Ta || !this._map._fadeAnimated? y(this._pruneTiles, this): setTimeout(g(this._pruneTiles, this), 250)))}},_getTilePos: function (c) {return c.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords: function (c) {var a = new C(this._wrapX? p(c.x, this._wrapX): c.x,this._wrapY? p(c.y, this._wrapY): c.y);return a.z = c.z,a},_pxBoundsToTileRange: function (c) {var a = this.getTileSize();return new H(c.min.unscaleBy(a).floor(), c.max.unscaleBy(a).ceil().subtract([1, 1]))},_noTilesToLoad: function () {for (var c in this._tiles) if (!this._tiles[c].loaded) return !1;return !0}}),eb = xc.extend({options: {minZoom: 0,maxZoom: 18,subdomains: "abc",errorTileUrl: "",zoomOffset: 0,tms: !1,zoomReverse: !1,detectRetina: !1,crossOrigin: !1},initialize: function (c, a) {this._url = c;(a = m(this, a)).detectRetina && Ba && 0a.maxZoom && (a.tileSize = Math.floor(a.tileSize / 2), a.zoomReverse? (a.zoomOffset --, a.minZoom ++): (a.zoomOffset ++, a.maxZoom --),a.minZoom = Math.max(0, a.minZoom));"string" == typeof a.subdomains && (a.subdomains = a.subdomains.split(""));Na || this.on("tileunload", this._onTileRemove)},setUrl: function (c, a) {return this._url = c,a || this.redraw(),this},createTile: function (c, a) {var b = document.createElement("img");return K(b, "load", g(this._tileOnLoad, this, a, b)),K(b, "error", g(this._tileOnError, this, a, b)),this.options.crossOrigin && (b.crossOrigin = ""),b.alt = "",b.setAttribute("role", "presentation"),b.src = this.getTileUrl(c),b},getTileUrl: function (c) {var a = {r: Ba? "@2x": "",s: this._getSubdomain(c),x: c.x,y: c.y,z: this._getZoomForUrl()};this._map && !this._map.options.crs.infinite && (c = this._globalTileRange.max.y - c.y, this.options.tms && (a.y = c), a["-y"] = c);return w(this._url, d(a, this.options))},_tileOnLoad: function (c, a) {Ta? setTimeout(g(c, this, null, a), 0): c(null, a)},_tileOnError: function (c, a, b) {var e = this.options.errorTileUrl;e && a.getAttribute("src") !== e && (a.src = e);c(b, a)},_onTileRemove: function (c) {c.tile.onload = null},_getZoomForUrl: function () {var c = this._tileZoom,a = this.options.maxZoom,b = this.options.zoomOffset;return this.options.zoomReverse && (c = a - c),c + b},_getSubdomain: function (c) {return this.options.subdomains[Math.abs(c.x + c.y) % this.options.subdomains.length]},_abortLoading: function () {var c,a;for (c in this._tiles) this._tiles[c].coords.z !== this._tileZoom && ((a = this._tiles[c].el).onload = e, a.onerror = e, a.complete || (a.src = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=", R(a), delete this._tiles[c]))}}),id = eb.extend({defaultWmsParams: {service: "WMS",request: "GetMap",layers: "",styles: "",format: "image/jpeg",transparent: !1,version: "1.1.1"},options: {crs: null,uppercase: !1},initialize: function (c, a) {this._url = c;var b = d({}, this.defaultWmsParams);for (e in a) e in this.options || (b[e] = a[e]);var e = m(this, a).detectRetina && Ba? 2: 1;var l = this.getTileSize();b.width = l.x * e;b.height = l.y * e;this.wmsParams = b},onAdd: function (c) {this._crs = this.options.crs || c.options.crs;this._wmsVersion = parseFloat(this.wmsParams.version);this.wmsParams[1.3 <= this._wmsVersion? "crs": "srs"] = this._crs.code;eb.prototype.onAdd.call(this, c)},getTileUrl: function (c) {var a = this._tileCoordsToNwSe(c),b = this._crs;b = I(b.project(a[0]), b.project(a[1]));a = b.min;b = b.max;a = (1.3 <= this._wmsVersion && this._crs === ed? [a.y, a.x, b.y, b.x]: [a.x, a.y, b.x, b.y]).join(",");c = L.TileLayer.prototype.getTileUrl.call(this, c);return c + t(this.wmsParams, c, this.options.uppercase) + (this.options.uppercase? "&BBOX=": "&bbox=") + a},setParams: function (c, a) {return d(this.wmsParams, c),a || this.redraw(),this}});eb.WMS = id;Oc.wms = function (c, a) {return new id(c, a)};var ra = ia.extend({options: {padding: .1,tolerance: 0},initialize: function (c) {m(this, c);f(this);this._layers = this._layers || {}},onAdd: function () {this._container || (this._initContainer(), this._zoomAnimated && M(this._container, "leaflet-zoom-animated"));this.getPane().appendChild(this._container);this._update();this.on("update", this._updatePaths, this)},onRemove: function () {this.off("update", this._updatePaths, this);this._destroyContainer()},getEvents: function () {var c = {viewreset: this._reset,zoom: this._onZoom,moveend: this._update,zoomend: this._onZoomEnd};return this._zoomAnimated && (c.zoomanim = this._onAnimZoom),c},_onAnimZoom: function (c) {this._updateTransform(c.center, c.zoom)},_onZoom: function () {this._updateTransform(this._map.getCenter(), this._map.getZoom())},_updateTransform: function (c, a) {var b = this._map.getZoomScale(a, this._zoom),e = Ha(this._container),d = this._map.getSize().multiplyBy(.5 + this.options.padding),m = this._map.project(this._center, a);m = this._map.project(c, a).subtract(m);e = d.multiplyBy(- b).add(e).add(d).subtract(m);ha? Ga(this._container, e, b): W(this._container, e)},_reset: function () {this._update();this._updateTransform(this._center, this._zoom);for (var c in this._layers) this._layers[c]._reset()},_onZoomEnd: function () {for (var c in this._layers) this._layers[c]._project()},_updatePaths: function () {for (var c in this._layers) this._layers[c]._update()},_update: function () {var c = this.options.padding,a = this._map.getSize(),b = this._map.containerPointToLayerPoint(a.multiplyBy(- c)).round();this._bounds = new H(b, b.add(a.multiplyBy(1 + 2 * c)).round());this._center = this._map.getCenter();this._zoom = this._map.getZoom()}}),fc = ra.extend({getEvents: function () {var c = ra.prototype.getEvents.call(this);return c.viewprereset = this._onViewPreReset,c},_onViewPreReset: function () {this._postponeUpdatePaths = !0},onAdd: function () {ra.prototype.onAdd.call(this);this._draw()},_initContainer: function () {var c = this._container = document.createElement("canvas");K(c, "mousemove", b(this._onMouseMove, 32, this), this);K(c, "click dblclick mousedown mouseup contextmenu", this._onClick, this);K(c, "mouseout", this._handleMouseOut, this);this._ctx = c.getContext("2d")},_destroyContainer: function () {delete this._ctx;R(this._container);U(this._container);delete this._container},_updatePaths: function () {if (!this._postponeUpdatePaths) {this._redrawBounds = null;for (var c in this._layers) this._layers[c]._update();this._redraw()}},_update: function () {if (!this._map._animatingZoom || !this._bounds) {this._drawnLayers = {};ra.prototype._update.call(this);var c = this._bounds,a = this._container,b = c.getSize(),e = Ba? 2: 1;W(a, c.min);a.width = e * b.x;a.height = e * b.y;a.style.width = b.x + "px";a.style.height = b.y + "px";Ba && this._ctx.scale(2, 2);this._ctx.translate(- c.min.x, - c.min.y);this.fire("update")}},_reset: function () {ra.prototype._reset.call(this);this._postponeUpdatePaths && (this._postponeUpdatePaths =! 1, this._updatePaths())},_initPath: function (c) {this._updateDashArray(c);this._layers[f(c)] = c;c = c._order = {layer: c,prev: this._drawLast,next: null};this._drawLast && (this._drawLast.next = c);this._drawLast = c;this._drawFirst = this._drawFirst || this._drawLast},_addPath: function (c) {this._requestRedraw(c)},_removePath: function (c) {var a = c._order,b = a.next;a = a.prev;b? b.prev = a: this._drawLast = a;a? a.next = b: this._drawFirst = b;delete c._order;delete this._layers[L.stamp(c)];this._requestRedraw(c)},_updatePath: function (c) {this._extendRedrawBounds(c);c._project();c._update();this._requestRedraw(c)},_updateStyle: function (c) {this._updateDashArray(c);this._requestRedraw(c)},_updateDashArray: function (c) {if (c.options.dashArray) {var a,b = c.options.dashArray.split(","),e = [];for (a = 0; ab.length; a++) e.push(Number(b[a]));c.options._dashArray = e}},_requestRedraw: function (c) {this._map && (this._extendRedrawBounds(c), this._redrawRequest = this._redrawRequest || y(this._redraw, this))},_extendRedrawBounds: function (c) {if (c._pxBounds) {var a = (c.options.weight || 0) + 1;this._redrawBounds = this._redrawBounds || new H;this._redrawBounds.extend(c._pxBounds.min.subtract([a, a]));this._redrawBounds.extend(c._pxBounds.max.add([a, a]))}},_redraw: function () {this._redrawRequest = null;this._redrawBounds && (this._redrawBounds.min._floor(), this._redrawBounds.max._ceil());this._clear();this._draw();this._redrawBounds = null},_clear: function () {var c = this._redrawBounds;if (c) {var a = c.getSize();this._ctx.clearRect(c.min.x, c.min.y, a.x, a.y)} else this._ctx.clearRect(0, 0, this._container.width, this._container.height)},_draw: function () {var c = this._redrawBounds;if (this._ctx.save(), c) {var a = c.getSize();this._ctx.beginPath();this._ctx.rect(c.min.x, c.min.y, a.x, a.y);this._ctx.clip()}this._drawing = !0;for (var b = this._drawFirst; b; b = b.next) a = b.layer,(! c || a._pxBounds && a._pxBounds.intersects(c)) && a._updatePath();this._drawing = !1;this._ctx.restore()},_updatePoly: function (c, a) {if (this._drawing) {var b,e,d = c._parts,m = d.length,h = this._ctx;if (m) {this._drawnLayers[c._leaflet_id] = c;h.beginPath();for (b = 0; bm; b++) {var l = 0;for (e = d[b].length; le; l++) {var f = d[b][l];h[l? "lineTo": "moveTo"](f.x, f.y)}a && h.closePath()}this._fillStroke(h, c)}}},_updateCircle: function (c) {if (this._drawing && ! c._empty()) {var a = c._point,b = this._ctx,e = Math.max(Math.round(c._radius), 1),d = (Math.max(Math.round(c._radiusY), 1) || e) / e;this._drawnLayers[c._leaflet_id] = c;1 !== d && (b.save(), b.scale(1, d));b.beginPath();b.arc(a.x, a.y / d, e, 0, 2 * Math.PI, !1);1 !== d && b.restore();this._fillStroke(b, c)}},_fillStroke: function (c, a) {var b = a.options;b.fill && (c.globalAlpha = b.fillOpacity, c.fillStyle = b.fillColor || b.color, c.fill(b.fillRule || "evenodd"));b.stroke && 0 !== b.weight && (c.setLineDash && c.setLineDash(a.options && a.options._dashArray || []), c.globalAlpha = b.opacity, c.lineWidth = b.weight, c.strokeStyle = b.color, c.lineCap = b.lineCap, c.lineJoin = b.lineJoin, c.stroke())},_onClick: function (c) {for (var a, b, e = this._map.mouseEventToLayerPoint(c), d = this._drawFirst; d; d = d.next) (a = d.layer).options.interactive && a._containsPoint(e) && !this._map._draggableMoved(a) && (b = a);b && (Qb(c), this._fireEvent([b], c))},_onMouseMove: function (c) {if (this._map && !this._map.dragging.moving() && !this._map._animatingZoom) {var a = this._map.mouseEventToLayerPoint(c);this._handleMouseHover(c, a)}},_handleMouseOut: function (c) {var a = this._hoveredLayer;a && (S(this._container, "leaflet-interactive"), this._fireEvent([a], c, "mouseout"), this._hoveredLayer = null)},_handleMouseHover: function (c, a) {for (var b, e, d = this._drawFirst; d; d = d.next) (b = d.layer).options.interactive && b._containsPoint(a) && (e = b);e !== this._hoveredLayer && (this._handleMouseOut(c), e && (M(this._container, "leaflet-interactive"), this._fireEvent([e], c, "mouseover"), this._hoveredLayer = e));this._hoveredLayer && this._fireEvent([this._hoveredLayer], c)},_fireEvent: function (c, a, b) {this._map._fireDOMEvent(a, b || a.type, c)},_bringToFront: function (c) {var a = c._order,b = a.next,e = a.prev;b && (b.prev = e, e? e.next = b: b && (this._drawFirst = b),a.prev = this._drawLast,this._drawLast.next = a,a.next = null,this._drawLast = a,this._requestRedraw(c))},_bringToBack: function (c) {var a = c._order,b = a.next,e = a.prev;e && (e.next = b, b? b.prev = e: e && (this._drawLast = e),a.prev = null,a.next = this._drawFirst,this._drawFirst.prev = a,this._drawFirst = a,this._requestRedraw(c))}}),lb = function () {try {return document.namespaces.add("lvml", "urn:schemas-microsoft-com:vml"),function (c) {return document.createElement("<lvml:" + c + ' class="lvml">')}} catch (c) {return function (c) {return document.createElement("<" + c + ' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),Jd = {_initContainer: function () {this._container = O("div", "leaflet-vml-container")},_update: function () {this._map._animatingZoom || (ra.prototype._update.call(this), this.fire("update"))},_initPath: function (c) {var a = c._container = lb("shape");M(a, "leaflet-vml-shape " + (this.options.className || ""));a.coordsize = "1 1";c._path = lb("path");a.appendChild(c._path);this._updateStyle(c);this._layers[f(c)] = c},_addPath: function (c) {var a = c._container;this._container.appendChild(a);c.options.interactive && c.addInteractiveTarget(a)},_removePath: function (c) {var a = c._container;R(a);c.removeInteractiveTarget(a);delete this._layers[f(c)]},_updateStyle: function (c) {var a = c._stroke,b = c._fill,e = c.options,d = c._container;d.stroked = !! e.stroke;d.filled = !! e.fill;e.stroke? (a || (a = c._stroke = lb("stroke")), d.appendChild(a), a.weight = e.weight + "px", a.color = e.color, a.opacity = e.opacity, e.dashArray? a.dashStyle = na(e.dashArray)? e.dashArray.join(" "): e.dashArray.replace(/( *, *)/g, " "): a.dashStyle = "",a.endcap = e.lineCap.replace("butt", "flat"),a.joinstyle = e.lineJoin): a && (d.removeChild(a), c._stroke = null);e.fill? (b || (b = c._fill = lb("fill")), d.appendChild(b), b.color = e.fillColor || e.color, b.opacity = e.fillOpacity): b && (d.removeChild(b), c._fill = null)},_updateCircle: function (c) {var a = c._point.round(),b = Math.round(c._radius),e = Math.round(c._radiusY || b);this._setPath(c, c._empty()? "M0 0": "AL " + a.x + "," + a.y + " " + b + "," + e + " 0,23592600")},_setPath: function (c, a) {c._path.v = a},_bringToFront: function (c) {Oa(c._container)},_bringToBack: function (c) {Pa(c._container)}},Fb = Ab? lb: V,Sa = ra.extend({getEvents: function () {var c = ra.prototype.getEvents.call(this);return c.zoomstart = this._onZoomStart,c},_initContainer: function () {this._container = Fb("svg");this._container.setAttribute("pointer-events", "none");this._rootGroup = Fb("g");this._container.appendChild(this._rootGroup)},_destroyContainer: function () {R(this._container);U(this._container);delete this._container;delete this._rootGroup;delete this._svgSize},_onZoomStart: function () {this._update()},_update: function () {if (!this._map._animatingZoom || !this._bounds) {ra.prototype._update.call(this);var c = this._bounds,a = c.getSize(),b = this._container;this._svgSize && this._svgSize.equals(a) || (this._svgSize = a, b.setAttribute("width", a.x), b.setAttribute("height", a.y));W(b, c.min);b.setAttribute("viewBox", [c.min.x, c.min.y, a.x, a.y].join(" "));this.fire("update")}},_initPath: function (c) {var a = c._path = Fb("path");c.options.className && M(a, c.options.className);c.options.interactive && M(a, "leaflet-interactive");this._updateStyle(c);this._layers[f(c)] = c},_addPath: function (c) {this._rootGroup || this._initContainer();this._rootGroup.appendChild(c._path);c.addInteractiveTarget(c._path)},_removePath: function (c) {R(c._path);c.removeInteractiveTarget(c._path);delete this._layers[f(c)]},_updatePath: function (c) {c._project();c._update()},_updateStyle: function (c) {var a = c._path;c = c.options;a && (c.stroke? (a.setAttribute("stroke", c.color), a.setAttribute("stroke-opacity", c.opacity), a.setAttribute("stroke-width", c.weight), a.setAttribute("stroke-linecap", c.lineCap), a.setAttribute("stroke-linejoin", c.lineJoin), c.dashArray? a.setAttribute("stroke-dasharray", c.dashArray): a.removeAttribute("stroke-dasharray"),c.dashOffset? a.setAttribute("stroke-dashoffset", c.dashOffset): a.removeAttribute("stroke-dashoffset")): a.setAttribute("stroke", "none"),c.fill? (a.setAttribute("fill", c.fillColor || c.color), a.setAttribute("fill-opacity", c.fillOpacity), a.setAttribute("fill-rule", c.fillRule || "evenodd")): a.setAttribute("fill", "none"))},_updatePoly: function (c, a) {this._setPath(c, Y(c._parts, a))},_updateCircle: function (c) {var a = c._point,b = Math.max(Math.round(c._radius), 1),e = "a" + b + "," + (Math.max(Math.round(c._radiusY), 1) || b) + " 0 1,0 ";a = c._empty()? "M0 0": "M" + (a.x - b) + "," + a.y + e + 2 * b + ",0 " + e + 2 * - b + ",0 ";this._setPath(c, a)},_setPath: function (c, a) {c._path.setAttribute("d", a)},_bringToFront: function (c) {Oa(c._path)},_bringToBack: function (c) {Pa(c._path)}});Ab && Sa.include(Jd);N.include({getRenderer: function (c) {c = c.options.renderer || this._getPaneRenderer(c.options.pane) || this.options.renderer || this._renderer;return c || (c = this._renderer = this.options.preferCanvas && ec() || gc()),this.hasLayer(c) || this.addLayer(c),c},_getPaneRenderer: function (c) {if ("overlayPane" === c || void 0 === c) return !1;var a = this._paneRenderers[c];return void 0 === a && (a = Sa && gc({pane: c}) || fc && ec({pane: c}), this._paneRenderers[c] = a),a}});var jd = Qa.extend({initialize: function (c, a) {Qa.prototype.initialize.call(this, this._boundsToLatLngs(c), a)},setBounds: function (c) {return this.setLatLngs(this._boundsToLatLngs(c))},_boundsToLatLngs: function (c) {return c = A(c),[c.getSouthWest(), c.getNorthWest(), c.getNorthEast(), c.getSouthEast()]}});Sa.create = Fb;Sa.pointsToPath = Y;va.geometryToLayer = bc;va.coordsToLatLng = cc;va.coordsToLatLngs = xb;va.latLngToCoords = dc;va.latLngsToCoords = yb;va.getFeature = Ra;va.asFeature = zb;N.mergeOptions({boxZoom: !0});var kd = qa.extend({initialize: function (c) {this._map = c;this._container = c._container;this._pane = c._panes.overlayPane;this._resetStateTimeout = 0;c.on("unload", this._destroy, this)},addHooks: function () {K(this._container, "mousedown", this._onMouseDown, this)},removeHooks: function () {U(this._container, "mousedown", this._onMouseDown, this)},moved: function () {return this._moved},_destroy: function () {R(this._pane);delete this._pane},_resetState: function () {this._resetStateTimeout = 0;this._moved = !1},_clearDeferredResetState: function () {0 !== this._resetStateTimeout && (clearTimeout(this._resetStateTimeout), this._resetStateTimeout = 0)},_onMouseDown: function (c) {if (! c.shiftKey || 1 !== c.which && 1 !== c.button) return !1;this._clearDeferredResetState();this._resetState();Cb();Xb();this._startPoint = this._map.mouseEventToContainerPoint(c);K(document, {contextmenu: pa,mousemove: this._onMouseMove,mouseup: this._onMouseUp,keydown: this._onKeyDown}, this)},_onMouseMove: function (c) {this._moved || (this._moved =! 0, this._box = O("div", "leaflet-zoom-box", this._container), M(this._container, "leaflet-crosshair"), this._map.fire("boxzoomstart"));this._point = this._map.mouseEventToContainerPoint(c);c = new H(this._point, this._startPoint);var a = c.getSize();W(this._box, c.min);this._box.style.width = a.x + "px";this._box.style.height = a.y + "px"},_finish: function () {this._moved && (R(this._box), S(this._container, "leaflet-crosshair"));Db();Yb();U(document, {contextmenu: pa,mousemove: this._onMouseMove,mouseup: this._onMouseUp,keydown: this._onKeyDown}, this)},_onMouseUp: function (c) {1 !== c.which && 1 !== c.button || (this._finish(), !this._moved) || (this._clearDeferredResetState(), this._resetStateTimeout = setTimeout(g(this._resetState, this), 0), c = new D(this._map.containerPointToLatLng(this._startPoint), this._map.containerPointToLatLng(this._point)), this._map.fitBounds(c).fire("boxzoomend", {boxZoomBounds: c}))},_onKeyDown: function (c) {27 === c.keyCode && this._finish()}});N.addInitHook("addHandler", "boxZoom", kd);N.mergeOptions({doubleClickZoom: !0});var ld = qa.extend({addHooks: function () {this._map.on("dblclick", this._onDoubleClick, this)},removeHooks: function () {this._map.off("dblclick", this._onDoubleClick, this)},_onDoubleClick: function (c) {var a = this._map,b = a.getZoom(),e = a.options.zoomDelta;b = c.originalEvent.shiftKey? b - e: b + e;"center" === a.options.doubleClickZoom? a.setZoom(b): a.setZoomAround(c.containerPoint, b)}});N.addInitHook("addHandler", "doubleClickZoom", ld);N.mergeOptions({dragging: !0,inertia: ! gb,inertiaDeceleration: 3400,inertiaMaxSpeed: 1 / 0,easeLinearity: .2,worldCopyJump: !1,maxBoundsViscosity: 0});var md = qa.extend({addHooks: function () {if (!this._draggable) {var c = this._map;this._draggable = new Ka(c._mapPane, c._container);this._draggable.on({dragstart: this._onDragStart,drag: this._onDrag,dragend: this._onDragEnd}, this);this._draggable.on("predrag", this._onPreDragLimit, this);c.options.worldCopyJump && (this._draggable.on("predrag", this._onPreDragWrap, this), c.on("zoomend", this._onZoomEnd, this), c.whenReady(this._onZoomEnd, this))}M(this._map._container, "leaflet-grab leaflet-touch-drag");this._draggable.enable();this._positions = [];this._times = []},removeHooks: function () {S(this._map._container, "leaflet-grab");S(this._map._container, "leaflet-touch-drag");this._draggable.disable()},moved: function () {return this._draggable && this._draggable._moved},moving: function () {return this._draggable && this._draggable._moving},_onDragStart: function () {var c = this._map;if (c._stop(), this._map.options.maxBounds && this._map.options.maxBoundsViscosity) {var a = A(this._map.options.maxBounds);this._offsetLimit = I(this._map.latLngToContainerPoint(a.getNorthWest()).multiplyBy(-1), this._map.latLngToContainerPoint(a.getSouthEast()).multiplyBy(-1).add(this._map.getSize()));this._viscosity = Math.min(1, Math.max(0, this._map.options.maxBoundsViscosity))} else this._offsetLimit = null;c.fire("movestart").fire("dragstart");c.options.inertia && (this._positions =[], this._times =[])},_onDrag: function (c) {if (this._map.options.inertia) {var a = this._lastTime = + new Date,b = this._lastPos = this._draggable._absPos || this._draggable._newPos;this._positions.push(b);this._times.push(a);this._prunePositions(a)}this._map.fire("move", c).fire("drag", c)},_prunePositions: function (c) {for (; 1 this._positions.length && 50c - this._times[0];) this._positions.shift(),this._times.shift()},_onZoomEnd: function () {var c = this._map.getSize().divideBy(2);this._initialWorldOffset = this._map.latLngToLayerPoint([0, 0]).subtract(c).x;this._worldWidth = this._map.getPixelWorldBounds().getSize().x},_viscousLimit: function (c, a) {return c - (c - a) * this._viscosity},_onPreDragLimit: function () {if (this._viscosity && this._offsetLimit) {var c = this._draggable._newPos.subtract(this._draggable._startPos),a = this._offsetLimit;c.x a.min.x && (c.x = this._viscousLimit(c.x, a.min.x));c.y a.min.y && (c.y = this._viscousLimit(c.y, a.min.y));c.x > a.max.x && (c.x = this._viscousLimit(c.x, a.max.x));c.y > a.max.y && (c.y = this._viscousLimit(c.y, a.max.y));this._draggable._newPos = this._draggable._startPos.add(c)}},_onPreDragWrap: function () {var c = this._worldWidth,a = Math.round(c / 2),b = this._initialWorldOffset,e = this._draggable._newPos.x,d = (e - a + b) % c + a - b;c = (e + a + b) % c - a - b;b = Math.abs(d + b)Math.abs(c + b)? d: c;this._draggable._absPos = this._draggable._newPos.clone();this._draggable._newPos.x = b},_onDragEnd: function (c) {var a = this._map,b = a.options,e = ! b.inertia || 2 > this._times.length;if (a.fire("dragend", c), e) a.fire("moveend"); else {this._prunePositions(+ new Date);c = this._lastPos.subtract(this._positions[0]);var d = b.easeLinearity;e = c.multiplyBy(d / ((this._lastTime - this._times[0]) / 1E3));var m = e.distanceTo([0, 0]);c = Math.min(b.inertiaMaxSpeed, m);e = e.multiplyBy(c / m);var h = c / (b.inertiaDeceleration * d),f = e.multiplyBy(- h / 2).round();f.x || f.y? (f = a._limitOffset(f, a.options.maxBounds), y(function () {a.panBy(f, {duration: h,easeLinearity: d,noMoveStart: !0,animate: !0})})): a.fire("moveend")}}});N.addInitHook("addHandler", "dragging", md);N.mergeOptions({keyboard: !0,keyboardPanDelta: 80});var nd = qa.extend({keyCodes: {left: [37],right: [39],down: [40],up: [38],zoomIn: [187, 107, 61, 171],zoomOut: [189, 109, 54, 173]},initialize: function (c) {this._map = c;this._setPanDelta(c.options.keyboardPanDelta);this._setZoomDelta(c.options.zoomDelta)},addHooks: function () {var c = this._map._container;0 >= c.tabIndex && (c.tabIndex = "0");K(c, {focus: this._onFocus,blur: this._onBlur,mousedown: this._onMouseDown}, this);this._map.on({focus: this._addHooks,blur: this._removeHooks}, this)},removeHooks: function () {this._removeHooks();U(this._map._container, {focus: this._onFocus,blur: this._onBlur,mousedown: this._onMouseDown}, this);this._map.off({focus: this._addHooks,blur: this._removeHooks}, this)},_onMouseDown: function () {if (!this._focused) {var c = document.body,a = document.documentElement,b = c.scrollTop || a.scrollTop;c = c.scrollLeft || a.scrollLeft;this._map._container.focus();window.scrollTo(c, b)}},_onFocus: function () {this._focused = !0;this._map.fire("focus")},_onBlur: function () {this._focused = !1;this._map.fire("blur")},_setPanDelta: function (c) {var a,b = this._panKeys = {},e = this.keyCodes;var d = 0;for (a = e.left.length; da; d++) b[e.left[d]] = [-1 * c,0];d = 0;for (a = e.right.length; da; d++) b[e.right[d]] = [c, 0];d = 0;for (a = e.down.length; da; d++) b[e.down[d]] = [0, c];d = 0;for (a = e.up.length; da; d++) b[e.up[d]] = [0, -1 * c]},_setZoomDelta: function (c) {var a,b = this._zoomKeys = {},e = this.keyCodes;var d = 0;for (a = e.zoomIn.length; da; d++) b[e.zoomIn[d]] = c;d = 0;for (a = e.zoomOut.length; da; d++) b[e.zoomOut[d]] = - c},_addHooks: function () {K(document, "keydown", this._onKeyDown, this)},_removeHooks: function () {U(document, "keydown", this._onKeyDown, this)},_onKeyDown: function (c) {if (!(c.altKey || c.ctrlKey || c.metaKey)) {var a = c.keyCode;var b = this._map;if (a in this._panKeys) {if (b._panAnim && b._panAnim._inProgress) return;a = this._panKeys[a];c.shiftKey && (a = E(a).multiplyBy(3));b.panBy(a);b.options.maxBounds && b.panInsideBounds(b.options.maxBounds)} else if (a in this._zoomKeys) b.setZoom(b.getZoom() + (c.shiftKey? 3: 1) * this._zoomKeys[a]); else {if (27 !== a || ! b._popup || ! b._popup.options.closeOnEscapeKey) return;b.closePopup()}pa(c)}}});N.addInitHook("addHandler", "keyboard", nd);N.mergeOptions({scrollWheelZoom: !0,wheelDebounceTime: 40,wheelPxPerZoomLevel: 60});var od = qa.extend({addHooks: function () {K(this._map._container, "mousewheel", this._onWheelScroll, this);this._delta = 0},removeHooks: function () {U(this._map._container, "mousewheel", this._onWheelScroll, this)},_onWheelScroll: function (c) {var a = Fc(c),b = this._map.options.wheelDebounceTime;this._delta += a;this._lastMousePos = this._map.mouseEventToContainerPoint(c);this._startTime || (this._startTime = + new Date);a = Math.max(b - (+ new Date - this._startTime), 0);clearTimeout(this._timer);this._timer = setTimeout(g(this._performZoom, this), a);pa(c)},_performZoom: function () {var c = this._map,a = c.getZoom(),b = this._map.options.zoomSnap || 0;c._stop();var e = 4 * Math.log(2 / (1 + Math.exp(-Math.abs(this._delta / (4 * this._map.options.wheelPxPerZoomLevel))))) / Math.LN2;b = b? Math.ceil(e / b) * b: e;b = c._limitZoom(a + (0 this._delta? b: - b)) - a;this._delta = 0;this._startTime = null;b && ("center" === c.options.scrollWheelZoom? c.setZoom(a + b): c.setZoomAround(this._lastMousePos, a + b))}});N.addInitHook("addHandler", "scrollWheelZoom", od);N.mergeOptions({tap: !0,tapTolerance: 15});var pd = qa.extend({addHooks: function () {K(this._map._container, "touchstart", this._onDown, this)},removeHooks: function () {U(this._map._container, "touchstart", this._onDown, this)},_onDown: function (c) {if (c.touches) {if (ea(c), this._fireClick =! 0, 1c.touches.length) return this._fireClick = !1,void clearTimeout(this._holdTimeout);var a = c.touches[0];c = a.target;this._startPos = this._newPos = new C(a.clientX, a.clientY);c.tagName && "a" === c.tagName.toLowerCase() && M(c, "leaflet-active");this._holdTimeout = setTimeout(g(function () {this._isTapValid() && (this._fireClick =! 1, this._onUp(), this._simulateEvent("contextmenu", a))}, this), 1E3);this._simulateEvent("mousedown", a);K(document, {touchmove: this._onMove,touchend: this._onUp}, this)}},_onUp: function (c) {if (clearTimeout(this._holdTimeout), U(document, {touchmove: this._onMove,touchend: this._onUp}, this), this._fireClick && c && c.changedTouches) {c = c.changedTouches[0];var a = c.target;a && a.tagName && "a" === a.tagName.toLowerCase() && S(a, "leaflet-active");this._simulateEvent("mouseup", c);this._isTapValid() && this._simulateEvent("click", c)}},_isTapValid: function () {return this._newPos.distanceTo(this._startPos) <= this._map.options.tapTolerance},_onMove: function (c) {c = c.touches[0];this._newPos = new C(c.clientX, c.clientY);this._simulateEvent("mousemove", c)},_simulateEvent: function (c, a) {var b = document.createEvent("MouseEvents");b._simulated = !0;a.target._simulatedClick = !0;b.initMouseEvent(c, !0, !0, window, 1, a.screenX, a.screenY, a.clientX, a.clientY, !1, !1, !1, !1, 0, null);a.target.dispatchEvent(b)}});oa && ! ka && N.addInitHook("addHandler", "tap", pd);N.mergeOptions({touchZoom: oa && ! gb,bounceAtZoomLimits: !0});var qd = qa.extend({addHooks: function () {M(this._map._container, "leaflet-touch-zoom");K(this._map._container, "touchstart", this._onTouchStart, this)},removeHooks: function () {S(this._map._container, "leaflet-touch-zoom");U(this._map._container, "touchstart", this._onTouchStart, this)},_onTouchStart: function (c) {var a = this._map;if (c.touches && 2 === c.touches.length && ! a._animatingZoom && !this._zooming) {var b = a.mouseEventToContainerPoint(c.touches[0]),e = a.mouseEventToContainerPoint(c.touches[1]);this._centerPoint = a.getSize()._divideBy(2);this._startLatLng = a.containerPointToLatLng(this._centerPoint);"center" !== a.options.touchZoom && (this._pinchStartLatLng = a.containerPointToLatLng(b.add(e)._divideBy(2)));this._startDist = b.distanceTo(e);this._startZoom = a.getZoom();this._moved = !1;this._zooming = !0;a._stop();K(document, "touchmove", this._onTouchMove, this);K(document, "touchend", this._onTouchEnd, this);ea(c)}},_onTouchMove: function (c) {if (c.touches && 2 === c.touches.length && this._zooming) {var a = this._map,b = a.mouseEventToContainerPoint(c.touches[0]),e = a.mouseEventToContainerPoint(c.touches[1]),d = b.distanceTo(e) / this._startDist;if (this._zoom = a.getScaleZoom(d, this._startZoom), ! a.options.bounceAtZoomLimits && (this._zoom a.getMinZoom() && 1 > d || this._zoom > a.getMaxZoom() && 1d) && (this._zoom = a._limitZoom(this._zoom)), "center" === a.options.touchZoom) {if (this._center = this._startLatLng, 1 === d) return} else {b = b._add(e)._divideBy(2)._subtract(this._centerPoint);if (1 === d && 0 === b.x && 0 === b.y) return;this._center = a.unproject(a.project(this._pinchStartLatLng, this._zoom).subtract(b), this._zoom)}this._moved || (a._moveStart(!0, !1), this._moved =! 0);u(this._animRequest);a = g(a._move, a, this._center, this._zoom, {pinch: !0,round: !1});this._animRequest = y(a, this, !0);ea(c)}},_onTouchEnd: function () {this._moved && this._zooming? (this._zooming =! 1, u(this._animRequest), U(document, "touchmove", this._onTouchMove), U(document, "touchend", this._onTouchEnd), this._map.options.zoomAnimation? this._map._animateZoom(this._center, this._map._limitZoom(this._zoom), !0, this._map.options.zoomSnap): this._map._resetView(this._center, this._map._limitZoom(this._zoom))): this._zooming = !1}});N.addInitHook("addHandler", "touchZoom", qd);N.BoxZoom = kd;N.DoubleClickZoom = ld;N.Drag = md;N.Keyboard = nd;N.ScrollWheelZoom = od;N.Tap = pd;N.TouchZoom = qd;var Kd = window.L;window.L = a;Object.freeze = Qc;a.version = "1.3.1+HEAD.ba6f97f";a.noConflict = function () {return window.L = Kd,this};a.Control = ma;a.control = jb;a.Browser = Ad;a.Evented = fb;a.Mixin = Dd;a.Util = ud;a.Class = G;a.Handler = qa;a.extend = d;a.bind = g;a.stamp = f;a.setOptions = m;a.DomEvent = Bd;a.DomUtil = Cd;a.PosAnimation = $c;a.Draggable = Ka;a.LineUtil = Ed;a.PolyUtil = Fd;a.Point = C;a.point = E;a.Bounds = H;a.bounds = I;a.Transformation = aa;a.transformation = Q;a.Projection = Gd;a.LatLng = F;a.latLng = J;a.LatLngBounds = D;a.latLngBounds = A;a.CRS = wa;a.GeoJSON = va;a.geoJSON = Nc;a.geoJson = Nc;a.Layer = ia;a.LayerGroup = Va;a.layerGroup = function (c, a) {return new Va(c, a)};a.FeatureGroup = Ja;a.featureGroup = function (c) {return new Ja(c)};a.ImageOverlay = wc;a.imageOverlay = function (c, a, b) {return new wc(c, a, b)};a.VideoOverlay = gd;a.videoOverlay = function (c, a, b) {return new gd(c, a, b)};a.DivOverlay = xa;a.Popup = Xa;a.popup = function (c, a) {return new Xa(c, a)};a.Tooltip = Ya;a.tooltip = function (c, a) {return new Ya(c, a)};a.Icon = Wa;a.icon = function (c) {return new Wa(c)};a.DivIcon = hd;a.divIcon = function (c) {return new hd(c)};a.Marker = db;a.marker = function (c, a) {return new db(c, a)};a.TileLayer = eb;a.tileLayer = Oc;a.GridLayer = xc;a.gridLayer = function (c) {return new xc(c)};a.SVG = Sa;a.svg = gc;a.Renderer = ra;a.Canvas = fc;a.canvas = ec;a.Path = Ca;a.CircleMarker = Eb;a.circleMarker = function (c, a) {return new Eb(c, a)};a.Circle = uc;a.circle = function (c, a, b) {return new uc(c, a, b)};a.Polyline = ua;a.polyline = function (c, a) {return new ua(c, a)};a.Polygon = Qa;a.polygon = function (c, a) {return new Qa(c, a)};a.Rectangle = jd;a.rectangle = function (c, a) {return new jd(c, a)};a.Map = N;a.map = function (c, a) {return new N(c, a)}});!function (a) {if ("object" == typeof exports) module.exports = a(); else if ("function" == typeof define && define.amd) define(a); else {var d;"undefined" != typeof window? d = window: "undefined" != typeof global? d = global: "undefined" != typeof self && (d = self);d.proj4 = a()}}(function () {return function b(d, g, f) {function p(h, q) {if (! g[h]) {if (! d[h]) {var m = "function" == typeof require && require;if (! q && m) return m(h, !0);if (e) return e(h, !0);throw Error("Cannot find module '" + h + "'");}m = g[h] = {exports: {}};d[h][0].call(m.exports, function (b) {var e = d[h][1][b];return p(e? e: b)}, m, m.exports, b, d, g, f)}return g[h].exports}for (var e = "function" == typeof require && require, q = 0; qf.length; q++) p(f[q]);return p}({1: [function (d, g, f) {function b(e, d, h) {if (!(this instanceof b)) return new b(e, d, h);Array.isArray(e)? (this.x = e[0], this.y = e[1], this.z = e[2] || 0): "object" == typeof e? (this.x = e.x, this.y = e.y, this.z = e.z || 0): "string" == typeof e && "undefined" == typeof d? (e = e.split(","), this.x = parseFloat(e[0], 10), this.y = parseFloat(e[1], 10), this.z = parseFloat(e[2], 10) || 0): (this.x = e, this.y = d, this.z = h || 0);console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var p = d("mgrs");b.fromMGRS = function (e) {return new b(p.toPoint(e))};b.prototype.toMGRS = function (b) {return p.forward([this.x, this.y], b)};g.exports = b}, {mgrs: 67}],2: [function (d, g, f) {function b(d, f) {if (!(this instanceof b)) return new b(d);f = f || function (b) {if (b) throw b;};var m = p(d);if ("object" != typeof m) return void f(d);m = q(m);var h = b.projections.get(m.projName);h? (e(this, m), e(this, h), this.init(), f(null, this)): f(d)}var p = d("./parseCode"),e = d("./extend");f = d("./projections");var q = d("./deriveConstants");b.projections = f;b.projections.start();g.exports = b}, {"./deriveConstants": 33,"./extend": 34,"./parseCode": 37,"./projections": 39}],3: [function (d, g, f) {g.exports = function (b, d, e) {var f,h,p,m = e.x,g = e.y,w = e.z || 0;for (p = 0; 3 > p; p++) if (! d || 2 !== p || void 0 !== e.z) switch (0 === p? (f = m, h = "x"): 1 === p? (f = g, h = "y"): (f = w, h = "z"),b.axis[p]) {case "e": e[h] = f;break;case "w": e[h] = - f;break;case "n": e[h] = f;break;case "s": e[h] = - f;break;case "u":void 0 !== e[h] && (e.z = f);break;case "d":void 0 !== e[h] && (e.z = - f);break;default:return null}return e}}, {}],4: [function (d, g, f) {var b = Math.PI / 2,p = d("./sign");g.exports = function (e) {return Math.abs(e)b? e: e - p(e) * Math.PI}}, {"./sign": 21}],5: [function (d, g, f) {var b = 2 * Math.PI,p = d("./sign");g.exports = function (e) {return 3.14159265359 >= Math.abs(e)? e: e - p(e) * b}}, {"./sign": 21}],6: [function (d, g, f) {g.exports = function (b) {return 1 Math.abs(b) && (b = 1b? 1: -1),Math.asin(b)}}, {}],7: [function (d, g, f) {g.exports = function (b) {return 1 - .25 * b * (1 + b / 16 * (3 + 1.25 * b))}}, {}],8: [function (d, g, f) {g.exports = function (b) {return.375 * b * (1 + .25 * b * (1 + .46875 * b))}}, {}],9: [function (d, g, f) {g.exports = function (b) {return.05859375 * b * b * (1 + .75 * b)}}, {}],10: [function (d, g, f) {g.exports = function (b) {return 35 / 3072 * b * b * b}}, {}],11: [function (d, g, f) {g.exports = function (b, d, e) {d *= e;return b / Math.sqrt(1 - d * d)}}, {}],12: [function (d, g, f) {g.exports = function (b, d, e, f, h) {var p;var m = b / d;for (var q = 0; 15 > q; q++) if (p =( b - (d * m - e * Math.sin(2 * m) + f * Math.sin(4 * m) - h * Math.sin(6 * m))) / (d - 2 * e * Math.cos(2 * m) + 4 * f * Math.cos(4 * m) - 6 * h * Math.cos(6 * m)), m += p, 1E-10 >= Math.abs(p)) return m;return 0 / 0}}, {}],13: [function (d, g, f) {var b = Math.PI / 2;g.exports = function (d, e) {if (1E-6 > Math.abs(Math.abs(e) - (1 -(1 - d * d) / (2 * d) * Math.log((1 - d) / (1 + d))))) return 0 > e? -1 * b: b;for (var f, h, p, m, g = Math.asin(.5 * e), w = 0; 30 > w; w++) if (h = Math.sin(g), p = Math.cos(g), m = d * h, f = Math.pow(1 - m * m, 2) / (2 * p) * (e / (1 - d * d) - h / (1 - m * m) + .5 / d * Math.log((1 - m) / (1 + m))), g += f, 1E-10 >= Math.abs(f)) return g;return 0 / 0}}, {}],14: [function (d, g, f) {g.exports = function (b, d, e, f, h) {return b * h - d * Math.sin(2 * h) + e * Math.sin(4 * h) - f * Math.sin(6 * h)}}, {}],15: [function (d, g, f) {g.exports = function (b, d, e) {b *= d;return e / Math.sqrt(1 - b * b)}}, {}],16: [function (d, g, f) {var b = Math.PI / 2;g.exports = function (d, e) {for (var f, h, p = .5 * d, m = b - 2 * Math.atan(e), g = 0; 15 >= g; g++) if (f = d * Math.sin(m), h = b - 2 * Math.atan(e * Math.pow((1 - f) / (1 + f), p)) - m, m += h, 1E-10 >= Math.abs(h)) return m;return -9999}}, {}],17: [function (d, g, f) {g.exports = function (b) {var d = [];d[0] = 1 - b * (.25 + b * (.046875 + b * (.01953125 + .01068115234375 * b)));d[1] = b * (.75 - b * (.046875 + b * (.01953125 + .01068115234375 * b)));var e = b * b;return d[2] = e * (.46875 - b * (.013020833333333334 + .007120768229166667 * b)),e *= b,d[3] = e * (.3645833333333333 - .005696614583333333 * b),d[4] = e * b * .3076171875,d}}, {}],18: [function (d, g, f) {var b = d("./pj_mlfn");g.exports = function (d, e, f) {for (var h = 1 / (1 - e), p = d, m = 20; m; -- m) {var q = Math.sin(p),g = 1 - e * q * q;if (g =( b(p, q, Math.cos(p), f) - d) * g * Math.sqrt(g) * h, p -= g, 1E-10 > Math.abs(g)) break}return p}}, {"./pj_mlfn": 19}],19: [function (d, g, f) {g.exports = function (b, d, e, f) {return e *= d,d *= d,f[0] * b - e * (f[1] + d * (f[2] + d * (f[3] + d * f[4])))}}, {}],20: [function (d, g, f) {g.exports = function (b, d) {var e;return 1E-7b? (e = b * d, (1 - b * b) * (d / (1 - e * e) - .5 / b * Math.log((1 - e) / (1 + e)))): 2 * d}}, {}],21: [function (d, g, f) {g.exports = function (b) {return 0 > b? -1: 1}}, {}],22: [function (d, g, f) {g.exports = function (b, d) {return Math.pow((1 - b) / (1 + b), d)}}, {}],23: [function (d, g, f) {g.exports = function (b) {var d = {x: b[0],y: b[1]};return 2b.length && (d.z = b[2]),3b.length && (d.m = b[3]),d}}, {}],24: [function (d, g, f) {var b = Math.PI / 2;g.exports = function (d, e, f) {f *= d;return f = Math.pow((1 - f) / (1 + f), .5 * d),Math.tan(.5 * (b - e)) / f}}, {}],25: [function (d, g, f) {f.wgs84 = {towgs84: "0,0,0",ellipse: "WGS84",datumName: "WGS84"};f.ch1903 = {towgs84: "674.374,15.056,405.346",ellipse: "bessel",datumName: "swiss"};f.ggrs87 = {towgs84: "-199.87,74.79,246.62",ellipse: "GRS80",datumName: "Greek_Geodetic_Reference_System_1987"};f.nad83 = {towgs84: "0,0,0",ellipse: "GRS80",datumName: "North_American_Datum_1983"};f.nad27 = {nadgrids: "@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse: "clrk66",datumName: "North_American_Datum_1927"};f.potsdam = {towgs84: "606.0,23.0,413.0",ellipse: "bessel",datumName: "Potsdam Rauenberg 1950 DHDN"};f.carthage = {towgs84: "-263.0,6.0,431.0",ellipse: "clark80",datumName: "Carthage 1934 Tunisia"};f.hermannskogel = {towgs84: "653.0,-212.0,449.0",ellipse: "bessel",datumName: "Hermannskogel"};f.ire65 = {towgs84: "482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse: "mod_airy",datumName: "Ireland 1965"};f.rassadiran = {towgs84: "-133.63,-157.5,-158.62",ellipse: "intl",datumName: "Rassadiran"};f.nzgd49 = {towgs84: "59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse: "intl",datumName: "New Zealand Geodetic Datum 1949"};f.osgb36 = {towgs84: "446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse: "airy",datumName: "Airy 1830"};f.s_jtsk = {towgs84: "589,76,480",ellipse: "bessel",datumName: "S-JTSK (Ferro)"};f.beduaram = {towgs84: "-106,-87,188",ellipse: "clrk80",datumName: "Beduaram"};f.gunung_segara = {towgs84: "-403,684,41",ellipse: "bessel",datumName: "Gunung Segara Jakarta"};f.rnb72 = {towgs84: "106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse: "intl",datumName: "Reseau National Belge 1972"}}, {}],26: [function (d, g, f) {f.MERIT = {a: 6378137,rf: 298.257,ellipseName: "MERIT 1983"};f.SGS85 = {a: 6378136,rf: 298.257,ellipseName: "Soviet Geodetic System 85"};f.GRS80 = {a: 6378137,rf: 298.257222101,ellipseName: "GRS 1980(IUGG, 1980)"};f.IAU76 = {a: 6378140,rf: 298.257,ellipseName: "IAU 1976"};f.airy = {a: 6377563.396,b: 6356256.91,ellipseName: "Airy 1830"};f.APL4 = {a: 6378137,rf: 298.25,ellipseName: "Appl. Physics. 1965"};f.NWL9D = {a: 6378145,rf: 298.25,ellipseName: "Naval Weapons Lab., 1965"};f.mod_airy = {a: 6377340.189,b: 6356034.446,ellipseName: "Modified Airy"};f.andrae = {a: 6377104.43,rf: 300,ellipseName: "Andrae 1876 (Den., Iclnd.)"};f.aust_SA = {a: 6378160,rf: 298.25,ellipseName: "Australian Natl & S. Amer. 1969"};f.GRS67 = {a: 6378160,rf: 298.247167427,ellipseName: "GRS 67(IUGG 1967)"};f.bessel = {a: 6377397.155,rf: 299.1528128,ellipseName: "Bessel 1841"};f.bess_nam = {a: 6377483.865,rf: 299.1528128,ellipseName: "Bessel 1841 (Namibia)"};f.clrk66 = {a: 6378206.4,b: 6356583.8,ellipseName: "Clarke 1866"};f.clrk80 = {a: 6378249.145,rf: 293.4663,ellipseName: "Clarke 1880 mod."};f.clrk58 = {a: 6378293.645208759,rf: 294.2606763692654,ellipseName: "Clarke 1858"};f.CPM = {a: 6375738.7,rf: 334.29,ellipseName: "Comm. des Poids et Mesures 1799"};f.delmbr = {a: 6376428,rf: 311.5,ellipseName: "Delambre 1810 (Belgium)"};f.engelis = {a: 6378136.05,rf: 298.2566,ellipseName: "Engelis 1985"};f.evrst30 = {a: 6377276.345,rf: 300.8017,ellipseName: "Everest 1830"};f.evrst48 = {a: 6377304.063,rf: 300.8017,ellipseName: "Everest 1948"};f.evrst56 = {a: 6377301.243,rf: 300.8017,ellipseName: "Everest 1956"};f.evrst69 = {a: 6377295.664,rf: 300.8017,ellipseName: "Everest 1969"};f.evrstSS = {a: 6377298.556,rf: 300.8017,ellipseName: "Everest (Sabah & Sarawak)"};f.fschr60 = {a: 6378166,rf: 298.3,ellipseName: "Fischer (Mercury Datum) 1960"};f.fschr60m = {a: 6378155,rf: 298.3,ellipseName: "Fischer 1960"};f.fschr68 = {a: 6378150,rf: 298.3,ellipseName: "Fischer 1968"};f.helmert = {a: 6378200,rf: 298.3,ellipseName: "Helmert 1906"};f.hough = {a: 6378270,rf: 297,ellipseName: "Hough"};f.intl = {a: 6378388,rf: 297,ellipseName: "International 1909 (Hayford)"};f.kaula = {a: 6378163,rf: 298.24,ellipseName: "Kaula 1961"};f.lerch = {a: 6378139,rf: 298.257,ellipseName: "Lerch 1979"};f.mprts = {a: 6397300,rf: 191,ellipseName: "Maupertius 1738"};f.new_intl = {a: 6378157.5,b: 6356772.2,ellipseName: "New International 1967"};f.plessis = {a: 6376523,rf: 6355863,ellipseName: "Plessis 1817 (France)"};f.krass = {a: 6378245,rf: 298.3,ellipseName: "Krassovsky, 1942"};f.SEasia = {a: 6378155,b: 6356773.3205,ellipseName: "Southeast Asia"};f.walbeck = {a: 6376896,b: 6355834.8467,ellipseName: "Walbeck"};f.WGS60 = {a: 6378165,rf: 298.3,ellipseName: "WGS 60"};f.WGS66 = {a: 6378145,rf: 298.25,ellipseName: "WGS 66"};f.WGS7 = {a: 6378135,rf: 298.26,ellipseName: "WGS 72"};f.WGS84 = {a: 6378137,rf: 298.257223563,ellipseName: "WGS 84"};f.sphere = {a: 6370997,b: 6370997,ellipseName: "Normal Sphere (r=6370997)"}}, {}],27: [function (d, g, f) {f.greenwich = 0;f.lisbon = -9.131906111111;f.paris = 2.337229166667;f.bogota = -74.080916666667;f.madrid = -3.687938888889;f.rome = 12.452333333333;f.bern = 7.439583333333;f.jakarta = 106.807719444444;f.ferro = -17.666666666667;f.brussels = 4.367975;f.stockholm = 18.058277777778;f.athens = 23.7163375;f.oslo = 10.722916666667}, {}],28: [function (d, g, f) {f.ft = {to_meter: .3048};f["us-ft"] = {to_meter: 1200 / 3937}}, {}],29: [function (d, g, f) {function b(b, e, d) {var m;return Array.isArray(d)? (m = q(b, e, d), 3 === d.length? [m.x, m.y, m.z]: [m.x, m.y]): q(b, e, d)}function p(b) {return b instanceof e? b: b.oProj? b.oProj: e(b)}var e = d("./Proj"),q = d("./transform"),h = e("WGS84");g.exports = function (e, d, f) {e = p(e);var m,q = !1;return "undefined" == typeof d? (d = e, e = h, q =! 0): ("undefined" != typeof d.x || Array.isArray(d)) && (f = d, d = e, e = h, q =! 0),d = p(d),f? b(e, d, f): (m ={ forward: function (m) {return b(e, d, m)},inverse: function (m) {return b(d, e, m)}}, q && (m.oProj = d), m)}}, {"./Proj": 2,"./transform": 65}],30: [function (d, g, f) {var b = Math.PI / 2,p = function (b) {if (!(this instanceof p)) return new p(b);if (this.datum_type = 4, b) {if (b.datumCode && "none" === b.datumCode && (this.datum_type = 5), b.datum_params) {for (var e = 0; eb.datum_params.length; e++) b.datum_params[e] = parseFloat(b.datum_params[e]);0 === b.datum_params[0] && 0 === b.datum_params[1] && 0 === b.datum_params[2] || (this.datum_type = 1);3b.datum_params.length && (0 !== b.datum_params[3] || 0 !== b.datum_params[4] || 0 !== b.datum_params[5] || 0 !== b.datum_params[6]) && (this.datum_type = 2, b.datum_params[3] *= 4.84813681109536E-6, b.datum_params[4] *= 4.84813681109536E-6, b.datum_params[5] *= 4.84813681109536E-6, b.datum_params[6] = b.datum_params[6] / 1E6 + 1)}this.datum_type = b.grids? 3: this.datum_type;this.a = b.a;this.b = b.b;this.es = b.es;this.ep2 = b.ep2;this.datum_params = b.datum_params;3 === this.datum_type && (this.grids = b.grids)}};p.prototype = {compare_datums: function (b) {return this.datum_type !== b.datum_type? !1: this.a !== b.a || 5E-11 Math.abs(this.es - b.es)? !1: 1 === this.datum_type? this.datum_params[0] === b.datum_params[0] && this.datum_params[1] === b.datum_params[1] && this.datum_params[2] === b.datum_params[2]: 2 === this.datum_type? this.datum_params[0] === b.datum_params[0] && this.datum_params[1] === b.datum_params[1] && this.datum_params[2] === b.datum_params[2] && this.datum_params[3] === b.datum_params[3] && this.datum_params[4] === b.datum_params[4] && this.datum_params[5] === b.datum_params[5] && this.datum_params[6] === b.datum_params[6]: 3 === this.datum_type || 3 === b.datum_type? this.nadgrids === b.nadgrids: !0},geodetic_to_geocentric: function (e) {var d,h,f,m,p,g,v,x = e.x,z = e.y,y = e.z? e.z: 0;if (- b > z && z > -1.001 * b) z = - b; else if (z > b && 1.001 * b > z) z = b; else if (- b > z || z > b) return null;return x > Math.PI && (x -= 2 * Math.PI),p = Math.sin(z),v = Math.cos(z),g = p * p,m = this.a / Math.sqrt(1 - this.es * g),d = (m + y) * v * Math.cos(x),h = (m + y) * v * Math.sin(x),f = (m * (1 - this.es) + y) * p,e.x = d,e.y = h,e.z = f,0},geocentric_to_geodetic: function (b) {var e,d,f;var m = b.x;var p = b.y;var g = b.z? b.z: 0;if (e = Math.sqrt(m * m + p * p), d = Math.sqrt(m * m + p * p + g * g), 1E-12 > e / this.a) {if (p = 0, 1E-12 > d / this.a) return} else p = Math.atan2(p, m);m = g / d;d = e / d;var v = 1 / Math.sqrt(1 - this.es * (2 - this.es) * d * d);var x = d * (1 - this.es) * v;var z = m * v;var y = 0;do {y++;var u = this.a / Math.sqrt(1 - this.es * z * z);var G = e * x + g * z - u * (1 - this.es * z * z);u = this.es * u / (u + G);v = 1 / Math.sqrt(1 - u * (2 - u) * d * d);u = d * (1 - u) * v;v *= m;var P = v * x - u * z;x = u;z = v} while (1E-24 P * P && 30 > y);return f = Math.atan(v / Math.abs(u)),b.x = p,b.y = f,b.z = G,b},geocentric_to_geodetic_noniter: function (e) {var d,h,f,m,p,g,v,x,z,y,u,G,P,C,E,H = e.x,I = e.y,D = e.z? e.z: 0;if (H = parseFloat(H), I = parseFloat(I), D = parseFloat(D), E =! 1, 0 !== H) var A = Math.atan2(I, H); else if (0I) A = b; else if (0 > I) A = - b; else if (E =! 0, A = 0, 0D) var F = b; else {if (!(0 > D)) return;F = - b}return f = H * H + I * I,h = Math.sqrt(f),m = 1.0026 * D,g = Math.sqrt(m * m + f),x = m / g,y = h / g,z = x * x * x,p = D + this.b * this.ep2 * z,C = h - this.a * this.es * y * y * y,v = Math.sqrt(p * p + C * C),u = p / v,G = C / v,P = this.a / Math.sqrt(1 - this.es * u * u),d = .3826834323650898 <= G? h / G - P: -.3826834323650898 >= G? h / - G - P: D / u + P * (this.es - 1),!1 === E && (F = Math.atan(u / G)),e.x = A,e.y = F,e.z = d,e},geocentric_to_wgs84: function (b) {if (1 === this.datum_type) b.x += this.datum_params[0],b.y += this.datum_params[1],b.z += this.datum_params[2]; else if (2 === this.datum_type) {var e = this.datum_params[3],d = this.datum_params[4],f = this.datum_params[5],m = this.datum_params[6],p = m * (f * b.x + b.y - e * b.z) + this.datum_params[1];e = m * (- d * b.x + e * b.y + b.z) + this.datum_params[2];b.x = m * (b.x - f * b.y + d * b.z) + this.datum_params[0];b.y = p;b.z = e}},geocentric_from_wgs84: function (b) {if (1 === this.datum_type) b.x -= this.datum_params[0],b.y -= this.datum_params[1],b.z -= this.datum_params[2]; else if (2 === this.datum_type) {var e = this.datum_params[3],d = this.datum_params[4],f = this.datum_params[5],m = this.datum_params[6],p = (b.x - this.datum_params[0]) / m,g = (b.y - this.datum_params[1]) / m;m = (b.z - this.datum_params[2]) / m;b.x = p + f * g - d * m;b.y = - f * p + g + e * m;b.z = d * p - e * g + m}}};g.exports = p}, {}],31: [function (d, g, f) {g.exports = function (b, d, e) {function f(b) {return 1 === b || 2 === b}var h;if (b.compare_datums(d) || 5 === b.datum_type || 5 === d.datum_type) return e;var p = b.a,m = b.es,g = d.a,w = d.es;var v = b.datum_type;if (3 === v) if (0 === this.apply_gridshift(b, 0, e)) b.a = 6378137,b.es = .006694379990141316; else {if (! b.datum_params) return b.a = p,b.es = b.es,e;v = 1;var x = 0;for (h = b.datum_params.length; h > x; x++) v *= b.datum_params[x];if (0 === v) return b.a = p,b.es = b.es,e;v = 3b.datum_params.length? 2: 1}return 3 === d.datum_type && (d.a = 6378137, d.es = .006694379990141316),(b.es !== d.es || b.a !== d.a || f(v) || f(d.datum_type)) && (b.geodetic_to_geocentric(e), f(b.datum_type) && b.geocentric_to_wgs84(e), f(d.datum_type) && d.geocentric_from_wgs84(e), d.geocentric_to_geodetic(e)),3 === d.datum_type && this.apply_gridshift(d, 1, e),b.a = p,b.es = m,d.a = g,d.es = w,e}}, {}],32: [function (d, g, f) {function b(d) {var f = this;if (2 === arguments.length) {var g = arguments[1];b[d] = "string" == typeof g? "+" === g.charAt(0)? p(arguments[1]): e(arguments[1]): g} else if (1 === arguments.length) {if (Array.isArray(d)) return d.map(function (e) {Array.isArray(e)? b.apply(f, e): b(e)});if ("string" == typeof d) {if (d in b) return b[d]} else "EPSG" in d? b["EPSG:" + d.EPSG] = d: "ESRI" in d? b["ESRI:" + d.ESRI] = d: "IAU2000" in d? b["IAU2000:" + d.IAU2000] = d: console.log(d)}}f = d("./global");var p = d("./projString"),e = d("./wkt");f(b);g.exports = b}, {"./global": 35,"./projString": 38,"./wkt": 66}],33: [function (d, g, f) {var b = d("./constants/Datum"),p = d("./constants/Ellipsoid"),e = d("./extend"),q = d("./datum");g.exports = function (d) {if (d.datumCode && "none" !== d.datumCode) {var f = b[d.datumCode];f && (d.datum_params = f.towgs84? f.towgs84.split(","): null,d.ellps = f.ellipse,d.datumName = f.datumName? f.datumName: d.datumCode)}d.a || e(d, p[d.ellps]? p[d.ellps]: p.WGS84);return d.rf && ! d.b && (d.b =( 1 - 1 / d.rf) * d.a),(0 === d.rf || 1E-10 > Math.abs(d.a - d.b)) && (d.sphere =! 0, d.b = d.a),d.a2 = d.a * d.a,d.b2 = d.b * d.b,d.es = (d.a2 - d.b2) / d.a2,d.e = Math.sqrt(d.es),d.R_A && (d.a *= 1 - d.es * (.16666666666666666 + d.es * (.04722222222222222 + .022156084656084655 * d.es)), d.a2 = d.a * d.a, d.b2 = d.b * d.b, d.es = 0),d.ep2 = (d.a2 - d.b2) / d.b2,d.k0 || (d.k0 = 1),d.axis || (d.axis = "enu"),d.datum || (d.datum = q(d)),d}}, {"./constants/Datum": 25,"./constants/Ellipsoid": 26,"./datum": 30,"./extend": 34}],34: [function (d, g, f) {g.exports = function (b, d) {b = b || {};var e;if (! d) return b;for (e in d) {var f = d[e];void 0 !== f && (b[e] = f)}return b}}, {}],35: [function (d, g, f) {g.exports = function (b) {b("EPSG:4326", "+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees");b("EPSG:4269", "+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees");b("EPSG:3857", "+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");b.WGS84 = b["EPSG:4326"];b["EPSG:3785"] = b["EPSG:3857"];b.GOOGLE = b["EPSG:3857"];b["EPSG:900913"] = b["EPSG:3857"];b["EPSG:102113"] = b["EPSG:3857"]}}, {}],36: [function (d, g, f) {f = d("./core");f.defaultDatum = "WGS84";f.Proj = d("./Proj");f.WGS84 = new f.Proj("WGS84");f.Point = d("./Point");f.toPoint = d("./common/toPoint");f.defs = d("./defs");f.transform = d("./transform");f.mgrs = d("mgrs");f.version = d("../package.json").version;d("./includedProjections")(f);g.exports = f}, {"../package.json": 68,"./Point": 1,"./Proj": 2,"./common/toPoint": 23,"./core": 29,"./defs": 32,"./includedProjections": "hTEDpn","./transform": 65,mgrs: 67}],37: [function (d, g, f) {function b(b) {return ["GEOGCS", "GEOCCS", "PROJCS", "LOCAL_CS"].reduce(function (d, e) {return d + 1 + b.indexOf(e)}, 0)}var p = d("./defs"),e = d("./wkt"),q = d("./projString");g.exports = function (d) {return "string" == typeof d? d in p? p[d]: b(d)? e(d): "+" === d[0]? q(d): void 0: d}}, {"./defs": 32,"./projString": 38,"./wkt": 66}],38: [function (d, g, f) {var b = d("./constants/PrimeMeridian"),p = d("./constants/units");g.exports = function (d) {var e = {},f = {};d.split("+").map(function (b) {return b.trim()}).filter(function (b) {return b}).forEach(function (b) {b = b.split("=");b.push(!0);f[b[0].toLowerCase()] = b[1]});var g,m,t = {proj: "projName",datum: "datumCode",rf: function (b) {e.rf = parseFloat(b)},lat_0: function (b) {e.lat0 = .017453292519943295 * b},lat_1: function (b) {e.lat1 = .017453292519943295 * b},lat_2: function (b) {e.lat2 = .017453292519943295 * b},lat_ts: function (b) {e.lat_ts = .017453292519943295 * b},lon_0: function (b) {e.long0 = .017453292519943295 * b},lon_1: function (b) {e.long1 = .017453292519943295 * b},lon_2: function (b) {e.long2 = .017453292519943295 * b},alpha: function (b) {e.alpha = .017453292519943295 * parseFloat(b)},lonc: function (b) {e.longc = .017453292519943295 * b},x_0: function (b) {e.x0 = parseFloat(b)},y_0: function (b) {e.y0 = parseFloat(b)},k_0: function (b) {e.k0 = parseFloat(b)},k: function (b) {e.k0 = parseFloat(b)},a: function (b) {e.a = parseFloat(b)},b: function (b) {e.b = parseFloat(b)},r_a: function () {e.R_A = !0},zone: function (b) {e.zone = parseInt(b, 10)},south: function () {e.utmSouth = !0},towgs84: function (b) {e.datum_params = b.split(",").map(function (b) {return parseFloat(b)})},to_meter: function (b) {e.to_meter = parseFloat(b)},units: function (b) {e.units = b;p[b] && (e.to_meter = p[b].to_meter)},from_greenwich: function (b) {e.from_greenwich = .017453292519943295 * b},pm: function (d) {e.from_greenwich = .017453292519943295 * (b[d]? b[d]: parseFloat(d))},nadgrids: function (b) {"@null" === b? e.datumCode = "none": e.nadgrids = b},axis: function (b) {3 === b.length && -1 !== "ewnsud".indexOf(b.substr(0, 1)) && -1 !== "ewnsud".indexOf(b.substr(1, 1)) && -1 !== "ewnsud".indexOf(b.substr(2, 1)) && (e.axis = b)}};for (g in f) d = f[g],g in t? (m = t[g], "function" == typeof m? m(d): e[m] = d): e[g] = d;return "string" == typeof e.datumCode && "WGS84" !== e.datumCode && (e.datumCode = e.datumCode.toLowerCase()),e}}, {"./constants/PrimeMeridian": 27,"./constants/units": 28}],39: [function (d, g, f) {function b(b, d) {var m = q.length;return b.names? (q[m] = b, b.names.forEach(function (b) {e[b.toLowerCase()] = m}), this): (console.log(d), !0)}var p = [d("./projections/merc"), d("./projections/longlat")],e = {},q = [];f.add = b;f.get = function (b) {if (! b) return !1;b = b.toLowerCase();return "undefined" != typeof e[b] && q[e[b]]? q[e[b]]: void 0};f.start = function () {p.forEach(b)}}, {"./projections/longlat": 51,"./projections/merc": 52}],40: [function (d, g, f) {var b = d("../common/msfnz"),p = d("../common/qsfnz"),e = d("../common/adjust_lon"),q = d("../common/asinz");f.init = function () {1E-10 > Math.abs(this.lat1 + this.lat2) || (this.temp = this.b / this.a, this.es = 1 - Math.pow(this.temp, 2), this.e3 = Math.sqrt(this.es), this.sin_po = Math.sin(this.lat1), this.cos_po = Math.cos(this.lat1), this.t1 = this.sin_po, this.con = this.sin_po, this.ms1 = b(this.e3, this.sin_po, this.cos_po), this.qs1 = p(this.e3, this.sin_po, this.cos_po), this.sin_po = Math.sin(this.lat2), this.cos_po = Math.cos(this.lat2), this.t2 = this.sin_po, this.ms2 = b(this.e3, this.sin_po, this.cos_po), this.qs2 = p(this.e3, this.sin_po, this.cos_po), this.sin_po = Math.sin(this.lat0), this.cos_po = Math.cos(this.lat0), this.t3 = this.sin_po, this.qs0 = p(this.e3, this.sin_po, this.cos_po), this.ns0 = 1E-10 Math.abs(this.lat1 - this.lat2)? (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1): this.con,this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1,this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0)};f.forward = function (b) {var d = b.x,m = b.y;this.sin_phi = Math.sin(m);this.cos_phi = Math.cos(m);m = p(this.e3, this.sin_phi, this.cos_phi);m = this.a * Math.sqrt(this.c - this.ns0 * m) / this.ns0;d = this.ns0 * e(d - this.long0);var f = this.rh - m * Math.cos(d) + this.y0;return b.x = m * Math.sin(d) + this.x0,b.y = f,b};f.inverse = function (b) {var d,m,f,h,p,g;return b.x -= this.x0,b.y = this.rh - b.y + this.y0,0 <= this.ns0? (d = Math.sqrt(b.x * b.x + b.y * b.y), f = 1): (d = -Math.sqrt(b.x * b.x + b.y * b.y), f = -1),h = 0,0 !== d && (h = Math.atan2(f * b.x, f * b.y)),f = d * this.ns0 / this.a,this.sphere? g = Math.asin((this.c - f * f) / (2 * this.ns0)): (m =( this.c - f * f) / this.ns0, g = this.phi1z(this.e3, m)),p = e(h / this.ns0 + this.long0),b.x = p,b.y = g,b};f.phi1z = function (b, d) {var e,f,h,p,g,r = q(.5 * d);if (1E-10 > b) return r;for (var y = b * b, u = 1; 25 >= u; u++) if (e = Math.sin(r), f = Math.cos(r), h = b * e, p = 1 - h * h, g = .5 * p * p / f * (d / (1 - y) - e / p + .5 / b * Math.log((1 - h) / (1 + h))), r += g, 1E-7 >= Math.abs(g)) return r;return null};f.names = ["Albers_Conic_Equal_Area", "Albers", "aea"]}, {"../common/adjust_lon": 5,"../common/asinz": 6,"../common/msfnz": 15,"../common/qsfnz": 20}],41: [function (d, g, f) {var b = d("../common/adjust_lon"),p = Math.PI / 2,e = d("../common/mlfn"),q = d("../common/e0fn"),h = d("../common/e1fn"),r = d("../common/e2fn"),m = d("../common/e3fn"),t = d("../common/gN"),w = d("../common/asinz"),v = d("../common/imlfn");f.init = function () {this.sin_p12 = Math.sin(this.lat0);this.cos_p12 = Math.cos(this.lat0)};f.forward = function (d) {var f,g,w,v,x,C,E,H,I,D,A,F,J,aa,Q,V,Y,T,X,ca,ja,ba,Ea,sa = d.y,ya = Math.sin(d.y),Da = Math.cos(d.y),Z = b(d.x - this.long0);return this.sphere? 1E-10 >= Math.abs(this.sin_p12 - 1)? (d.x = this.x0 + this.a * (p - sa) * Math.sin(Z), d.y = this.y0 - this.a * (p - sa) * Math.cos(Z), d): 1E-10 >= Math.abs(this.sin_p12 + 1)? (d.x = this.x0 + this.a * (p + sa) * Math.sin(Z), d.y = this.y0 + this.a * (p + sa) * Math.cos(Z), d): (T = this.sin_p12 * ya + this.cos_p12 * Da * Math.cos(Z), V = Math.acos(T), Y = V / Math.sin(V), d.x = this.x0 + this.a * Y * Da * Math.sin(Z), d.y = this.y0 + this.a * Y * (this.cos_p12 * ya - this.sin_p12 * Da * Math.cos(Z)), d): (f = q(this.es), g = h(this.es), w = r(this.es), v = m(this.es), 1E-10 >= Math.abs(this.sin_p12 - 1)? (x = this.a * e(f, g, w, v, p), C = this.a * e(f, g, w, v, sa), d.x = this.x0 + (x - C) * Math.sin(Z), d.y = this.y0 -(x - C) * Math.cos(Z), d): 1E-10 >= Math.abs(this.sin_p12 + 1)? (x = this.a * e(f, g, w, v, p), C = this.a * e(f, g, w, v, sa), d.x = this.x0 + (x + C) * Math.sin(Z), d.y = this.y0 + (x + C) * Math.cos(Z), d): (E = ya / Da, H = t(this.a, this.e, this.sin_p12), I = t(this.a, this.e, ya), D = Math.atan((1 - this.es) * E + this.es * H * this.sin_p12 / (I * Da)), A = Math.atan2(Math.sin(Z), this.cos_p12 * Math.tan(D) - this.sin_p12 * Math.cos(Z)), X = 0 === A? Math.asin(this.cos_p12 * Math.sin(D) - this.sin_p12 * Math.cos(D)): 1E-10 >= Math.abs(Math.abs(A) - Math.PI)? -Math.asin(this.cos_p12 * Math.sin(D) - this.sin_p12 * Math.cos(D)): Math.asin(Math.sin(Z) * Math.cos(D) / Math.sin(A)),F = this.e * this.sin_p12 / Math.sqrt(1 - this.es),J = this.e * this.cos_p12 * Math.cos(A) / Math.sqrt(1 - this.es),aa = F * J,Q = J * J,ca = X * X,ja = ca * X,ba = ja * X,Ea = ba * X,V = H * X * (1 - ca * Q * (1 - Q) / 6 + ja / 8 * aa * (1 - 2 * Q) + ba / 120 * (Q * (4 - 7 * Q) - 3 * F * F * (1 - 7 * Q)) - Ea / 48 * aa),d.x = this.x0 + V * Math.sin(A),d.y = this.y0 + V * Math.cos(A),d))};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var f,g,u,x,P,C,E,H,I,D,A,F,J,aa,Q,V,Y,T,X,ca,ja,ba,Ea;return this.sphere? (f = Math.sqrt(d.x * d.x + d.y * d.y), f > 2 * p * this.a)? void 0: (g = f / this.a, u = Math.sin(g), x = Math.cos(g), P = this.long0, 1E-10 >= Math.abs(f)? C = this.lat0: (C = w(x * this.sin_p12 + d.y * u * this.cos_p12 / f), E = Math.abs(this.lat0) - p, P = b(1E-10 >= Math.abs(E)? 0 <= this.lat0? this.long0 + Math.atan2(d.x, - d.y): this.long0 - Math.atan2(- d.x, d.y): this.long0 + Math.atan2(d.x * u, f * this.cos_p12 * x - d.y * this.sin_p12 * u))),d.x = P,d.y = C,d): (H = q(this.es), I = h(this.es), D = r(this.es), A = m(this.es), 1E-10 >= Math.abs(this.sin_p12 - 1)? (F = this.a * e(H, I, D, A, p), f = Math.sqrt(d.x * d.x + d.y * d.y), J = F - f, C = v(J / this.a, H, I, D, A), P = b(this.long0 + Math.atan2(d.x, -1 * d.y)), d.x = P, d.y = C, d): 1E-10 >= Math.abs(this.sin_p12 + 1)? (F = this.a * e(H, I, D, A, p), f = Math.sqrt(d.x * d.x + d.y * d.y), J = f - F, C = v(J / this.a, H, I, D, A), P = b(this.long0 + Math.atan2(d.x, d.y)), d.x = P, d.y = C, d): (f = Math.sqrt(d.x * d.x + d.y * d.y), V = Math.atan2(d.x, d.y), aa = t(this.a, this.e, this.sin_p12), Y = Math.cos(V), T = this.e * this.cos_p12 * Y, X = - T * T / (1 - this.es), ca = 3 * this.es * (1 - X) * this.sin_p12 * this.cos_p12 * Y / (1 - this.es), ja = f / aa, ba = ja - X * (1 + X) * Math.pow(ja, 3) / 6 - ca * (1 + 3 * X) * Math.pow(ja, 4) / 24, Ea = 1 - X * ba * ba / 2 - ja * ba * ba * ba / 6, Q = Math.asin(this.sin_p12 * Math.cos(ba) + this.cos_p12 * Math.sin(ba) * Y), P = b(this.long0 + Math.asin(Math.sin(V) * Math.sin(ba) / Math.cos(Q))), C = Math.atan((1 - this.es * Ea * this.sin_p12 / Math.sin(Q)) * Math.tan(Q) / (1 - this.es)), d.x = P, d.y = C, d))};f.names = ["Azimuthal_Equidistant", "aeqd"]}, {"../common/adjust_lon": 5,"../common/asinz": 6,"../common/e0fn": 7,"../common/e1fn": 8,"../common/e2fn": 9,"../common/e3fn": 10,"../common/gN": 11,"../common/imlfn": 12,"../common/mlfn": 14}],42: [function (d, g, f) {var b = d("../common/mlfn"),p = d("../common/e0fn"),e = d("../common/e1fn"),q = d("../common/e2fn"),h = d("../common/e3fn"),r = d("../common/gN"),m = d("../common/adjust_lon"),t = d("../common/adjust_lat"),w = d("../common/imlfn"),v = Math.PI / 2;f.init = function () {this.sphere || (this.e0 = p(this.es), this.e1 = e(this.es), this.e2 = q(this.es), this.e3 = h(this.es), this.ml0 = this.a * b(this.e0, this.e1, this.e2, this.e3, this.lat0))};f.forward = function (d) {var e = d.x,f = d.y;if (e = m(e - this.long0), this.sphere) {var h = this.a * Math.asin(Math.cos(f) * Math.sin(e));var p = this.a * (Math.atan2(Math.tan(f), Math.cos(e)) - this.lat0)} else {p = Math.sin(f);var g = Math.cos(f),q = r(this.a, this.e, p),t = Math.tan(f) * Math.tan(f);h = e * Math.cos(f);e = h * h;var w = this.es * g * g / (1 - this.es);f = this.a * b(this.e0, this.e1, this.e2, this.e3, f);h = q * h * (1 - e * t * (1 / 6 -(8 - t + 8 * w) * e / 120));p = f - this.ml0 + q * p / g * e * (.5 + (5 - t + 6 * w) * e / 24)}return d.x = h + this.x0,d.y = p + this.y0,d};f.inverse = function (b) {b.x -= this.x0;b.y -= this.y0;var d = b.x / this.a;var e = b.y / this.a;if (this.sphere) {var f = e + this.lat0;e = Math.asin(Math.sin(f) * Math.cos(d));f = Math.atan2(Math.tan(d), Math.cos(f))} else {f = w(this.ml0 / this.a + e, this.e0, this.e1, this.e2, this.e3);if (1E-10 >= Math.abs(Math.abs(f) - v)) return b.x = this.long0,b.y = v,0 > e && (b.y *= -1),b;e = r(this.a, this.e, Math.sin(f));var h = Math.pow(Math.tan(f), 2);d = d * this.a / e;var p = d * d;e = f - e * Math.tan(f) / (e * e * e / this.a / this.a * (1 - this.es)) * d * d * (.5 -(1 + 3 * h) * d * d / 24);f = d * (1 - p * (h / 3 + (1 + 3 * h) * h * p / 15)) / Math.cos(f)}return b.x = m(f + this.long0),b.y = t(e),b};f.names = ["Cassini", "Cassini_Soldner", "cass"]}, {"../common/adjust_lat": 4,"../common/adjust_lon": 5,"../common/e0fn": 7,"../common/e1fn": 8,"../common/e2fn": 9,"../common/e3fn": 10,"../common/gN": 11,"../common/imlfn": 12,"../common/mlfn": 14}],43: [function (d, g, f) {var b = d("../common/adjust_lon"),p = d("../common/qsfnz"),e = d("../common/msfnz"),q = d("../common/iqsfnz");f.init = function () {this.sphere || (this.k0 = e(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts)))};f.forward = function (d) {var e = d.y;var f = b(d.x - this.long0);this.sphere? (f = this.x0 + this.a * f * Math.cos(this.lat_ts), e = this.y0 + this.a * Math.sin(e) / Math.cos(this.lat_ts)): (e = p(this.e, Math.sin(e)), f = this.x0 + this.a * this.k0 * f, e = this.y0 + this.a * e * .5 / this.k0);return d.x = f,d.y = e,d};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var e,f;return this.sphere? (e = b(this.long0 + d.x / this.a / Math.cos(this.lat_ts)), f = Math.asin(d.y / this.a * Math.cos(this.lat_ts))): (f = q(this.e, 2 * d.y * this.k0 / this.a), e = b(this.long0 + d.x / (this.a * this.k0))),d.x = e,d.y = f,d};f.names = ["cea"]}, {"../common/adjust_lon": 5,"../common/iqsfnz": 13,"../common/msfnz": 15,"../common/qsfnz": 20}],44: [function (d, g, f) {var b = d("../common/adjust_lon"),p = d("../common/adjust_lat");f.init = function () {this.x0 = this.x0 || 0;this.y0 = this.y0 || 0;this.lat0 = this.lat0 || 0;this.long0 = this.long0 || 0;this.lat_ts = this.lat_ts || 0;this.title = this.title || "Equidistant Cylindrical (Plate Carre)";this.rc = Math.cos(this.lat_ts)};f.forward = function (d) {var e = d.y,f = b(d.x - this.long0);e = p(e - this.lat0);return d.x = this.x0 + this.a * f * this.rc,d.y = this.y0 + this.a * e,d};f.inverse = function (d) {var e = d.y;return d.x = b(this.long0 + (d.x - this.x0) / (this.a * this.rc)),d.y = p(this.lat0 + (e - this.y0) / this.a),d};f.names = ["Equirectangular", "Equidistant_Cylindrical", "eqc"]}, {"../common/adjust_lat": 4,"../common/adjust_lon": 5}],45: [function (d, g, f) {var b = d("../common/e0fn"),p = d("../common/e1fn"),e = d("../common/e2fn"),q = d("../common/e3fn"),h = d("../common/msfnz"),r = d("../common/mlfn"),m = d("../common/adjust_lon"),t = d("../common/adjust_lat"),w = d("../common/imlfn");f.init = function () {1E-10 > Math.abs(this.lat1 + this.lat2) || (this.lat2 = this.lat2 || this.lat1, this.temp = this.b / this.a, this.es = 1 - Math.pow(this.temp, 2), this.e = Math.sqrt(this.es), this.e0 = b(this.es), this.e1 = p(this.es), this.e2 = e(this.es), this.e3 = q(this.es), this.sinphi = Math.sin(this.lat1), this.cosphi = Math.cos(this.lat1), this.ms1 = h(this.e, this.sinphi, this.cosphi), this.ml1 = r(this.e0, this.e1, this.e2, this.e3, this.lat1), 1E-10 > Math.abs(this.lat1 - this.lat2)? this.ns = this.sinphi: (this.sinphi = Math.sin(this.lat2), this.cosphi = Math.cos(this.lat2), this.ms2 = h(this.e, this.sinphi, this.cosphi), this.ml2 = r(this.e0, this.e1, this.e2, this.e3, this.lat2), this.ns =( this.ms1 - this.ms2) / (this.ml2 - this.ml1)),this.g = this.ml1 + this.ms1 / this.ns,this.ml0 = r(this.e0, this.e1, this.e2, this.e3, this.lat0),this.rh = this.a * (this.g - this.ml0))};f.forward = function (b) {var d = b.x;var e = b.y;this.sphere? e = this.a * (this.g - e): (e = r(this.e0, this.e1, this.e2, this.e3, e), e = this.a * (this.g - e));d = this.ns * m(d - this.long0);var f = this.y0 + this.rh - e * Math.cos(d);return b.x = this.x0 + e * Math.sin(d),b.y = f,b};f.inverse = function (b) {b.x -= this.x0;b.y = this.rh - b.y + this.y0;var d,e,f,h;0 <= this.ns? (e = Math.sqrt(b.x * b.x + b.y * b.y), d = 1): (e = -Math.sqrt(b.x * b.x + b.y * b.y), d = -1);var p = 0;return(0 !== e && (p = Math.atan2(d * b.x, d * b.y)), this.sphere)? (h = m(this.long0 + p / this.ns), f = t(this.g - e / this.a), b.x = h, b.y = f, b): (f = w(this.g - e / this.a, this.e0, this.e1, this.e2, this.e3), h = m(this.long0 + p / this.ns), b.x = h, b.y = f, b)};f.names = ["Equidistant_Conic", "eqdc"]}, {"../common/adjust_lat": 4,"../common/adjust_lon": 5,"../common/e0fn": 7,"../common/e1fn": 8,"../common/e2fn": 9,"../common/e3fn": 10,"../common/imlfn": 12,"../common/mlfn": 14,"../common/msfnz": 15}],46: [function (d, g, f) {var b = Math.PI / 4,p = d("../common/srat"),e = Math.PI / 2;f.init = function () {var d = Math.sin(this.lat0),e = Math.cos(this.lat0);e *= e;this.rc = Math.sqrt(1 - this.es) / (1 - this.es * d * d);this.C = Math.sqrt(1 + this.es * e * e / (1 - this.es));this.phic0 = Math.asin(d / this.C);this.ratexp = .5 * this.C * this.e;this.K = Math.tan(.5 * this.phic0 + b) / (Math.pow(Math.tan(.5 * this.lat0 + b), this.C) * p(this.e * d, this.ratexp))};f.forward = function (d) {var f = d.x,g = d.y;return d.y = 2 * Math.atan(this.K * Math.pow(Math.tan(.5 * g + b), this.C) * p(this.e * Math.sin(g), this.ratexp)) - e,d.x = this.C * f,d};f.inverse = function (d) {for (var f = d.x / this.C, g = d.y, m = Math.pow(Math.tan(.5 * g + b) / this.K, 1 / this.C), q = 20; 0q && (g = 2 * Math.atan(m * p(this.e * Math.sin(d.y), -.5 * this.e)) - e, !(1E-14 > Math.abs(g - d.y))); -- q) d.y = g;return q? (d.x = f, d.y = g, d): null};f.names = ["gauss"]}, {"../common/srat": 22}],47: [function (d, g, f) {var b = d("../common/adjust_lon"),p = d("../common/asinz");f.init = function () {this.sin_p14 = Math.sin(this.lat0);this.cos_p14 = Math.cos(this.lat0);this.infinity_dist = 1E3 * this.a;this.rc = 1};f.forward = function (d) {var e,f,p,m,g,w,v,x = d.y;return p = b(d.x - this.long0),e = Math.sin(x),f = Math.cos(x),m = Math.cos(p),g = this.sin_p14 * e + this.cos_p14 * f * m,0g || 1E-10 >= Math.abs(g)? (w = this.x0 + 1 * this.a * f * Math.sin(p) / g, v = this.y0 + 1 * this.a * (this.cos_p14 * e - this.sin_p14 * f * m) / g): (w = this.x0 + this.infinity_dist * f * Math.sin(p), v = this.y0 + this.infinity_dist * (this.cos_p14 * e - this.sin_p14 * f * m)),d.x = w,d.y = v,d};f.inverse = function (d) {var e,f,g,m,t,w;return d.x = (d.x - this.x0) / this.a,d.y = (d.y - this.y0) / this.a,d.x /= this.k0,d.y /= this.k0,(e = Math.sqrt(d.x * d.x + d.y * d.y))? (m = Math.atan2(e, this.rc), f = Math.sin(m), g = Math.cos(m), w = p(g * this.sin_p14 + d.y * f * this.cos_p14 / e), t = Math.atan2(d.x * f, e * this.cos_p14 * g - d.y * this.sin_p14 * f), t = b(this.long0 + t)): (w = this.phic0, t = 0),d.x = t,d.y = w,d};f.names = ["gnom"]}, {"../common/adjust_lon": 5,"../common/asinz": 6}],48: [function (d, g, f) {var b = d("../common/adjust_lon");f.init = function () {this.a = 6377397.155;this.es = .006674372230614;this.e = Math.sqrt(this.es);this.lat0 || (this.lat0 = .863937979737193);this.long0 || (this.long0 = .4334234309119251);this.k0 || (this.k0 = .9999);this.s45 = .785398163397448;this.s90 = 2 * this.s45;this.fi0 = this.lat0;this.e2 = this.es;this.e = Math.sqrt(this.e2);this.alfa = Math.sqrt(1 + this.e2 * Math.pow(Math.cos(this.fi0), 4) / (1 - this.e2));this.uq = 1.04216856380474;this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa);this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2);this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g;this.k1 = this.k0;this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2));this.s0 = 1.37008346281555;this.n = Math.sin(this.s0);this.ro0 = this.k1 * this.n0 / Math.tan(this.s0);this.ad = this.s90 - this.uq};f.forward = function (d) {var e,f,p,g,m,t,w,v = d.y,x = b(d.x - this.long0);return e = Math.pow((1 + this.e * Math.sin(v)) / (1 - this.e * Math.sin(v)), this.alfa * this.e / 2),f = 2 * (Math.atan(this.k * Math.pow(Math.tan(v / 2 + this.s45), this.alfa) / e) - this.s45),p = - x * this.alfa,g = Math.asin(Math.cos(this.ad) * Math.sin(f) + Math.sin(this.ad) * Math.cos(f) * Math.cos(p)),m = Math.asin(Math.cos(f) * Math.sin(p) / Math.cos(g)),t = this.n * m,w = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(g / 2 + this.s45), this.n),d.y = w * Math.cos(t),d.x = w * Math.sin(t),this.czech || (d.y *= -1, d.x *= -1),d};f.inverse = function (b) {var d = b.x;b.x = b.y;b.y = d;this.czech || (b.y *= -1, b.x *= -1);d = Math.sqrt(b.x * b.x + b.y * b.y);var f = Math.atan2(b.y, b.x) / Math.sin(this.s0);var h = 2 * (Math.atan(Math.pow(this.ro0 / d, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45);d = Math.asin(Math.cos(this.ad) * Math.sin(h) - Math.sin(this.ad) * Math.cos(h) * Math.cos(f));b.x = this.long0 - Math.asin(Math.cos(h) * Math.sin(f) / Math.cos(d)) / this.alfa;f = d;var p = h = 0;do b.y = 2 * (Math.atan(Math.pow(this.k, -1 / this.alfa) * Math.pow(Math.tan(d / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(f)) / (1 - this.e * Math.sin(f)), this.e / 2)) - this.s45),1E-10 > Math.abs(f - b.y) && (h = 1),f = b.y,p += 1; while (0 === h && 15 > p);return 15 <= p? null: b};f.names = ["Krovak", "krovak"]}, {"../common/adjust_lon": 5}],49: [function (d, g, f) {var b = Math.PI / 2,p = Math.PI / 4,e = d("../common/qsfnz"),q = d("../common/adjust_lon");f.S_POLE = 1;f.N_POLE = 2;f.EQUIT = 3;f.OBLIQ = 4;f.init = function () {var d = Math.abs(this.lat0);if (this.mode = 1E-10 > Math.abs(d - b)? 0 > this.lat0? this.S_POLE: this.N_POLE: 1E-10 > Math.abs(d)? this.EQUIT: this.OBLIQ,0 this.es) switch (this.qp = e(this.e, 1), this.mmf = .5 / (1 - this.es), this.apa = this.authset(this.es), this.mode) {case this.N_POLE:this.dd = 1;break;case this.S_POLE:this.dd = 1;break;case this.EQUIT:this.rq = Math.sqrt(.5 * this.qp);this.dd = 1 / this.rq;this.xmf = 1;this.ymf = .5 * this.qp;break;case this.OBLIQ:this.rq = Math.sqrt(.5 * this.qp),d = Math.sin(this.lat0),this.sinb1 = e(this.e, d) / this.qp,this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1),this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * d * d) * this.rq * this.cosb1),this.ymf = (this.xmf = this.rq) / this.dd,this.xmf *= this.dd} else this.mode === this.OBLIQ && (this.sinph0 = Math.sin(this.lat0), this.cosph0 = Math.cos(this.lat0))};f.forward = function (d) {var f,m,h,g,v,x,z;var y = d.x;var u = d.y;if (y = q(y - this.long0), this.sphere) if (h = Math.sin(u), g = Math.cos(u), m = Math.cos(y), this.mode === this.OBLIQ || this.mode === this.EQUIT) {if (f = this.mode === this.EQUIT? 1 + g * m: 1 + this.sinph0 * h + this.cosph0 * g * m,1E-10 >= f) return null;f = Math.sqrt(2 / f);var G = f * g * Math.sin(y);f *= this.mode === this.EQUIT? h: this.cosph0 * h - this.sinph0 * g * m} else {if (this.mode === this.N_POLE || this.mode === this.S_POLE) {if (this.mode === this.N_POLE && (m = - m), 1E-10 > Math.abs(u + this.phi0)) return null;f = p - .5 * u;f = 2 * (this.mode === this.S_POLE? Math.cos(f): Math.sin(f));G = f * Math.sin(y);f *= m}} else {switch (v = 0, x = 0, z = 0, m = Math.cos(y), y = Math.sin(y), h = Math.sin(u), g = e(this.e, h), (this.mode === this.OBLIQ || this.mode === this.EQUIT) && (v = g / this.qp, x = Math.sqrt(1 - v * v)), this.mode) {case this.OBLIQ: z = 1 + this.sinb1 * v + this.cosb1 * x * m;break;case this.EQUIT: z = 1 + x * m;break;case this.N_POLE: z = b + u;g = this.qp - g;break;case this.S_POLE: z = u - b,g = this.qp + g}if (1E-10 > Math.abs(z)) return null;switch (this.mode) {case this.OBLIQ:case this.EQUIT: z = Math.sqrt(2 / z);f = this.mode === this.OBLIQ? this.ymf * z * (this.cosb1 * v - this.sinb1 * x * m): (z = Math.sqrt(2 / (1 + x * m))) * v * this.ymf;G = this.xmf * z * x * y;break;case this.N_POLE:case this.S_POLE:0 <= g? (G =( z = Math.sqrt(g)) * y, f = m * (this.mode === this.S_POLE? z: - z)): G = f = 0}}return d.x = this.a * G + this.x0,d.y = this.a * f + this.y0,d};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var e,f,p;var h = d.x / this.a;var g = d.y / this.a;if (this.sphere) {var x = p = 0;if (f = Math.sqrt(h * h + g * g), e = .5 * f, 1e) return null;switch (e = 2 * Math.asin(e), (this.mode === this.OBLIQ || this.mode === this.EQUIT) && (x = Math.sin(e), p = Math.cos(e)), this.mode) {case this.EQUIT: e = 1E-10 >= Math.abs(f)? 0: Math.asin(g * x / f);h *= x;g = p * f;break;case this.OBLIQ: e = 1E-10 >= Math.abs(f)? this.phi0: Math.asin(p * this.sinph0 + g * x * this.cosph0 / f);h *= x * this.cosph0;g = (p - Math.sin(e) * this.sinph0) * f;break;case this.N_POLE: g = - g;e = b - e;break;case this.S_POLE: e -= b}h = 0 !== g || this.mode !== this.EQUIT && this.mode !== this.OBLIQ? Math.atan2(h, g): 0} else {if (e = 0, this.mode === this.OBLIQ || this.mode === this.EQUIT) {if (h /= this.dd, g *= this.dd, p = Math.sqrt(h * h + g * g), 1E-10 > p) return d.x = 0,d.y = this.phi0,d;x = 2 * Math.asin(.5 * p / this.rq);f = Math.cos(x);h *= x = Math.sin(x);this.mode === this.OBLIQ? (e = f * this.sinb1 + g * x * this.cosb1 / p, g = p * this.cosb1 * f - g * this.sinb1 * x): (e = g * x / p, g = p * f)} else if (this.mode === this.N_POLE || this.mode === this.S_POLE) {if (this.mode === this.N_POLE && (g = - g), x = h * h + g * g, !x) return d.x = 0,d.y = this.phi0,d;e = 1 - x / this.qp;this.mode === this.S_POLE && (e = - e)}h = Math.atan2(h, g);e = this.authlat(Math.asin(e), this.apa)}return d.x = q(this.long0 + h),d.y = e,d};f.P00 = .3333333333333333;f.P01 = .17222222222222222;f.P02 = .10257936507936508;f.P10 = .06388888888888888;f.P11 = .0664021164021164;f.P20 = .016415012942191543;f.authset = function (b) {var d,e = [];return e[0] = b * this.P00,d = b * b,e[0] += d * this.P01,e[1] = d * this.P10,d *= b,e[0] += d * this.P02,e[1] += d * this.P11,e[2] = d * this.P20,e};f.authlat = function (b, d) {var e = b + b;return b + d[0] * Math.sin(e) + d[1] * Math.sin(e + e) + d[2] * Math.sin(e + e + e)};f.names = ["Lambert Azimuthal Equal Area", "Lambert_Azimuthal_Equal_Area", "laea"]}, {"../common/adjust_lon": 5,"../common/qsfnz": 20}],50: [function (d, g, f) {var b = d("../common/msfnz"),p = d("../common/tsfnz"),e = Math.PI / 2,q = d("../common/sign"),h = d("../common/adjust_lon"),r = d("../common/phi2z");f.init = function () {if (this.lat2 || (this.lat2 = this.lat1), this.k0 || (this.k0 = 1), this.x0 = this.x0 || 0, this.y0 = this.y0 || 0, !(1E-10 > Math.abs(this.lat1 + this.lat2))) {var d = this.b / this.a;this.e = Math.sqrt(1 - d * d);d = Math.sin(this.lat1);var e = b(this.e, d, Math.cos(this.lat1)),f = p(this.e, this.lat1, d),g = Math.sin(this.lat2),h = b(this.e, g, Math.cos(this.lat2));g = p(this.e, this.lat2, g);var q = p(this.e, this.lat0, Math.sin(this.lat0));this.ns = 1E-10 Math.abs(this.lat1 - this.lat2)? Math.log(e / h) / Math.log(f / g): d;isNaN(this.ns) && (this.ns = d);this.f0 = e / (this.ns * Math.pow(f, this.ns));this.rh = this.a * this.f0 * Math.pow(q, this.ns);this.title || (this.title = "Lambert Conformal Conic")}};f.forward = function (b) {var d = b.x,f = b.y;1E-10 >= Math.abs(2 * Math.abs(f) - Math.PI) && (f = q(f) * (e - 2E-10));var m = Math.abs(Math.abs(f) - e);if (1E-10m) f = p(this.e, f, Math.sin(f)),f = this.a * this.f0 * Math.pow(f, this.ns); else {if (m = f * this.ns, 0 >= m) return null;f = 0}d = this.ns * h(d - this.long0);return b.x = this.k0 * f * Math.sin(d) + this.x0,b.y = this.k0 * (this.rh - f * Math.cos(d)) + this.y0,b};f.inverse = function (b) {var d,f,m,p,g,q = (b.x - this.x0) / this.k0,u = this.rh -(b.y - this.y0) / this.k0;0 this.ns? (d = Math.sqrt(q * q + u * u), f = 1): (d = -Math.sqrt(q * q + u * u), f = -1);var G = 0;if (0 !== d && (G = Math.atan2(f * q, f * u)), 0 !== d || 0 this.ns) {if (f = 1 / this.ns, m = Math.pow(d / (this.a * this.f0), f), p = r(this.e, m), -9999 === p) return null} else p = - e;return g = h(G / this.ns + this.long0),b.x = g,b.y = p,b};f.names = ["Lambert Tangential Conformal Conic Projection", "Lambert_Conformal_Conic", "Lambert_Conformal_Conic_2SP", "lcc"]}, {"../common/adjust_lon": 5,"../common/msfnz": 15,"../common/phi2z": 16,"../common/sign": 21,"../common/tsfnz": 24}],51: [function (d, g, f) {function b(b) {return b}f.init = function () {};f.forward = b;f.inverse = b;f.names = ["longlat", "identity"]}, {}],52: [function (d, g, f) {var b = d("../common/msfnz"),p = Math.PI / 2,e = d("../common/adjust_lon"),q = Math.PI / 4,h = d("../common/tsfnz"),r = d("../common/phi2z");f.init = function () {var d = this.b / this.a;this.es = 1 - d * d;"x0" in this || (this.x0 = 0);"y0" in this || (this.y0 = 0);this.e = Math.sqrt(this.es);this.lat_ts? this.k0 = this.sphere? Math.cos(this.lat_ts): b(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts)): this.k0 || (this.k0 = this.k? this.k: 1)};f.forward = function (b) {var d = b.x,f = b.y;if (90 < 57.29577951308232 * f && -90 > 57.29577951308232 * f && 180 < 57.29577951308232 * d && -180 > 57.29577951308232 * d || 1E-10 >= Math.abs(Math.abs(f) - p)) return null;this.sphere? (d = this.x0 + this.a * this.k0 * e(d - this.long0), f = this.y0 + this.a * this.k0 * Math.log(Math.tan(q + .5 * f))): (f = h(this.e, f, Math.sin(f)), d = this.x0 + this.a * this.k0 * e(d - this.long0), f = this.y0 - this.a * this.k0 * Math.log(f));return b.x = d,b.y = f,b};f.inverse = function (b) {var d,f = b.x - this.x0,m = b.y - this.y0;if (this.sphere) var g = p - 2 * Math.atan(Math.exp(- m / (this.a * this.k0))); else if (g = r(this.e, Math.exp(- m / (this.a * this.k0))), -9999 === g) return null;return d = e(this.long0 + f / (this.a * this.k0)),b.x = d,b.y = g,b};f.names = ["Mercator", "Popular Visualisation Pseudo Mercator", "Mercator_1SP", "Mercator_Auxiliary_Sphere", "merc"]}, {"../common/adjust_lon": 5,"../common/msfnz": 15,"../common/phi2z": 16,"../common/tsfnz": 24}],53: [function (d, g, f) {var b = d("../common/adjust_lon");f.init = function () {};f.forward = function (d) {var e = d.y,f = b(d.x - this.long0);e = this.y0 + this.a * Math.log(Math.tan(Math.PI / 4 + e / 2.5)) * 1.25;return d.x = this.x0 + this.a * f,d.y = e,d};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var e = b(this.long0 + d.x / this.a),f = 2.5 * (Math.atan(Math.exp(.8 * d.y / this.a)) - Math.PI / 4);return d.x = e,d.y = f,d};f.names = ["Miller_Cylindrical", "mill"]}, {"../common/adjust_lon": 5}],54: [function (d, g, f) {var b = d("../common/adjust_lon");f.init = function () {};f.forward = function (d) {for (var e = d.y, f = b(d.x - this.long0), g = e, p = Math.PI * Math.sin(e), m = 0;; m++) {var t = -(g + Math.sin(g) - p) / (1 + Math.cos(g));if (g += t, 1E-10 > Math.abs(t)) break}g /= 2;1E-10 > Math.PI / 2 - Math.abs(e) && (f = 0);e = 1.4142135623731 * this.a * Math.sin(g) + this.y0;return d.x = .900316316158 * this.a * f * Math.cos(g) + this.x0,d.y = e,d};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var e = d.y / (1.4142135623731 * this.a);.999999999999 Math.abs(e) && (e = .999999999999);e = Math.asin(e);var f = b(this.long0 + d.x / (.900316316158 * this.a * Math.cos(e)));f < -Math.PI && (f = -Math.PI);f > Math.PI && (f = Math.PI);e = (2 * e + Math.sin(2 * e)) / Math.PI;1 Math.abs(e) && (e = 1);e = Math.asin(e);return d.x = f,d.y = e,d};f.names = ["Mollweide", "moll"]}, {"../common/adjust_lon": 5}],55: [function (d, g, f) {f.iterations = 1;f.init = function () {this.A = [];this.A[1] = .6399175073;this.A[2] = -.1358797613;this.A[3] = .063294409;this.A[4] = -.02526853;this.A[5] = .0117879;this.A[6] = -.0055161;this.A[7] = .0026906;this.A[8] = -.001333;this.A[9] = 6.7E-4;this.A[10] = -3.4E-4;this.B_re = [];this.B_im = [];this.B_re[1] = .7557853228;this.B_im[1] = 0;this.B_re[2] = .249204646;this.B_im[2] = .003371507;this.B_re[3] = -.001541739;this.B_im[3] = .04105856;this.B_re[4] = -.10162907;this.B_im[4] = .01727609;this.B_re[5] = -.26623489;this.B_im[5] = -.36249218;this.B_re[6] = -.6870983;this.B_im[6] = -1.1651967;this.C_re = [];this.C_im = [];this.C_re[1] = 1.3231270439;this.C_im[1] = 0;this.C_re[2] = -.577245789;this.C_im[2] = -.007809598;this.C_re[3] = .508307513;this.C_im[3] = -.112208952;this.C_re[4] = -.15094762;this.C_im[4] = .18200602;this.C_re[5] = 1.01418179;this.C_im[5] = 1.64497696;this.C_re[6] = 1.9660549;this.C_im[6] = 2.5127645;this.D = [];this.D[1] = 1.5627014243;this.D[2] = .5185406398;this.D[3] = -.03333098;this.D[4] = -.1052906;this.D[5] = -.0368594;this.D[6] = .007317;this.D[7] = .0122;this.D[8] = .00394;this.D[9] = -.0013};f.forward = function (b) {var d,e = b.x - this.long0,f = (b.y - this.lat0) / 4.84813681109536E-6 * 1E-5,g = 1,r = 0;for (d = 1; 10 >= d; d++) g *= f,r += this.A[d] * g;var m;g = r;r = 1;var t = m = 0,w = 0;for (d = 1; 6 >= d; d++) f = r * g - m * e,m = m * g + r * e,r = f,t = t + this.B_re[d] * r - this.B_im[d] * m,w = w + this.B_im[d] * r + this.B_re[d] * m;return b.x = w * this.a + this.x0,b.y = t * this.a + this.y0,b};f.inverse = function (b) {var d,e,f = (b.y - this.y0) / this.a,g = (b.x - this.x0) / this.a,r = 1,m = e = 0,t = 0;for (d = 1; 6 >= d; d++) {var w = r * f - e * g;e = e * f + r * g;r = w;m = m + this.C_re[d] * r - this.C_im[d] * e;t = t + this.C_im[d] * r + this.C_re[d] * e}for (w = 0; w this.iterations; w ++) {var v = m;var x = t;r = f;e = g;for (d = 2; 6 >= d; d++) {var z = v * m - x * t;x = x * m + v * t;v = z;r += (d - 1) * (this.B_re[d] * v - this.B_im[d] * x);e += (d - 1) * (this.B_im[d] * v + this.B_re[d] * x)}v = 1;x = 0;var y = this.B_re[1],u = this.B_im[1];for (d = 2; 6 >= d; d++) z = v * m - x * t,x = x * m + v * t,v = z,y += d * (this.B_re[d] * v - this.B_im[d] * x),u += d * (this.B_im[d] * v + this.B_re[d] * x);t = y * y + u * u;m = (r * y + e * u) / t;t = (e * y - r * u) / t}f = m;g = 1;m = 0;for (d = 1; 9 >= d; d++) g *= f,m += this.D[d] * g;d = this.lat0 + .484813681109536 * m;return b.x = this.long0 + t,b.y = d,b};f.names = ["New_Zealand_Map_Grid", "nzmg"]}, {}],56: [function (d, g, f) {var b = d("../common/tsfnz"),p = d("../common/adjust_lon"),e = d("../common/phi2z"),q = Math.PI / 2,h = Math.PI / 4;f.init = function () {this.no_off = this.no_off || !1;this.no_rot = this.no_rot || !1;isNaN(this.k0) && (this.k0 = 1);var d = Math.sin(this.lat0),e = Math.cos(this.lat0),f = this.e * d;this.bl = Math.sqrt(1 + this.es / (1 - this.es) * Math.pow(e, 4));this.al = this.a * this.bl * this.k0 * Math.sqrt(1 - this.es) / (1 - f * f);d = b(this.e, this.lat0, d);e = this.bl / e * Math.sqrt((1 - this.es) / (1 - f * f));1 > e * e && (e = 1);if (isNaN(this.longc)) {f = b(this.e, this.lat1, Math.sin(this.lat1));var g = b(this.e, this.lat2, Math.sin(this.lat2));this.el = 0 <= this.lat0? (e + Math.sqrt(e * e - 1)) * Math.pow(d, this.bl): (e - Math.sqrt(e * e - 1)) * Math.pow(d, this.bl);f = Math.pow(f, this.bl);var h = Math.pow(g, this.bl);g = this.el / f;d = .5 * (g - 1 / g);g = (this.el * this.el - h * f) / (this.el * this.el + h * f);f = (h - f) / (h + f);h = p(this.long1 - this.long2);this.long0 = .5 * (this.long1 + this.long2) - Math.atan(g * Math.tan(.5 * this.bl * h) / f) / this.bl;this.long0 = p(this.long0);f = p(this.long1 - this.long0);this.gamma0 = Math.atan(Math.sin(this.bl * f) / d);this.alpha = Math.asin(e * Math.sin(this.gamma0))} else g = 0 <= this.lat0? e + Math.sqrt(e * e - 1): e - Math.sqrt(e * e - 1),this.el = g * Math.pow(d, this.bl),this.gamma0 = Math.asin(Math.sin(this.alpha) / e),this.long0 = this.longc - Math.asin(.5 * (g - 1 / g) * Math.tan(this.gamma0)) / this.bl;this.uc = this.no_off? 0: 0 <= this.lat0? this.al / this.bl * Math.atan2(Math.sqrt(e * e - 1), Math.cos(this.alpha)): -1 * this.al / this.bl * Math.atan2(Math.sqrt(e * e - 1), Math.cos(this.alpha))};f.forward = function (d) {var e = d.y;var f = p(d.x - this.long0);if (1E-10 >= Math.abs(Math.abs(e) - q)) f = 0e? -1: 1,e = this.al / this.bl * Math.log(Math.tan(h + f * this.gamma0 * .5)),f = -1 * f * q * this.al / this.bl; else {e = b(this.e, e, Math.sin(e));e = this.el / Math.pow(e, this.bl);var g = .5 * (e - 1 / e),r = Math.sin(this.bl * f);e = (g * Math.sin(this.gamma0) - r * Math.cos(this.gamma0)) / (.5 * (e + 1 / e));e = 1E-10 >= Math.abs(Math.abs(e) - 1)? Number.POSITIVE_INFINITY: .5 * this.al * Math.log((1 - e) / (1 + e)) / this.bl;f = 1E-10 >= Math.abs(Math.cos(this.bl * f))? this.al * this.bl * f: this.al * Math.atan2(g * Math.cos(this.gamma0) + r * Math.sin(this.gamma0), Math.cos(this.bl * f)) / this.bl}return this.no_rot? (d.x = this.x0 + f, d.y = this.y0 + e): (f -= this.uc, d.x = this.x0 + e * Math.cos(this.alpha) + f * Math.sin(this.alpha), d.y = this.y0 + f * Math.cos(this.alpha) - e * Math.sin(this.alpha)),d};f.inverse = function (b) {var d,f;this.no_rot? (f = b.y - this.y0, d = b.x - this.x0): (f =( b.x - this.x0) * Math.cos(this.alpha) - (b.y - this.y0) * Math.sin(this.alpha), d =( b.y - this.y0) * Math.cos(this.alpha) + (b.x - this.x0) * Math.sin(this.alpha), d += this.uc);var g = Math.exp(-1 * this.bl * f / this.al);f = .5 * (g - 1 / g);var h = Math.sin(this.bl * d / this.al);g = (h * Math.cos(this.gamma0) + f * Math.sin(this.gamma0)) / (.5 * (g + 1 / g));var r = Math.pow(this.el / Math.sqrt((1 + g) / (1 - g)), 1 / this.bl);return 1E-10 > Math.abs(g - 1)? (b.x = this.long0, b.y = q): 1E-10 > Math.abs(g + 1)? (b.x = this.long0, b.y = -1 * q): (b.y = e(this.e, r), b.x = p(this.long0 - Math.atan2(f * Math.cos(this.gamma0) - h * Math.sin(this.gamma0), Math.cos(this.bl * d / this.al)) / this.bl)),b};f.names = ["Hotine_Oblique_Mercator", "Hotine Oblique Mercator", "Hotine_Oblique_Mercator_Azimuth_Natural_Origin", "Hotine_Oblique_Mercator_Azimuth_Center", "omerc"]}, {"../common/adjust_lon": 5,"../common/phi2z": 16,"../common/tsfnz": 24}],57: [function (d, g, f) {var b = d("../common/e0fn"),p = d("../common/e1fn"),e = d("../common/e2fn"),q = d("../common/e3fn"),h = d("../common/adjust_lon"),r = d("../common/adjust_lat"),m = d("../common/mlfn"),t = d("../common/gN");f.init = function () {this.temp = this.b / this.a;this.es = 1 - Math.pow(this.temp, 2);this.e = Math.sqrt(this.es);this.e0 = b(this.es);this.e1 = p(this.es);this.e2 = e(this.es);this.e3 = q(this.es);this.ml0 = this.a * m(this.e0, this.e1, this.e2, this.e3, this.lat0)};f.forward = function (b) {var d,e,f,g = b.y,p = h(b.x - this.long0);(f = p * Math.sin(g), this.sphere)? 1E-10 >= Math.abs(g)? (d = this.a * p, e = -1 * this.a * this.lat0): (d = this.a * Math.sin(f) / Math.tan(g), e = this.a * (r(g - this.lat0) + (1 - Math.cos(f)) / Math.tan(g))): 1E-10 >= Math.abs(g)? (d = this.a * p, e = -1 * this.ml0): (e = t(this.a, this.e, Math.sin(g)) / Math.tan(g), d = e * Math.sin(f), e = this.a * m(this.e0, this.e1, this.e2, this.e3, g) - this.ml0 + e * (1 - Math.cos(f)));return b.x = d + this.x0,b.y = e + this.y0,b};f.inverse = function (b) {var d,e,f;if (d = b.x - this.x0, e = b.y - this.y0, this.sphere) if (1E-10 >= Math.abs(e + this.a * this.lat0)) {d = h(d / this.a + this.long0);var g = 0} else {var p = this.lat0 + e / this.a;var q = d * d / this.a / this.a + p * p;var r = p;var t;for (e = 20; e; -- e) if (t = Math.tan(r), f = -1 * (p * (r * t + 1) - r - .5 * (r * r + q) * t) / ((r - p) / t - 1), r += f, 1E-10 >= Math.abs(f)) {g = r;break}d = h(this.long0 + Math.asin(d * Math.tan(r) / this.a) / Math.sin(g))} else if (1E-10 >= Math.abs(e + this.ml0)) g = 0,d = h(this.long0 + d / this.a); else {p = (this.ml0 + e) / this.a;q = d * d / this.a / this.a + p * p;r = p;var w,H,I,D,A;for (e = 20; e; -- e) if (A = this.e * Math.sin(r), w = Math.sqrt(1 - A * A) * Math.tan(r), H = this.a * m(this.e0, this.e1, this.e2, this.e3, r), I = this.e0 - 2 * this.e1 * Math.cos(2 * r) + 4 * this.e2 * Math.cos(4 * r) - 6 * this.e3 * Math.cos(6 * r), D = H / this.a, f =( p * (w * D + 1) - D - .5 * w * (D * D + q)) / (this.es * Math.sin(2 * r) * (D * D + q - 2 * p * D) / (4 * w) + (p - D) * (w * I - 2 / Math.sin(2 * r)) - I), r -= f, 1E-10 >= Math.abs(f)) {g = r;break}w = Math.sqrt(1 - this.es * Math.pow(Math.sin(g), 2)) * Math.tan(g);d = h(this.long0 + Math.asin(d * w / this.a) / Math.sin(g))}return b.x = d,b.y = g,b};f.names = ["Polyconic", "poly"]}, {"../common/adjust_lat": 4,"../common/adjust_lon": 5,"../common/e0fn": 7,"../common/e1fn": 8,"../common/e2fn": 9,"../common/e3fn": 10,"../common/gN": 11,"../common/mlfn": 14}],58: [function (d, g, f) {var b = d("../common/adjust_lon"),p = d("../common/adjust_lat"),e = d("../common/pj_enfn"),q = d("../common/pj_mlfn"),h = d("../common/pj_inv_mlfn"),r = Math.PI / 2,m = d("../common/asinz");f.init = function () {this.sphere? (this.n = 1, this.m = 0, this.es = 0, this.C_y = Math.sqrt((this.m + 1) / this.n), this.C_x = this.C_y / (this.m + 1)): this.en = e(this.es)};f.forward = function (d) {var e = d.x;var f = d.y;if (e = b(e - this.long0), this.sphere) {if (this.m) for (var m = this.n * Math.sin(f), g = 20; g; -- g) {var h = (this.m * f + Math.sin(f) - m) / (this.m + Math.cos(f));if (f -= h, 1E-10 > Math.abs(h)) break} else f = 1 !== this.n? Math.asin(this.n * Math.sin(f)): f;e = this.a * this.C_x * e * (this.m + Math.cos(f));f *= this.a * this.C_y} else m = Math.sin(f),g = Math.cos(f),f = this.a * q(f, m, g, this.en),e = this.a * e * g / Math.sqrt(1 - this.es * m * m);return d.x = e,d.y = f,d};f.inverse = function (d) {var e,f,g,q;return d.x -= this.x0,g = d.x / this.a,d.y -= this.y0,e = d.y / this.a,this.sphere? (e /= this.C_y, g /= this.C_x * (this.m + Math.cos(e)), this.m? e = m((this.m * e + Math.sin(e)) / this.n): 1 !== this.n && (e = m(Math.sin(e) / this.n)),g = b(g + this.long0),e = p(e)): (e = h(d.y / this.a, this.es, this.en), q = Math.abs(e), r > q? (q = Math.sin(e), f = this.long0 + d.x * Math.sqrt(1 - this.es * q * q) / (this.a * Math.cos(e)), g = b(f)): r > q - 1E-10 && (g = this.long0)),d.x = g,d.y = e,d};f.names = ["Sinusoidal", "sinu"]}, {"../common/adjust_lat": 4,"../common/adjust_lon": 5,"../common/asinz": 6,"../common/pj_enfn": 17,"../common/pj_inv_mlfn": 18,"../common/pj_mlfn": 19}],59: [function (d, g, f) {f.init = function () {var b = this.lat0;this.lambda0 = this.long0;var d = Math.sin(b),e = this.a,f = 1 / this.rf;f = 2 * f - Math.pow(f, 2);var g = this.e = Math.sqrt(f);this.R = this.k0 * e * Math.sqrt(1 - f) / (1 - f * Math.pow(d, 2));this.alpha = Math.sqrt(1 + f / (1 - f) * Math.pow(Math.cos(b), 4));this.b0 = Math.asin(d / this.alpha);this.K = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2)) - this.alpha * Math.log(Math.tan(Math.PI / 4 + b / 2)) + this.alpha * g / 2 * Math.log((1 + g * d) / (1 - g * d))};f.forward = function (b) {var d = 2 * (Math.atan(Math.exp(-this.alpha * (Math.log(Math.tan(Math.PI / 4 - b.y / 2)) + this.e / 2 * Math.log((1 + this.e * Math.sin(b.y)) / (1 - this.e * Math.sin(b.y)))) + this.K)) - Math.PI / 4),e = this.alpha * (b.x - this.lambda0),f = Math.atan(Math.sin(e) / (Math.sin(this.b0) * Math.tan(d) + Math.cos(this.b0) * Math.cos(e)));d = Math.asin(Math.cos(this.b0) * Math.sin(d) - Math.sin(this.b0) * Math.cos(d) * Math.cos(e));return b.y = this.R / 2 * Math.log((1 + Math.sin(d)) / (1 - Math.sin(d))) + this.y0,b.x = this.R * f + this.x0,b};f.inverse = function (b) {var d = (b.x - this.x0) / this.R,e = 2 * (Math.atan(Math.exp((b.y - this.y0) / this.R)) - Math.PI / 4),f = Math.asin(Math.cos(this.b0) * Math.sin(e) + Math.sin(this.b0) * Math.cos(e) * Math.cos(d));d = this.lambda0 + Math.atan(Math.sin(d) / (Math.cos(this.b0) * Math.cos(d) - Math.sin(this.b0) * Math.tan(e))) / this.alpha;for (var g = f, r = -1E3, m = 0; 1E-7 Math.abs(g - r);) {if (20 < ++ m) return;e = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + f / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(g)) / 2));r = g;g = 2 * Math.atan(Math.exp(e)) - Math.PI / 2}return b.x = d,b.y = g,b};f.names = ["somerc"]}, {}],60: [function (d, g, f) {var b = Math.PI / 2,p = d("../common/sign"),e = d("../common/msfnz"),q = d("../common/tsfnz"),h = d("../common/phi2z"),r = d("../common/adjust_lon");f.ssfn_ = function (d, e, f) {return e *= f,Math.tan(.5 * (b + d)) * Math.pow((1 - e) / (1 + e), .5 * f)};f.init = function () {this.coslat0 = Math.cos(this.lat0);this.sinlat0 = Math.sin(this.lat0);this.sphere? 1 === this.k0 && !isNaN(this.lat_ts) && 1E-10 >= Math.abs(this.coslat0) && (this.k0 = .5 * (1 + p(this.lat0) * Math.sin(this.lat_ts))): (1E-10 >= Math.abs(this.coslat0) && (this.con = 0 this.lat0? 1: -1), this.cons = Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e)), 1 === this.k0 && !isNaN(this.lat_ts) && 1E-10 >= Math.abs(this.coslat0) && (this.k0 = .5 * this.cons * e(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts)) / q(this.e, this.con * this.lat_ts, this.con * Math.sin(this.lat_ts))), this.ms1 = e(this.e, this.sinlat0, this.coslat0), this.X0 = 2 * Math.atan(this.ssfn_(this.lat0, this.sinlat0, this.e)) - b, this.cosX0 = Math.cos(this.X0), this.sinX0 = Math.sin(this.X0))};f.forward = function (d) {var e,f,g,m,h,p,u = d.x,G = d.y,P = Math.sin(G),C = Math.cos(G),E = r(u - this.long0);return 1E-10 >= Math.abs(Math.abs(u - this.long0) - Math.PI) && 1E-10 >= Math.abs(G + this.lat0)? (d.x = 0 / 0, d.y = 0 / 0, d): this.sphere? (e = 2 * this.k0 / (1 + this.sinlat0 * P + this.coslat0 * C * Math.cos(E)), d.x = this.a * e * C * Math.sin(E) + this.x0, d.y = this.a * e * (this.coslat0 * P - this.sinlat0 * C * Math.cos(E)) + this.y0, d): (f = 2 * Math.atan(this.ssfn_(G, P, this.e)) - b, m = Math.cos(f), g = Math.sin(f), 1E-10 >= Math.abs(this.coslat0)? (h = q(this.e, G * this.con, this.con * P), p = 2 * this.a * this.k0 * h / this.cons, d.x = this.x0 + p * Math.sin(u - this.long0), d.y = this.y0 - this.con * p * Math.cos(u - this.long0), d): (1E-10 > Math.abs(this.sinlat0)? (e = 2 * this.a * this.k0 / (1 + m * Math.cos(E)), d.y = e * g): (e = 2 * this.a * this.k0 * this.ms1 / (this.cosX0 * (1 + this.sinX0 * g + this.cosX0 * m * Math.cos(E))), d.y = e * (this.cosX0 * g - this.sinX0 * m * Math.cos(E)) + this.y0),d.x = e * m * Math.sin(E) + this.x0,d))};f.inverse = function (d) {d.x -= this.x0;d.y -= this.y0;var e,f,g = Math.sqrt(d.x * d.x + d.y * d.y);if (this.sphere) {var m = 2 * Math.atan(g / (.5 * this.a * this.k0));return e = this.long0,f = this.lat0,1E-10 >= g? (d.x = e, d.y = f, d): (f = Math.asin(Math.cos(m) * this.sinlat0 + d.y * Math.sin(m) * this.coslat0 / g), e = r(1E-10 > Math.abs(this.coslat0)? 0 this.lat0? this.long0 + Math.atan2(d.x, -1 * d.y): this.long0 + Math.atan2(d.x, d.y): this.long0 + Math.atan2(d.x * Math.sin(m), g * this.coslat0 * Math.cos(m) - d.y * this.sinlat0 * Math.sin(m))), d.x = e, d.y = f, d)}if (1E-10 >= Math.abs(this.coslat0)) {if (1E-10 >= g) return f = this.lat0,e = this.long0,d.x = e,d.y = f,d;d.x *= this.con;d.y *= this.con;e = g * this.cons / (2 * this.a * this.k0);f = this.con * h(this.e, e);e = this.con * r(this.con * this.long0 + Math.atan2(d.x, -1 * d.y))} else f = 2 * Math.atan(g * this.cosX0 / (2 * this.a * this.k0 * this.ms1)),e = this.long0,1E-10 >= g? m = this.X0: (m = Math.asin(Math.cos(f) * this.sinX0 + d.y * Math.sin(f) * this.cosX0 / g), e = r(this.long0 + Math.atan2(d.x * Math.sin(f), g * this.cosX0 * Math.cos(f) - d.y * this.sinX0 * Math.sin(f)))),f = -1 * h(this.e, Math.tan(.5 * (b + m)));return d.x = e,d.y = f,d};f.names = ["stere", "Stereographic_South_Pole", "Polar Stereographic (variant B)"]}, {"../common/adjust_lon": 5,"../common/msfnz": 15,"../common/phi2z": 16,"../common/sign": 21,"../common/tsfnz": 24}],61: [function (d, g, f) {var b = d("./gauss"),p = d("../common/adjust_lon");f.init = function () {b.init.apply(this);this.rc && (this.sinc0 = Math.sin(this.phic0), this.cosc0 = Math.cos(this.phic0), this.R2 = 2 * this.rc, this.title || (this.title = "Oblique Stereographic Alternative"))};f.forward = function (d) {var e,f,g,m;return d.x = p(d.x - this.long0),b.forward.apply(this, [d]),e = Math.sin(d.y),f = Math.cos(d.y),g = Math.cos(d.x),m = this.k0 * this.R2 / (1 + this.sinc0 * e + this.cosc0 * f * g),d.x = m * f * Math.sin(d.x),d.y = m * (this.cosc0 * e - this.sinc0 * f * g),d.x = this.a * d.x + this.x0,d.y = this.a * d.y + this.y0,d};f.inverse = function (d) {var e;if (d.x =( d.x - this.x0) / this.a, d.y =( d.y - this.y0) / this.a, d.x /= this.k0, d.y /= this.k0, e = Math.sqrt(d.x * d.x + d.y * d.y)) {var f = 2 * Math.atan2(e, this.R2);var g = Math.sin(f);var m = Math.cos(f);f = Math.asin(m * this.sinc0 + d.y * g * this.cosc0 / e);g = Math.atan2(d.x * g, e * this.cosc0 * m - d.y * this.sinc0 * g)} else f = this.phic0,g = 0;return d.x = g,d.y = f,b.inverse.apply(this, [d]),d.x = p(d.x + this.long0),d};f.names = ["Stereographic_North_Pole", "Oblique_Stereographic", "Polar_Stereographic", "sterea", "Oblique Stereographic Alternative"]}, {"../common/adjust_lon": 5,"./gauss": 46}],62: [function (d, g, f) {var b = d("../common/e0fn"),p = d("../common/e1fn"),e = d("../common/e2fn"),q = d("../common/e3fn"),h = d("../common/mlfn"),r = d("../common/adjust_lon"),m = Math.PI / 2,t = d("../common/sign"),w = d("../common/asinz");f.init = function () {this.e0 = b(this.es);this.e1 = p(this.es);this.e2 = e(this.es);this.e3 = q(this.es);this.ml0 = this.a * h(this.e0, this.e1, this.e2, this.e3, this.lat0)};f.forward = function (b) {var d = b.y;var e = r(b.x - this.long0);var f = Math.sin(d);var g = Math.cos(d);if (this.sphere) {var m = g * Math.sin(e);if (1E-10 > Math.abs(Math.abs(m) - 1)) return 93;var p = .5 * this.a * this.k0 * Math.log((1 + m) / (1 - m));f = Math.acos(g * Math.cos(e) / Math.sqrt(1 - m * m));0 > d && (f = - f);d = this.a * this.k0 * (f - this.lat0)} else {p = g * e;e = Math.pow(p, 2);g = this.ep2 * Math.pow(g, 2);m = Math.tan(d);var q = Math.pow(m, 2);f = 1 - this.es * Math.pow(f, 2);f = this.a / Math.sqrt(f);d = this.a * h(this.e0, this.e1, this.e2, this.e3, d);p = this.k0 * f * p * (1 + e / 6 * (1 - q + g + e / 20 * (5 - 18 * q + Math.pow(q, 2) + 72 * g - 58 * this.ep2))) + this.x0;d = this.k0 * (d - this.ml0 + f * m * e * (.5 + e / 24 * (5 - q + 9 * g + 4 * Math.pow(g, 2) + e / 30 * (61 - 58 * q + Math.pow(q, 2) + 600 * g - 330 * this.ep2)))) + this.y0}return b.x = p,b.y = d,b};f.inverse = function (b) {var d;if (this.sphere) {var e = Math.exp(b.x / (this.a * this.k0));var f = .5 * (e - 1 / e);var g = this.lat0 + b.y / (this.a * this.k0);var h = Math.cos(g);e = Math.sqrt((1 - h * h) / (1 + f * f));e = w(e);0 > g && (e = - e);f = 0 === f && 0 === h? this.long0: r(Math.atan2(f, h) + this.long0)} else {g = b.x - this.x0;var p = b.y - this.y0;f = e = (this.ml0 + p / this.k0) / this.a;for (d = 0; h =( e + this.e1 * Math.sin(2 * f) - this.e2 * Math.sin(4 * f) + this.e3 * Math.sin(6 * f)) / this.e0 - f, f += h, !(1E-10 >= Math.abs(h)); d++) if (6 <= d) return 95;if (Math.abs(f)m) {h = Math.cos(f);var q = Math.tan(f);d = this.ep2 * Math.pow(h, 2);p = Math.pow(d, 2);var v = Math.pow(q, 2),H = Math.pow(v, 2);e = 1 - this.es * Math.pow(Math.sin(f), 2);var I = this.a / Math.sqrt(e);g /= I * this.k0;var D = Math.pow(g, 2);e = f - I * q * D / (I * (1 - this.es) / e) * (.5 - D / 24 * (5 + 3 * v + 10 * d - 4 * p - 9 * this.ep2 - D / 30 * (61 + 90 * v + 298 * d + 45 * H - 252 * this.ep2 - 3 * p)));f = r(this.long0 + g * (1 - D / 6 * (1 + 2 * v + d - D / 20 * (5 - 2 * d + 28 * v - 3 * p + 8 * this.ep2 + 24 * H))) / h)} else e = m * t(p),f = this.long0}return b.x = f,b.y = e,b};f.names = ["Transverse_Mercator", "Transverse Mercator", "tmerc"]}, {"../common/adjust_lon": 5,"../common/asinz": 6,"../common/e0fn": 7,"../common/e1fn": 8,"../common/e2fn": 9,"../common/e3fn": 10,"../common/mlfn": 14,"../common/sign": 21}],63: [function (d, g, f) {var b = d("./tmerc");f.dependsOn = "tmerc";f.init = function () {this.zone && (this.lat0 = 0, this.long0 = .017453292519943295 * (6 * Math.abs(this.zone) - 183), this.x0 = 5E5, this.y0 = this.utmSouth? 1E7: 0,this.k0 = .9996,b.init.apply(this),this.forward = b.forward,this.inverse = b.inverse)};f.names = ["Universal Transverse Mercator System", "utm"]}, {"./tmerc": 62}],64: [function (d, g, f) {var b = d("../common/adjust_lon"),p = Math.PI / 2,e = d("../common/asinz");f.init = function () {this.R = this.a};f.forward = function (d) {var f,g = d.y;var m = b(d.x - this.long0);1E-10 >= Math.abs(g) && (f = this.y0);var q = e(2 * Math.abs(g / Math.PI));(1E-10 >= Math.abs(m) || 1E-10 >= Math.abs(Math.abs(g) - p)) && (f = 0 <= g? this.y0 + Math.PI * this.R * Math.tan(.5 * q): this.y0 + Math.PI * this.R * -Math.tan(.5 * q));var w = .5 * Math.abs(Math.PI / m - m / Math.PI),v = w * w,x = Math.sin(q);q = Math.cos(q);q /= x + q - 1;x = q * (2 / x - 1);var z = x * x,y = Math.PI * this.R * (w * (q - z) + Math.sqrt(v * (q - z) * (q - z) - (z + v) * (q * q - z))) / (z + v);0 > m && (y = - y);m = this.x0 + y;q = v + q;return y = Math.PI * this.R * (x * q - w * Math.sqrt((z + v) * (v + 1) - q * q)) / (z + v),f = 0 <= g? this.y0 + y: this.y0 - y,d.x = m,d.y = f,d};f.inverse = function (d) {var e,f,g,p,q,v,x,z,y,u,G,P,C;return d.x -= this.x0,d.y -= this.y0,G = Math.PI * this.R,g = d.x / G,p = d.y / G,q = g * g + p * p,v = -Math.abs(p) * (1 + q),x = v - 2 * p * p + g * g,z = -2 * v + 1 + 2 * p * p + q * q,C = p * p / z + (2 * x * x * x / z / z / z - 9 * v * x / z / z) / 27,y = (v - x * x / 3 / z) / z,u = 2 * Math.sqrt(- y / 3),G = 3 * C / y / u,1 Math.abs(G) && (G = 0 <= G? 1: -1),P = Math.acos(G) / 3,f = 0 <= d.y? (- u * Math.cos(P + Math.PI / 3) - x / 3 / z) * Math.PI: -(- u * Math.cos(P + Math.PI / 3) - x / 3 / z) * Math.PI,e = 1E-10 > Math.abs(g)? this.long0: b(this.long0 + Math.PI * (q - 1 + Math.sqrt(1 + 2 * (g * g - p * p) + q * q)) / 2 / g),d.x = e,d.y = f,d};f.names = ["Van_der_Grinten_I", "VanDerGrinten", "vandg"]}, {"../common/adjust_lon": 5,"../common/asinz": 6}],65: [function (d, g, f) {var b = d("./datum_transform"),p = d("./adjust_axis"),e = d("./Proj"),q = d("./common/toPoint");g.exports = function w(d, f, g) {var m;return Array.isArray(g) && (g = q(g)),d.datum && f.datum && ((1 === d.datum.datum_type || 2 === d.datum.datum_type) && "WGS84" !== f.datumCode || (1 === f.datum.datum_type || 2 === f.datum.datum_type) && "WGS84" !== d.datumCode) && (m = new e("WGS84"), w(d, m, g), d = m),"enu" !== d.axis && p(d, !1, g),"longlat" === d.projName? (g.x *= .017453292519943295, g.y *= .017453292519943295): (d.to_meter && (g.x *= d.to_meter, g.y *= d.to_meter), d.inverse(g)),d.from_greenwich && (g.x += d.from_greenwich),g = b(d.datum, f.datum, g),f.from_greenwich && (g.x -= f.from_greenwich),"longlat" === f.projName? (g.x *= 57.29577951308232, g.y *= 57.29577951308232): (f.forward(g), f.to_meter && (g.x /= f.to_meter, g.y /= f.to_meter)),"enu" !== f.axis && p(f, !0, g),g}}, {"./Proj": 2,"./adjust_axis": 3,"./common/toPoint": 23,"./datum_transform": 31}],66: [function (d, g, f) {function b(b, d, e) {b[d] = e.map(function (b) {var d = {};return p(b, d),d}).reduce(function (b, d) {return r(b, d)}, {})}function p(d, e) {var f;return Array.isArray(d)? (f = d.shift(), "PARAMETER" === f && (f = d.shift()), 1 === d.length? Array.isArray(d[0])? (e[f] ={}, p(d[0], e[f])): e[f] = d[0]: d.length? "TOWGS84" === f? e[f] = d: (e[f] ={}, -1 < ["UNIT", "PRIMEM", "VERT_DATUM"].indexOf(f)? (e[f] ={ name: d[0].toLowerCase(),convert: d[1]}, 3 === d.length && (e[f].auth = d[2])): "SPHEROID" === f? (e[f] ={ name: d[0],a: d[1],rf: d[2]}, 4 === d.length && (e[f].auth = d[3])): -1 "GEOGCS GEOCCS DATUM VERT_CS COMPD_CS LOCAL_CS FITTED_CS LOCAL_DATUM".split(" ").indexOf(f)? (d[0] =["name", d[0]], b(e, f, d)): d.every(function (b) {return Array.isArray(b)})? b(e, f, d): p(d, e[f])): e[f] =! 0,void 0): void(e[d] = !0)}function e(b) {return b * h}function q(b) {function d(d) {var e = b.to_meter || 1;return parseFloat(d, 10) * e}"GEOGCS" === b.type? b.projName = "longlat": "LOCAL_CS" === b.type? (b.projName = "identity", b.local =! 0): b.projName = "object" == typeof b.PROJECTION? Object.keys(b.PROJECTION)[0]: b.PROJECTION;b.UNIT && (b.units = b.UNIT.name.toLowerCase(), "metre" === b.units && (b.units = "meter"), b.UNIT.convert && (b.to_meter = parseFloat(b.UNIT.convert, 10)));b.GEOGCS && (b.datumCode = b.GEOGCS.DATUM? b.GEOGCS.DATUM.name.toLowerCase(): b.GEOGCS.name.toLowerCase(),"d_" === b.datumCode.slice(0, 2) && (b.datumCode = b.datumCode.slice(2)),("new_zealand_geodetic_datum_1949" === b.datumCode || "new_zealand_1949" === b.datumCode) && (b.datumCode = "nzgd49"),"wgs_1984" === b.datumCode && ("Mercator_Auxiliary_Sphere" === b.PROJECTION && (b.sphere =! 0), b.datumCode = "wgs84"),"_ferro" === b.datumCode.slice(-6) && (b.datumCode = b.datumCode.slice(0, -6)),"_jakarta" === b.datumCode.slice(-8) && (b.datumCode = b.datumCode.slice(0, -8)), ~ b.datumCode.indexOf("belge") && (b.datumCode = "rnb72"),b.GEOGCS.DATUM && b.GEOGCS.DATUM.SPHEROID && (b.ellps = b.GEOGCS.DATUM.SPHEROID.name.replace("_19", "").replace(/[Cc]larke_18/, "clrk"), "international" === b.ellps.toLowerCase().slice(0, 13) && (b.ellps = "intl"), b.a = b.GEOGCS.DATUM.SPHEROID.a, b.rf = parseFloat(b.GEOGCS.DATUM.SPHEROID.rf, 10)), ~ b.datumCode.indexOf("osgb_1936") && (b.datumCode = "osgb36"));b.b && !isFinite(b.b) && (b.b = b.a);[["standard_parallel_1", "Standard_Parallel_1"],["standard_parallel_2", "Standard_Parallel_2"],["false_easting", "False_Easting"],["false_northing", "False_Northing"],["central_meridian", "Central_Meridian"],["latitude_of_origin", "Latitude_Of_Origin"],["latitude_of_origin", "Central_Parallel"],["scale_factor", "Scale_Factor"],["k0", "scale_factor"],["latitude_of_center", "Latitude_of_center"],["lat0", "latitude_of_center", e],["longitude_of_center", "Longitude_Of_Center"],["longc", "longitude_of_center", e],["x0", "false_easting", d],["y0", "false_northing", d],["long0", "central_meridian", e],["lat0", "latitude_of_origin", e],["lat0", "standard_parallel_1", e],["lat1", "standard_parallel_1", e],["lat2", "standard_parallel_2", e],["alpha", "azimuth", e],["srsCode", "name"]].forEach(function (d) {var e = d[0],f = d[1];!(e in b) && f in b && (b[e] = b[f], 3 === d.length && (b[e] = d[2](b[e])))});b.long0 || ! b.longc || "Albers_Conic_Equal_Area" !== b.projName && "Lambert_Azimuthal_Equal_Area" !== b.projName || (b.long0 = b.longc);b.lat_ts || ! b.lat1 || "Stereographic_South_Pole" !== b.projName && "Polar Stereographic (variant B)" !== b.projName || (b.lat0 =(0b.lat1? 90: -90) * h, b.lat_ts = b.lat1)}var h = .017453292519943295,r = d("./extend");g.exports = function (b, d) {var e = JSON.parse(("," + b).replace(/\s*,\s*([A-Z_0-9]+?)(\[)/g, ',["$1",').slice(1).replace(/\s*,\s*([A-Z_0-9]+?)\]/g, ',"$1"]').replace(/,\["VERTCS".+/, "")),f = e.shift(),g = e.shift();e.unshift(["name", g]);e.unshift(["type", f]);e.unshift("output");f = {};return p(e, f),q(f.output),r(d, f.output)}}, {"./extend": 34}],67: [function (d, g, f) {function b(d) {var e = d.easting,f = d.zoneNumber;if (0 > f || 60f) return null;var g = (1 - Math.sqrt(.99330562)) / (1 + Math.sqrt(.99330562));var p = d.northing;"N" > d.zoneLetter && (p -= 1E7);p = p / .9996 / 6367449.145945056;var h = p + (3 * g / 2 - 27 * g * g * g / 32) * Math.sin(2 * p) + (21 * g * g / 16 - 55 * g * g * g * g / 32) * Math.sin(4 * p) + 151 * g * g * g / 96 * Math.sin(6 * p);var m = 6378137 / Math.sqrt(1 - .00669438 * Math.sin(h) * Math.sin(h));g = Math.tan(h) * Math.tan(h);p = .006739496752268451 * Math.cos(h) * Math.cos(h);var q = 6335439.32722994 / Math.pow(1 - .00669438 * Math.sin(h) * Math.sin(h), 1.5);e = (e - 5E5) / (.9996 * m);m = h - m * Math.tan(h) / q * (e * e / 2 -(5 + 3 * g + 10 * p - 4 * p * p - .06065547077041606) * e * e * e * e / 24 + (61 + 90 * g + 298 * p + 45 * g * g - 1.6983531815716497 - 3 * p * p) * e * e * e * e * e * e / 720);m = m / Math.PI * 180;e = (e - (1 + 2 * g + p) * e * e * e / 6 + (5 - 2 * p + 28 * g - 3 * p * p + .05391597401814761 + 24 * g * g) * e * e * e * e * e / 120) / Math.cos(h);e = 6 * (f - 1) - 180 + 3 + e / Math.PI * 180;d.accuracy? (d = b({northing: d.northing + d.accuracy,easting: d.easting + d.accuracy,zoneLetter: d.zoneLetter,zoneNumber: d.zoneNumber}), d ={ top: d.lat,right: d.lon,bottom: m,left: e}): d = {lat: m,lon: e};return d}function p(b) {b %= h;return 0 === b && (b = h),b}function e(b) {if (b && 0 === b.length) throw "MGRSPoint coverting from nothing";for (var d, e = b.length, f, g = "", h = 0; !/[A-Z]/.test(d = b.charAt(h));) {if (2 <= h) throw "MGRSPoint bad conversion from: " + b;g += d;h++}d = parseInt(g, 10);if (0 === h || h + 3 > e) throw "MGRSPoint bad conversion from: " + b;g = b.charAt(h++);if ("A" >= g || "B" === g || "Y" === g || "Z" <= g || "I" === g || "O" === g) throw "MGRSPoint zone letter " + g + " not handled: " + b;f = b.substring(h, h += 2);var y = p(d);var I = f.charAt(0);for (var D = r.charCodeAt(y - 1), A = 1E5, F =! 1; D !== I.charCodeAt(0);) {if (D++, D === w && D++, D === v && D++, D > z) {if (F) throw "Bad character: " + I;D = t;F = !0}A += 1E5}I = A;f = f.charAt(1);if ("V"f) throw "MGRSPoint given invalid Northing " + f;y = m.charCodeAt(y - 1);D = 0;for (A =! 1; y !== f.charCodeAt(0);) {if (y++, y === w && y++, y === v && y++, y > x) {if (A) throw "Bad character: " + f;y = t;A = !0}D += 1E5}for (y = D; y q(g);) y += 2E6;e -= h;if (0 !== e % 2) throw "MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters" + b;var J,aa,Q,V,Y;e /= 2;D = f = 0;return 0e && (J = 1E5 / Math.pow(10, e), aa = b.substring(h, h + e), f = parseFloat(aa) * J, Q = b.substring(h + e), D = parseFloat(Q) * J),V = f + I,Y = D + y, {easting: V,northing: Y,zoneLetter: g,zoneNumber: d,accuracy: J}}function q(b) {switch (b) {case "C":var d = 11E5;break;case "D": d = 2E6;break;case "E": d = 28E5;break;case "F": d = 37E5;break;case "G": d = 46E5;break;case "H": d = 55E5;break;case "J": d = 64E5;break;case "K": d = 73E5;break;case "L": d = 82E5;break;case "M": d = 91E5;break;case "N": d = 0;break;case "P": d = 8E5;break;case "Q": d = 17E5;break;case "R": d = 26E5;break;case "S": d = 35E5;break;case "T": d = 44E5;break;case "U": d = 53E5;break;case "V": d = 62E5;break;case "W": d = 7E6;break;case "X": d = 79E5;break;default: d = -1}if (0 <= d) return d;throw "Invalid zone letter: " + b;}var h = 6,r = "AJSAJS",m = "AFAFAF",t = 65,w = 73,v = 79,x = 86,z = 90;f.forward = function (b, d) {var e = b[1];var f = b[0];var g = Math.PI / 180 * e;var h = Math.PI / 180 * f;var q = Math.floor((f + 180) / 6) + 1;180 === f && (q = 60);56 <= e && 64 > e && 3 <= f && 12 > f && (q = 32);72 <= e && 84 > e && (0 <= f && 9 > f? q = 31: 9 <= f && 21 > f? q = 33: 21 <= f && 33 > f? q = 35: 33 <= f && 42 > f && (q = 37));var u = Math.PI / 180 * (6 * (q - 1) - 180 + 3);f = 6378137 / Math.sqrt(1 - .00669438 * Math.sin(g) * Math.sin(g));var y = Math.tan(g) * Math.tan(g);var A = .006739496752268451 * Math.cos(g) * Math.cos(g);h = Math.cos(g) * (h - u);g = .9996 * (6378137 * (.9983242984503243 * g - .002514607064228144 * Math.sin(2 * g) + 2.639046602129982E-6 * Math.sin(4 * g) - 3.4180461016968582E-9 * Math.sin(6 * g)) + f * Math.tan(g) * (h * h / 2 + (5 - y + 9 * A + 4 * A * A) * h * h * h * h / 24 + (61 - 58 * y + y * y + 600 * A - 2.2240339282485886) * h * h * h * h * h * h / 720));0 > e && (g += 1E7);g = Math.round(g);f = Math.round(.9996 * f * (h + (1 - y + A) * h * h * h / 6 + (5 - 18 * y + y * y + 72 * A - .39089081163157013) * h * h * h * h * h / 120) + 5E5);A = "Z";y = (84 >= e && 72 <= e? A = "X": 72 > e && 64 <= e? A = "W": 64 > e && 56 <= e? A = "V": 56 > e && 48 <= e? A = "U": 48 > e && 40 <= e? A = "T": 40 > e && 32 <= e? A = "S": 32 > e && 24 <= e? A = "R": 24 > e && 16 <= e? A = "Q": 16 > e && 8 <= e? A = "P": 8 > e && 0 <= e? A = "N": 0 > e && -8 <= e? A = "M": -8 > e && -16 <= e? A = "L": -16 > e && -24 <= e? A = "K": -24 > e && -32 <= e? A = "J": -32 > e && -40 <= e? A = "H": -40 > e && -48 <= e? A = "G": -48 > e && -56 <= e? A = "F": -56 > e && -64 <= e? A = "E": -64 > e && -72 <= e? A = "D": -72 > e && -80 <= e && (A = "C"),A);A = g;h = f;g = q;q = d || 5;e = "00000" + h;f = "00000" + A;y = g + y;u = p(g);g = Math.floor(h / 1E5);h = Math.floor(A / 1E5) % 20;-- u;A = r.charCodeAt(u);u = m.charCodeAt(u);g = A + g - 1;h = u + h;var F = !1;g > z && (g = g - z + t - 1, F =! 0);(g === w || w > A && g > w || (g > w || w > A) && F) && g++;(g === v || v > A && g > v || (g > v || v > A) && F) && (g++, g === w && g++);g > z && (g = g - z + t - 1);h > x? (h = h - x + t - 1, F =! 0): F = !1;(h === w || w > u && h > w || (h > w || w > u) && F) && h++;(h === v || v > u && h > v || (h > v || v > u) && F) && (h++, h === w && h++);h > x && (h = h - x + t - 1);A = String.fromCharCode(g) + String.fromCharCode(h);return y + A + e.substr(e.length - 5, q) + f.substr(f.length - 5, q)};f.inverse = function (d) {d = b(e(d.toUpperCase()));return d.lat && d.lon? [d.lon, d.lat, d.lon, d.lat]: [d.left, d.bottom, d.right, d.top]};f.toPoint = function (d) {d = b(e(d.toUpperCase()));return d.lat && d.lon? [d.lon, d.lat]: [(d.left + d.right) / 2,(d.top + d.bottom) / 2]}}, {}],68: [function (d, g, f) {g.exports = {name: "proj4",version: "2.3.10",description: "Proj4js is a JavaScript library to transform point coordinates from one coordinate system to another, including datum transformations.",main: "lib/index.js",directories: {test: "test",doc: "docs"},scripts: {test: "./node_modules/istanbul/lib/cli.js test ./node_modules/mocha/bin/_mocha test/test.js"},repository: {type: "git",url: "git://github.com/proj4js/proj4js.git"},author: "",license: "MIT",jam: {main: "dist/proj4.js",include: ["dist/proj4.js", "README.md", "AUTHORS", "LICENSE.md"]},devDependencies: {"grunt-cli": "~0.1.13",grunt: "~0.4.2","grunt-contrib-connect": "~0.6.0","grunt-contrib-jshint": "~0.8.0",chai: "~1.8.1",mocha: "~1.17.1","grunt-mocha-phantomjs": "~0.4.0",browserify: "~3.24.5","grunt-browserify": "~1.3.0","grunt-contrib-uglify": "~0.3.2",curl: "git://github.com/cujojs/curl.git",istanbul: "~0.2.4",tin: "~0.4.0"},dependencies: {mgrs: "~0.0.2"}}}, {}],"./includedProjections": [function (d, g, f) {g.exports = d("hTEDpn")}, {}],hTEDpn: [function (d, g, f) {var b = [d("./lib/projections/tmerc"),d("./lib/projections/utm"),d("./lib/projections/sterea"),d("./lib/projections/stere"),d("./lib/projections/somerc"),d("./lib/projections/omerc"),d("./lib/projections/lcc"),d("./lib/projections/krovak"),d("./lib/projections/cass"),d("./lib/projections/laea"),d("./lib/projections/aea"),d("./lib/projections/gnom"),d("./lib/projections/cea"),d("./lib/projections/eqc"),d("./lib/projections/poly"),d("./lib/projections/nzmg"),d("./lib/projections/mill"),d("./lib/projections/sinu"),d("./lib/projections/moll"),d("./lib/projections/eqdc"),d("./lib/projections/vandg"),d("./lib/projections/aeqd")];g.exports = function (d) {b.forEach(function (b) {d.Proj.projections.add(b)})}}, {"./lib/projections/aea": 40,"./lib/projections/aeqd": 41,"./lib/projections/cass": 42,"./lib/projections/cea": 43,"./lib/projections/eqc": 44,"./lib/projections/eqdc": 45,"./lib/projections/gnom": 47,"./lib/projections/krovak": 48,"./lib/projections/laea": 49,"./lib/projections/lcc": 50,"./lib/projections/mill": 53,"./lib/projections/moll": 54,"./lib/projections/nzmg": 55,"./lib/projections/omerc": 56,"./lib/projections/poly": 57,"./lib/projections/sinu": 58,"./lib/projections/somerc": 59,"./lib/projections/stere": 60,"./lib/projections/sterea": 61,"./lib/projections/tmerc": 62,"./lib/projections/utm": 63,"./lib/projections/vandg": 64}]}, {}, [36])(36)});(function (a) {if ("function" === typeof define && define.amd) define(["leaflet", "proj4"], a); else if ("object" === typeof module && "object" === typeof module.exports) {var d = require("leaflet");var g = require("proj4");module.exports = a(d, g)} else {if ("undefined" === typeof window.L || "undefined" === typeof window.proj4) throw "Leaflet and proj4 must be loaded first";a(window.L, window.proj4)}})(function (a, d) {a.Proj = {};a.Proj._isProj4Obj = function (a) {return "undefined" !== typeof a.inverse && "undefined" !== typeof a.forward};a.Proj.Projection = a.Class.extend({initialize: function (d, f, b) {var g = a.Proj._isProj4Obj(d);this._proj = g? d: this._projFromCodeDef(d, f);this.bounds = g? f: b},project: function (d) {d = this._proj.forward([d.lng, d.lat]);return new a.Point(d[0], d[1])},unproject: function (d, f) {var b = this._proj.inverse([d.x, d.y]);return new a.LatLng(b[1], b[0], f)},_projFromCodeDef: function (a, f) {if (f) d.defs(a, f); else if (void 0 === d.defs[a]) {var b = a.split(":");3b.length && (a = b[b.length - 3] + ":" + b[b.length - 1]);if (void 0 === d.defs[a]) throw "No projection definition for code " + a;}return d(a)}});a.Proj.CRS = a.Class.extend({includes: a.CRS,options: {transformation: new a.Transformation(1, 0, -1, 0)},initialize: function (d, f, b) {if (a.Proj._isProj4Obj(d)) {var g = d.srsCode;b = f || {};this.projection = new a.Proj.Projection(d, b.bounds)} else g = d,b = b || {},this.projection = new a.Proj.Projection(g, f, b.bounds);a.Util.setOptions(this, b);this.code = g;this.transformation = this.options.transformation;this.options.origin && (this.transformation = new a.Transformation(1, -this.options.origin[0], -1, this.options.origin[1]));if (this.options.scales) this._scales = this.options.scales; else if (this.options.resolutions) for (this._scales =[], d = this.options.resolutions.length - 1; 0 <= d; d--) this.options.resolutions[d] && (this._scales[d] = 1 / this.options.resolutions[d]);this.infinite = !this.options.bounds},scale: function (a) {var d = Math.floor(a);if (a === d) return this._scales[a];var b = this._scales[d];return b + (this._scales[d + 1] - b) * (a - d)},zoom: function (a) {var d = this._closestElement(this._scales, a),b = this._scales.indexOf(d);return a === d? b: (a - d) / (this._scales[b + 1] - d) + b},_closestElement: function (a, d) {for (var b, f = a.length; f--;) a[f] <= d && (void 0 === b || ba[f]) && (b = a[f]);return b}});a.Proj.GeoJSON = a.GeoJSON.extend({initialize: function (d, f) {this._callLevel = 0;a.GeoJSON.prototype.initialize.call(this, d, f)},addData: function (d) {var f;d && (d.crs && "name" === d.crs.type? f = new a.Proj.CRS(d.crs.properties.name): d.crs && d.crs.type && (f = new a.Proj.CRS(d.crs.type + ":" + d.crs.properties.code)),void 0 !== f && (this.options.coordsToLatLng = function (b) {b = a.point(b[0], b[1]);return f.projection.unproject(b)}));this._callLevel ++;try {a.GeoJSON.prototype.addData.call(this, d)} finally {this._callLevel --,0 === this._callLevel && delete this.options.coordsToLatLng}}});a.Proj.geoJson = function (d, f) {return new a.Proj.GeoJSON(d, f)};return a.Proj});(function (a, d) {if ("function" === typeof define && define.amd) define(["leaflet"], a); else if ("undefined" !== typeof module) module.exports = d.L? a(d.L): a(require("leaflet")); else {if ("undefined" === typeof d.L) throw "Leaflet must be loaded first.";d.L = a(d.L)}})(function (a) {a.TileLayer.MML = a.TileLayer.extend({options: {attribution: '&copy; <a href="http://www.maanmittauslaitos.fi/avoindata_lisenssi_versio1_20120501"target=new>Maanmittauslaitos</a>'},statics: {get3067Proj: function () {return new a.Proj.CRS("EPSG:3067", "+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs", {origin: [-548576, 8388608],bounds: a.bounds([-548576, 8388608], [1548576, 6291456]),resolutions: [8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1,.5,.25,.125,.0625,.03125,.015625]})}},urls: {peruskartta: "http://tiles.kartat.kapsi.fi/peruskartta/{z}/{x}/{y}.jpg",taustakartta: "http://tiles.kartat.kapsi.fi/taustakartta/{z}/{x}/{y}.jpg",ortokuva: "http://tiles.kartat.kapsi.fi/ortokuva/{z}/{x}/{y}.jpg",peruskartta_3067: "http://tiles.kartat.kapsi.fi/peruskartta_3067/{z}/{x}/{y}.jpg",taustakartta_3067: "http://tiles.kartat.kapsi.fi/taustakartta_3067/{z}/{x}/{y}.jpg",ortokuva_3067: "http://tiles.kartat.kapsi.fi/ortokuva_3067/{z}/{x}/{y}.jpg"},initialize: function (d, g) {a.setOptions(this, g);var f = this.urls[d.toLowerCase()];if (-1 != d.indexOf("3067") && void 0 === a.Proj) throw "Use of EPSG:3067 layers requires Proj4Leaflet plugin.";a.TileLayer.prototype.initialize.call(this, f, g)}});a.tileLayer.mml = function (d, g) {return new a.TileLayer.MML(d, g)};a.TileLayer.MML_WMTS = a.TileLayer.extend({options: {style: "default",maxZoom: 15,minZoom: 0,attribution: '&copy; <a href="http://www.maanmittauslaitos.fi/avoindata_lisenssi_versio1_20120501"target=new>Maanmittauslaitos</a>'}});a.tileLayer.mml_wmts = function (d) {return new a.TileLayer.MML_WMTS("http://avoindata.maanmittauslaitos.fi/mapcache/wmts/1.0.0/" + (d.layer || "taustakartta") + "/default/ETRS-TM35FIN/{z}/{y}/{x}.png", d)};return a}, window); /*
 jQuery UI Touch Punch 0.2.3

 Copyright 2011?2014, Dave Furfero
 Dual licensed under the MIT or GPL Version 2 licenses.

 Depends:
  jquery.ui.widget.js
  jquery.ui.mouse.js
*/!function (a) {function d(a, b) {if (!(1a.originalEvent.touches.length)) {a.preventDefault();var d = a.originalEvent.changedTouches[0],e = document.createEvent("MouseEvents");e.initMouseEvent(b, !0, !0, window, 1, d.screenX, d.screenY, d.clientX, d.clientY, !1, !1, !1, !1, 0, null);a.target.dispatchEvent(e)}}if (a.support.touch = "ontouchend" in document, a.support.touch) {var g,f = a.ui.mouse.prototype,b = f._mouseInit,p = f._mouseDestroy;f._touchStart = function (a) {! g && this._mouseCapture(a.originalEvent.changedTouches[0]) && (g =! 0, this._touchMoved =! 1, d(a, "mouseover"), d(a, "mousemove"), d(a, "mousedown"))};f._touchMove = function (a) {g && (this._touchMoved =! 0, d(a, "mousemove"))};f._touchEnd = function (a) {g && (d(a, "mouseup"), d(a, "mouseout"), this._touchMoved || d(a, "click"), g =! 1)};f._mouseInit = function () {this.element.bind({touchstart: a.proxy(this, "_touchStart"),touchmove: a.proxy(this, "_touchMove"),touchend: a.proxy(this, "_touchEnd")});b.call(this)};f._mouseDestroy = function () {this.element.unbind({touchstart: a.proxy(this, "_touchStart"),touchmove: a.proxy(this, "_touchMove"),touchend: a.proxy(this, "_touchEnd")});p.call(this)}}}(jQuery);!function (a, d) {"object" == typeof exports? module.exports = d(): "function" == typeof define && define.amd? define(d): a.Spinner = d()}(this, function () {function a(a, b) {var d,e = document.createElement(a || "div");for (d in b) e[d] = b[d];return e}function d(a) {for (var b = 1, d = arguments.length; d > b; b++) a.appendChild(arguments[b]);return a}function g(a, b, d, e) {var f = ["opacity", b, ~~ (100 * a),d,e].join("-");d = .01 + d / e * 100;e = Math.max(1 -(1 - a) / b * (100 - d), a);var g = r.substring(0, r.indexOf("Animation")).toLowerCase();return t[f] || (w.insertRule("@" + (g && "-" + g + "-" || "") + "keyframes " + f + "{0%{opacity:" + e + "}" + d + "%{opacity:" + a + "}" + (d + .01) + "%{opacity:1}" + (d + b) % 100 + "%{opacity:" + a + "}100%{opacity:" + e + "}}", w.cssRules.length), t[f] = 1),f}function f(a, b) {var d,e,f = a.style;b = b.charAt(0).toUpperCase() + b.slice(1);for (e = 0; e m.length; e++) if (d = m[e] + b, void 0 !== f[d]) return d;return void 0 !== f[b]? b: void 0}function b(a, b) {for (var d in b) a.style[f(a, d) || d] = b[d];return a}function p(a) {for (var b = 1; b arguments.length; b++) {var d = arguments[b],e;for (e in d) void 0 === a[e] && (a[e] = d[e])}return a}function e(a, b) {return "string" == typeof a? a: a[b % a.length]}function q(a) {this.opts = p(a || {}, q.defaults, v)}function h() {function f(b, d) {return a("<" + b + ' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">', d)}w.addRule(".spin-vml", "behavior:url(#default#VML)");q.prototype.lines = function (a, g) {function h() {return b(f("group", {coordsize: q + " " + q,coordorigin: -m + " " + -m}), {width: q,height: q})}function p(a, p, q) {d(t, d(b(h(), {rotation: 360 / g.lines * a + "deg",left :~~ p}), d(b(f("roundrect", {arcsize: g.corners}), {width: m,height: g.width,left: g.radius,top: - g.width >> 1,filter: q}), f("fill", {color: e(g.color, a),opacity: g.opacity}), f("stroke", {opacity: 0}))))}var m = g.length + g.width,q = 2 * m;var r = 2 * -(g.width + g.length) + "px";var t = b(h(), {position: "absolute",top: r,left: r});if (g.shadow) for (r = 1; r <= g.lines; r++) p(r, -2, "progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for (r = 1; r <= g.lines; r++) p(r);return d(a, t)};q.prototype.opacity = function (a, b, d, e) {a = a.firstChild;e = e.shadow && e.lines || 0;a && b + ea.childNodes.length && (a = a.childNodes[b + e], a = a && a.firstChild, a = a && a.firstChild, a && (a.opacity = d))}}var r,m = ["webkit", "Moz", "ms", "O"],t = {},w = function () {var b = a("style", {type: "text/css"});return d(document.getElementsByTagName("head")[0], b),b.sheet || b.styleSheet}(),v = {lines: 12,length: 7,width: 5,radius: 10,rotate: 0,corners: 1,color: "#000",direction: 1,speed: 1,trail: 100,opacity: .25,fps: 20,zIndex: 2E9,className: "spinner",top: "50%",left: "50%",position: "absolute"};q.defaults = {};p(q.prototype, {spin: function (d) {this.stop();var e = this,f = e.opts,g = e.el = b(a(0, {className: f.className}), {position: f.position,width: 0,zIndex: f.zIndex});f.radius + f.length + f.width;if (b(g, {left: f.left,top: f.top}), d && d.insertBefore(g, d.firstChild || null), g.setAttribute("role", "progressbar"), e.lines(g, e.opts), ! r) {var h,p = 0,m = (f.lines - 1) * (1 - f.direction) / 2,q = f.fps,t = q / f.speed,v = (1 - f.opacity) / (t * f.trail / 100),w = t / f.lines;!function J() {p++;for (var a = 0; af.lines; a++) h = Math.max(1 -(p + (f.lines - a) * w) % t * v, f.opacity),e.opacity(g, a * f.direction + m, h, f);e.timeout = e.el && setTimeout(J, ~~ (1E3 / q))}()}return e},stop: function () {var a = this.el;return a && (clearTimeout(this.timeout), a.parentNode && a.parentNode.removeChild(a), this.el = void 0),this},lines: function (f, h) {function p(d, e) {return b(a(), {position: "absolute",width: h.length + h.width + "px",height: h.width + "px",background: d,boxShadow: e,transformOrigin: "left",transform: "rotate(" + ~~ (360 / h.lines * q + h.rotate) + "deg) translate(" + h.radius + "px,0)",borderRadius: (h.corners * h.width >> 1) + "px"})}for (var m, q = 0, t =( h.lines - 1) * (1 - h.direction) / 2; qh.lines; q++) m = b(a(), {position: "absolute",top: 1 + ~ (h.width / 2) + "px",transform: h.hwaccel? "translate3d(0,0,0)": "",opacity: h.opacity,animation: r && g(h.opacity, h.trail, t + q * h.direction, h.lines) + " " + 1 / h.speed + "s linear infinite"}),h.shadow && d(m, b(p("#000", "0 0 4px #000"), {top: "2px"})),d(f, d(m, p(e(h.color, q), "0 0 1px rgba(0,0,0,.1)")));return f},opacity: function (a, b, d) {ba.childNodes.length && (a.childNodes[b].style.opacity = d)}});var x = b(a("group"), {behavior: "url(#default#VML)"});return ! f(x, "transform") && x.adj? h(): r = f(x, "animation"),q});(function (a) {var d = function () {var d = {showEvent: "click",onShow: function () {},onBeforeShow: function () {},onHide: function () {},onChange: function () {},onSubmit: function () {},colorScheme: "light",color: "3289c7",livePreview: !0,flat: !1,layout: "full",submit: 1,submitText: "OK",height: 156},e = function (b, d) {var e = p(b);a(d).data("colpick").fields.eq(1).val(e.r).end().eq(2).val(e.g).end().eq(3).val(e.b).end()},g = function (b, d) {a(d).data("colpick").fields.eq(4).val(Math.round(b.h)).end().eq(5).val(Math.round(b.s)).end().eq(6).val(Math.round(b.b)).end()},t = function (b, d) {a(d).data("colpick").fields.eq(0).val(q(b))},w = function (b, d) {a(d).data("colpick").selector.css("backgroundColor", "#" + q({h: b.h, s: 100, b: 100}));a(d).data("colpick").selectorIndic.css({left: parseInt(a(d).data("colpick").height * b.s / 100, 10),top: parseInt(a(d).data("colpick").height * (100 - b.b) / 100, 10)})},v = function (b, d) {a(d).data("colpick").hue.css("top", parseInt(a(d).data("colpick").height - a(d).data("colpick").height * b.h / 360, 10))},x = function (b, d) {a(d).data("colpick").currentColor.css("backgroundColor", "#" + q(b))},z = function (b, d) {a(d).data("colpick").newColor.css("backgroundColor", "#" + q(b))},y = function (d) {d = a(this).parent().parent();if (0 this.parentNode.className.indexOf("_hex")) {var h = d.data("colpick");var m = this.value,r = 6 - m.length;if (0r) {for (var u =[], ca = 0; car; ca++) u.push("0");u.push(m);m = u.join("")}h.color = h = f(m);e(h, d.get(0));g(h, d.get(0))} else 0 this.parentNode.className.indexOf("_hsb")? (d.data("colpick").color = h = T({h: parseInt(d.data("colpick").fields.eq(4).val(), 10),s: parseInt(d.data("colpick").fields.eq(5).val(), 10),b: parseInt(d.data("colpick").fields.eq(6).val(), 10)}), e(h, d.get(0)), t(h, d.get(0))): (h = d.data("colpick"), m = parseInt(d.data("colpick").fields.eq(1).val(), 10), r = parseInt(d.data("colpick").fields.eq(2).val(), 10), u = parseInt(d.data("colpick").fields.eq(3).val(), 10), h.color = h = b({r: Math.min(255, Math.max(0, m)),g: Math.min(255, Math.max(0, r)),b: Math.min(255, Math.max(0, u))}), t(h, d.get(0)), g(h, d.get(0)));w(h, d.get(0));v(h, d.get(0));z(h, d.get(0));d.data("colpick").onChange.apply(d.parent(), [h, q(h), p(h), d.data("colpick").el, 0])},u = function (b) {a(this).parent().removeClass("colpick_focus")},G = function () {a(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus");a(this).parent().addClass("colpick_focus")},P = function (b) {b.preventDefault? b.preventDefault(): b.returnValue = !1;var d = a(this).parent().find("input").focus();b = {el: a(this).parent().addClass("colpick_slider"),max: 0 this.parentNode.className.indexOf("_hsb_h")? 360: 0 this.parentNode.className.indexOf("_hsb")? 100: 255,y: b.pageY,field: d,val: parseInt(d.val(), 10),preview: a(this).parent().parent().data("colpick").livePreview};a(document).mouseup(b, E);a(document).mousemove(b, C)},C = function (a) {a.data.field.val(Math.max(0, Math.min(a.data.max, parseInt(a.data.val - a.pageY + a.data.y, 10))));a.data.preview && y.apply(a.data.field.get(0), [!0]);return !1},E = function (b) {y.apply(b.data.field.get(0), [!0]);b.data.el.removeClass("colpick_slider").find("input").focus();a(document).off("mouseup", E);a(document).off("mousemove", C);return !1},H = function (b) {b.preventDefault? b.preventDefault(): b.returnValue = !1;var d = {cal: a(this).parent(),y: a(this).offset().top};a(document).on("mouseup touchend", d, D);a(document).on("mousemove touchmove", d, I);b = "touchstart" == b.type? b.originalEvent.changedTouches[0].pageY: b.pageY;y.apply(d.cal.data("colpick").fields.eq(4).val(parseInt(360 * (d.cal.data("colpick").height -(b - d.y)) / d.cal.data("colpick").height, 10)).get(0), [d.cal.data("colpick").livePreview]);return !1},I = function (a) {var b = "touchmove" == a.type? a.originalEvent.changedTouches[0].pageY: a.pageY;y.apply(a.data.cal.data("colpick").fields.eq(4).val(parseInt(360 * (a.data.cal.data("colpick").height - Math.max(0, Math.min(a.data.cal.data("colpick").height, b - a.data.y))) / a.data.cal.data("colpick").height, 10)).get(0), [a.data.preview]);return !1},D = function (b) {e(b.data.cal.data("colpick").color, b.data.cal.get(0));t(b.data.cal.data("colpick").color, b.data.cal.get(0));a(document).off("mouseup touchend", D);a(document).off("mousemove touchmove", I);return !1},A = function (b) {b.preventDefault? b.preventDefault(): b.returnValue = !1;var d = {cal: a(this).parent(),pos: a(this).offset()};d.preview = d.cal.data("colpick").livePreview;a(document).on("mouseup touchend", d, J);a(document).on("mousemove touchmove", d, F);"touchstart" == b.type? (pageX = b.originalEvent.changedTouches[0].pageX, b = b.originalEvent.changedTouches[0].pageY): (pageX = b.pageX, b = b.pageY);y.apply(d.cal.data("colpick").fields.eq(6).val(parseInt(100 * (d.cal.data("colpick").height -(b - d.pos.top)) / d.cal.data("colpick").height, 10)).end().eq(5).val(parseInt(100 * (pageX - d.pos.left) / d.cal.data("colpick").height, 10)).get(0), [d.preview]);return !1},F = function (a) {if ("touchmove" == a.type) {pageX = a.originalEvent.changedTouches[0].pageX;var b = a.originalEvent.changedTouches[0].pageY} else pageX = a.pageX,b = a.pageY;y.apply(a.data.cal.data("colpick").fields.eq(6).val(parseInt(100 * (a.data.cal.data("colpick").height - Math.max(0, Math.min(a.data.cal.data("colpick").height, b - a.data.pos.top))) / a.data.cal.data("colpick").height, 10)).end().eq(5).val(parseInt(100 * Math.max(0, Math.min(a.data.cal.data("colpick").height, pageX - a.data.pos.left)) / a.data.cal.data("colpick").height, 10)).get(0), [a.data.preview]);return !1},J = function (b) {e(b.data.cal.data("colpick").color, b.data.cal.get(0));t(b.data.cal.data("colpick").color, b.data.cal.get(0));a(document).off("mouseup touchend", J);a(document).off("mousemove touchmove", F);return !1},aa = function (b) {b = a(this).parent();var d = b.data("colpick").color;b.data("colpick").origColor = d;x(d, b.get(0));b.data("colpick").onSubmit(d, q(d), p(d), b.data("colpick").el)},Q = function (b) {b.stopPropagation();b = a("#" + a(this).data("colpickId"));b.data("colpick").onBeforeShow.apply(this, [b.get(0)]);var d = a(this).offset(),e = d.top + this.offsetHeight;d = d.left;var f = Y(),g = b.width();d + g > f.l + f.w && (d -= g);b.css({left: d + "px",top: e + "px"});0 != b.data("colpick").onShow.apply(this, [b.get(0)]) && b.show();a("html").mousedown({cal: b}, V);b.mousedown(function (a) {a.stopPropagation()})},V = function (b) {0 != b.data.cal.data("colpick").onHide.apply(this, [b.data.cal.get(0)]) && b.data.cal.hide();a("html").off("mousedown", V)},Y = function () {var a = "CSS1Compat" == document.compatMode;return {l: window.pageXOffset || (a? document.documentElement.scrollLeft: document.body.scrollLeft),w: window.innerWidth || (a? document.documentElement.clientWidth: document.body.clientWidth)}},T = function (a) {return {h: Math.min(360, Math.max(0, a.h)),s: Math.min(100, Math.max(0, a.s)),b: Math.min(100, Math.max(0, a.b))}},X = function () {var b = a(this).parent(),d = b.data("colpick").origColor;b.data("colpick").color = d;e(d, b.get(0));t(d, b.get(0));g(d, b.get(0));w(d, b.get(0));v(d, b.get(0));z(d, b.get(0))};return {init: function (h) {h = a.extend({}, d, h || {});if ("string" == typeof h.color) h.color = f(h.color); else if (void 0 != h.color.r && void 0 != h.color.g && void 0 != h.color.b) h.color = b(h.color); else if (void 0 != h.color.h && void 0 != h.color.s && void 0 != h.color.b) h.color = T(h.color); else return this;return this.each(function () {if (! a(this).data("colpickId")) {var b = a.extend({}, h);b.origColor = h.color;var d = "collorpicker_" + parseInt(1E3 * Math.random());a(this).data("colpickId", d);d = a('<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>').attr("id", d);d.addClass("colpick_" + b.layout + (b.submit? "": " colpick_" + b.layout + "_ns"));"light" != b.colorScheme && d.addClass("colpick_" + b.colorScheme);d.find("div.colpick_submit").html(b.submitText).click(aa);b.fields = d.find("input").change(y).blur(u).focus(G);d.find("div.colpick_field_arrs").mousedown(P).end().find("div.colpick_current_color").click(X);b.selector = d.find("div.colpick_color").on("mousedown touchstart", A);b.selectorIndic = b.selector.find("div.colpick_selector_outer");b.el = this;b.hue = d.find("div.colpick_hue_arrs");huebar = b.hue.parent();var f = navigator.userAgent.toLowerCase(),p = "Microsoft Internet Explorer" === navigator.appName,m = p? parseFloat(f.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]): 0;f = "#ff0000 #ff0080 #ff00ff #8000ff #0000ff #0080ff #00ffff #00ff80 #00ff00 #80ff00 #ffff00 #ff8000 #ff0000".split(" ");if (p && 10 > m) for (p = 0; 11 >= p; p++) m = a("<div></div>").attr("style", "height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=" + f[p] + ", endColorstr=" + f[p + 1] + '); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=' + f[p] + ", endColorstr=" + f[p + 1] + ')";'),huebar.append(m); else stopList = f.join(","),huebar.attr("style", "background:-webkit-linear-gradient(top," + stopList + "); background: -o-linear-gradient(top," + stopList + "); background: -ms-linear-gradient(top," + stopList + "); background:-moz-linear-gradient(top," + stopList + "); -webkit-linear-gradient(top," + stopList + "); background:linear-gradient(to bottom," + stopList + "); ");d.find("div.colpick_hue").on("mousedown touchstart", H);b.newColor = d.find("div.colpick_new_color");b.currentColor = d.find("div.colpick_current_color");d.data("colpick", b);e(b.color, d.get(0));g(b.color, d.get(0));t(b.color, d.get(0));v(b.color, d.get(0));w(b.color, d.get(0));x(b.color, d.get(0));z(b.color, d.get(0));b.flat? (d.appendTo(this).show(), d.css({position: "relative", display: "block"})): (d.appendTo(document.body), a(this).on(b.showEvent, Q), d.css({position: "absolute"}))}})},showPicker: function () {return this.each(function () {a(this).data("colpickId") && Q.apply(this)})},hidePicker: function () {return this.each(function () {a(this).data("colpickId") && a("#" + a(this).data("colpickId")).hide()})},setColor: function (d, h) {h = "undefined" === typeof h? 1: h;if ("string" == typeof d) d = f(d); else if (void 0 != d.r && void 0 != d.g && void 0 != d.b) d = b(d); else if (void 0 != d.h && void 0 != d.s && void 0 != d.b) d = T(d); else return this;return this.each(function () {if (a(this).data("colpickId")) {var b = a("#" + a(this).data("colpickId"));b.data("colpick").color = d;b.data("colpick").origColor = d;e(d, b.get(0));g(d, b.get(0));t(d, b.get(0));v(d, b.get(0));w(d, b.get(0));z(d, b.get(0));b.data("colpick").onChange.apply(b.parent(), [d, q(d), p(d), b.data("colpick").el, 1]);h && x(d, b.get(0))}})}}}(),g = function (a) {a = parseInt(-1a.indexOf("#")? a.substring(1): a,16);return {r: a >> 16,g: (a & 65280) >> 8,b: a & 255}},f = function (a) {return b(g(a))},b = function (a) {var b = {h: 0,s: 0,b: 0},d = Math.max(a.r, a.g, a.b),e = d - Math.min(a.r, a.g, a.b);b.b = d;b.s = 0 != d? 255 * e / d: 0;b.h = 0 != b.s? a.r == d? (a.g - a.b) / e: a.g == d? 2 + (a.b - a.r) / e: 4 + (a.r - a.g) / e: -1;b.h *= 60;0 > b.h && (b.h += 360);b.s *= 100 / 255;b.b *= 100 / 255;return b},p = function (a) {var b,d;var e = a.h;var f = 255 * a.s / 100;a = 255 * a.b / 100;if (0 == f) e = b = d = a; else {f = (255 - f) * a / 255;var g = e % 60 * (a - f) / 60;360 == e && (e = 0);60 > e? (e = a, d = f, b = f + g): 120 > e? (b = a, d = f, e = a - g): 180 > e? (b = a, e = f, d = f + g): 240 > e? (d = a, e = f, b = a - g): 300 > e? (d = a, b = f, e = f + g): 360 > e? (e = a, b = f, d = a - g): d = b = e = 0}return {r: Math.round(e), g: Math.round(b), b: Math.round(d)}},e = function (b) {var d = [b.r.toString(16), b.g.toString(16), b.b.toString(16)];a.each(d, function (a, b) {1 == b.length && (d[a] = "0" + b)});return d.join("")},q = function (a) {return e(p(a))};a.fn.extend({colpick: d.init, colpickHide: d.hidePicker, colpickShow: d.showPicker, colpickSetColor: d.setColor});a.extend({colpick: {rgbToHex: e,rgbToHsb: b,hsbToHex: q,hsbToRgb: p,hexToHsb: f,hexToRgb: g}})})(jQuery);(function (a) {if ("function" === typeof define && define.amd) define(["leaflet"], a); else if ("undefined" !== typeof module) {var d = require("leaflet");module.exports = a(d)} else {if ("undefined" === typeof window.L) throw Error("Leaflet must be loaded first");a(window.L)}})(function (a) {a.Map.mergeOptions({contextmenuItems: []});a.Map.ContextMenu = a.Handler.extend({_touchstart: a.Browser.msPointer? "MSPointerDown": a.Browser.pointer? "pointerdown": "touchstart",statics: {BASE_CLS: "leaflet-contextmenu"},initialize: function (b) {a.Handler.prototype.initialize.call(this, b);this._items = [];this._visible = !1;var d = this._container = a.DomUtil.create("div", a.Map.ContextMenu.BASE_CLS, b._container);d.style.zIndex = 1E4;d.style.position = "absolute";b.options.contextmenuWidth && (d.style.width = b.options.contextmenuWidth + "px");this._createItems();a.DomEvent.on(d, "click", a.DomEvent.stop).on(d, "mousedown", a.DomEvent.stop).on(d, "dblclick", a.DomEvent.stop).on(d, "contextmenu", a.DomEvent.stop)},addHooks: function () {a.DomEvent.on(document, "keydown", this._onKeyDown, this);this._map.on({contextmenu: this._show,mousedown: this._hide,movestart: this._hide,zoomstart: this._hide}, this);a.DomEvent.on(this._map.getContainer(), "mouseleave", this._hide, this)},removeHooks: function () {a.DomEvent.off(document, a.Browser.touch? this._touchstart: "mousedown",this._onMouseDown,this).off(document, "keydown", this._onKeyDown, this);this._map.off({contextmenu: this._show,mousedown: this._hide,movestart: this._hide,zoomstart: this._hide}, this);a.DomEvent.off(this._map.getContainer(), "mouseleave", this._hide, this)},showAt: function (b, d) {b instanceof a.LatLng && (b = this._map.latLngToContainerPoint(b));this._showAtPoint(b, d)},hide: function () {this._hide()},addItem: function (a) {return this.insertItem(a)},insertItem: function (a, b) {b = void 0 !== b? b: this._items.length;var d = this._createItem(this._container, a, b);this._items.push(d);this._sizeChanged = !0;this._map.fire("contextmenu.additem", {contextmenu: this,el: d.el,index: b});return d.el},removeItem: function (b) {var d = this._container;isNaN(b) || (b = d.children[b]);b && (this._removeItem(a.Util.stamp(b)), this._sizeChanged =! 0, this._map.fire("contextmenu.removeitem", {contextmenu: this,el: b}))},removeAllItems: function () {for (var b; this._container.children.length;) b = this._container.children[0],this._removeItem(a.Util.stamp(b))},hideAllItems: function () {var a;var b = 0;for (a = this._items.length; ba; b++) {var d = this._items[b];d.el.style.display = "none"}},showAllItems: function () {var a;var b = 0;for (a = this._items.length; ba; b++) {var d = this._items[b];d.el.style.display = ""}},setDisabled: function (b, d) {var e = this._container,f = a.Map.ContextMenu.BASE_CLS + "-item";isNaN(b) || (b = e.children[b]);b && a.DomUtil.hasClass(b, f) && (d? (a.DomUtil.addClass(b, f + "-disabled"), this._map.fire("contextmenu.disableitem", {contextmenu: this,el: b})): (a.DomUtil.removeClass(b, f + "-disabled"), this._map.fire("contextmenu.enableitem", {contextmenu: this,el: b})))},isVisible: function () {return this._visible},_createItems: function () {var b = this._map.options.contextmenuItems,a;var d = 0;for (a = b.length; da; d++) this._items.push(this._createItem(this._container, b[d]))},_createItem: function (b, d, f) {if (d.separator || "-" === d) return this._createSeparator(b, f);var e = a.Map.ContextMenu.BASE_CLS + "-item";b = this._insertElementAt("a", d.disabled? e + " " + e + "-disabled": e,b,f);f = this._createEventHandler(b, d.callback, d.context, d.hideOnSelect);e = "";d.icon? e = '<img class="' + a.Map.ContextMenu.BASE_CLS + '-icon" src="' + d.icon + '"/>': d.iconCls && (e = '<span class="' + a.Map.ContextMenu.BASE_CLS + "-icon " + d.iconCls + '"></span>');b.innerHTML = e + d.text;b.href = "#";a.DomEvent.on(b, "mouseover", this._onItemMouseOver, this).on(b, "mouseout", this._onItemMouseOut, this).on(b, "mousedown", a.DomEvent.stopPropagation).on(b, "click", f);return {id: a.Util.stamp(b), el: b, callback: f}},_removeItem: function (b) {var d;var e = 0;for (d = this._items.length; ed; e++) {var f = this._items[e];if (f.id === b) return b = f.el,(d = f.callback) && a.DomEvent.off(b, "mouseover", this._onItemMouseOver, this).off(b, "mouseover", this._onItemMouseOut, this).off(b, "mousedown", a.DomEvent.stopPropagation).off(b, "click", d),this._container.removeChild(b),this._items.splice(e, 1),f}return null},_createSeparator: function (b, d) {var e = this._insertElementAt("div", a.Map.ContextMenu.BASE_CLS + "-separator", b, d);return {id: a.Util.stamp(e), el: e}},_createEventHandler: function (b, d, f, g) {var e = this,h = this._map,p = a.Map.ContextMenu.BASE_CLS + "-item-disabled";g = void 0 !== g? g: !0;return function (m) {a.DomUtil.hasClass(b, p) || (g && e._hide(), d && d.call(f || h, e._showLocation), e._map.fire("contextmenu:select", {contextmenu: e,el: b}))}},_insertElementAt: function (b, a, d, f) {var e;b = document.createElement(b);b.className = a;void 0 !== f && (e = d.children[f]);e? d.insertBefore(b, e): d.appendChild(b);return b},_show: function (b) {this._showAtPoint(b.containerPoint, b)},_showAtPoint: function (b, d) {if (this._items.length) {var e = this._map,f = e.containerPointToLayerPoint(b);e = e.layerPointToLatLng(f);var g = a.extend(d || {}, {contextmenu: this});this._showLocation = {latlng: e,layerPoint: f,containerPoint: b};d && d.relatedTarget && (this._showLocation.relatedTarget = d.relatedTarget);this._setPosition(b);this._visible? this._setPosition(b): (this._container.style.display = "block", this._visible =! 0);this._map.fire("contextmenu.show", g)}},_hide: function () {this._visible && (this._visible =! 1, this._container.style.display = "none", this._map.fire("contextmenu.hide", {contextmenu: this}))},_setPosition: function (b) {var d = this._map.getSize(),e = this._container,f = this._getElementSize(e);if (this._map.options.contextmenuAnchor) {var g = a.point(this._map.options.contextmenuAnchor);b = b.add(g)}e._leaflet_pos = b;b.x + f.x > d.x? (e.style.left = "auto", e.style.right = Math.max(d.x - b.x, 0) + "px"): (e.style.left = Math.max(b.x, 0) + "px", e.style.right = "auto");b.y + f.y > d.y? (e.style.top = "auto", e.style.bottom = Math.max(d.y - b.y, 0) + "px"): (e.style.top = Math.max(b.y, 0) + "px", e.style.bottom = "auto")},_getElementSize: function (b) {var a = this._size,d = b.style.display;if (! a || this._sizeChanged) a = {},b.style.left = "-999999px",b.style.right = "auto",b.style.display = "block",a.x = b.offsetWidth,a.y = b.offsetHeight,b.style.left = "auto",b.style.display = d,this._sizeChanged = !1;return a},_onMouseDown: function (b) {this._hide()},_onKeyDown: function (b) {27 === b.keyCode && this._hide()},_onItemMouseOver: function (b) {a.DomUtil.addClass(b.target || b.srcElement, "over")},_onItemMouseOut: function (b) {a.DomUtil.removeClass(b.target || b.srcElement, "over")}});a.Map.addInitHook("addHandler", "contextmenu", a.Map.ContextMenu);a.Mixin.ContextMenu = {bindContextMenu: function (b) {a.setOptions(this, b);this._initContextMenu();return this},unbindContextMenu: function () {this.off("contextmenu", this._showContextMenu, this);return this},_initContextMenu: function () {this._items = [];this.on("contextmenu", this._showContextMenu, this)},_showContextMenu: function (b) {var d;if (this._map.contextmenu) {var e = a.extend({relatedTarget: this}, b);var f = this._map.mouseEventToContainerPoint(b.originalEvent);this.options.contextmenuInheritItems || this._map.contextmenu.hideAllItems();var g = 0;for (d = this.options.contextmenuItems.length; gd; g++) b = this.options.contextmenuItems[g],this._items.push(this._map.contextmenu.insertItem(b, b.index));this._map.once("contextmenu.hide", this._hideContextMenu, this);this._map.contextmenu.showAt(f, e)}},_hideContextMenu: function () {var b;var a = 0;for (b = this._items.length; ab; a++) this._map.contextmenu.removeItem(this._items[a]);this._items.length = 0;this.options.contextmenuInheritItems || this._map.contextmenu.showAllItems()}};var d = [a.Marker, a.Path],g = {contextmenu: !1,contextmenuItems: [],contextmenuInheritItems: !0},f;var b = 0;for (f = d.length; bf; b++) {var p = d[b];p.prototype.options? p.mergeOptions(g): p.prototype.options = g;p.addInitHook(function () {this.options.contextmenu && this._initContextMenu()});p.include(a.Mixin.ContextMenu)}return a.Map.ContextMenu});L.Control.Fullscreen = L.Control.extend({options: {position: "topleft",title: {"false": "View Fullscreen","true": "Exit Fullscreen"}},onAdd: function (a) {var d = L.DomUtil.create("div", "leaflet-control-fullscreen leaflet-bar leaflet-control");this.link = L.DomUtil.create("a", "leaflet-control-fullscreen-button leaflet-bar-part", d);this.link.href = "#";this._map = a;this._map.on("fullscreenchange", this._toggleTitle, this);this._toggleTitle();L.DomEvent.on(this.link, "click", this._click, this);return d},_click: function (a) {L.DomEvent.stopPropagation(a);L.DomEvent.preventDefault(a);this._map.toggleFullscreen()},_toggleTitle: function () {this.link.title = this.options.title[this._map.isFullscreen()]}});L.Map.include({isFullscreen: function () {return this._isFullscreen || !1},toggleFullscreen: function () {var a = this.getContainer();this.isFullscreen()? document.exitFullscreen? document.exitFullscreen(): document.mozCancelFullScreen? document.mozCancelFullScreen(): document.webkitCancelFullScreen? document.webkitCancelFullScreen(): document.msExitFullscreen? document.msExitFullscreen(): (L.DomUtil.removeClass(a, "leaflet-pseudo-fullscreen"), this._setFullscreen(!1), this.invalidateSize(), this.fire("fullscreenchange")): a.requestFullscreen? a.requestFullscreen(): a.mozRequestFullScreen? a.mozRequestFullScreen(): a.webkitRequestFullscreen? a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT): a.msRequestFullscreen? a.msRequestFullscreen(): (L.DomUtil.addClass(a, "leaflet-pseudo-fullscreen"), this._setFullscreen(!0), this.invalidateSize(), this.fire("fullscreenchange"))},_setFullscreen: function (a) {this._isFullscreen = a;var d = this.getContainer();a? L.DomUtil.addClass(d, "leaflet-fullscreen-on"): L.DomUtil.removeClass(d, "leaflet-fullscreen-on")},_onFullscreenChange: function (a) {a = document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;a !== this.getContainer() || this._isFullscreen? a !== this.getContainer() && this._isFullscreen && (this._setFullscreen(!1), this.fire("fullscreenchange")): (this._setFullscreen(!0), this.fire("fullscreenchange"))}});L.Map.mergeOptions({fullscreenControl: !1});L.Map.addInitHook(function () {this.options.fullscreenControl && (this.fullscreenControl = new L.Control.Fullscreen, this.addControl(this.fullscreenControl));var a;"onfullscreenchange" in document? a = "fullscreenchange": "onmozfullscreenchange" in document? a = "mozfullscreenchange": "onwebkitfullscreenchange" in document? a = "webkitfullscreenchange": "onmsfullscreenchange" in document && (a = "MSFullscreenChange");if (a) {var d = L.bind(this._onFullscreenChange, this);this.whenReady(function () {L.DomEvent.on(document, a, d)});this.on("unload", function () {L.DomEvent.off(document, a, d)})}});L.control.fullscreen = function (a) {return new L.Control.Fullscreen(a)};L.Control.ViewCenter = L.Control.extend({options: {position: "topleft",title: "Center map",forceSeparateButton: !1,vcLatLng: [52.03, 19.27],vcZoom: 6},onAdd: function (a) {var d = a.zoomControl && !this.options.forceSeparateButton? a.zoomControl._container: L.DomUtil.create("div", "leaflet-bar");this._createButton(this.options, "leaflet-control-view-center", d, this.setCenterView, a);return d},_createButton: function (a, d, g, f, b) {d = L.DomUtil.create("a", d, g);d.href = "";d.title = a.title;L.DomEvent.addListener(d, "click", L.DomEvent.stopPropagation).addListener(d, "click", L.DomEvent.preventDefault).addListener(d, "click", function () {centerMapByImage()}, b);return d}});L.control.viewcenter = function (a) {return new L.Control.ViewCenter(a)};window.L_PREFER_CANVAS = !0;var mapLoverlay = null,osmOverlay = null,attributionText = "gpsseuranta.net";opts = {lines: 13,length: 40,width: 10,radius: 25,corners: 1,rotate: 0,direction: 1,color: "#000",speed: .8,trail: 60,shadow: !1,hwaccel: !1,className: "spinner",zIndex: 2E9,top: "50%",left: "50%"};var target = document.getElementById("map");spinner = (new Spinner(opts)).spin(target);opts2 = {lines: 10,length: 6,width: 3,radius: 3,corners: 1,rotate: 0,direction: 1,color: "#ff1818",speed: 1,trail: 60,shadow: !1,hwaccel: !1,className: "spinner2",zIndex: 2E9,top: "50%",left: "50%",position: "relative"};spinner2 = (new Spinner(opts2)).spin();document.getElementById("playTime").appendChild(spinner2.el);L.CRS.CustomZoom = L.extend({}, L.CRS.Simple, {scale: function (a) {return Math.pow(2, .5 * (a + 1))}});var map = L.map("map", {minZoom: -4,maxZoom: 4,crs: L.CRS.Simple,zoomSnap: 0,zoomDelta: 1,contextmenu: hideallmenus? !1: !0,contextmenuWidth: 180,contextmenuItems: [{text: "Add splitpoint",callback: cmenu_splitpoint}, {text: "Add splitline",callback: cmenu_splitline}, {text: "Mass-start here",callback: massstartHere}, {text: "Reset all offsets",callback: resetAllOffsets}]}).setView([0, 0], -1);map.contextmenu.setDisabled(3, !0);map.on("zoomend", function (a) {updatescalebar()});map.on("zoomstart", function (a) {zoomstarted()});map.on("contextmenu.show", function (a) {markcmenupoint(a.contextmenu._showLocation.latlng)});map.on("contextmenu.hide", function () {hidecmenupoint()});map.on("mousemove", function (a) {isdrawingsline && (splitlinecandidate.setLatLngs([splitlinecandidate.getLatLngs()[0],a.latlng]), splitlinecandidate2.setLatLngs([splitlinecandidate.getLatLngs()[0],a.latlng]))});map.on("click", function (a) {isdrawingsline && endsplitline(a.latlng)});map.on("contextmenu", function (a) {L.DomEvent.stopPropagation(a)});var offsetBtn = L.Control.extend({options: {position: "bottomleft"},onAdd: function (a) {a = L.DomUtil.create("div", "btnOffsetReset");a.innerHTML = "diff";return a}});map.addControl(new offsetBtn);$(".btnOffsetReset").click(function (a) {resetAllOffset()});function setMapSystem(a, d, g, f, b) {if (0a) {new L.Proj.CRS("EPSG:3067", "+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,-0,-0,-0,0 + +units=m +no_defs", {resolutions: [8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1,.5,.25,.125,.0625],bounds: L.bounds([-548576, 6291456], [1548576, 8388608]),origin: [-548576, 0]});new L.Proj.CRS("EPSG:3067", "+proj=utm +zone=35 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 + +units=m +no_defs", {resolutions: [8192,4096,2048,1024,512,256,128,64,32,16,8,4,2,1,.5,.25,.125,.0625,.03125,.015625],origin: [-548576, 8388608],bounds: L.bounds([-548576, 8388608], [1548576, 6291456])});map.remove();var p = "";p = 7;var e = 5;4 == a && (p = g + "/{z}/{x}/{y}.png", g = f.split("|"), osmOverlay = L.tileLayer(p, {minZoom: g[0],maxZoom: g[1]}), p = e = g[0]);3 == a? (osmOverlay = L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {maxZoom: 18,attribution: "&copy; OpenStreetMap"}), attributionText = "&copy; OpenStreetMap"): 2 == a? (osmOverlay = L.tileLayer("http://opencache.statkart.no/gatekeeper/gk/gk.open_wmts?&layer=topo4&style=default&tilematrixset=EPSG%3A3857&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fpng&TileMatrix=EPSG%3A3857%3A{z}&TileCol={x}&TileRow={y}", {maxZoom: 18,attribution: "&copy; Kartverket"}), attributionText = "&copy; Kartverket"): 1 == a? osmOverlay = L.tileLayer.mml_wmts({layer: "maastokartta"}): 5 == a? (osmOverlay = L.tileLayer("http://{s}.kartat.kapsi.fi/peruskartta/{z}/{x}/{y}.png", {subdomains: ["tile1", "tile2"],maxZoom: 18,attribution: "&copy; Maanmittauslaitos"}), attributionText = "&copy; Maanmittauslaitos", p = 10, attrib = "&copy; Maanmittauslaitos", osmOverlay = new L.TileLayer("http://{s}.kartat.kapsi.fi/peruskartta_3067/{z}/{x}/{y}.png", {maxZoom: 13,minZoom: 0,tileSize: 256,tms: !1,continuousWorld: !1,attribution: attrib,subdomains: ["tile1", "tile2"]})): 6 == a && (osmOverlay = L.tileLayer.mml_wmts({layer: "taustakartta"}));map = L.map("map", {minZoom: e,crs: 1 == a || 5 == a || 6 == a? L.TileLayer.MML.get3067Proj(): L.CRS.EPSG3857,zoomSnap: 1 == a || 5 == a || 6 == a? 1: 0,zoomDelta: 1,contextmenu: hideallmenus? !1: !0,maxZoom: 1 == a || 5 == a || 6 == a? 15: 18,contextmenuWidth: 180,bounceAtZoomLimits: !1,contextmenuItems: [{text: "Add splitpoint",callback: cmenu_splitpoint}, {text: "Add splitline",callback: cmenu_splitline}, {text: "Mass-start here",callback: massstartHere}, {text: "Reset all offsets",callback: resetAllOffsets}]}).setView([d.y, d.x], p).addLayer(osmOverlay);4 == a && (a = b.split("|"), a = new L.LatLngBounds(new L.LatLng(a[1], a[0]), new L.LatLng(a[3], a[2])), map.fitBounds(a));map.contextmenu.setDisabled(3, !0);map.on("zoomend", function (b) {updatescalebar()});map.on("zoomstart", function (b) {zoomstarted()});map.on("contextmenu.show", function (b) {markcmenupoint(b.contextmenu._showLocation.latlng)});map.on("contextmenu.hide", function () {hidecmenupoint()});map.on("mousemove", function (b) {isdrawingsline && (splitlinecandidate.setLatLngs([splitlinecandidate.getLatLngs()[0],b.latlng]), splitlinecandidate2.setLatLngs([splitlinecandidate.getLatLngs()[0],b.latlng]))});map.on("click", function (b) {isdrawingsline && endsplitline(b.latlng)});map.addControl(new offsetBtn);$(".btnOffsetReset").click(function (b) {resetAllOffset()});spinner.stop();splitlgroup.addTo(map)}}var group = L.layerGroup().addTo(map),group2 = L.layerGroup().addTo(map),splitlgroup = L.layerGroup().addTo(map),mapHeight = 0,mapWidth = 0;function centerMapByImage() {var a = mapWidth / 2,d = mapHeight / 2;null != trevent && 0 trevent.mapsystem? map.setView([trevent.cpoint.y, trevent.cpoint.x], 12): map.setView([d, a], -1)}function drawLeafletMap(a, d, g, f) {imageSize(a, d, g, function (b) {if (0 == mapsystem) {var d = b.height;b = b.width;mapHeight = d;mapWidth = b;console.log(d + " " + b);var e = [[0, 0],[d, b]];map.setView([d / 2,b / 2], -1);mapLoverlay = L.imageOverlay(a, e, {attribution: '<a href="http://www.gpsseuranta.net/">GPS-seuranta</a> <div id="evName"></div>'}).addTo(map);0 trevent.predefcradius && 0 == mapsystem && map.contextmenu.addItem({text: "Pre-def splitpoints", callback: usePredefSplitpoints});f("")}})}function imageSize(a, d, g, f) {var b = {};if (0d) b = {width: d,height: g},f && f(b); else {var p = new Image;p.onload = function () {b = {width: p.width,height: p.height};f && f(b)};console.log("map downloaded");p.src = a}}function cmenu_splitpoint(a) {addsplitpoint(a.latlng)}function cmenu_splitline(a) {startsplitline(a.latlng)}function massstartHere(a) {setoneclickmassstart(a.latlng.lng, a.latlng.lat)}function centerMap(a) {map.panTo(a.latlng, {})}function resetAllOffsets(a) {resetAllOffset()}function zoomIn(a) {var d = map.getZoom() + 1;map.setZoomAround(a.latlng, d)}function zoomOut(a) {var d = map.getZoom() - 1;map.setZoomAround(a.latlng, d)}function usePredefSplitpoints(a) {map.contextmenu.removeItem(4);definepredefsplitpoints()}L.Control.Fullscreen;$(".leaflet-container").css("cursor", "auto");function point(a, d) {this.x = a;this.y = d}function calibration() {this.calibrated = !1;this.a23 = this.a22 = this.a21 = this.a13 = this.a12 = this.a11 = this.centralmeridian = 0;this.overallscale = 1;this.MML = !1;this.calibrate = function (a, d) {var g = a.split("|");this.centralmeridian = g[0];var f = new point(g[0], g[1]);var b = new point(g[4], g[5]);var p = new point(g[8], g[9]);var e = this.KKJLaLo_to_KKJxy(f, this.centralmeridian).x;f = this.KKJLaLo_to_KKJxy(f, this.centralmeridian).y;var q = this.KKJLaLo_to_KKJxy(b, this.centralmeridian).x;b = this.KKJLaLo_to_KKJxy(b, this.centralmeridian).y;var h = this.KKJLaLo_to_KKJxy(p, this.centralmeridian).x;var r = this.KKJLaLo_to_KKJxy(p, this.centralmeridian).y;p = g[2] / d;var m = - g[3] / d;var t = g[6] / d;var w = - g[7] / d;var v = g[10] / d;g = - g[11] / d;if (1 > Math.abs(b - r)) {var x = q,z = t,y = b,u = w;q = e;t = p;b = f;w = m;e = x;p = z;f = y;m = u}this.a11 = (p * (b - r) - f * (t - v) + t * r - b * v) / (e * (b - r) - f * (q - h) + q * r - b * h);this.a12 = -(p * (b - r) - f * (t - v) + t * r - b * v) * (q - h) / ((e * (b - r) - f * (q - h) + q * r - b * h) * (b - r)) + t / (b - r) - v / (b - r);this.a13 = (p * (b - r) - f * (t - v) + t * r - b * v) * (q * r - b * h) / ((e * (b - r) - f * (q - h) + q * r - b * h) * (b - r)) - t * r / (b - r) + b * v / (b - r);this.a21 = -(f * (w - g) - m * (b - r) + b * g - w * r) / (e * (b - r) - f * (q - h) + q * r - b * h);this.a22 = (f * (w - g) - m * (b - r) + b * g - w * r) * (q - h) / ((e * (b - r) - f * (q - h) + q * r - b * h) * (b - r)) + (w - g) / (b - r);this.a23 = -(f * (w - g) - m * (b - r) + b * g - w * r) * (q * r - b * h) / ((e * (b - r) - f * (q - h) + q * r - b * h) * (b - r)) - (w - g) * r / (b - r) + g;this.calibrated = !0;this.overallscale = (Math.pow((Math.pow(t - p, 2) + Math.pow(w - m, 2)) / (Math.pow(q - e, 2) + Math.pow(b - f, 2)), .5) + Math.pow((Math.pow(v - p, 2) + Math.pow(g - m, 2)) / (Math.pow(h - e, 2) + Math.pow(r - f, 2)), .5) + Math.pow((Math.pow(t - v, 2) + Math.pow(w - g, 2)) / (Math.pow(q - h, 2) + Math.pow(b - r, 2)), .5)) / 3};this.getmapx = function (a, d) {if (this.MML) return this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).x;if (!this.calibrated) return 0;var g = this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).x,f = this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).y;return this.a11 * g + this.a12 * f + this.a13};this.getmapy = function (a, d) {if (this.MML || !this.calibrated) return this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).y;var g = this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).x,f = this.KKJLaLo_to_KKJxy(new point(a, d), this.centralmeridian).y;return -(this.a21 * g + this.a22 * f + this.a23)};this.setMML = function () {this.MML = !0};this.setCenterMer = function (a) {this.centralmeridian = a};this.KKJLaLo_to_KKJxy = function (a, d) {var g = (a.x - d) * Math.PI / 180,f = 6378137 * (1 - 1 / 298.257223563),b = f * f,p = 6378137 / f * 6378137,e = (40680631590769 - b) / b;b = (6378137 - f) / (6378137 + f);var q = b * b;f = Math.cos(a.y * Math.PI / 180);f = Math.atan(Math.tan(a.y * Math.PI / 180) / Math.cos(g * Math.sqrt(1 + e * f * f)));var h = Math.cos(f);g = Math.tan(g) * h / Math.sqrt(1 + e * h * h);var r = 6378137 / (1 + b);e = r * (1 + q / 4 + q * q / 64);h = 1.5 * r * b * (1 - q / 8);var m = .9375 * r * q * (1 - q / 4);b *= 35 * r / 48 * q;q = new point(0, 0);q.y = e * f - h * Math.sin(2 * f) + m * Math.sin(4 * f) - b * Math.sin(6 * f);q.x = p * Math.log(g + Math.sqrt(1 + g * g)) + 15E5;return q};this.GetDistance2 = function (a, d, g, f) {var b = Math.sin((d - f) * Math.PI / 180 * .5);a = Math.sin((a - g) * Math.PI / 180 * .5);return 12756274 * Math.asin(Math.sqrt(b * b + Math.cos(d * Math.PI / 180) * Math.cos(f * Math.PI / 180) * a * a))}}function ETRStoWGS(a, d) {var g = 27 * Math.PI / 180,f = 1 / 298.257223563,b = b = f / (2 - f),p = 6378137 / (1 + b) * (1 + Math.pow(b, 2) / 4 + Math.pow(b, 4) / 64);f = Math.sqrt(2 * f - Math.pow(f, 2));var e = .5 * b - 2 / 3 * Math.pow(b, 2) + 37 / 96 * Math.pow(b, 3) - 1 / 360 * Math.pow(b, 4),q = 1 / 48 * Math.pow(b, 2) + 1 / 15 * Math.pow(b, 3) - 437 / 1440 * Math.pow(b, 4),h = 17 / 480 * Math.pow(b, 3) - 37 / 840 * Math.pow(b, 4);b = 4397 / 161280 * Math.pow(b, 4);var r = d / (.9996 * p),m = (a - 5E5) / (.9996 * p);p = m - e * Math.cos(2 * r) * Math.sinh(2 * m) - q * Math.cos(4 * r) * Math.sinh(4 * m) - h * Math.cos(6 * r) * Math.sinh(6 * m) - b * Math.cos(8 * r) * Math.sinh(8 * m);e = Math.asin(Math.sin(r - e * Math.sin(2 * r) * Math.cosh(2 * m) - q * Math.sin(4 * r) * Math.cosh(4 * m) - h * Math.sin(6 * r) * Math.cosh(6 * m) - b * Math.sin(8 * r) * Math.cosh(8 * m)) / Math.cosh(p));q = Math.asinh(Math.tan(e));h = q + f * Math.atanh(f * Math.tanh(q));h = q + f * Math.atanh(f * Math.tanh(h));h = q + f * Math.atanh(f * Math.tanh(h));h = q + f * Math.atanh(f * Math.tanh(h));LALO = {};return {x: 180 *(g + Math.asin(Math.tanh(p) / Math.cos(e))) / Math.PI,y: 180 *Math.atan(Math.sinh(h)) / Math.PI}}Math.sinh = Math.sinh || function (a) {return(Math.exp(a) - Math.exp(- a)) / 2};Math.cosh = Math.cosh || function (a) {return(Math.exp(a) + Math.exp(- a)) / 2};Math.tanh = Math.tanh || function (a) {return Infinity === a? 1: -Infinity === a? -1: (Math.exp(a) - Math.exp(- a)) / (Math.exp(a) + Math.exp(- a))};Math.asinh = Math.asinh || function (a) {return -Infinity === a? a: Math.log(a + Math.sqrt(a * a + 1))};Math.acosh = Math.acosh || function (a) {return Math.log(a + Math.sqrt(a * a - 1))};Math.atanh = Math.atanh || function (a) {return Math.log((1 + a) / (1 - a)) / 2};L.NumberedDivIcon = L.Icon.extend({balloondiv: null,numdiv: null,options: {number: "",shadowUrl: null,iconSize: new L.Point(12, 12),iconAnchor: new L.Point(6, 6),popupAnchor: new L.Point(12, -33),color: "red",opacityB: 1,size: 12,lsize: 20,highlighted: 0,zIndex: 0,blackshadow: !1,isbuoy: !1,rallymode: 0},createIcon: function () {var a = document.createElement("div");this.balloondiv = document.createElement("div");this.balloondiv.style.backgroundColor = this.options.color;this.balloondiv.style.opacity = this.options.opacityB;this.numdiv = document.createElement("div");a.setAttribute("class", "Leaf_marker");this.balloondiv.setAttribute("class", "Leaf_balloon");this.numdiv.setAttribute("class", this.options.blackshadow? "Leaf_label_black": "Leaf_label_white");this.numdiv.innerHTML = this.options.number || "";this.numdiv.style.color = this.options.color;a.appendChild(this.balloondiv);a.appendChild(this.numdiv);this.balloondiv.style.width = this.options.size + "px";this.balloondiv.style.height = this.options.size + "px";this.balloondiv.style.top = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.left = "-" + (this.options.size / 2 + 2) + "px";this.numdiv.style.top = .35 * this.options.size + "px";this.numdiv.style.left = .35 * this.options.size + "px";this.numdiv.style.fontSize = this.options.lsize + "px";this.numdiv.style.lineHeight = "1.0";0 this.options.highlighted && (this.numdiv.style.backgroundColor = "rgba(255, 255, 255, 0.9)", this.numdiv.style.border = "1px solid", this.numdiv.style.borderRadius = "25%", this.numdiv.style.borderColor = "black", this.numdiv.style.padding = "2px");this.options.isbuoy && (this.balloondiv.style.width = this.options.size / 2 + "px", this.balloondiv.style.height = this.options.size / 2 + "px", this.balloondiv.style.top = "-" + (this.options.size / 4 + 1) + "px", this.balloondiv.style.left = "-" + (this.options.size / 4 + 1) + "px", this.balloondiv.style.boxShadow = "0px 0px 0px " + (this.options.size / 2 + "px") + " rgba(100, 100, 100, 0.7)");a.style.pointerEvents = "none";return a},createShadow: function () {return null},setopacity: function (a) {this.balloondiv.style.borderColor = .9a? "black": "gray"},settext: function (a) {this.options.number = a;this.numdiv.innerHTML = this.options.number || ""},setsizes: function (a, d) {this.options.size = a;this.options.lsize = d;this.balloondiv.style.width = this.options.size + "px";this.balloondiv.style.height = this.options.size + "px";this.balloondiv.style.top = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.left = "-" + (this.options.size / 2 + 2) + "px";this.numdiv.style.top = .35 * this.options.size + "px";this.numdiv.style.left = .35 * this.options.size + "px";this.numdiv.style.fontSize = this.options.lsize + "px";this.numdiv.style.lineHeight = "1.0";0 this.options.highlighted && (this.numdiv.style.backgroundColor = "rgba(255, 255, 255, 0.9)", this.numdiv.style.border = "1px solid", this.numdiv.style.borderRadius = "25%", this.numdiv.style.borderColor = "black", this.numdiv.style.padding = "2px");this.options.isbuoy && (this.balloondiv.style.width = this.options.size / 2 + "px", this.balloondiv.style.height = this.options.size / 2 + "px", this.balloondiv.style.top = "-" + (this.options.size / 4 + 1) + "px", this.balloondiv.style.left = "-" + (this.options.size / 4 + 1) + "px", this.balloondiv.style.boxShadow = "0px 0px 0px " + (this.options.size / 2 + "px") + " rgba(100, 100, 100, 0.7)")},setcolor: function (a, d) {this.options.color = a;this.options.blackshadow = d;this.balloondiv.style.backgroundColor = this.options.color;this.numdiv.setAttribute("class", this.options.blackshadow? "Leaf_label_black": "Leaf_label_white");this.numdiv.style.color = this.options.color},sethl: function (a) {this.options.highlighted = a;0 this.options.highlighted? (this.numdiv.style.backgroundColor = "rgba(255, 255, 255, 0.9)", this.numdiv.style.border = "1px solid", this.numdiv.style.borderRadius = "25%", this.numdiv.style.borderColor = "black", this.numdiv.style.padding = "2px"): (this.numdiv.style.backgroundColor = "transparent", this.numdiv.style.border = "0px", this.numdiv.style.padding = "0px")},setrallystate: function (a) {1 == a? (this.balloondiv.style.backgroundColor = "green", this.balloondiv.style.border = "1px solid black"): 2 == a? (this.balloondiv.style.backgroundColor = "red", this.balloondiv.style.border = "1px solid black"): 3 == a? (this.balloondiv.style.backgroundColor = "yellow", this.balloondiv.style.border = "3px solid green"): 4 == a? (this.balloondiv.style.backgroundColor = "yellow", this.balloondiv.style.border = "3px solid red"): 5 == a? (this.balloondiv.style.backgroundColor = "white", this.balloondiv.style.border = "3px solid green"): 6 == a? (this.balloondiv.style.backgroundColor = "white", this.balloondiv.style.border = "3px solid red"): 0 == a && (this.balloondiv.style.backgroundColor = this.options.color, this.balloondiv.style.border = "1px solid black")}});function hexToRgb(a) {return(a = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))? {r: parseInt(a[1], 16),g: parseInt(a[2], 16),b: parseInt(a[3], 16)}: null}function trackpoint(a, d, g, f, b, p, e, q) {this.time = a;this.timefromstart = d;this.wgsx = g;this.wgsy = f;this.mapx = b;this.mapy = p;this.speed = e;this.distance = 0;this.battery = q;this.coursedistance = -1}trackpoint.prototype.setdistance = function (a, d) {var g = Math.pow(Math.pow(this.mapx - a.mapx, 2) + Math.pow(this.mapy - a.mapy, 2), .5) / d.overallscale;this.distance = 1 * a.distance + g;0 > a.timefromstart && (this.distance = 0 > this.timefromstart? 0: g * this.timefromstart / (this.time - a.time));0 > this.speed && (this.speed = g / (this.time - a.time) * 3.6)};function competitor() {this.letters = this.name = this.id = "undef";this.additionaldata = "";this.trackpoints = [];this.pointcount = 0;this.color = "red";this.starttime = 0;this.starttimestring = "00:00:00";this.timedifference = 0;this.checked = !0;this.showbeforestart = 0;this.isbuoy = !1;this.isconnectedtoid = "";this.isconnectedto = null;this.index = 0;this.fullroute = this.highlighted = this.autocenter = !1;this.battery = -100;this.offset = 0;this.mapyalltodraw = this.mapxalltodraw = this.mapytodraw = this.mapxtodraw = -1E4;this.wgsytodraw = this.wgsxtodraw = 0;this.currentspeed = -1;this.currentdistance = 0;this.dataage = -1;this.status = "N/A";this.lowestadded = 0;this.isovertime = !1;this.multipointlist = this.marker = this.path = this.layer = null;this.oneclicktempsplit = -999999;this.isonmap = !0;this.split1 = -999999;this.splitInstance2 = this.splitInstance2b = this.splitInstance2a = this.splitInstance = null;this.maxtimemins = -1;this.rallymode = !1;this.rallystate = 0;this.sectormode = !1;this.popuptext = "";this.sectorfactor = 0;this.sectorcolor = "green";this.rogc = null;this.rogpoints = 0;this.retired = this.finished = !1;this.finishtime = -1;this.finishtimeupperlimit = 999999999;this.highestwcd = 0;this.nocourse = !1}competitor.prototype.set_from_inistring = function (a, d, g, f, b, p, e, q, h, r, m) {this.color = g;this.timedifference = d;this.index = p;a = a.split("|");this.maxtimemins = m;this.id = a[0];m = "000000";switch (a[2].length) {case 3: m = "0" + a[2] + "00";break;case 4: m = a[2] + "00";break;case 5: m = "0" + a[2];break;case 6: m = a[2]}var t = a[1];-1 != b && (t =( b + "").substring(0, 8), m =( b + "").substring(8, 12));b = t.substring(0, 4);g = t.substring(4, 6) - 1;t = t.substring(6, 8);var w = m.substring(0, 2),v = m.substring(2, 4),x = m.substring(4, 6);d = Date.UTC(b, g, t, w, v, x) - 1E3 * d;this.starttimestring = m.substring(0, 2) + ":" + m.substring(2, 4) + ":" + m.substring(4, 6);this.starttime = d / 1E3 - 1136073600;this.name = a[3];this.letters = a[4];for (ii = 5; ii a.length; ii ++) "A=" == a[ii].substring(0, 2) && (this.additionaldata = a[ii].substring(2)),"C=" == a[ii].substring(0, 2) && (this.color = "rgb(" + a[ii].substring(2, 5) + "," + a[ii].substring(5, 8) + "," + a[ii].substring(8, 11) + ")"),"H=" == a[ii].substring(0, 2) && (this.nocourse =! 0);"XXPOIJUXX" == this.name && (this.isbuoy =! 0, this.name = this.letters, 7a.length && (this.isconnectedtoid = a[7], console.log(this.id + " connected to " + this.isconnectedtoid)));this.showbeforestart = f;this.path = L.polyline([[0, 0]], {contextmenu: !0,color: this.isbuoy? "rgba(100, 100, 100, 0.7)": this.color,weight: h,opacity: r,lineJoin: "round",pointerEvents: "none"});f = 0;(h = hexToRgb(this.color)) && (f = Math.round((299 * parseInt(h.r) + 587 * parseInt(h.g) + 114 * parseInt(h.b)) / 1E3));this.marker = new L.Marker(L.latLng(1E6, 1E6), {contextmenu: !0,pointerEvents: "none",fullname: this.name,zIndexOffset: p * (this.isbuoy? 1: 1E3),icon: new L.NumberedDivIcon({color: this.color,blackshadow: 100f,number: this.letters,size: e,lsize: q,isbuoy: this.isbuoy})})};competitor.prototype.getOffsetString = function () {var a = Math.round(this.offset);0 > a && (a *= -1);var d = Math.floor(a % 60);return(0 > this.offset? "-": "+") + Math.floor(a / 60) + (10 > d? ":0": ":") + d};competitor.prototype.adddata = function (a, d) {var g = a.split(".");if (!(2 > g.length || -1g[1].indexOf("*"))) {var f = g[1].split("_"),b = f[1] / 5E4,p = f[2] / 1E5,e = f[0] / 1,q = -100,h = -100,r = -100,m = 0,t = -100,w = 0;if (3f.length) for (i1 = 3; i1 f.length; i1 ++) "B" == f[i1].substring(0, 1)? (w = i1, q = t = f[i1].substring(1)): "S" == f[i1].substring(0, 1) && (m = i1, r = f[i1].substring(1), h = r / 10);f = d.getmapx(b, p);var v = d.getmapy(b, p);q = new trackpoint(e, e - this.starttime, b, p, f, v, h, q);this.addtrackpoint(q);for (k = 2; k g.length; k ++) {q = h = -100;if (3 > g[k].length) break;f = g[k].split("_");3 > f.length? (e = e + "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(g[k].substring(0, 1)) - 31, b =( 5E4 * b + "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(g[k].substring(1, 2)) - 31) / 5E4, p =( 1E5 * p + "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(g[k].substring(2, 3)) - 31) / 1E5, -1r && g[k].length > m && "*" != g[k].substring(m, m + 1) && (r = 1 * r + 1 * "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(g[k].substring(m, m + 1)) - 31, h = r / 10), -1t && g[k].length > m && "*" != g[k].substring(w, w + 1) && (q = t = 1 * t + 1 * "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".indexOf(g[k].substring(w, w + 1)) - 31)): (e += f[0] / 1, b += f[1] / 5E4, p += f[2] / 1E5, -1r && f.length > m && "*" != f[m] && (r = 1 * r + 1 * f[m], h = r / 10), -1t && f.length > w && "*" != f[w] && (q = t = 1 * t + 1 * f[w]));f = d.getmapx(b, p);v = d.getmapy(b, p);q = new trackpoint(e, e - this.starttime, b, p, f, v, h, q);this.addtrackpoint(q)}}};competitor.prototype.setchecked = function (a, d, g) {g && (a && !this.checked && (this.marker.addTo(d), this.rallymode && this.marker.options.icon.setrallystate(this.rallystate), this.path.addTo(d), this.isonmap =! 0), ! a && this.checked && (d.removeLayer(this.path), d.removeLayer(this.marker), this.isonmap =! 1));this.checked = a};competitor.prototype.setuprog = function (a) {this.rogc = [];for (i = 0; i a; i ++) this.rogc[i] = -1};competitor.prototype.changeiconsize = function (a, d) {null != this.marker && this.marker.options.icon.setsizes(a, d)};competitor.prototype.changeiconhl = function () {console.log("click " + this.id);null != this.marker && (this.marker.options.icon.sethl(this.highlighted? 1: 0), this.marker.setZIndexOffset(1E3 * this.index + (this.highlighted? 1E6: 0)))};competitor.prototype.setrallymode = function (a) {this.rallymode = a;this.rallystate = 0;a? (this.marker.setOpacity(1), this.marker.options.icon.setopacity(1)): this.marker.options.icon.setrallystate(0)};competitor.prototype.temphighlight = function () {console.log("click");null != this.marker && this.marker.options.icon.sethl(!0);setTimeout(this.removetemphighlight, 2E3)};competitor.prototype.removetemphighlight = function () {null == this.marker || this.highlighted || this.marker.options.icon.sethl(!1)};competitor.prototype.changeiconcolor = function () {var a = 0,d = hexToRgb(this.color);d && (a = Math.round((299 * parseInt(d.r) + 587 * parseInt(d.g) + 114 * parseInt(d.b)) / 1E3));null != this.marker && this.marker.options.icon.setcolor(this.color, 100a);this.rallystate = 0};competitor.prototype.changelinestyle = function (a, d) {this.path.setStyle({weight: a,opacity: d,color: this.sectorcolormode && this.sectormode? this.sectorcolor: this.color})};competitor.prototype.get1sttime = function () {return this.starttime - this.showbeforestart};competitor.prototype.getlasttime = function () {return 1 > this.pointcount? -1: this.trackpoints[this.pointcount - 1].time};competitor.prototype.printdata = function (a) {var d = "id:" + this.id + "|name:" + this.name + "|start:" + this.starttimestring + "\n";for (i = 0; i this.trackpoints.length; i ++) d += this.trackpoints[i].time + " " + this.trackpoints[i].mapx + " " + this.trackpoints[i].mapy + "\n";a.innerHTML = d};competitor.prototype.addtrackpoint = function (a) {var d = this.pointcount - 1;if (!(a.time this.starttime - this.showbeforestart || 0 this.maxtimemins && a.time - this.starttime > this.maxtimemins)) {for (; -1d && this.trackpoints[d].time > a.time;) d--;if (!(-1d && (this.trackpoints[d].time > a.time - 1.1 || d this.pointcount - 1 && this.trackpoints[d + 1].time a.time + 1.1))) {this.pointcount ++;for (j = this.pointcount - 1; j > d + 1; j --) this.trackpoints[j] = this.trackpoints[j - 1];this.trackpoints[d + 1] = a;d + 1 this.lowestadded && (this.lowestadded = d + 1)}for (d = this.trackpoints.length - 1; -1d; d--) if (-1 this.trackpoints[d].battery) {this.battery = this.trackpoints[d].battery;break}}};competitor.prototype.testlog = function () {console.log(this.pointcount + " " + this.trackpoints.length);for (i = this.trackpoints.length - 1; i > this.trackpoints.length - 15; i --) console.log(this.trackpoints[i].time)};competitor.prototype.drawbattery = function (a, d, g, f, b) {b = this.battery + "%";0 > this.battery && (b = "?");a.fillStyle = "rgb(150,29,28)";if (0 this.battery) {var p = this.battery / 100 * 180;console.log(batterwi);a.fillRect(d + 50 - 1, g - f - 1, p, f + 2)}a.font = f + "px Verdana";a.strokeText(this.id, d + 0, g);a.strokeText(b, d + 50, g);a.strokeText(this.name, d + 250, g)};competitor.prototype.setsectormode = function (a, d) {(this.sectormode = a)? (this.path.on("mouseover", function (a) {a.target.setStyle({weight: a.target.options.weight + 10})}), this.path.on("mouseout", function (a) {a.target.setStyle({weight: a.target.options.weight - 10})}), this.path.on("click", function (a) {L.popup().setLatLng(a.latlng).setContent('<span style="color:' + a.target.options.color + ';">' + this.popuptext + "<span>").openOn(d)}, this)): (this.path.off("mouseover"), this.path.off("mouseout"), this.path.off("click"))};competitor.prototype.drawtrackL = function (a, d, g, f, b, p, e, q, h) {if (!(1 > this.pointcount)) {var r = 0;a.getZoom();this.fullroute && (f = this.starttime - this.showbeforestart);f this.starttime - this.showbeforestart && (f = this.starttime - this.showbeforestart);this.status = e? "LIVE": "OK";if (g this.starttime - this.showbeforestart) {for (d = 0; d this.pointcount && this.trackpoints[d].time this.starttime - this.showbeforestart;) d++;this.mapxalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !0, d + 1, !1);this.mapyalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !1, d + 1, !1);this.isovertime = !0;this.status = "PRE";this.currentspeed = -1;this.currentdistance = 0} else {var m = !1;g > this.trackpoints[this.pointcount - 1].time? (m = this.isovertime =! 0, this.status = "POST", this.dataage = g - this.trackpoints[this.pointcount - 1].time, this.currentspeed = this.trackpoints[this.pointcount - 1].speed, this.currentdistance = this.trackpoints[this.pointcount - 1].distance): this.isovertime = !1;for (var t = this.pointcount - 1; 0t && this.trackpoints[t - 1].time > g;) t--;this.mapxalltodraw = this.getmapxy(g, !0, t, !1);this.mapyalltodraw = this.getmapxy(g, !1, t, !1);a = this.mapxalltodraw;e = this.mapyalltodraw;this.currentspeed = this.getspeed(g, t - 1);this.currentdistance = this.getdistance(g, t - 1);this.mapxtodraw = a;this.mapytodraw = e;0t && ! m && (this.isovertime = g = this.trackpoints[t].time - this.trackpoints[t - 1].time > b) && (this.status = "BREAK");if (this.checked) {g = [];g.push(L.latLng(q - e, a));for (j = t - 1; -1 j && (t =! 1, this.trackpoints[j].time f? (a = this.getmapxy(f, !0, j + 1, !1), e = this.getmapxy(f, !1, j + 1, !1), t =! 0): (a = this.trackpoints[j].mapx, e = this.trackpoints[j].mapy),this.trackpoints[j + 1].time - this.trackpoints[j].time > b? (d.push(new L.polyline(g, {color: this.color,weight: p,lineJoin: "round",opacity: h,noClip: !1})), g =[], g.push(L.latLng(q - e, a)), r = 1): (g.push(L.latLng(q - e, a)), r ++),! t); j --) 0r && d.push(new L.polyline(g, {color: this.color,weight: p,lineJoin: "round",opacity: h,noClip: !1}))}}}};competitor.prototype.drawtrackL2 = function (a, d, g, f, b, p, e, q, h, r, m, t) {this.multipointlist = null;if (r) this.drawtrackL2wgs(a, d, g, f, b, p, e, q, h, m, t); else if (d += this.offset, g += this.offset, p && (d += this.starttime, g += this.starttime), !(1 > this.pointcount)) {a = [];p = 0;this.fullroute && (g = this.starttime - this.showbeforestart);g this.starttime - this.showbeforestart && (g = this.starttime - this.showbeforestart);this.status = b? "LIVE": "OK";if (d this.starttime - this.showbeforestart || d this.trackpoints[0].time) {for (b = 0; b this.pointcount && this.trackpoints[b].time this.starttime - this.showbeforestart;) b++;this.mapxalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !0, b + 1, !1);this.mapyalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !1, b + 1, !1);this.isovertime = !0;this.status = "PRE";this.currentspeed = -1;this.currentdistance = 0;this.path.setLatLngs(a);this.rallymode && (4 != this.rallystate && this.marker.options.icon.setrallystate(4), this.rallystate = 4);if (!this.sectormode) return} else {a = !1;d > this.trackpoints[this.pointcount - 1].time? (a = this.isovertime =! 0, this.status = b? this.getovertimestring(d - this.trackpoints[this.pointcount - 1].time): "POST",this.dataage = d - this.trackpoints[this.pointcount - 1].time,this.currentspeed = this.trackpoints[this.pointcount - 1].speed,this.currentdistance = this.trackpoints[this.pointcount - 1].distance): this.isovertime = !1;for (var w = this.pointcount - 1; 0w && this.trackpoints[w - 1].time > d;) w--;this.mapxalltodraw = this.getmapxy(d, !0, w, !1);this.mapyalltodraw = this.getmapxy(d, !1, w, !1);var v = this.mapxalltodraw,x = this.mapyalltodraw;this.currentspeed = this.getspeed(d, w - 1);this.currentdistance = this.getdistance(d, w - 1);this.mapxtodraw = v;this.mapytodraw = x;0w && ! a && (this.isovertime = d = this.trackpoints[w].time - this.trackpoints[w - 1].time > f) && (this.status = "BREAK");this.rallymode && (b = b? this.isovertime? 100 > this.dataage? this.currentspeed > 5 / 3.6? 3: 4: this.currentspeed > 5 / 3.6? 5: 6: this.currentspeed > 5 / 3.6? 1: 2: a && 100 this.dataage? this.currentspeed > 5 / 3.6? 5: 6: this.isovertime? this.currentspeed > 5 / 3.6? 3: 4: this.currentspeed > 5 / 3.6? 1: 2,this.rallystate != b && this.marker.options.icon.setrallystate(b),this.rallystate = b)}if (this.isbuoy && null != this.isconnectedto) h = [],a = [],h.push(L.latLng(e - x, v)),f = this.isconnectedto.mapxalltodraw,m = this.isconnectedto.mapyalltodraw,-1E4 != f && (h.push(L.latLng(e - x, v)), h.push(L.latLng(e - m, f)), a.push(h), this.path.setLatLngs(a)); else if (this.checked && h) {h = [];a = [];if (this.sectormode) {if (null === this.splitInstance2a || null === this.splitInstance2b || this.splitInstance2b.time this.splitInstance2a.time) {this.path.setLatLngs(a);return}g = this.splitInstance2a.time;d = this.splitInstance2b.time;for (w = this.pointcount - 1; 0 w && this.trackpoints[w - 1].time > d;) w --;v = this.getmapxy(d, !0, w, !1);x = this.getmapxy(d, !1, w, !1)}h.push(L.latLng(e - x, v));for (j = w - 1; -1 j && (w =! 1, this.trackpoints[j].time g? (v = this.getmapxy(g, !0, j + 1, !1), x = this.getmapxy(g, !1, j + 1, !1), w =! 0): (v = this.trackpoints[j].mapx, x = this.trackpoints[j].mapy),this.trackpoints[j + 1].time - this.trackpoints[j].time > f? (a.push(h), h =[], h.push(L.latLng(e - x, v)), p = 1): (h.push(L.latLng(e - x, v)), p ++),!w); j --) 0p && a.push(h);t && g > this.starttime - this.showbeforestart && 0a.length && 1a[a.length - 1].length && (vikalista = a[a.length - 1], vex1 = vikalista[vikalista.length - 2].lng, vey1 = vikalista[vikalista.length - 2].lat, vx1 = vikalista[vikalista.length - 1].lng, vy1 = vikalista[vikalista.length - 1].lat, wi = 4 * this.path.options.weight, d1 = vx1 - vex1, d2 = vy1 - vey1, pituus = Math.pow(Math.pow(d1, 2) + Math.pow(d2, 2), .5), 0 pituus? (h =[], h.push(L.latLng(1 * vy1 + wi / 2 * d1 / (1 * pituus), vx1 - wi / 2 * d2 / (1 * pituus))), h.push(L.latLng(1 * vy1 - wi / 2 * d1 / (1 * pituus), vx1 + wi / 2 * d2 / (1 * pituus))), a.push(h)): 2 vikalista.length && (vex1 = vikalista[vikalista.length - 3].lng, vey1 = vikalista[vikalista.length - 3].lat, d1 = vx1 - vex1, d2 = vy1 - vey1, pituus = Math.pow(Math.pow(d1, 2) + Math.pow(d2, 2), .5), 0 pituus && (h =[], h.push(L.latLng(1 * vy1 + wi / 2 * d1 / (1 * pituus), vx1 - wi / 2 * d2 / (1 * pituus))), h.push(L.latLng(1 * vy1 - wi / 2 * d1 / (1 * pituus), vx1 + wi / 2 * d2 / (1 * pituus))), a.push(h))));this.path.setLatLngs(a);m && (this.multipointlist = a)}}};competitor.prototype.drawtrackL2wgs = function (a, d, g, f, b, p, e, q, h, r, m) {d += this.offset;g += this.offset;p && (d += this.starttime, g += this.starttime);if (!(1 > this.pointcount)) {e = [];p = 0;this.fullroute && (g = this.starttime - this.showbeforestart);g this.starttime - this.showbeforestart && (g = this.starttime - this.showbeforestart);this.status = b? "LIVE": "OK";if (d this.starttime - this.showbeforestart || d this.trackpoints[0].time) {for (b = 0; b this.pointcount && this.trackpoints[b].time this.starttime - this.showbeforestart;) b++;this.mapxalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !0, b + 1, !0);this.mapyalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !1, b + 1, !0);this.isovertime = !0;this.status = "PRE";this.currentspeed = -1;this.currentdistance = 0;this.path.setLatLngs(e);this.rallymode && (4 != this.rallystate && this.marker.options.icon.setrallystate(4), this.rallystate = 4);if (!this.sectormode) return} else {e = !1;d > this.trackpoints[this.pointcount - 1].time? (e = this.isovertime =! 0, this.status = b? this.getovertimestring(d - this.trackpoints[this.pointcount - 1].time): "POST",this.dataage = d - this.trackpoints[this.pointcount - 1].time,this.currentspeed = this.trackpoints[this.pointcount - 1].speed,this.currentdistance = this.trackpoints[this.pointcount - 1].distance): this.isovertime = !1;for (var t = this.pointcount - 1; 0t && this.trackpoints[t - 1].time > d;) t--;this.mapxalltodraw = this.getmapxy(d, !0, t, !0);this.mapyalltodraw = this.getmapxy(d, !1, t, !0);var w = this.mapxalltodraw,v = this.mapyalltodraw;this.currentspeed = this.getspeed(d, t - 1);this.currentdistance = this.getdistance(d, t - 1);this.mapxtodraw = w;this.mapytodraw = v;0t && ! e && (this.isovertime = d = this.trackpoints[t].time - this.trackpoints[t - 1].time > f) && (this.status = "BREAK");this.rallymode && (b = b? this.isovertime? 100 > this.dataage? this.currentspeed > 5 / 3.6? 3: 4: this.currentspeed > 5 / 3.6? 5: 6: this.currentspeed > 5 / 3.6? 1: 2: e && 100 this.dataage? this.currentspeed > 5 / 3.6? 5: 6: this.isovertime? this.currentspeed > 5 / 3.6? 3: 4: this.currentspeed > 5 / 3.6? 1: 2,this.rallystate != b && this.marker.options.icon.setrallystate(b),this.rallystate = b)}if ((this.checked || !this.isbuoy) && h) {h = [];e = [];if (this.sectormode) {if (null === this.splitInstance2a || null === this.splitInstance2b || this.splitInstance2b.time this.splitInstance2a.time) {this.path.setLatLngs(e);return}g = this.splitInstance2a.time;d = this.splitInstance2b.time;for (t = this.pointcount - 1; 0 t && this.trackpoints[t - 1].time > d;) t --;w = this.getmapxy(d, !0, t, !0);v = this.getmapxy(d, !1, t, !0)}h.push(L.latLng(v, w));for (j = t - 1; -1 j && (t =! 1, this.trackpoints[j].time g? (w = this.getmapxy(g, !0, j + 1, !0), v = this.getmapxy(g, !1, j + 1, !0), t =! 0): (w = this.trackpoints[j].wgsx, v = this.trackpoints[j].wgsy),this.trackpoints[j + 1].time - this.trackpoints[j].time > f? (e.push(h), h =[], h.push(L.latLng(v, w)), p = 1): (h.push(L.latLng(v, w)), p ++),!t); j --) 0p && e.push(h);m && g > this.starttime - this.showbeforestart && 0e.length && 1e[e.length - 1].length && (vikalista = e[e.length - 1], vex1 = a.project(vikalista[vikalista.length - 2]).x, vey1 = a.project(vikalista[vikalista.length - 2]).y, vx1 = a.project(vikalista[vikalista.length - 1]).x, vy1 = a.project(vikalista[vikalista.length - 1]).y, wi = 4 * this.path.options.weight, d1 = vx1 - vex1, d2 = vy1 - vey1, pituus = Math.pow(Math.pow(d1, 2) + Math.pow(d2, 2), .5), 0 pituus? (h =[], h.push(a.unproject([vx1 - wi / 2 * d2 / (1 * pituus),1 * vy1 + wi / 2 * d1 / (1 * pituus)])), h.push(a.unproject([vx1 + wi / 2 * d2 / (1 * pituus),1 * vy1 - wi / 2 * d1 / (1 * pituus)])), e.push(h)): 2 vikalista.length && (vex1 = a.project(vikalista[vikalista.length - 3]).x, vey1 = a.project(vikalista[vikalista.length - 3]).y, d1 = vx1 - vex1, d2 = vy1 - vey1, pituus = Math.pow(Math.pow(d1, 2) + Math.pow(d2, 2), .5), 0 pituus && (h =[], h.push(a.unproject([vx1 - wi / 2 * d2 / (1 * pituus),1 * vy1 + wi / 2 * d1 / (1 * pituus)])), h.push(a.unproject([vx1 + wi / 2 * d2 / (1 * pituus),1 * vy1 - wi / 2 * d1 / (1 * pituus)])), e.push(h))));this.path.setLatLngs(e);r && (this.multipointlist = e)}}};competitor.prototype.drawtrackNEW = function (a, d, g, f, b, p) {var e = 0;if (!(1 > this.pointcount)) if (this.fullroute && (f = this.starttime - this.showbeforestart), f this.starttime - this.showbeforestart && (f = this.starttime - this.showbeforestart), this.status = p? "LIVE": "OK",g this.starttime - this.showbeforestart) {for (a = 0; a this.pointcount && this.trackpoints[a].time this.starttime - this.showbeforestart;) a++;a = this.getmapxyNEW(this.starttime - this.showbeforestart, a + 1);this.mapxalltodraw = a.x;this.mapyalltodraw = a.y;d = d.maptoscreen(this.mapxalltodraw, this.mapyalltodraw);this.mapxtodraw = d.x;this.mapytodraw = d.y;this.isovertime = !0;this.status = "PRE";this.currentspeed = -1;this.currentdistance = 0} else {a.strokeStyle = this.color;var q = !1;g > this.trackpoints[this.pointcount - 1].time? (q = this.isovertime =! 0, this.status = "POST", this.dataage = g - this.trackpoints[this.pointcount - 1].time, this.status = this.status + " (" + Math.round(this.dataage, 0) + ")", this.currentspeed = this.trackpoints[this.pointcount - 1].speed, this.currentdistance = this.trackpoints[this.pointcount - 1].distance): this.isovertime = !1;for (p = this.pointcount - 1; 0p && this.trackpoints[p - 1].time > g;) p--;var h = this.getmapxyNEW(g, p);this.mapxalltodraw = h.x;this.mapyalltodraw = h.y;var r = d.maptoscreen(this.mapxalltodraw, this.mapyalltodraw);h = r.x;r = r.y;this.currentspeed = this.getspeed(g, p - 1);this.currentdistance = this.getdistance(g, p - 1);this.mapxtodraw = h;this.mapytodraw = r;0p && ! q && (this.isovertime = g = this.trackpoints[p].time - this.trackpoints[p - 1].time > b) && (this.status = "BREAK");if (this.checked) {a.beginPath();a.moveTo(h, r);for (j = p - 1; -1 j && (g =! 1, this.trackpoints[j].time f? (h = this.getmapxyNEW(f, j + 1), r = d.maptoscreen(h.x, h.y), h = r.x, r = r.y, g =! 0): (r = d.maptoscreen(this.trackpoints[j].mapx, this.trackpoints[j].mapy), h = r.x, r = r.y),this.trackpoints[j + 1].time - this.trackpoints[j].time > b? (a.stroke(), e = 0, a.beginPath(), a.moveTo(h, r)): (a.lineTo(h, r), e ++, 500e && (a.stroke(), e = 0, a.beginPath(), a.moveTo(h, r))),! g); j --) a.stroke()}}};competitor.prototype.drawtrack = function (a, d, g, f, b, p, e, q) {var h = 0;if (!(1 > this.pointcount)) if (this.fullroute && (p = this.starttime - this.showbeforestart), p this.starttime - this.showbeforestart && (p = this.starttime - this.showbeforestart), this.status = q? "LIVE": "OK",b this.starttime - this.showbeforestart) {for (a = 0; a this.pointcount && this.trackpoints[a].time this.starttime - this.showbeforestart;) a++;this.mapxalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !0, a + 1, !1);this.mapyalltodraw = this.getmapxy(this.starttime - this.showbeforestart, !1, a + 1, !1);this.mapxtodraw = (this.mapxalltodraw - d) * f;this.mapytodraw = (this.mapyalltodraw - g) * f;this.isovertime = !0;this.status = "PRE";this.currentspeed = -1;this.currentdistance = 0} else {a.strokeStyle = this.color;var r = !1;b > this.trackpoints[this.pointcount - 1].time? (r = this.isovertime =! 0, this.status = "POST", this.dataage = b - this.trackpoints[this.pointcount - 1].time, this.currentspeed = this.trackpoints[this.pointcount - 1].speed, this.currentdistance = this.trackpoints[this.pointcount - 1].distance): this.isovertime = !1;for (var m = this.pointcount - 1; 0m && this.trackpoints[m - 1].time > b;) m--;this.mapxalltodraw = this.getmapxy(b, !0, m, !1);this.mapyalltodraw = this.getmapxy(b, !1, m, !1);q = (this.mapxalltodraw - d) * f;var t = (this.mapyalltodraw - g) * f;this.currentspeed = this.getspeed(b, m - 1);this.currentdistance = this.getdistance(b, m - 1);this.mapxtodraw = q;this.mapytodraw = t;0m && ! r && (this.isovertime = b = this.trackpoints[m].time - this.trackpoints[m - 1].time > e) && (this.status = "BREAK");if (this.checked) {a.beginPath();a.moveTo(q, t);for (j = m - 1; -1 j && (b =! 1, this.trackpoints[j].time p? (q =( this.getmapxy(p, !0, j + 1, !1) - d) * f, t =( this.getmapxy(p, !1, j + 1, !1) - g) * f, b =! 0): (q =( this.trackpoints[j].mapx - d) * f, t =( this.trackpoints[j].mapy - g) * f),this.trackpoints[j + 1].time - this.trackpoints[j].time > e? (a.stroke(), h = 0, a.beginPath(), a.moveTo(q, t)): (a.lineTo(q, t), h ++, 500h && (a.stroke(), h = 0, a.beginPath(), a.moveTo(q, t))),! b); j --) a.stroke()}}};competitor.prototype.getspeed = function (a, d) {return 0 > d? -1: a > this.trackpoints[this.pointcount - 1].time? this.trackpoints[this.pointcount - 1].speed: this.trackpoints[d].speed + (this.trackpoints[d + 1].speed - this.trackpoints[d].speed) * (a - this.trackpoints[d].time) / (this.trackpoints[d + 1].time - this.trackpoints[d].time)};competitor.prototype.getdistance = function (a, d) {return 0 > d? 0: a > this.trackpoints[this.pointcount - 1].time? this.trackpoints[this.pointcount - 1].distance: this.trackpoints[d].distance + (this.trackpoints[d + 1].distance - this.trackpoints[d].distance) * (a - this.trackpoints[d].time) / (this.trackpoints[d + 1].time - this.trackpoints[d].time)};competitor.prototype.updatedistances = function (a, d, g, f, b) {if (!(2 > this.pointcount) && this.lowestadded != this.pointcount - 1) {1 > this.lowestadded && (this.lowestadded = 1);for (i5 = this.lowestadded; i5 this.pointcount; i5 ++) this.trackpoints[i5].setdistance(this.trackpoints[i5 - 1], a);if (null != b && !this.nocourse) {if (this.lowestadded this.highestwcd) {for (; 0 edwithc && 0 > this.trackpoints[edwithc].coursedistance;) edwithc --;this.highestwcd = edwithc}var p = 0,e = 0,q = 0;-1 this.highestwcd && (p = this.trackpoints[this.highestwcd].coursedistance, e = this.trackpoints[this.highestwcd].timefromstart, q = this.trackpoints[this.highestwcd].speed);for (i5 = this.lowestadded; i5 this.pointcount; i5 ++) 0 this.trackpoints[i5].timefromstart && this.trackpoints[i5].timefromstart this.finishtimeupperlimit && (p = b.getsimplecoursedistance(this.trackpoints[i5].mapx, this.trackpoints[i5].mapy, p, this.highestwcd, this.trackpoints[i5].timefromstart, e, this.trackpoints[i5].distance, q, this.id), this.trackpoints[i5].coursedistance = p.d, p.f && (this.finished =! 0, this.finishtime = p.ft, this.finishtimeupperlimit = this.trackpoints[i5].timefromstart), this.highestwcd = i5, p = this.trackpoints[this.highestwcd].coursedistance, e = this.trackpoints[this.highestwcd].timefromstart, q = this.trackpoints[this.highestwcd].speed)}if (null != this.rogc) for (i10 = this.rogpoints = 0; i10 this.rogc.length; i10 ++) 0 > this.rogc[i10] && (this.rogc[i10] = this.calcrog(d[i10].x, d[i10].y, g * a.overallscale, f)),0 this.rogc[i10] && (this.rogpoints += 1 * d[i10].points);this.lowestadded = this.pointcount - 1}};competitor.prototype.drawballoon = function (a, d) {-1E4 != this.mapxtodraw && (a.globalAlpha = this.isovertime? .5: 1,a.beginPath(),a.arc(this.mapxtodraw, this.mapytodraw, d / 2, 0, 2 * Math.PI, !0),a.closePath(),a.strokeStyle = this.isovertime? "gray": "black",a.lineWidth = 2,a.fillStyle = this.color,a.fill(),a.stroke())};competitor.prototype.drawballoonL = function (a, d, g, f, b, p) {-1E4 != this.mapxalltodraw && d.push(marker2)};competitor.prototype.drawballoonL2 = function (a, d) {if (-1E4 != this.mapxalltodraw) {var g = 1;!this.isovertime || this.isbuoy || this.rallymode || (g = .6);this.rallymode || this.marker.setOpacity(g);this.marker.setLatLng(L.latLng(d? this.mapyalltodraw: a - this.mapyalltodraw,this.mapxalltodraw));this.rallymode || this.marker.options.icon.setopacity(g)}};competitor.prototype.drawletters = function (a, d, g, f) {-1E4 != this.mapxtodraw && (a.strokeStyle = "black", a.lineWidth = 1, f && (f = a.measureText(this.letters).width, a.fillStyle = "white", a.globalAlpha = .5, fillRoundedRect(a, this.mapxtodraw + g - 3, this.mapytodraw + g - 2, f + 6, d + 5, 4), a.globalAlpha = 1, strokeRoundedRect(a, this.mapxtodraw + g - 3, this.mapytodraw + g - 2, f + 6, d + 5, 4)), a.fillStyle = this.color, a.fillText(this.letters, this.mapxtodraw + g, this.mapytodraw + g + d), a.strokeText(this.letters, this.mapxtodraw + g, this.mapytodraw + g + d))};competitor.prototype.getcoordstodraw = function (a, d, g) {var f = [];if (1 > this.pointcount) return f;if (a <= this.trackpoints[0].time) return this.wgsxtodraw = this.trackpoints[0].wgsx,this.wgsytodraw = this.trackpoints[0].wgsy,this.isovertime = !0,f;this.isovertime = a > this.trackpoints[this.pointcount - 1].time? !0: !1;for (var b = this.pointcount - 1; 0b && this.trackpoints[b - 1].time > a;) b--;var p = this.getwgsxy(a, !0, b);a = this.getwgsxy(a, !1, b);f.push(new LatLon(a, p));this.wgsxtodraw = p;this.wgsytodraw = a;0b && (this.isovertime = this.trackpoints[b].time - this.trackpoints[b - 1].time > g);for (j = b - 1; -1 j && (g =! 1, this.trackpoints[j].time d? (p = this.getwgsxy(d, !0, j), a = this.getwgsxy(d, !1, j), g =! 0): (p = this.trackpoints[j].wgsx, a = this.trackpoints[j].wgsy),f.push(new LatLon(a, p)),! g); j --) return f};competitor.prototype.getmapcoordstodraw = function (a, d, g) {var f = [];if (1 > this.pointcount) return f;if (a <= this.trackpoints[0].time) return this.wgsxtodraw = this.trackpoints[0].wgsx,this.wgsytodraw = this.trackpoints[0].wgsy,this.isovertime = !0,f;this.isovertime = a > this.trackpoints[this.pointcount - 1].time? !0: !1;for (var b = this.pointcount - 1; 0b && this.trackpoints[b - 1].time > a;) b--;var p = this.getmapxy(a, !0, b, !1);a = this.getmapxy(a, !1, b, !1);f.push(new LatLon(a, p));this.wgsxtodraw = p;this.wgsytodraw = a;0b && (this.isovertime = this.trackpoints[b].time - this.trackpoints[b - 1].time > g);for (j = b - 1; -1 j && (g =! 1, this.trackpoints[j].time d? (p = this.getmapxy(d, !0, j), a = this.getmapxy(d, !1, j), g =! 0): (p = this.trackpoints[j].mapx, a = this.trackpoints[j].mapy),f.push(new LatLon(a, p)),! g); j --) return f};competitor.prototype.getmapxy = function (a, d, g, f) {if (f) {if (a <= this.trackpoints[0].time) return d? this.trackpoints[0].wgsx: this.trackpoints[0].wgsy;if (a > this.trackpoints[this.pointcount - 1].time || g > this.pointcount - 1) return d? this.trackpoints[this.pointcount - 1].wgsx: this.trackpoints[this.pointcount - 1].wgsy;a = d? (1 * a - this.trackpoints[g - 1].time) / (this.trackpoints[g].time - this.trackpoints[g - 1].time) * (this.trackpoints[g].wgsx - this.trackpoints[g - 1].wgsx) + this.trackpoints[g - 1].wgsx: (1 * a - this.trackpoints[g - 1].time) / (this.trackpoints[g].time - this.trackpoints[g - 1].time) * (this.trackpoints[g].wgsy - this.trackpoints[g - 1].wgsy) + this.trackpoints[g - 1].wgsy} else {if (a <= this.trackpoints[0].time) return d? this.trackpoints[0].mapx: this.trackpoints[0].mapy;if (a > this.trackpoints[this.pointcount - 1].time || g > this.pointcount - 1) return d? this.trackpoints[this.pointcount - 1].mapx: this.trackpoints[this.pointcount - 1].mapy;a = d? (1 * a - this.trackpoints[g - 1].time) / (this.trackpoints[g].time - this.trackpoints[g - 1].time) * (this.trackpoints[g].mapx - this.trackpoints[g - 1].mapx) + this.trackpoints[g - 1].mapx: (1 * a - this.trackpoints[g - 1].time) / (this.trackpoints[g].time - this.trackpoints[g - 1].time) * (this.trackpoints[g].mapy - this.trackpoints[g - 1].mapy) + this.trackpoints[g - 1].mapy}return a};competitor.prototype.getmapxyNEW = function (a, d) {return a <= this.trackpoints[0].time? {x: this.trackpoints[0].mapx,y: this.trackpoints[0].mapy}: a > this.trackpoints[this.pointcount - 1].time || d > this.pointcount - 1? {x: this.trackpoints[this.pointcount - 1].mapx,y: this.trackpoints[this.pointcount - 1].mapy}: {x: (1 * a - this.trackpoints[d - 1].time) / (this.trackpoints[d].time - this.trackpoints[d - 1].time) * (this.trackpoints[d].mapx - this.trackpoints[d - 1].mapx) + this.trackpoints[d - 1].mapx,y: (1 * a - this.trackpoints[d - 1].time) / (this.trackpoints[d].time - this.trackpoints[d - 1].time) * (this.trackpoints[d].mapy - this.trackpoints[d - 1].mapy) + this.trackpoints[d - 1].mapy}};competitor.prototype.getwgsxy = function (a, d, g) {return a <= this.trackpoints[0].time? d? this.trackpoints[0].wgsx: this.trackpoints[0].wgsy: a > this.trackpoints[this.pointcount - 1].time || g > this.pointcount - 1? d? this.trackpoints[this.pointcount - 1].wgsx: this.trackpoints[this.pointcount - 1].wgsy: paikka};competitor.prototype.getnearesttimetopoint = function (a, d) {var g = -1,f = -999999;if (1 this.pointcount) for (n = 1; n this.pointcount; n ++) {var b = this.trackpoints[n - 1].mapx;var p = this.trackpoints[n - 1].mapy,e = this.trackpoints[n].mapx - b,q = this.trackpoints[n].mapy - p,h = 0;if (0 != e || 0 != q) h = ((a - b) * e + (d - p) * q) / (e * e + q * q);1h && (h = 1);0 > h && (h = 0);b = Math.pow(a - (b + h * e), 2) + Math.pow(d - (p + h * q), 2);if (-1 == g || g > b) g = b,f = this.trackpoints[n - 1].time + h * (this.trackpoints[n].time - this.trackpoints[n - 1].time)}return f};competitor.prototype.getnearesttimetopointlimited = function (a, d, g, f, b, p, e) {var q = -1,h = -9999999;b = g? b: b + this.starttime;f = g? f: f + this.starttime;if (1 this.pointcount) {for (n = 1; n this.pointcount; n ++) if (this.trackpoints[n - 1].time b && this.trackpoints[n].time > f) {var r = this.trackpoints[n - 1].mapx;var m = this.trackpoints[n - 1].mapy,t = this.trackpoints[n].mapx - r,w = this.trackpoints[n].mapy - m,v = 0;if (0 != t || 0 != w) v = ((a - r) * t + (d - m) * w) / (t * t + w * w);1v && (v = 1);0 > v && (v = 0);r = Math.pow(a - (1 * r + v * t), 2) + Math.pow(d - (1 * m + v * w), 2);if (-1 == q || q > r) q = r,h = this.trackpoints[n - 1].time + v * (this.trackpoints[n].time - this.trackpoints[n - 1].time)}h > b && (h = b);hf && (h = f);return -1 == q || 0p && q > p * p * e * e || h this.starttime? -9999999: g? h: h - this.starttime}return -9999999};competitor.prototype.getovertimestring = function (a) {var d = Math.floor(a / 60);a = Math.floor(a - 60 * d);return d + ":" + (10 > a? "0": "") + a};competitor.prototype.setsectoratstart = function () {this.splitInstance2a = {name: this.letters,time: this.starttime,hl: !1,distance: 0}};competitor.prototype.calcrog = function (a, d, g, f) {var b = -1,p = -999999;if (1 this.pointcount) {var e = this.lowestadded - 1;1 > e && (e = 1);for (n = e; n this.pointcount; n ++) {var q = this.trackpoints[n - 1].mapx;var h = this.trackpoints[n - 1].mapy,r = this.trackpoints[n].mapx - q,m = this.trackpoints[n].mapy - h;e = 0;if (0 != r || 0 != m) e = ((a - q) * r + (d - h) * m) / (r * r + m * m);1e && (e = 1);0 > e && (e = 0);q = Math.pow(a - (q + e * r), 2) + Math.pow(d - (h + e * m), 2);(-1 == b || b > q) && this.trackpoints[n].time - this.trackpoints[n - 1].time f && (b = q, p = this.trackpoints[n - 1].time + e * (this.trackpoints[n].time - this.trackpoints[n - 1].time))}if (0 <= b && bg * g && 0p) return p}return -1};competitor.prototype.calcsplit1 = function (a, d, g, f, b, p, e, q, h, r) {switch (r) {case 0:this.splitInstance = null;break;case 1:this.splitInstance2a = null;break;case 2:this.splitInstance2b = null}if (! e || this.checked) {this.split1 = -999999;e = -1;var m = -999999,t = -9999;if (1 this.pointcount) {for (var w = 1; w this.pointcount && (this.trackpoints[w].time q || this.trackpoints[w].timefromstart h);) w++;for (n = w; n this.pointcount; n ++) {h = this.trackpoints[n - 1].mapx;w = this.trackpoints[n - 1].mapy;var v = this.trackpoints[n].mapx - h,x = this.trackpoints[n].mapy - w;q = 0;if (0 != v || 0 != x) q = ((a - h) * v + (d - w) * x) / (v * v + x * x);1q && (q = 1);0 > q && (q = 0);h = Math.pow(a - (h + q * v), 2) + Math.pow(d - (w + q * x), 2);if (-1 == e || e > h) e = h,m = this.trackpoints[n - 1].time + q * (this.trackpoints[n].time - this.trackpoints[n - 1].time),t = n - 1}0 <= e && eg * f * g * f && 0m && (this.split1 = m)}if (-999998 this.split1) switch (r) {case 0:this.splitInstance = {name: p? this.letters: this.name,time: b? this.split1 - this.starttime: this.split1 + this.timedifference,hl: this.highlighted};break;case 1:this.splitInstance2a = {name: p? this.letters: this.name,time: this.split1,hl: this.highlighted,distance: this.getdistance(this.split1, t)};break;case 2:this.splitInstance2b = {name: p? this.letters: this.name,time: this.split1,hl: this.highlighted,distance: this.getdistance(this.split1, t)}}}};competitor.prototype.calcsplit1line = function (a, d, g, f, b, p, e, q, h, r, m, t) {switch (t) {case 0:this.splitInstance = null;break;case 1:this.splitInstance2a = null;break;case 2:this.splitInstance2b = null}if (!(q && !this.checked || 2 > this.pointcount)) {q = [];this.split1 = -999999;var w = this.pointcount,v = [];if (b) {for (b = 0; b this.pointcount && (this.trackpoints[b].time h || this.trackpoints[b].timefromstart r);) b++;for (i = b; i w - 1; i ++) doLineSegmentsIntersect(this.trackpoints[i].wgsx, this.trackpoints[i].wgsy, this.trackpoints[i + 1].wgsx, this.trackpoints[i + 1].wgsy, a, d, g, f) && (h = this.trackpoints[i].time, r = this.trackpoints[i + 1].time, r -= h, b = this.intersectPoint(this.trackpoints[i].wgsx, this.trackpoints[i].wgsy, this.trackpoints[i + 1].wgsx, this.trackpoints[i + 1].wgsy, a, d, g, f), h = b * r + h, q[q.length] = h, v[v.length] = i)} else {for (b = 0; b this.pointcount && (this.trackpoints[b].time h || this.trackpoints[b].timefromstart r);) b++;for (i = b; i w - 1; i ++) doLineSegmentsIntersect(this.trackpoints[i].mapx, this.trackpoints[i].mapy, this.trackpoints[i + 1].mapx, this.trackpoints[i + 1].mapy, a, d, g, f) && (h = this.trackpoints[i].time, r = this.trackpoints[i + 1].time, r -= h, b = this.intersectPoint(this.trackpoints[i].mapx, this.trackpoints[i].mapy, this.trackpoints[i + 1].mapx, this.trackpoints[i + 1].mapy, a, d, g, f), h = b * r + h, q[q.length] = h, v[v.length] = i)}if (q.length > m) switch (t) {case 0:this.splitInstance = {name: e? this.letters: this.name,time: p? q[m] - this.starttime: q[m] + this.timedifference,hl: this.highlighted};break;case 1:this.splitInstance2a = {name: e? this.letters: this.name,time: q[m],hl: this.highlighted,distance: this.getdistance(q[m], v[m])};break;case 2:this.splitInstance2b = {name: e? this.letters: this.name,time: q[m],hl: this.highlighted,distance: this.getdistance(q[m], v[m])}}}};competitor.prototype.calcsectortime = function (a) {this.splitInstance2 = null;null == this.splitInstance2a || null == this.splitInstance2b || this.splitInstance2a.time > this.splitInstance2b.time || (this.splitInstance2 ={name: a? this.letters: this.name,time: this.splitInstance2b.time - this.splitInstance2a.time,hl: this.highlighted,distance: Math.round(this.splitInstance2b.distance - this.splitInstance2a.distance),index: this.index})};competitor.prototype.getsplit1 = function () {return -999990 > this.split1? this.letters + " N/A": this.letters + " " + this.getovertimestring(this.split1)};competitor.prototype.getcompare2time = function (a, d) {var g = d? a: a + this.starttime;return 0 == this.pointcount || g this.starttime? -9999999: g > this.trackpoints[this.pointcount - 1].time? this.trackpoints[this.pointcount - 1].time -(d? 0: this.starttime): g - (d? 0: this.starttime)};competitor.prototype.intersectPoint = function (a, d, g, f, b, p, e, q) {var h = q - p,r = (g - a) * h - (f - d) * (e - b);return 0 != r? (r =(( d - p) * (e - b) - (a - b) * h) / r, 0 > r? (console.log("R=" + r), 0): 1r? (console.log("R=" + r + " (" + a + "," + d + ")(" + g + "," + f + ")(" + b + "," + p + ")(" + e + "," + q + ")"), 1): r): 0};function doLineSegmentsIntersect(a, d, g, f, b, p, e, q) {if (be) {if (ab && gb || a > e && g > e) return !1} else if (ae && ge || a > b && g > b) return !1;if (pq) {if (dp && fp || d > q && f > q) return !1} else if (dq && fq || d > p && f > p) return !1;var h = {},r = {},m = {},t = {};h.x = a;h.y = d;r.x = g;r.y = f;m.x = b;m.y = p;t.x = e;t.y = q;g = subtractPoints(r, h);a = subtractPoints(t, m);d = crossProduct(subtractPoints(m, h), g);g = crossProduct(g, a);if (0 == d && 0 == g) return equalPoints(h, m) || equalPoints(h, t) || equalPoints(r, m) || equalPoints(r, t)? !0: 0 > m.x - h.x != 0 > m.x - r.x != 0 > t.x - h.x != 0 > t.x - r.x || 0 > m.y - h.y != 0 > m.y - r.y != 0 > t.y - h.y != 0 > t.y - r.y;if (0 == g) return !1;r = d / g;h = crossProduct(subtractPoints(m, h), a) / g;return 0 <= h && 1 >= h && 0 <= r && 1 >= r}function crossProduct(a, d) {return a.x * d.y - a.y * d.x}function subtractPoints(a, d) {var g = {};g.x = a.x - d.x;g.y = a.y - d.y;return g}function equalPoints(a, d) {return a.x == d.x && a.y == d.y};function Event(a, d, g) {this.eventpath = a;this.iFactor = d;this.initloaded = !1;this.replaymode = !0;this.tfsmode = !1;this.racename = "";this.timedifference = 10800;this.livegrabinterval = 15;this.livebuffer = 30;this.dashlimit = 45;this.markersize = 10;this.lettersize = 16;this.linewidth = 5;this.lineopacity = .8;this.taillength = 60;this.showbeforestart = 0;this.maxtimemins = -1;this.isliveevent = !1;this.lkm = 0;this.tracks = [];this.buoys = [];this.splitlines = [];this.nextsplitid = 1;this.splitdefaultrt = "";this.calibration = this.setdefaulttail = this.enablerog = this.updateroglist = this.data_added = this.createnamelist = null;this.replaymintime = 999999999999;this.timetodraw = this.replaymaxtimeTFS = this.replaymintimeTFS = this.replaymaxtime = 0;this.resetvalue = -1;this.bytesrecieved = 0;this.lastline = "undef";this.last10drawtime = this.draws = 0;this.autocentered = -1;this.mapsystem = this.numberoflogos = 0;this.forcedMapSystem = g;this.overlay = this.cpoint = null;this.showlines = !0;this.liveCenterLogin = !1;this.lcLogoutText = "WOC2017";this.difference = -9999999;this.sectorcolormode = this.sectormode = !1;this.sectorhl = -1;this.sectorhlpath = L.polyline([[0, 0]], {contextmenu: !0,color: "black",weight: 10,opacity: 1,lineJoin: "round",pointerEvents: "none"});this.sectorhlpath2 = L.polyline([[0, 0]], {contextmenu: !0,color: "yellow",weight: 6,opacity: 1,lineJoin: "round",pointerEvents: "none"});this.sectororder = null;this.sectorhlpopuptext = "";this.sectorhlpath2.bindPopup(this.sectorhlpopuptext);this.isrogaining = !1;this.rogctrls = null;this.rogradius = 50;this.nomorelive = !1;this.centeredonce = !0;this.drawTailEnd = !1;this.course = null;this.colors = [];this.colors[0] = "rgb(0,0,255)";this.colors[1] = "rgb(255,0,0)";this.colors[2] = "rgb(0,128,0)";this.colors[3] = "rgb(128,0,0)";this.colors[4] = "rgb(0,0,128)";this.colors[5] = "rgb(255,0,128)";this.colors[6] = "rgb(255,128,0)";this.colors[7] = "rgb(0,128,255)";this.colors[8] = "rgb(128,0,255)";this.colors[9] = "#08bf08";this.load_init = function () {$.ajax({type: "get",url: this.eventpath + "init.txt" + (issessioned? "?GpsSeurantaSessionID=" + sessionid: ""),contentType: "application/text; charset=ISO-8859-1",error: function () {status = "Can't get init data";window.alert(this.eventpath + "init.txt " + status)},cache: !1,context: this,success: function (b) {this.handleinidata(b)}})};this.initialiseMarkersizes = function (b, a, d, f) {this.markersize = b;this.lettersize = a;this.linewidth = d;this.lineopacity = f};this.setMarkerSize = function (b) {this.markersize = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].changeiconsize(this.markersize, this.lettersize);for (i = 0; i this.buoys.length; i ++) this.buoys[i].changeiconsize(this.markersize, this.lettersize)};this.setLetterSize = function (b) {this.lettersize = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].changeiconsize(this.markersize, this.lettersize);for (i = 0; i this.buoys.length; i ++) this.tracks[i].changeiconsize(this.markersize, this.lettersize)};this.setLineWidth = function (b) {this.linewidth = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].changelinestyle(this.linewidth, this.lineopacity)};this.setLineOpacity = function (b) {this.lineopacity = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].changelinestyle(this.linewidth, this.lineopacity)};this.setTailLength = function (b) {this.taillength = b};this.checkAll = function (b, a) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].setchecked(!0, b, a);a && this.reorderPaths(b)};this.checkNone = function (b, a) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].setchecked(!1, b, a)};this.checkUntil = function (b, a, d) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].setchecked(i <= b? !0: !1,a,d);d && this.reorderPaths(a)};this.toggleCheck = function (b, a, d) {this.tracks[b].setchecked(!this.tracks[b].checked, a, d);d && this.reorderPaths(a)};this.addbuoys = function (b) {for (i = 0; i this.buoys.length; i ++) this.buoys[i].marker.addTo(b);for (i = 0; i this.buoys.length; i ++) null != this.buoys[i].isconnectedto && this.buoys[i].path.addTo(b),console.log(this.buoys[i].isconnectedto)};this.toggleAutocenter = function (b) {this.tracks[b].autocenter = !this.tracks[b].autocenter;if (this.tracks[b].autocenter) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].autocenter = i == b? !0: !1;this.autocentered = b} else this.autocentered = -1};this.setDrawTailEnd = function (b) {this.drawTailEnd = b};this.getOffset = function (b) {return this.tracks[b].offset};this.setOffset = function (b, a) {this.tracks[b].offset = a};this.resetAllOffsets = function () {for (i = 0; i this.tracks.length; i ++) this.tracks[i].offset = 0};this.setoneclickmassstart = function (b, a) {var d = b,f = a;0 this.mapsystem && (d = this.calibration.getmapx(b, a), f = this.calibration.getmapy(b, a));var g = 1E20;for (i = 0; i this.tracks.length; i ++) if (this.tracks[i].offset = 0, this.tracks[i].checked) {var p = this.tracks[i].getnearesttimetopoint(d, f);-1E5p && (tfsmode && (p -= this.tracks[i].starttime), p g && (g = p));this.tracks[i].oneclicktempsplit = p}if (1E20 > g) for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && -1E5 this.tracks[i].oneclicktempsplit && (this.tracks[i].offset = this.tracks[i].oneclicktempsplit - g);return g};this.setsectormode = function (b, a) {this.sectormode = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].setsectormode(b, a);b? (this.sectorhlpath.addTo(a), this.sectorhlpath2.addTo(a)): a.hasLayer(this.sectorhlpath) && (a.removeLayer(this.sectorhlpath), a.removeLayer(this.sectorhlpath2));this.sectorcolormode && this.sectorcolortracks(b);this.reorderPaths(a)};this.setsectorcolormode = function (b, a) {this.sectorcolormode = b;for (i = 0; i this.tracks.length; i ++) this.tracks[i].sectorcolormode = b;b && this.sectormode? this.sectorcolortracks(!0): this.sectorcolortracks(!1);this.reorderPaths(a)};this.sectorcolortracks = function (b) {if (b) for (i = 0; i this.tracks.length; i ++) {b = .5 this.tracks[i].sectorfactor? 255: Math.round(this.tracks[i].sectorfactor / .5 * 255);var a = .5 this.tracks[i].sectorfactor? Math.round(255 -(this.tracks[i].sectorfactor - .5) / .5 * 255): Math.round(128 + this.tracks[i].sectorfactor / .5 * 127);this.tracks[i].sectorcolor = "rgb(" + b + "," + a + ",0)";this.tracks[i].path.setStyle({color: "rgb(" + b + "," + a + ",0)"})} else for (i = 0; i this.tracks.length; i ++) this.tracks[i].path.setStyle({color: this.tracks[i].color})};this.calcsectortimes = function (b, a, d, f, g, r, m, t) {if (0 == this.splitlines.length) return "";if (0 > b) for (i = 0; i this.tracks.length; i ++) this.tracks[i].setsectoratstart(); else if (this.splitlines[b].ispoint) for (i = 0; i this.tracks.length; i ++) this.tracks[i].calcsplit1(this.splitlines[b].x1B, 0 this.mapsystem? this.splitlines[b].y1B: g - this.splitlines[b].y1B,this.splitlines[b].radiusmeters,this.calibration.overallscale,!1,m,t,this.splitlines[b].ignorebeforerealtime,this.splitlines[b].ignorebeforetfs,1); else for (i2 = 0; i2 this.tracks.length; i2 ++) this.tracks[i2].calcsplit1line(this.splitlines[b].x1, 0 this.mapsystem? this.splitlines[b].y1: g - this.splitlines[b].y1,this.splitlines[b].x2,0 this.mapsystem? this.splitlines[b].y2: g - this.splitlines[b].y2,0 this.mapsystem,!1,m,t,this.splitlines[b].ignorebeforerealtime,this.splitlines[b].ignorebeforetfs,d,1);if (this.splitlines[a].ispoint) for (i = 0; i this.tracks.length; i ++) this.tracks[i].calcsplit1(this.splitlines[a].x1B, 0 this.mapsystem? this.splitlines[a].y1B: g - this.splitlines[a].y1B,this.splitlines[a].radiusmeters,this.calibration.overallscale,!1,m,t,this.splitlines[a].ignorebeforerealtime,this.splitlines[a].ignorebeforetfs,2); else for (i2 = 0; i2 this.tracks.length; i2 ++) this.tracks[i2].calcsplit1line(this.splitlines[a].x1, 0 this.mapsystem? this.splitlines[a].y1: g - this.splitlines[a].y1,this.splitlines[a].x2,0 this.mapsystem? this.splitlines[a].y2: g - this.splitlines[a].y2,0 this.mapsystem,!1,m,t,this.splitlines[a].ignorebeforerealtime,this.splitlines[a].ignorebeforetfs,f,2);for (i2 = 0; i2 this.tracks.length; i2 ++) this.tracks[i2].calcsectortime(m);b = [];for (i = 0; i this.tracks.length; i ++) null != this.tracks[i].splitInstance2 && b.push(this.tracks[i].splitInstance2);b.sort(function (b, a) {return b.time - a.time});a = "";d = 1;f = 0;g = 1;0b.length? (f = b[0].time, g = b[b.length - 1].time + 1E-4, this.sectorhl = b[0].index - 1): this.sectorhl = -1;this.sectororder = [];for (i = 0; i b.length; i ++) a = a + '<span id="sect' + (b[i].index - 1) + '" class="sectornamebase ' + (0 == i? "hlsectorname": "sectorname") + '">',b[i].hl && (a += '<span class="hlsplit">'),a = a + d + ". ",m = "",m = r && 0 != i? this.showtimestring2b(b[i].time - f): this.showtimestring3b(b[i].time),a = a + m + " " + b[i].name + " (" + b[i].distance + " m)" + (b[i].hl? "</span>": "") + "</span><br />",this.tracks[b[i].index - 1].popuptext = d + ". " + this.showtimestring2b(b[i].time - f) + " " + b[i].name + " (" + b[i].distance + " m)",this.tracks[b[i].index - 1].sectorfactor = 1 - Math.pow((g - b[i].time) / (g - f), 2),d ++,this.sectororder[i] = b[i].index - 1;this.sectormode && this.sectorcolormode && this.sectorcolortracks(!0);return a};this.calcrog = function () {if (!this.isrogaining) return "";var b = [];for (i = 0; i this.tracks.length; i ++) b.push({name: this.tracks[i].name, points: this.tracks[i].rogpoints, hl: this.tracks[i].highlighted});b.sort(function (b, a) {return a.points - b.points});var a = "",d = 0,f = 0,g = 9999999;for (i = 0; i b.length; i ++) f += 1,b[i].points g && (d = f),g = b[i].points,a = a + d + ". " + b[i].points + " " + b[i].name + "<br />";return a};this.calcsplitpointtimes = function (b, a, d, f, g, r, m) {if (0 == this.splitlines.length) return "";if (this.splitlines[b].ispoint) for (i = 0; i this.tracks.length; i ++) this.tracks[i].calcsplit1(this.splitlines[b].x1B, 0 this.mapsystem? this.splitlines[b].y1B: a - this.splitlines[b].y1B,this.splitlines[b].radiusmeters,this.calibration.overallscale,d,g,r,this.splitlines[b].ignorebeforerealtime,this.splitlines[b].ignorebeforetfs,0); else for (i2 = 0; i2 this.tracks.length; i2 ++) this.tracks[i2].calcsplit1line(this.splitlines[b].x1, 0 this.mapsystem? this.splitlines[b].y1: a - this.splitlines[b].y1,this.splitlines[b].x2,0 this.mapsystem? this.splitlines[b].y2: a - this.splitlines[b].y2,0 this.mapsystem,d,g,r,this.splitlines[b].ignorebeforerealtime,this.splitlines[b].ignorebeforetfs,m,0);b = [];for (i = 0; i this.tracks.length; i ++) null != this.tracks[i].splitInstance && b.push(this.tracks[i].splitInstance);b.sort(function (b, a) {return b.time - a.time});a = "";g = 1;r = 0;0b.length && (r = b[0].time);for (i = 0; i b.length; i ++) b[i].hl && (a += '<span class="hlsplit">'),a = a + g + ". ",m = "",m = d? f && 0 != i? this.showtimestring2b(b[i].time - r): this.showtimestring3b(b[i].time): f && 0 != i? this.showtimestring2b(b[i].time - r): this.showtimestring(b[i].time),a = a + m + " " + b[i].name + (b[i].hl? "</span>": "") + "<br />",g ++;return a};this.addsplitpoint = function (b, a, d, f, g, r) {var e = new splitline;e.x1 = b.lng;e.y1 = b.lat;0 this.mapsystem? (e.x1B = this.calibration.getmapx(b.lng, b.lat), e.y1B = this.calibration.getmapy(b.lng, b.lat)): (e.x1B = e.x1, e.y1B = e.y1);e.radiusmeters = a;e.ispoint = !0;e.id = this.nextsplitid;e.title = g.replace("<", "").replace(">", "");this.nextsplitid ++;e.marker = new L.Marker(b, {contextmenu: !0,clickable: !1,pointerEvents: "none",zIndexOffset: 1E6,icon: new L.NumberedDivIcon2({color: "red",blackshadow: !1,number: e.title,size: 2 *e.radiusmeters / f,lsize: 14})});this.showlines && d.addLayer(e.marker);this.splitlines.splice(r, 0, e)};this.removesplitpoint = function (b, a) {this.splitlines.length b - 1 || (this.splitlines[b].ispoint || a.removeLayer(this.splitlines[b].polyline), a.removeLayer(this.splitlines[b].marker), this.splitlines.splice(b, 1))};this.isline = function (a) {return 0 == this.splitlines.length || this.splitlines[a].ispoint? !1: !0};this.addsplitline = function (a, d, e, f) {var b = new splitline;b.x1 = a.getLatLngs()[0].lng;b.y1 = a.getLatLngs()[0].lat;b.x2 = a.getLatLngs()[1].lng;b.y2 = a.getLatLngs()[1].lat;b.ispoint = !1;b.id = this.nextsplitid;b.title = e.replace("<", "").replace(">", "");this.nextsplitid ++;b.polyline = new L.polyline(a.getLatLngs(), {contextmenu: !0,clickable: !1,pointerEvents: "none",color: "red",weight: 4,opacity: .8});b.marker = new L.Marker(a.getLatLngs()[b.y1 > b.y2? 1: 0], {contextmenu: !0,clickable: !1,pointerEvents: "none",zIndexOffset: 1E6,icon: new L.NumberedDivIcon3({color: "red",blackshadow: !1,number: b.title,lsize: 14})});this.showlines && (d.addLayer(b.polyline), d.addLayer(b.marker));this.splitlines.splice(f, 0, b)};this.showhidelines = function (a, d) {if (a) {if (!this.showlines) for (this.showlines =! 0, i = 0; i this.splitlines.length; i ++) this.splitlines[i].ispoint || d.addLayer(this.splitlines[i].polyline),d.addLayer(this.splitlines[i].marker)} else this.showlines && (this.showlines =! 1, d.clearLayers())};this.resizesplitpoints = function (a) {for (i = 0; i this.splitlines.length; i ++) this.splitlines[i].ispoint && this.splitlines[i].marker.options.icon.setsize(2 * this.splitlines[i].radiusmeters / a)};this.getsplitpointlist = function (a, d) {var b = "";a && (b += '<option value="0">(first)</option>');d && (b += '<option value="0">start</option>');for (i = 0; i this.splitlines.length; i ++) b = b + '<option value="' + ((a || d? 1: 0) + i) + '">' + this.splitlines[i].title + "</option>";return b};this.getsplitsettingRT = function (a) {if (0 > a || a > this.splitlines.length) return -1;a = this.splitlines[a].ignorebeforerealtime;if (-1 == a) return -1;a = a + 1136073600 + this.timedifference;return(new Date(1E3 * a)).toISOString()};this.getsplitsettingTFS = function (a) {if (0 > a || a > this.splitlines.length) return -1;a = this.splitlines[a].ignorebeforetfs;return -1 == a? -1: this.showtimestring3(a)};this.setsplitsettingRT = function (a, d) {if (!(0 > a || a > this.splitlines.length)) if (-1 == d) this.splitlines[a].ignorebeforerealtime = -1; else {var b = d.replace(" ", "T") + ".000Z";b = Date.parse(b);this.splitlines[a].ignorebeforerealtime = b / 1E3 - 1136073600 - this.timedifference}};this.setsplitsettingTFS = function (a, d) {if (!(0 > a || a > this.splitlines.length)) if (-1 == d) this.splitlines[a].ignorebeforetfs = -1; else {var b = d.split(":");this.splitlines[a].ignorebeforetfs = Math.round(3600 * b[0] + 60 * b[1] + 1 * b[2])}};this.setRallymode = function (a) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].setrallymode(a)};this.centercompetitor = function (a, d) {var b = this.tracks[d].mapxalltodraw,f = this.tracks[d].mapyalltodraw;-1E4 != b && map.setView([0 == this.mapsystem? a - f: f,b])};this.toggleHighlight = function (a, d, e) {this.tracks[a].highlighted = !this.tracks[a].highlighted;this.tracks[a].changeiconhl();e && this.reorderPaths(d)};this.toggleFullroute = function (a) {this.tracks[a].fullroute = !this.tracks[a].fullroute};this.setColor = function (a, d) {this.tracks[a].color = d;this.tracks[a].changeiconcolor();this.tracks[a].changelinestyle(this.linewidth, this.lineopacity)};this.getReplayMinTime = function () {return this.tfsmode? this.replaymintimeTFS: this.replaymintime};this.getReplayMaxTime = function () {return this.tfsmode? this.replaymaxtimeTFS: this.replaymaxtime};this.getRaceName = function () {return this.racename};this.setTimeToDraw = function (a) {if (a == this.timetodraw) return !1;this.timetodraw = a;return !0};this.getTimeDifference = function () {return this.timedifference};this.getLiveStatus = function () {return this.isliveevent};this.setTFSmode = function (a) {this.tfsmode = a};this.setreplaymode = function (a) {this.replaymode = a};this.getlaststarttime = function () {var a = -1E3,d = 1E20;for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && this.tracks[i].starttime > a && (a = this.tracks[i].starttime),this.tracks[i].starttime d && (d = this.tracks[i].starttime);return -1E3a? a: d};this.getmperpixel = function () {return null == this.calibration? -1: 1 / this.calibration.overallscale};this.updatenamelist = function (a, d) {for (i = 0; i this.tracks.length; i ++) {var b = "?";var f = " km/h";1 == a? b = Number(this.tracks[i].currentspeed.toFixed(0)): 2 == a? (.2 this.tracks[i].currentspeed && (b = 3600 / this.tracks[i].currentspeed, b = 5 * Math.round(b / 5), b = this.tracks[i].getovertimestring(b)), f = "/km"): 3 == a && (b = Number((this.tracks[i].currentspeed / 1.852).toFixed(1)), f = " kn");b = d? (0 != this.tracks[i].offset? '<span style="color:red;">' + this.tracks[i].getOffsetString() + "</span>": this.tracks[i].starttimestring) + ' <span style="float:right; width:48px; text-align:right;">' + this.tracks[i].status + '</span><span style="float:right; width:63px; text-align:right;">' + Number(this.tracks[i].currentdistance / 1E3).toFixed(2) + ' km </span><span style="float:right; width:auto; text-align:right;">' + (0 > this.tracks[i].currentspeed? "?": b) + f + "</span>": (0 != this.tracks[i].offset? '<span style="color:red;">' + this.tracks[i].getOffsetString() + "</span>": this.tracks[i].starttimestring) + ' <span style="float:right; width:40px; text-align:right;">' + this.tracks[i].status + '</span><span style="float:right; width:52px; text-align:right;">' + Number(this.tracks[i].currentdistance / 1E3).toFixed(2) + ' km </span><span style="float:right; width:auto; text-align:right;">' + (0 > this.tracks[i].currentspeed? "?": b) + f + "</span>";this.updatecompinfo(i, b)}};this.reorderPaths = function (a) {for (i = 0; i this.tracks.length; i ++) a.hasLayer(this.tracks[i].path) && a.removeLayer(this.tracks[i].path);a.hasLayer(this.sectorhlpath) && (a.removeLayer(this.sectorhlpath), a.removeLayer(this.sectorhlpath2));if (this.sectormode && this.sectorcolormode && null != this.sectororder) for (i = this.sectororder.length - 1; -1 i; i --) this.tracks[this.sectororder[i]].checked && this.tracks[this.sectororder[i]].path.addTo(a); else {for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && !this.tracks[i].highlighted && this.tracks[i].path.addTo(a);for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && this.tracks[i].highlighted && this.tracks[i].path.addTo(a)}this.sectormode && (this.sectorhlpath.addTo(a), this.sectorhlpath2.addTo(a))};this.updatemarkers = function (a) {this.reorderPaths(a);for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && !this.tracks[i].isonmap? (this.tracks[i].marker.addTo(a), this.tracks[i].rallymode && this.tracks[i].marker.options.icon.setrallystate(this.tracks[i].rallystate), this.tracks[i].isonmap =! 0): !this.tracks[i].checked && this.tracks[i].isonmap && (a.removeLayer(this.tracks[i].marker), this.tracks[i].isonmap =! 1)};this.handleinidata = function (a) {this.replaymode = !0;var b = -1,e = 0,f = 0,g = !1,r = a.split("\n"),m = "",t = "",w = "",v = "",x = a = !1,z = !1,y = "";for (i = 0; i r.length; i ++) {var u = r[i].split(":");if ("CALIBRATION" == u[0]) this.calibration = new calibration,this.calibration.calibrate(u[1], d),u = u[1].split("|"),e = u[0],f = u[1]; else if ("RACENAME" == u[0]) this.racename = u[1]; else if ("TIMEZONE" == u[0]) this.timedifference = 60 * u[1]; else if ("GRABINTERVAL" == u[0]) this.livegrabinterval = 1 * u[1]; else if ("LIVEBUFFER" == u[0]) this.livebuffer = 1 * u[1]; else if ("DATETIME" == u[0]) g = "1" == u[1]; else if ("LIVE" == u[0]) {if (this.isliveevent = "1" == u[1]) this.replaymode = !1} else if ("NUMBEROFLOGOS" == u[0]) this.numberoflogos = 1 * u[1]; else if ("PREC" == u[0]) for (u = u[1].split("|"), this.predefc =[], this.predefcradius = u[0], i65 = 1; i65 u.length - 1; i65 += 2) this.predefc[this.predefc.length] = {x: u[i65] / this.iFactor,y: u[i65 + 1] / this.iFactor}; else if ("ROGC" == u[0]) u = u[1].split("|"),0 == this.isrogaining && (this.isrogaining =! 0, this.rogctrls =[]),this.rogctrls[this.rogctrls.length] = {x: u[0] / this.iFactor,y: u[1] / this.iFactor,code: u[2],points: u[3]}; else if ("ROGD" == u[0]) this.rogradius = u[1]; else if ("MAPSYSTEM" == u[0]) "MML" == u[1] && (this.mapsystem = 1),"NOR" == u[1] && (this.mapsystem = 2),"OSM" == u[1] && (this.mapsystem = 3),"OWN" == u[1] && (this.mapsystem = 4),"MML2" == u[1] && (this.mapsystem = 5),"MML3" == u[1] && (this.mapsystem = 6),this.calibration = new calibration,this.calibration.setMML(); else if ("OWNWMS" == u[0]) t = "http://" + u[1].replace("+", "/"); else if ("OWNZOOMS" == u[0]) v = u[1]; else if ("FORCEAUTOCENTER" == u[0]) z = !0; else if ("OWNBOUNDS" == u[0]) w = u[1]; else if ("CENTERPOINT" == u[0]) f = u[1].split("|"),e = f[0],f = f[1]; else if ("DASHLIMIT" == u[0]) this.dashlimit = 1 * u[1]; else if ("TAILLEN" == u[0]) this.taillength = 1 * u[1],this.setdefaulttail(this.taillength); else if ("MAXTIMEMINS" == u[0]) this.maxtimemins = 60 * u[1]; else if ("RALLYMODE" == u[0] && "1" == u[1]) a = !0; else if ("ALLOWGPXUPLOAD" == u[0] && "1" == u[1]) x = !0; else if ("MINBEFORESTART" == u[0]) this.showbeforestart = 60 * u[1],this.replaymintimeTFS = -1 * this.showbeforestart,this.replaymaxtimeTFS = -1 * this.showbeforestart; else if ("OVERLAY" == u[0]) m = 2u.length? u[1].trim() + ":" + u[2].trim(): timeeventhost + "/gps/extrafile.php?a=" + u[1].trim(); else if ("COMMONSTARTTIME" == u[0]) b = u[1]; else if ("CENTERONCE" == u[0]) this.centeredonce = !1; else if ("COURSE" == u[0]) y = 2u.length? u[1].trim() + ":" + u[2].trim(): timeeventhost + "/gps/extrafile.php?a=" + u[1].trim(); else if ("PUBLICLOGIN" == u[0]) "LiveOrienteering" == u[1] && (this.liveCenterLogin =! 0); else if ("COMPETITOR" == u[0]) {var G = new competitor;-1u[1].indexOf("XXPOIJUXX")? (G.set_from_inistring(u[1], this.timedifference, "#ffffff", this.showbeforestart, b, this.lkm, this.markersize, this.lettersize, this.linewidth, this.lineopacity, this.maxtimemins), this.buoys[this.buoys.length] = G): (G.set_from_inistring(u[1], this.timedifference, this.colors[this.tracks.length % this.colors.length], this.showbeforestart, b, this.lkm + 1, this.markersize, this.lettersize, this.linewidth, this.lineopacity, this.maxtimemins), this.tracks[this.lkm] = G, this.lkm ++)}}for (i = 0; i this.buoys.length; i ++) if (2 this.buoys[i].isconnectedtoid.length) for (j = 0; j this.buoys.length; j ++) if (this.buoys[j].id == this.buoys[i].isconnectedtoid) {this.buoys[i].isconnectedto = this.buoys[j];break}0 this.forcedMapSystem && (this.mapsystem = this.forcedMapSystem, this.calibration = new calibration, this.calibration.setMML());0 == e && (1 == this.mapsystem || 3 == this.mapsystem || 5 == this.mapsystem || 6 == this.mapsystem? (e = 25.748997, f = 62.239674): 2 == this.mapsystem? (e = 11.394069, f = 59.122785): 4 == this.mapsystem && (b = w.split("|"), e =( 1 * b[0] + 1 * b[2]) / 2, f =( 1 * b[1] + 1 * b[3]) / 2));this.cpoint = {x: e,y: f};0 this.mapsystem && this.calibration.setCenterMer(e);this.mapsystemset(this.mapsystem, e, f, 0 this.mapsystem && 0m.length, t, v, w);0 this.mapsystem && 0m.length && (this.overlay = new overlay(m));this.createnamelist(this.tracks, g);this.initloaded = !0;e = 1704110400;for (i = 0; i this.tracks.length; i ++) this.tracks[i].get1sttime(),this.tracks[i].starttime e && (e = this.tracks[i].starttime);e = e + 1136073600 + this.timedifference;this.splitdefaultrt = (new Date(1E3 * e)).toISOString().replace("T", " ").replace(".000Z", "");if (this.isrogaining) for (this.enablerog(), i234 = 0; i234 this.tracks.length; i234 ++) this.tracks[i234].setuprog(this.rogctrls.length);5y.length && this.readcourse(y);if (this.isliveevent) this.startlivepreparations(); else {this.showLoading();this.load_data();for (i = 0; i this.tracks.length; i ++) e = this.tracks[i].get1sttime(),e this.replaymintime && (this.replaymintime = e);this.timetodraw = this.replaymintime}document.title = "GPS-seuranta | " + this.racename;a && this.enablerallymode();x && this.enablegpxuploadmode();z && (this.autocentered = 0, this.tracks[0].autocenter =! 0)};this.logoutLC = function (a) {1 == confirm("Logout " + a.lcLogoutText + " tracking?") && window.open(a.eventpath + "?logout=1", "_self")};this.courseread = function (a) {this.course = new gsacourse(a, this.calibration);console.log("course read")};this.readcourse = function (a) {$.ajax({type: "get",url: a,cache: !1,context: this,error: function () {console.log("Can't read course")},success: function (a, b, d) {this.courseread(a)}})};this.startlivepreparations = function () {$.ajax({type: "get",url: timeeventhost + "/gps/time.php?a=" + Math.floor(100 * Math.random() + 1),cache: !1,context: this,error: function () {},success: function (a, d, e) {a = parseInt(a);this.setLive(new Date, a);this.showLoading();this.load_data()}})};var f = this;this.load_data = function () {$.ajax({type: "get",url: this.eventpath + "data.lst" + (issessioned? "?GpsSeurantaSessionID=" + sessionid: ""),context: this,xhr: function () {var a = new window.XMLHttpRequest;a.addEventListener("progress", function (a) {a.lengthComputable && f.updateLoading("loading data... <br>" + Math.round(a.loaded / a.total * 100) + "%")}, !1);return a},error: function () {this.handledata("", !1);var a = this;this.isliveevent && setTimeout(function () {a.reload_data()}, 1E3 * a.datagrabinterval)},cache: !1,success: function (a, d, e) {f.updateLoading("processing data...");if ("<HTML>" == a.substring(6, 0)) {if (this.isliveevent) {var b = this;setTimeout(function () {b.reload_data()}, 1E3 * b.livegrabinterval)}} else this.bytesrecieved = a.length,f.updateLoading("processing data..."),this.handledata(a, !1),this.isliveevent && (b = this, setTimeout(function () {b.reload_data()}, 1E3 * b.livegrabinterval))}})};this.reload_data = function () {$.ajax({type: "get",url: this.eventpath + "data.php?" + (-1 this.bytesrecieved? "offset=" + this.bytesrecieved + "&reset=" + this.resetvalue: "data=" + this.lastline) + (issessioned? "&GpsSeurantaSessionID=" + sessionid: ""),error: function () {var a = this;this.isliveevent && !this.nomorelive && setTimeout(function () {a.reload_data()}, 1E3 * a.livegrabinterval)},cache: !1,statusCode: {410: function () {this.nomorelive = !0;console.log("no more live")},402: function () {this.nomorelive = !0;console.log("status 402")}},context: this,success: function (a, d, e) {if ("<HTML>" == a.substring(6, 0)) {if (this.isliveevent && !this.nomorelive) {var b = this;setTimeout(function () {b.reload_data()}, 1E3 * b.livegrabinterval)}} else this.bytesrecieved = e.getResponseHeader("X-GPS-Server-Filesize"),this.resetvalue = e.getResponseHeader("X-GPS-Server-Reset"),this.resetvalue || (this.resetvalue = -1),this.bytesrecieved || (this.bytesrecieved = -1),this.handledata(a, !0),this.isliveevent && !this.nomorelive && (b = this, setTimeout(function () {b.reload_data()}, 1E3 * b.livegrabinterval))}})};this.handledata = function (a, d) {var b = a.split("\n");1b.length && 0b[0].indexOf("DOCTYPE") && (this.nomorelive =! 0);var f;for (f = b.length - 1; -1f; f--) if (10b[f].length) {this.lastline = b[f];break}30 this.lastline.length && (this.lastline = this.lastline.substring(0, 29));10 > this.lastline.length && (this.lastline = "undef");for (f = 0; fb.length; f++) {var g = b[f].split(".")[0],p = !1;for (j = 0; j this.lkm; j ++) if (this.tracks[j].id == g) {this.tracks[j].adddata(b[f], this.calibration);p = !0;break}if (! p) for (j = 0; j this.buoys.length; j ++) if (this.buoys[j].id == g) {this.buoys[j].adddata(b[f], this.calibration);break}}for (f = 0; f this.tracks.length; f++) b = this.tracks[f].get1sttime(),g = this.tracks[f].getlasttime(),b this.replaymintime && (this.replaymintime = b),g > this.replaymaxtime && (this.replaymaxtime = g),g - this.tracks[f].starttime > this.replaymaxtimeTFS && (this.replaymaxtimeTFS = g - this.tracks[f].starttime);b = (new Date).getTime();for (f = 0; f this.tracks.length; f++) this.tracks[f].updatedistances(this.calibration, this.rogctrls, this.rogradius, this.dashlimit, this.course),this.updateroglist();f = (new Date).getTime();console.log("cd took " + (f - b) + " ms");d || (this.timetodraw = this.replaymintime);this.data_added(d)};this.drawL = function (a, d, e) {0 == this.mapheight && (this.mapheight = d);if (null != a) {if (e) {for (i = 0; i this.buoys.length; i ++) this.buoys[i].drawtrackL2(a, this.timetodraw, this.timetodraw - this.taillength, this.dashlimit, !this.replaymode, this.tfsmode, d, this.lineopacity, e, 0 this.mapsystem, !1);for (i = 0; i this.buoys.length; i ++) this.buoys[i].drawballoonL2(d, 0 this.mapsystem)}for (i = 0; i this.tracks.length; i ++) this.tracks[i].highlighted || this.tracks[i].drawtrackL2(a, this.timetodraw, this.timetodraw - this.taillength, this.dashlimit, !this.replaymode, this.tfsmode, d, this.lineopacity, e, 0 this.mapsystem, this.sectormode && this.sectorhl == i, this.drawTailEnd);for (i = 0; i this.tracks.length; i ++) this.tracks[i].highlighted && this.tracks[i].drawtrackL2(a, this.timetodraw, this.timetodraw - this.taillength, this.dashlimit, !this.replaymode, this.tfsmode, d, this.lineopacity, e, 0 this.mapsystem, this.sectormode && this.sectorhl == i, this.drawTailEnd);this.sectormode && (this.sectorhlpath.setLatLngs([[0, 0]]), this.sectorhlpath2.setLatLngs([[0, 0]]), -1 this.sectorhl && null != this.tracks[this.sectorhl].multipointlist && (this.sectorhlpath.setLatLngs(this.tracks[this.sectorhl].multipointlist), this.sectorhlpath2.setLatLngs(this.tracks[this.sectorhl].multipointlist), this.sectorhlpath2.setPopupContent($("#sect" + this.sectorhl).text())));if (e) {for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && !this.tracks[i].highlighted && this.tracks[i].drawballoonL2(d, 0 this.mapsystem);for (i = 0; i this.tracks.length; i ++) this.tracks[i].checked && this.tracks[i].highlighted && this.tracks[i].drawballoonL2(d, 0 this.mapsystem)}if (-1 this.autocentered) {e = this.tracks[this.autocentered].mapxalltodraw;var b = this.tracks[this.autocentered].mapyalltodraw;0 == this.mapsystem && (b = d - b);if (-1E4 != e) {d = a.latLngToContainerPoint([b, e]);var f = a.getSize();1E4 Math.pow(d.x - f.x / 2, 2) + Math.pow(d.y - f.y / 2, 2) && (d = a.getZoom(), a.setView([b, e], d, {animate: !1}))}} else this.centeredonce || (e = this.tracks[0].mapxalltodraw, b = this.tracks[0].mapyalltodraw, 0 == this.mapsystem && (b = d - b), -1E4 != e && (a.latLngToContainerPoint([b, e]), a.getSize(), d = a.getZoom(), a.setView([b, e], d, {animate: !1}), this.centeredonce =! 0));a = new Date;this.draws ++;10 == this.draws && (this.draws = 0, 0 this.last10drawtime && (e = a.getTime() - this.last10drawtime.getTime(), e = Math.round(1E5 / e), $("#fps").text("fps " + e / 10)), this.last10drawtime = a)}};this.getCurrentTimeString = function () {var a = this.timetodraw;tfsmode || (a = this.timetodraw + this.timedifference);return this.showtimestring(a)};this.getCurrentDateString = function () {var a = this.timetodraw;if (tfsmode) return Math.floor(a / 86400) + "d";a = this.timetodraw + this.timedifference + 1136073600;return(new Date(1E3 * a)).toISOString().slice(0, 10)};this.showtimestring = function (a) {var b = 0 > a;b && (a *= -1);var d = Math.floor(a % 86400 / 3600),f = Math.floor((a % 86400 - 3600 * d) / 60);a = Math.floor(a % 86400 - 3600 * d - 60 * f);return(b? "-": "") + (10 > d? "0": "") + d + ":" + (10 > f? "0": "") + f + ":" + (10 > a? "0": "") + a};this.showtimestring2 = function (a) {var b = 0 > a;b && (a *= -1);var d = Math.floor(a % 86400 / 3600),f = Math.floor((a % 86400 - 3600 * d) / 60);a = Math.floor(a % 86400 - 3600 * d - 60 * f);return(b? "-": "") + (0d? d + ":" + (10 > f? "0": ""): "") + f + ":" + (10 > a? "0": "") + a};this.showtimestring2b = function (a) {var b = 0 > a;b && (a *= -1);var d = Math.floor(a / 3600),f = Math.floor((a - 3600 * d) / 60);a = Math.floor(a - 3600 * d - 60 * f);return(b? "-": "+") + (0d? d + ":" + (10 > f? "0": ""): "") + f + ":" + (10 > a? "0": "") + a};this.showtimestring3 = function (a) {var b = Math.floor(a / 3600),d = Math.floor((a - 3600 * b) / 60);a = Math.floor(a - 3600 * b - 60 * d);return b + ":" + (10 > d? "0": "") + d + ":" + (10 > a? "0": "") + a};this.showtimestring3b = function (a) {var b = Math.floor(a / 3600),d = Math.floor((a - 3600 * b) / 60);a = Math.floor(a - 3600 * b - 60 * d);return(0b? b + ":" + (10 > d? "0": ""): "") + d + ":" + (10 > a? "0": "") + a};this.calcdifference = function (a, d, e, f) {this.difference = -9999999;var b = this.tracks[d].getcompare2time(this.timetodraw, !this.tfsmode);var g = this.tracks[d].mapxalltodraw;var m = this.tracks[d].mapyalltodraw;this.calibration.MML && (d = this.calibration.getmapx(g, m), m = this.calibration.getmapy(g, m), g = d);if (!(-1E5 > b)) if (g = this.tracks[a].getnearesttimetopointlimited(g, m, !this.tfsmode, b - f, b - e, 50, this.calibration.overallscale), -1E5 > g) this.difference = -9999999; else if (this.difference = b > g? b - g: -9999999,g > this.tracks[a].trackpoints[this.tracks[a].pointcount - 1].time - .01 && (this.difference = -9999999),b - ge + 1E-4 || b - g > f - 1E-4) this.difference = -9999999}};L.NumberedDivIcon2 = L.Icon.extend({balloondiv: null,numdiv: null,options: {number: "",iconSize: new L.Point(12, 12),iconAnchor: new L.Point(6, 6),popupAnchor: new L.Point(12, -33),color: "red",opacityB: 1,size: 12,lsize: 20,highlighted: 0,zIndex: 0,blackshadow: !1,isbuoy: !1},createIcon: function () {var a = document.createElement("div");this.balloondiv = document.createElement("div");this.numdiv = document.createElement("div");a.setAttribute("class", "Leaf_marker");this.balloondiv.setAttribute("class", "Leaf_balloon");this.numdiv.setAttribute("class", this.options.blackshadow? "Leaf_label_black": "Leaf_label_white");this.numdiv.innerHTML = this.options.number || "";this.numdiv.style.color = this.options.color;this.balloondiv.style.backgroundColor = "transparent";a.appendChild(this.balloondiv);a.appendChild(this.numdiv);this.balloondiv.style.width = this.options.size + "px";this.balloondiv.style.height = this.options.size + "px";this.balloondiv.style.top = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.left = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.border = "3px solid rgba(255, 0, 0, 0.75)";this.numdiv.style.top = .35 * this.options.size + "px";this.numdiv.style.left = .35 * this.options.size + "px";this.numdiv.style.fontSize = this.options.lsize + "px";this.numdiv.style.lineHeight = "1.0";this.numdiv.style.backgroundColor = "rgba(255, 255, 255, 0.6)";this.numdiv.style.borderRadius = "25%";this.numdiv.style.border = "1px solid red";a.style.pointerEvents = "none";return a},createShadow: function () {return null},setsize: function (a) {this.options.size = a;this.balloondiv.style.width = this.options.size + "px";this.balloondiv.style.height = this.options.size + "px";this.balloondiv.style.top = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.left = "-" + (this.options.size / 2 + 2) + "px";this.numdiv.style.top = .35 * this.options.size + "px";this.numdiv.style.left = .35 * this.options.size + "px"},settitle: function (a) {this.options.number = a}});L.NumberedDivIcon3 = L.Icon.extend({balloondiv: null,numdiv: null,options: {number: "",iconSize: new L.Point(12, 12),iconAnchor: new L.Point(6, 6),popupAnchor: new L.Point(12, -33),color: "red",opacityB: 1,size: 12,lsize: 20,highlighted: 0,zIndex: 0,blackshadow: !1,isbuoy: !1},createIcon: function () {var a = document.createElement("div");this.numdiv = document.createElement("div");a.setAttribute("class", "Leaf_marker");this.numdiv.setAttribute("class", this.options.blackshadow? "Leaf_label_black": "Leaf_label_white");this.numdiv.innerHTML = this.options.number || "";this.numdiv.style.color = this.options.color;a.appendChild(this.numdiv);this.numdiv.style.top = "0px";this.numdiv.style.left = "0px";this.numdiv.style.fontSize = this.options.lsize + "px";this.numdiv.style.lineHeight = "1.0";this.numdiv.style.backgroundColor = "rgba(255, 255, 255, 0.6)";this.numdiv.style.borderRadius = "25%";this.numdiv.style.border = "1px solid red";a.style.pointerEvents = "none";return a},createShadow: function () {return null},setsize: function (a) {this.options.size = a;this.balloondiv.style.width = this.options.size + "px";this.balloondiv.style.height = this.options.size + "px";this.balloondiv.style.top = "-" + (this.options.size / 2 + 2) + "px";this.balloondiv.style.left = "-" + (this.options.size / 2 + 2) + "px";this.numdiv.style.top = .35 * this.options.size + "px";this.numdiv.style.left = .35 * this.options.size + "px"},settitle: function (a) {this.options.number = a}});function splitline() {this.y1B = this.x1B = this.y2 = this.y1 = this.x2 = this.x1 = 0;this.radiuspixels = this.radiusmeters = 30;this.ispoint = !1;this.title = "";this.ignorebeforetfs = this.ignorebeforerealtime = this.id = -1;this.polyline = this.marker = null};L.CanvasOverlay = (L.Layer? L.Layer: L.Class).extend({initialize: function (a, d) {this._userDrawFunc = a;L.setOptions(this, d)},drawing: function (a, d) {this._userDrawFunc = a;this.isMML = d;return this},params: function (a) {L.setOptions(this, a);return this},canvas: function () {return this._canvas},redraw: function () {this._frame || (this._frame = L.Util.requestAnimFrame(this._redraw, this));return this},onAdd: function (a) {this._map = a;this._canvas = L.DomUtil.create("canvas", "leaflet-heatmap-layer");var d = L.DomUtil.testProp(["transformOrigin", "WebkitTransformOrigin", "msTransformOrigin"]);this._canvas.style[d] = "50% 50%";d = this._map.getSize();this._canvas.width = d.x;this._canvas.height = d.y;L.DomUtil.addClass(this._canvas, "leaflet-zoom-" + (this._map.options.zoomAnimation && L.Browser.any3d? "animated": "hide"));a._panes.overlayPane.appendChild(this._canvas);a.on("moveend", this._reset, this);a.on("resize", this._resize, this);if (a.options.zoomAnimation && L.Browser.any3d) a.on("zoomanim", this._animateZoom, this);this._reset()},onRemove: function (a) {a.getPanes().overlayPane.removeChild(this._canvas);a.off("moveend", this._reset, this);a.off("resize", this._resize, this);a.options.zoomAnimation && a.off("zoomanim", this._animateZoom, this);this_canvas = null},addTo: function (a) {a.addLayer(this);return this},_resize: function (a) {this._canvas.width = a.newSize.x;this._canvas.height = a.newSize.y},_reset: function () {var a = this._map.containerPointToLayerPoint([0, 0]);L.DomUtil.setPosition(this._canvas, a);this._redraw()},_redraw: function () {var a = this._map.getSize(),d = this._map.getBounds(),g = 180 * a.x / (2.003750834E7 * (d.getEast() - d.getWest())),f = this._map.getZoom();this._userDrawFunc && this._userDrawFunc(this, {canvas: this._canvas,bounds: d,size: a,zoomScale: g,zoom: f,options: this.options,isMML: this.isMML});this._frame = null},_animateZoom: function (a) {var d = this._map.getZoomScale(a.zoom);a = this._map._getCenterOffset(a.center)._multiplyBy(- d).subtract(this._map._getMapPanePos());L.DomUtil.setTransform? L.DomUtil.setTransform(this._canvas, a, d): this._canvas.style[L.DomUtil.TRANSFORM] = L.DomUtil.getTranslateString(a) + " scale(" + d + ")"}});L.canvasOverlay = function (a, d) {return new L.CanvasOverlay(a, d)};function overlay(a) {this.ctrls = [];this.clines = [];this.lines = [];$.ajax({type: "get",url: a,contentType: "application/text; charset=ISO-8859-1",error: function () {},cache: !1,context: this,success: function (a) {this.handleoverlaydata(a)}});this.handleoverlaydata = function (a) {var d = !0;a = a.split("\n");for (i = 0; i a.length; i ++) {var f = a[i].split("|");if ("COORDS" == f[0]) d = "ETRS" != f[1]; else if ("POINT" == f[0]) {var b = f[1],p = b,e = f[2],q = f[3];if (! d) {var h = ETRStoWGS(e, q);e = h.x;q = h.y}4f.length && (p = f[4]);h = "rgba(200,6,80, 0.88)";var r = 1;for (i5 = 5; i5 f.length; i5 ++) "COLOR:" == f[i5].substring(0, 6) && 15 == f[i5].length? h = "rgba(" + f[i5].substring(6, 9) + "," + f[i5].substring(9, 12) + "," + f[i5].substring(12, 15) + ",0.88)": "SIZE:" == f[i5].substring(0, 5) && (r = f[i5].substring(5));this.ctrls.push({id: b,x: e,y: q,def: p,color: h,sizefactor: r})} else if ("CLINE" == f[0]) {h = f[1];r = f[2];q = e = p = b = 0;var m = !1,t = !1;for (i649 = 0; i649 this.ctrls.length && (this.ctrls[i649].id == h && (b = this.ctrls[i649].x, p = this.ctrls[i649].y, m =! 0), this.ctrls[i649].id == r && (e = this.ctrls[i649].x, q = this.ctrls[i649].y, t =! 0), ! m || ! t); i649 ++) m = 0;h = "rgba(200,6,80, 0.88)";r = 1;for (i5 = 3; i5 f.length; i5 ++) "COLOR:" == f[i5].substring(0, 6) && 15 == f[i5].length? h = "rgba(" + f[i5].substring(6, 9) + "," + f[i5].substring(9, 12) + "," + f[i5].substring(12, 15) + ",0.88)": "SIZE:" == f[i5].substring(0, 5)? r = f[i5].substring(5): "DASH:" == f[i5].substring(0, 5) && (m = f[i5].substring(5));this.clines.push({x1: b,y1: p,x2: e,y2: q,dash: m,color: h,sizefactor: r})} else if ("LINESTART" == f[0]) {m = 0;h = "rgba(200,6,80";b = 88;for (i5 = r = 1; i5 f.length; i5 ++) "COLOR:" == f[i5].substring(0, 6) && 15 == f[i5].length? h = "rgba(" + f[i5].substring(6, 9) + "," + f[i5].substring(9, 12) + "," + f[i5].substring(12, 15): "SIZE:" == f[i5].substring(0, 5)? r = f[i5].substring(5): "DASH:" == f[i5].substring(0, 5)? m = f[i5].substring(5): "OPACITY:" == f[i5].substring(0, 8) && (b = f[i5].substring(8));h = h + "," + b / 100 + ")";this.lines.push({dash: m, color: h, sizefactor: r, points: []})} else "LINEPOINT" == f[0] && (e = f[1], q = f[2], d || (h = ETRStoWGS(e, q), e = h.x, q = h.y), this.lines[this.lines.length - 1].points.push({x: e, y: q}))}};this.draw = function (a, g) {var d = new Date,b = a._map.getZoom();g.isMML && (b += 3);var p = 1;p = 13b? Math.pow(Math.pow(2, b - 14), .5): 8b? Math.pow(Math.pow(2, b - 14), .125): Math.pow(Math.pow(2, -5), .125);b = g.canvas.getContext("2d");b.clearRect(0, 0, g.canvas.width, g.canvas.height);b.setLineDash || (b.setLineDash = function () {});b.fillStyle = "#88C425";b.strokeStyle = "#88C425";b.lineJoin = "round";for (i = 0; i this.clines.length; i ++) {b.strokeStyle = this.clines[i].color;b.lineWidth = 3 * p * this.clines[i].sizefactor;var e = a._map.latLngToContainerPoint([this.clines[i].y1,this.clines[i].x1]),q = a._map.latLngToContainerPoint([this.clines[i].y2,this.clines[i].x2]);b.beginPath();1 == this.clines[i].dash && b.setLineDash([5]);b.moveTo(e.x, e.y);b.lineTo(q.x, q.y);b.stroke();1 == this.clines[i].dash && b.setLineDash([])}b.globalCompositeOperation = "destination-out";for (i = 0; i this.ctrls.length; i ++) {e = 10 * p * this.ctrls[i].sizefactor;q = Math.round(16 * p * this.ctrls[i].sizefactor);b.font = "bold " + q + "px Arial";var h = a._map.latLngToContainerPoint([this.ctrls[i].y,this.ctrls[i].x]),r = b.measureText(this.ctrls[i].def).width;b.fillRect(h.x + e + 1, h.y - e - 1 - q, r, q);b.lineWidth = 3 * p * this.ctrls[i].sizefactor;b.beginPath();b.arc(h.x, h.y, e, 0, 2 * Math.PI, !1);b.fill()}b.globalCompositeOperation = "source-over";for (i = 0; i this.lines.length; i ++) {h = a._map.latLngToContainerPoint([this.lines[i].points[0].y,this.lines[i].points[0].x]);b.beginPath();b.moveTo(h.x, h.y);for (j = 1; j this.lines[i].points.length; j ++) h = a._map.latLngToContainerPoint([this.lines[i].points[j].y,this.lines[i].points[j].x]),b.lineTo(h.x, h.y);b.strokeStyle = this.lines[i].color;b.lineWidth = 3 * p * this.lines[i].sizefactor;1 == this.lines[i].dash && b.setLineDash([5]);b.stroke();1 == this.lines[i].dash && b.setLineDash([])}for (i = 0; i this.ctrls.length; i ++) b.strokeStyle = this.ctrls[i].color,b.lineWidth = 3 * p * this.ctrls[i].sizefactor,q = a._map.latLngToContainerPoint([this.ctrls[i].y,this.ctrls[i].x]),b.beginPath(),b.arc(q.x, q.y, 10 * p * this.ctrls[i].sizefactor, 0, 2 * Math.PI, !1),b.closePath(),b.stroke();for (i = 0; i this.ctrls.length; i ++) e = 10 * p * this.ctrls[i].sizefactor,q = Math.round(16 * p * this.ctrls[i].sizefactor),b.font = "bold " + q + "px Arial",b.fillStyle = this.ctrls[i].color,q = a._map.latLngToContainerPoint([this.ctrls[i].y,this.ctrls[i].x]),b.fillText(this.ctrls[i].def, q.x + e + 1, q.y - e - 1);console.log((new Date).getTime() - d.getTime() + " ms")}};$(".textbox").val("");var versioninfo = "version 2017-08-21",divHeights = ["calc(100% - 61px)", "calc(100% - 41px)"],iswp = !1,appIsReady = !1,trevent = null,compFullName = "",compOffId,pickCompIdForColor = 0,isCompSelected = !1,tfsmode = !1,replaymode = !0,eventIsLive = !1,continueReplaying = !1,logos = [],logotoshow = 0,ismapvisible = !0,compSettingsWindowVisible = !1,compMenuVisible = null,replaystartrealtime,replayspeed = 10,replaystartracetime,myAnimationReq = null,sliding = !1,myReplayAnimationReq = null,replaying = !1,previousreplaydrawtime = 0,replayfps = 30,replayfpsmobile = 10,mobileinfoupdatefps = 1,previousinfoupdatetime = 0,mapsystem = 0,wgscenterpoint = {x: 0,y: 0},canvasoverlay = null,timeshowdate = !0,contextmenumarker = L.circleMarker([0, 0], 15);contextmenumarker.setStyle({fillColor: "red",fill: !0,fillOpacity: .3,color: "black",weight: 2});var splitcandidate = null,prevsplitpointradius = 30,nsdialog,splitlinecandidate = null,splitlinecandidate2 = null,isdrawingsline = !1,iszooming = !1,iniwidth = 0,iniheight = 0,speedunit = 1,timedifference = 0,isdiffvisible = !1,maxPT,minPT,requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (a) {window.setTimeout(a, 0)},cancelAnimationFrame = window.cancelAnimationFrame || window.webkitCancelRequestAnimationFrame || window.webkitCancelAnimationFrame || window.mozCancelRequestAnimationFrame || window.mozCancelAnimationFrame || window.oCancelRequestAnimationFrame || window.oCancelAnimationFrame || window.msCancelRequestAnimationFrame || window.msCancelAnimationFrame || function (a) {window.clearTimeout(a)},livestartrealtime,livestartlocaltime,previouslivedrawtime = 0,livefps = 10,livefpsmobile = 4,myLiveAnimationReq = null,livelaststarttime = 0,curV = 0,fSpeed = 1E3,multiplier = 1.5,splitsVisible = !1,diffcomp1 = "?",diffcomp2 = "?",diffcomp1nro = -1,diffcomp2nro = -1,mindiff = 0,maxdiff = 10,splitlapval = 1,splitlap1val = 1,splitlap2val = 1;function addOption(a, d, g) {$("#optionsCont").append("<div id=" + a + " class=btnSetting>" + d + "</div>");$("#optionsCont").append("<div class=setAreaID id=" + a + "Area></div>");$("#" + a + "Area").append("<div class=settingArea>" + g + "</div>");$("#" + a + "Area").css("display", "none");addClickFunction(a)}var appModeOptions = '<div id="appModeRadio"><input type="radio" id="appModeDesktopRadio" name="radioAppMode" value="Desktop" checked><label for="appModeDesktopRadio">Desktop</label><input type="radio" id="appModeMobileRadio" name="radioAppMode" value="Mobile"><label for="appModeMobileRadio">Mobile</label></div>',tailOptions = '<div id="tailOnOffRadio"><input type="radio" id="tailOnRadio" name="radioTail" value="On" checked><label for="tailOnRadio">Tail</label><input type="radio" id="tailOffRadio" name="radioTail" value="Off"><label for="tailOffRadio">Route</label></div><div class=tailContHolder> <div class=tailTextCont>Len</div> <div class=tailSetCont> <div class=tailBtnCont> <a class=addbtn id=addbtnH></a><a class=addbtn id=addbtnM></a><a class=addbtn id=addbtnS></a> </div> <div class=tailTbCont> <input type=text class=textboxOptions id=tailBox maxlength=8> </div> <div class=tailBtnCont> <a class=minusbtn id=minusbtnH></a><a class=minusbtn id=minusbtnM></a><a class=minusbtn id=minusbtnS></a> </div> </div> <div class=tailApplyCont><button id=changeTailLength class=tailOkBtn>OK</button></div><div class=tailEndCont><input type=checkbox id=drawtailendcb> draw tail end</div></div>',markerOptions = "<div id=showMS></div><div id=markerSizeSlider></div><div id=showML></div><div id=markerLetSlider></div><div id=showLW></div><div id=lineWidthSlider></div><div id=showLO></div><div id=lineOpacitySlider></div><div id=showMO></div><div id=mapOpacitySlider></div>",rallyOptions = '<div id="rallymodeRadio"><input type="radio" id="rmOnRadio" name="radioRally" value="On" checked><label for="rmOnRadio">On</label><input type="radio" id="rmOffRadio" name="radioRally" value="Off"><label for="rmOffRadio">Off</label></div>',linkOptions = '<a href="?v=j" id="javalink">Java client</a><br><a href="?v=m" id="mobilelink">Old mobile client</a>',gpxuploadOptions = '<a href="#" id="gpxlink" target="_blank">Upload GPX</a><br>(requires login)';addOption("appMode", "App Mode", appModeOptions);addOption("tailSet", "Tail", tailOptions);addOption("markerSet", "Marker, line & map", markerOptions);addOption("infoSet", "Competitor info", '<div id="infoRadios"><input type="radio" id="sinforadio" name="inforadio" value="Show" checked="checked"><label for="sinforadio">Show</label><input type="radio" id="hinforadio" value="Hide" name="inforadio"><label for="hinforadio">Hide</label></div> <div id="unitRadios"><input type="radio" id="kmhradio" name="unitradio" value="kmh" checked="checked"><label for="kmhradio">km/h</label><input type="radio" id="minkmradio" name="unitradio" value="minkm"><label for="minkmradio">min/km</label><input type="radio" id="knotradio" name="unitradio" value="knot"><label for="knotradio">knot</label></div>');addOption("offsetSet", "Offset", '<div class=showSelOffName>Select competitor first</div><div class=showSelOffID></div> <div class=offsetContHolder> <input id=offBox class=textboxSetOff type=text maxlength=8 value=0:00><button id="offokbutton">OK </button></div> <button id="resetOff">Reset all offsets</button>');addOption("debugSet", "Debug", "<div id=fps>fps ?</div><div id=versio>" + versioninfo + "</div>");addOption("rallySet", "Rally mode", rallyOptions);addOption("gpxuploadSet", "GPX upload", gpxuploadOptions);var eventPath2 = new String(document.location),pathArray2 = eventPath2.split("?"),hasversion = !1;if (1pathArray2.length) {var params2 = pathArray2[1];-1params2.indexOf("v=m3") && (hasversion =! 0)}var clienttime = 15;function closecdialog() {$("#cdialog").dialog("close")}function calcclienttime() {$("#cdialog").dialog("isOpen") && (clienttime--, 1 > clienttime? $("#cdialog").dialog("close"): ($("#cdialog").dialog("option", "title", "Switch client (" + clienttime + ")"), setTimeout(function () {calcclienttime()}, 1E3)))}hasversion || calcclienttime();$(document).mouseup(function (a) {if (compSettingsWindowVisible) {var d = $(".compSettingsCont, .competitorSelected, #colorBox");d.is(a.target) || 0 !== d.has(a.target).length || $("#colorBox").hide()}});$(window).resize(function () {! iswp && detectIE() && $("#competitorCont").height(15E3);compSettingsWindowVisible && $("#colorBox").hide()});$("#boxclose").click(function () {$(".compSettingsCont").hide();$("#colorBox").hide();hideCompMenu();compSettingsWindowVisible = !1});function hideCompMenu() {null != compMenuVisible && (compMenuVisible.hide(), compMenuVisible.parent().height(compMenuVisible.parent().height() - ("desktop" == appMode? 70: 90)), compMenuVisible = null)}$("#hideStatusBox").click(function () {$(this).hasClass("hideStatusBox")? $(this).addClass("showStatusBox").removeClass("hideStatusBox"): $(this).addClass("hideStatusBox").removeClass("showStatusBox");$("#btnMassStart").toggle();eventIsLive && $("#liveStatus").toggle();$("#scalebox").toggle()});function redrawMap() {iszooming || trevent.drawL(map, mapHeight, ismapvisible);updatedifference()}function updatedifference() {if (null != trevent && isdiffvisible) {trevent.calcdifference(diffcomp1nro, diffcomp2nro, 60 * mindiff, 60 * maxdiff);var a = "???";0trevent.difference && (a = "<strong>+" + trevent.showtimestring2(trevent.difference) + "</strong>");tfsmode || trevent.tracks[diffcomp1nro].starttime == trevent.tracks[diffcomp2nro].starttime || (a += '<span class="smallerdiff"> (\u25b7 ' + trevent.showtimestring2b(trevent.tracks[diffcomp2nro].starttime - trevent.tracks[diffcomp1nro].starttime) + ")</span>");$(".btnOffsetReset").html(diffcomp1 + "<br>" + a + "<br>" + diffcomp2)}}function timeslided(a) {null != trevent && trevent.setTimeToDraw($("#timeSlider").slider("option", "value")) && (redrawMap(), updateTime(), "desktop" == appMode && trevent.updatenamelist(speedunit, "desktop" != appMode));sliding && (myAnimationReq = requestAnimationFrame(timeslided))}function timesliderstopped() {null != trevent && trevent.setTimeToDraw($("#timeSlider").slider("option", "value")) && (redrawMap(), updateTime(), "desktop" == appMode && trevent.updatenamelist(speedunit, "desktop" != appMode))}$("#timeSlider").slider({min: 0,max: 0,value: 0,range: "min",start: function (a, d) {console.log("slide start");replaying && (replaying =! 1, window.cancelAnimationFrame(myReplayAnimationReq), $("#btnPlay").addClass("paused").removeClass("playing"), continueReplaying =! 0);myAnimationReq = requestAnimationFrame(timeslided);sliding = !0},stop: function (a, d) {console.log("slide stop");window.cancelAnimationFrame(myAnimationReq);sliding = !1;timesliderstopped();continueReplaying && (replaying =! 0, continueReplaying =! 1, replaystartrealtime = new Date, replaystartracetime = trevent.timetodraw, myReplayAnimationReq = requestAnimationFrame(replaytimer), $("#btnPlay").addClass("playing").removeClass("paused"))}});$("#speed-select, #speed-selectMob").change(function () {replaying && (replaystartrealtime = new Date, replaystartracetime = trevent.timetodraw);replayspeed = this.value});function setTimeDifference() {timedifference = trevent.getTimeDifference()}function updateTime() {$("#curTime").text(trevent.getCurrentTimeString());timeshowdate && $("#curDate").text(trevent.getCurrentDateString())}function replaytimer(a) {if (replaying) if (a =( new Date).getTime(), a - previousreplaydrawtime > 1E3 / ("desktop" == appMode? replayfps: replayfpsmobile)) {var d = (a - replaystartrealtime.getTime()) / 1E3;d = replaystartracetime + d * replayspeed;updateTime();null != trevent && dmaxPT && (trevent.setTimeToDraw(d) && (redrawMap(), "desktop" == appMode || $("#compMenu").is(":visible") && a - previousinfoupdatetime > 1E3 / mobileinfoupdatefps) && (trevent.updatenamelist(speedunit, "desktop" != appMode), previousinfoupdatetime = a), $("#timeSlider").slider("option", "value", d));previousreplaydrawtime = a;replaying && (dmaxPT? myReplayAnimationReq = requestAnimationFrame(replaytimer): (replaying =! 1, resetPlayBtn()))} else replaying && (myReplayAnimationReq = requestAnimationFrame(replaytimer))}function livetimer(a) {a = (new Date).getTime();if (a - previouslivedrawtime > 1E3 / ("desktop" == appMode? livefps: livefpsmobile)) {var d = livestartrealtime + (a / 1E3 - livestartlocaltime) - trevent.livebuffer;tfsmode && (d -= livelaststarttime);updateTime();trevent.setTimeToDraw(d) && (redrawMap(), "desktop" == appMode || $("#compMenu").is(":visible") && a - previousinfoupdatetime > 1E3 / mobileinfoupdatefps) && (trevent.updatenamelist(speedunit, "desktop" != appMode), previousinfoupdatetime = a);previouslivedrawtime = a}myLiveAnimationReq = requestAnimationFrame(livetimer)}function updatelivefromstarttime() {livelaststarttime = trevent.getlaststarttime()}$("#markerLetSlider").slider({min: 6,max: 30,value: 16,range: "min",slide: function (a, d) {m_val = d.value;$("#showML").text("Letters: " + m_val + " px");null != trevent && (trevent.setLetterSize(m_val), redrawMap())}});$("#markerSizeSlider").slider({min: 2,max: 30,value: 10,range: "min",slide: function (a, d) {s_val = d.value;$("#showMS").text("Marker size: " + s_val + " px");null != trevent && (trevent.setMarkerSize(s_val), redrawMap())}});$("#lineWidthSlider").slider({min: 2,max: 10,value: 4,range: "min",slide: function (a, d) {lw_val = d.value;$("#showLW").text("Line width: " + lw_val + " px");null != trevent && (trevent.setLineWidth(lw_val), redrawMap())}});$("#lineOpacitySlider").slider({min: 0,max: 100,value: 80,range: "min",slide: function (a, d) {lo_val = d.value;$("#showLO").text("Line opacity: " + lo_val + " %");null != trevent && (trevent.setLineOpacity(lo_val / 100), redrawMap())}});$("#mapOpacitySlider").slider({min: 0,max: 100,value: 100,range: "min",slide: function (a, d) {mo_val = d.value;$("#showMO").text("Map opacity: " + mo_val + " %");null != trevent && (null != osmOverlay? osmOverlay.setOpacity(mo_val / 100): mapLoverlay.setOpacity(mo_val / 100))}});function showMS() {var a = $("#markerSizeSlider").slider("value");$("#showMS").html("Marker size: " + a + " px")}showMS();function showML() {var a = $("#markerLetSlider").slider("value");$("#showML").html("Letters: " + a + " px")}showML();function showLW() {var a = $("#lineWidthSlider").slider("value");$("#showLW").html("Line width: " + a + " px")}showLW();function showLO() {var a = $("#lineOpacitySlider").slider("value");$("#showLO").html("Line opacity: " + a + " %")}showLO();function showMO() {var a = $("#mapOpacitySlider").slider("value");$("#showMO").html("Map opacity: " + a + " %")}showMO();$("#showMS").css({"margin-bottom": "4px"});$("#showML").css({"margin-bottom": "4px"});$("#showLW").css({"margin-bottom": "4px"});$("#showLO").css({"margin-bottom": "4px"});$("#showMO").css({"margin-bottom": "4px"});"desktop" == appMode? ($("#appModeDesktopRadio").prop("checked", !0), $("#btnShowMenu").addClass("hideMenu")): ($("#appModeMobileRadio").prop("checked", !0), $("#btnShowMenu").addClass("showMenu"), setTimeout(function () {map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()}, 1E3));"" == compFullName && ($(".offsetContHolder").hide(), $("#resetOff").hide());$("#picker").colpick({flat: !0,layout: "hex",onSubmit: function (a, d, g, f) {compColArray[pickCompIdForColor] = "#" + d;$("#ccol" + pickCompIdForColor).css("background-color", compColArray[pickCompIdForColor]);$("#compID" + pickCompIdForColor).find(".checkboxFour label").css("background-color", "#" + d);trevent.setColor(pickCompIdForColor, "#" + d);redrawMap();$("#colorBox").hide(0, function () {})}});$(function () {$("#resetOff").button().click(function (a) {resetAllOffset()})});$(function () {$("#calcSectorButton").button().click(function (a) {calcsectortimes()})});$("#offBox").bind("enterKey", function (a) {setOff()});$("#offBox").keyup(function (a) {13 == a.keyCode && $(this).trigger("enterKey")});$(function () {$("#offokbutton").button().click(function (a) {setOff()})});function setOff() {var a = /^([-]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9])$/,d = $(".showSelOffID").text().replace(/^\D+/g, "");if (/^([-]?[0-9]?[0-9]?[0-9]?[:]?[0-5]?[0-9])$|^([-]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9])$/.test($("#offBox").val())) {if (a.test($("#offBox").val())) curV = $("#offBox").val(),trevent.setOffset(d, curV); else {curV = $("#offBox").val();var g = curV.split(":");a = "-" == g[0].charAt(0);var f = Number(g[0]);g = Number(g[1]);curV = 0 == f && a? -1 * g: 0 > f? 60 * f - g: 60 * f + g;trevent.setOffset(d, curV);redrawMap();trevent.updatenamelist(speedunit, "desktop" != appMode)}updateOffsetStuff()} else $("#offBox").val(curV);updateOffBox()}function resetAllOffset() {$("#offBox").val("0:00");var a = 0;$(".compName").each(function () {$(this).css("color", "black");$("#cst" + a).css("color", "black");a += 1});trevent.resetAllOffsets();redrawMap();trevent.updatenamelist(speedunit, "desktop" != appMode);updateOffsetStuff()}function updateOffBox() {console.log(curV);if (0 <= curV) {var a = Math.floor(curV / 60),d = Math.floor(curV - 60 * a);$("#offBox").val(a + ":" + pad(d))} else a = Math.floor(- curV / 60),d = Math.floor(- curV - 60 * a),$("#offBox").val("-" + a + ":" + pad(d))}function updateOffsetStuff() {trevent.updatenamelist(speedunit, "desktop" != appMode);var a = 0,d = !1;$(".compName").each(function () {0 != trevent.getOffset(a)? ($(this).css("color", "red"), d =! 0): $(this).css("color", "black");a += 1});d? map.contextmenu.setDisabled(3, !1): map.contextmenu.setDisabled(3, !0)}var tailLength = 60,tailHour = 0,tailMin = 1,tailSec = 0,canIUpdate = !1;$("#tailBox").bind("enterKey", function (a) {canIUpdate = !0;setTail()});$("#tailBox").keyup(function (a) {13 == a.keyCode && $(this).trigger("enterKey")});$("#tailBox").focusout(function (a) {canIUpdate = !0});$("#drawtailendcb").change(function () {trevent.setDrawTailEnd($("#drawtailendcb").is(":checked"));redrawMap()});$(document).mouseup(function (a) {var d = $("#tailBox, #changeTailLength");d.is(a.target) || 0 !== d.has(a.target).length || canIUpdate && updateTailBox()});$("#changeTailLength").button().on("click", function () {canIUpdate = !0;setTail()});function setTail() {var a = /^\d+$/,d = /^[0-9]?[0-9][:][0-9]?[0-9]([:][0-9]?[0-9])?$/;if (/^(([1-9]?([0-9]){1,5}))$|^(([0-9]?[0-9])[:]([0-5]?[0-9])([:][0-5]?[0-9]))$|^([0-9]?[0-9][:][0-5]?[0-9])$/.test($("#tailBox").val())) {var g = $("#tailBox").val();a.test(g)? (tailLength = Number(g), 0g? (tailHour = Math.floor(g / 60 / 60), tailMin = Math.floor((g - 3600 * tailHour) / 60), tailSec = Math.floor(g - 3600 * tailHour - 60 * tailMin)): (tailHour = Math.ceil(g / 60 / 60), tailMin = Math.floor((Math.abs(g) - 3600 * Math.abs(tailHour)) / 60), tailSec = Math.floor(Math.abs(g) - 3600 * Math.abs(tailHour) - 60 * tailMin))): d.test(g) && (a = g.split(":"), 2 >= a.length? (tailHour = 0, tailMin = Number(a[0]), tailSec = Number(a[1]), tailLength = "-" == a[0].charAt(0)? -(60 * tailMin + tailSec): 60 * tailMin + tailSec): (tailHour = Number(a[0]), tailMin = Number(a[1]), tailSec = Number(a[2]), tailLength = "-" == a[0].charAt(0)? -(3600 * tailHour + 60 * tailMin + tailSec): 3600 * tailHour + 60 * tailMin + tailSec));trevent.setTailLength(tailLength);redrawMap()} else window.alert("Invalid value.");updateTailBox()}function updateTailBox() {var a = Math.floor(tailLength / 60 / 60),d = Math.floor((tailLength - 3600 * a) / 60),g = Math.floor(tailLength - 3600 * a - 60 * d);0 == a? $("#tailBox").val(d + ":" + pad(g)): $("#tailBox").val(a + ":" + pad(d) + ":" + pad(g));canIUpdate = !1}function updateTailBox2(a) {tailLength = a;updateTailBox()}function addTailLength(a) {tailLength += a;0 > tailLength && (tailLength = 0);359999tailLength && (tailLength = 359999)}$("#addbtnS").click(function () {addTailLength(1);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});$("#addbtnM").click(function () {addTailLength(60);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});$("#addbtnH").click(function () {addTailLength(3600);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});$("#minusbtnH").click(function () {addTailLength(-3600);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});function pad(a) {return 10 > a? "0" + a: a}$("#minusbtnS").click(function () {addTailLength(-1);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});$("#minusbtnM").click(function () {addTailLength(-60);updateTailBox();trevent.setTailLength(tailLength);redrawMap()});$("#sectorroutescb").change(function () {null != trevent && trevent.setsectormode($("#sectorroutescb").prop("checked"), map);map.closePopup();$("#sectorcolorcb").prop("disabled", !$("#sectorroutescb").prop("checked"));redrawMap()});$("#sectorcolorcb").change(function () {null != trevent && trevent.setsectorcolormode($("#sectorcolorcb").prop("checked"), map);map.closePopup();redrawMap()});$("#liveStatus").click(function () {appIsReady && eventIsLive && ($("#liveStatus").hasClass("liveMode")? (replaymode =! 0, $("#liveStatus").addClass("replayMode").removeClass("liveMode"), $("#text").html('<span class="smallertext">LIVE</span>&nbsp;&nbsp;<span class="boldertext">REPLAY</span>'), $("#ball").css("background-color", "red"), map.contextmenu.setDisabled(2, !1)): (replaymode =! 1, map.contextmenu.setDisabled(2, !0), $("#liveStatus").addClass("liveMode").removeClass("replayMode"), $("#text").html('<span class="boldertext">LIVE</span>&nbsp;&nbsp;<span class="smallertext">REPLAY</span>'), $("#ball").css("background-color", "green")),replaymodechanged())});function replaymodechanged() {trevent.setreplaymode(replaymode);if (replaymode) {window.cancelAnimationFrame(myLiveAnimationReq);var a = trevent.getReplayMinTime(),d = trevent.getReplayMaxTime();da && (d = a);$("#timeSlider").slider("option", "max", d);$("#timeSlider").slider("option", "min", a);trevent.timetodraw a && trevent.setTimeToDraw(a);trevent.timetodraw > d && trevent.setTimeToDraw(d);$("#timeSlider").slider("option", "value", trevent.timetodraw);updateTime();redrawMap();trevent.updatenamelist(speedunit, "desktop" != appMode)} else sliding = replaying = !1,window.cancelAnimationFrame(myReplayAnimationReq),window.cancelAnimationFrame(myAnimationReq),myLiveAnimationReq = requestAnimationFrame(livetimer),$("#btnPlay").addClass("paused").removeClass("playing");uiLiveReplay(! replaymode, !1)}$("#btnShowSetMenu").click(function () {$("#btnShowSetMenu").hide();$("#btnShowSetMenu").hasClass("showSetMenu")? ($("#btnShowSetMenu").addClass("hideSetMenu").removeClass("showSetMenu"), $("#statusBox").css("right", "190px"), $("#btnShowSetMenu").css("right", "180px"), $("#settingsMenu").toggle("fast", "linear", function () {$("#btnShowSetMenu").show();map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()}), 1 == $("#setMenuTabs").tabs("option", "active") && (splitsVisible =! 0, updateSplits())): ($("#settingsMenu").toggle("fast", "linear", function () {$("#btnShowSetMenu").show();map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()}), $("#btnShowSetMenu").addClass("showSetMenu").removeClass("hideSetMenu"), $("#btnShowSetMenu").css("right", "0px"), $("#statusBox").css("right", "10px"), splitsVisible =! 1);console.log(map.getSize().x)});$(function () {$("#infoRadios").buttonset()});$("#infoRadios input[type=radio]").change(function () {hideCompMenu();$(".compData").toggle();"Show" == this.value? "desktop" == appMode? changeUI("30px", "30px", "1px", "30px", "6px"): changeUI("39px", "39px", "1px", "39px", "7px"): "desktop" == appMode? changeUI("24px", "24px", "3px", "24px", "3px"): changeUI("28px", "28px", "4px", "28px", "3px")});function changeUI(a, d, g, f, b) {$(".competitor").css({height: a});$(".competitorSelected").css({height: d});$(".compName").css({"margin-top": g});$(".compSelect").css("height", f);$(".checkboxFour").css("margin-top", b)}$("#btnShowMenu").click(function () {"desktop" == appMode? ($("#btnShowMenu").hide(), $("#menu").toggle("fast", "linear", function () {$("#btnShowMenu").hasClass("showMenu")? ($("#btnShowMenu").addClass("hideMenu").removeClass("showMenu"), "desktop" == appMode && $("#btnShowMenu").css("left", "230px")): ($("#btnShowMenu").addClass("showMenu").removeClass("hideMenu"), "desktop" == appMode && $("#btnShowMenu").css("left", "0px"));$("#btnShowMenu").show();map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw();console.log(map.getSize().x)})): ($("#menuBtnContainerMobile").hasClass("showMobileMenu")? ($("#menuBtnContainerMobile").hide(), $("#menu, #settingsMenu").hide(), $("#statusBox").show(), splitsVisible =! 1, playerStatus(), $("#menuBtnContainerMobile").removeClass("showMobileMenu"), $("#btnShowMenu").addClass("showMenu").removeClass("hideMenu"), ismapvisible =! 0, mapbecamevisible()): $("#btnShowMenu").hasClass("showMenu")? ($("#btnShowMenu").hide(), $("#btnShowMenu").css("top", "130px"), $("#menuBtnContainerMobile").slideDown(400, function () {$("#btnShowMenu").show()}), $("#btnShowMenu").addClass("hideMenu").removeClass("showMenu")): ($("#menuBtnContainerMobile").hide(), $("#btnShowMenu").addClass("showMenu").removeClass("hideMenu"), $("#btnShowMenu").css("top", "0px")),map.invalidateSize(!1),null != canvasoverlay && canvasoverlay.redraw())});$("#btnShowPlayer").click(function () {$("#player").toggle(0, "linear", function () {$("#btnShowPlayer").hasClass("hidePlayer")? ($("#btnShowPlayer").addClass("showPlayer").removeClass("hidePlayer"), $("#btnShowPlayer").css("bottom", "0px"), $("#map").css("height", "100%")): ($("#btnShowPlayer").addClass("hidePlayer").removeClass("showPlayer"), $("#btnShowPlayer").css("bottom", "61px"), $("#map").css("height", divHeights[0]));map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()})});function playerStatus() {replaymode && ($("#btnShowPlayer").show(), $("#btnShowPlayer").hasClass("hidePlayer")? ($("#player").show(), $("#btnShowPlayer").css("bottom", "61px"), $("#map").css("height", divHeights[0])): ($("#player").hide(), $("#btnShowPlayer").css("bottom", "0px")),map.invalidateSize(!1),null != canvasoverlay && canvasoverlay.redraw())}$("#btnOptions, #btnList").click(function () {var a = this.id;$(this).hasClass("btnNotSelected") && ($(this).addClass("btnSelected").removeClass("btnNotSelected"), "btnList" == a? ($("#btnList").hide(), $("#btnOptions").show(), $("#btnOptions").addClass("btnNotSelected").removeClass("btnSelected")): ($("#btnOptions").hide(), $("#btnList").show(), $("#btnList").addClass("btnNotSelected").removeClass("btnSelected")),$("#compMenu").toggle(0, "linear", function () {}),$("#optionsMenu").toggle(0, "linear", function () {}))});$("#listoptionsButton").click(function () {$(this).hasClass("fa-wrench")? $(this).addClass("fa-list-ul").removeClass("fa-wrench"): $(this).addClass("fa-wrench").removeClass("fa-list-ul");$("#compMenu").toggle(0, "linear", function () {});$("#optionsMenu").toggle(0, "linear", function () {})});$("#btnOptionsMobile, #btnListMobile, #btnSettingsMobile").click(function () {var a = this.id;$("#menuBtnContainerMobile").hide();$("#btnShowMenu").css("top", "0px");$("#btnShowPlayer").hide();$("#player").hide();$("#menuBtnContainerMobile").addClass("showMobileMenu");ismapvisible = !1;"btnListMobile" == a? ($("#menu").show(), $("#statusBox").hide(), $("#optionsMenu").hide(0, "linear", function () {}), $("#compMenu").show(0, "linear", function () {}), trevent.updatenamelist(speedunit, "desktop" != appMode)): "btnOptionsMobile" == a? ($("#menu").show(), $("#statusBox").hide(), $("#compMenu").hide(0, "linear", function () {}), $("#optionsMenu").show(0, "linear", function () {})): ($("#settingsMenu").show(), $("#statusBox").hide(), 1 == $("#setMenuTabs").tabs("option", "active") && (splitsVisible =! 0, updateSplits()))});$("#btnPlay, #btnPlayMob").click(function () {maxPT = $("#timeSlider").slider("option", "max");minPT = $("#timeSlider").slider("option", "min");$(this).hasClass("paused")? ($(this).addClass("playing").removeClass("paused"), replaystartrealtime = new Date, replaystartracetime = trevent.timetodraw, replaying =! 0, myReplayAnimationReq = requestAnimationFrame(replaytimer)): ($(this).addClass("paused").removeClass("playing"), replaying =! 1, window.cancelAnimationFrame(myReplayAnimationReq))});function resetPlayBtn() {$("#btnPlay, #btnPlayMob").addClass("paused").removeClass("playing")}function tfsmodechanged() {trevent.setTFSmode(tfsmode);updatelivefromstarttime();var a = trevent.getReplayMinTime(),d = trevent.getReplayMaxTime();da && (d = a);$("#timeSlider").slider("option", "max", d);$("#timeSlider").slider("option", "min", a);$("#timeSlider").slider("option", "value", a);replaymode && trevent.setTimeToDraw(a) && (redrawMap(), updateTime(), trevent.updatenamelist(speedunit, "desktop" != appMode))}$("#btnMassStart").click(function () {appIsReady && ($(this).hasClass("btnMSoff")? (tfsmode =! 0, $("#btnMassStart").addClass("btnMSon").removeClass("btnMSoff"), $("#btnMassStartText").html('<span class="smallertext">REAL</span>&nbsp;&nbsp;&nbsp;<span class="boldertext">SYNC</span>')): (tfsmode =! 1, $("#btnMassStart").addClass("btnMSoff").removeClass("btnMSon"), $("#btnMassStartText").html('<span class="boldertext">REAL</span>&nbsp;&nbsp;&nbsp;<span class="smallertext">SYNC</span>')),replaying && (replaying =! 1, window.cancelAnimationFrame(myReplayAnimationReq), resetPlayBtn()),tfsmodechanged())});$("#btnCheckAll").click(function () {$(this).hasClass("fa-circle")? ($(this).addClass("fa-check").removeClass("fa-circle"), $("#btnClear").is(":visible")? ($("#competitorCont input:checkbox").prop("checked", !0), trevent.checkNone(map, ismapvisible), $(".competitor:visible, .competitorSelected:visible").each(function () {var a = $(this).attr("id").replace(/^\D+/g, "");$(this).find("input:checkbox").prop("checked", !1);trevent.toggleCheck(a, map, ismapvisible)})): ($("#competitorCont input:checkbox").prop("checked", !1), trevent.checkAll(map, ismapvisible))): ($(this).addClass("fa-circle").removeClass("fa-check"), $("#competitorCont input:checkbox").prop("checked", !0), trevent.checkNone(map, ismapvisible));eventIsLive && updatelivefromstarttime();splitsVisible && updateSplits();redrawMap()});$("#btnSel").click(function () {if ("-> Sel." == $("#btnSel").text()) {$("#competitorCont input:checkbox").prop("checked", !0);var a = $(".competitor").length;if (isCompSelected) for (var d = 0; da + 1; d++) {if ($("#compID" + d).hasClass("competitorSelected")) {isCompSelected = !0;for (var g = 0; g <= d; g++) $("#c" + g).prop("checked", !1);trevent.checkUntil(d, map, ismapvisible);eventIsLive && updatelivefromstarttime()}} else trevent.checkNone(map, ismapvisible)} else $("#competitorCont input:checkbox").prop("checked", !0),trevent.checkNone(map, ismapvisible),$(".competitor:visible, .competitorSelected:visible").each(function () {var a = $(this).attr("id").replace(/^\D+/g, "");$(this).find("input:checkbox").prop("checked", !1);trevent.toggleCheck(a, map, ismapvisible)}),eventIsLive && updatelivefromstarttime();redrawMap()});var textFlag = !1;$(".textbox").on("input", function () {var a = "",d = "",g = $(this).val();0 == textFlag && ($("#btnClear").show(), textFlag =! 0);if ("" == g) $("#btnClear").hide(),$(".competitor, .competitorSelected").each(function () {$(this).show()}),textFlag = !1; else {g = escapeRegExp(g);var f = new RegExp(g, "i");$(".competitor, .competitorSelected").each(function () {var b = $(this).attr("id").replace(/^\D+/g, "");a = $("#" + b).text();d = $("#compLetters" + b).text();f.test(a) || f.test(d)? $(this).show(): $(this).hide()})}});function escapeRegExp(a) {return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&")}$("#btnClear").click(function () {$(".textbox").val("");$(".competitor, .competitorSelected").each(function () {$(this).show()});$("#btnClear").hide();$(".textbox").css("width", "180px");$(".textbox").css("border-top-right-radius", "6px");$(".textbox").css("border-bottom-right-radius", "6px");textFlag = !1});$(function () {$("#appModeRadio").buttonset()});$("#appModeRadio input[type=radio]").change(function () {hideCompMenu();"Mobile" == this.value? (document.cookie = "gpsAppMode=mobile", appMode = "mobile", replaymode? ($("#player").show(), $("#map").css("height", divHeights[0]), $("#menu").css("height", "100%"), $("#btnShowPlayer").addClass("hidePlayer").removeClass("showPlayer"), $("#btnShowPlayer").show(), $("#btnShowPlayer").css("bottom", "61px")): $("#btnShowPlayer").hide(),$("#btnShowMenu").css("left", "50%"),$("#btnShowMenu").css("top", "0px"),$("#cssMode").attr("href", cdnpath + "css/mobile.css"),$("#btnShowMenu").hasClass("hideMenu") && ($("#menu").hide(), $("#btnShowMenu").addClass("showMenu").removeClass("hideMenu")),$("#btnShowSetMenu").hasClass("hideSetMenu") && ($("#settingsMenu").hide(), $("#btnShowSetMenu").addClass("showSetMenu").removeClass("hideSetMenu"), $("#btnShowSetMenu").css("right", "0px"), $("#statusBox").css("right", "20px")),"Show" == $("#infoRadios :radio:checked").val()? changeUI("39px", "39px", "1px", "39px", "7px"): changeUI("28px", "28px", "4px", "28px", "3px")): ($("#menuBtnContainerMobile").removeClass("showMobileMenu"), document.cookie = "gpsAppMode=desktop", appMode = "desktop", $("#statusBox").show(), replaymode && ($("#player").show(), $("#map, #menu").css("height", divHeights[1])), $("#btnShowMenu").css("top", "50%"), $("#btnShowMenu").css("left", "230px"), $("#cssMode").attr("href", cdnpath + "css/style.css"), ismapvisible =! 0, mapbecamevisible(), "Show" == $("#infoRadios :radio:checked").val()? changeUI("30px", "30px", "1px", "30px", "6px"): changeUI("24px", "24px", "3px", "24px", "3px"));0logos.length && changelogo(!1);map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw();setTimeout(function () {map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()}, 1E3);splitsVisible = !1;initTooltip()});var tailLengthBU = 0;$(function () {$("#rallymodeRadio").buttonset()});$("#rallymodeRadio input[type=radio]").change(function () {"Off" == this.value? trevent.setRallymode(!1): trevent.setRallymode(!0);redrawMap()});$(function () {$("#tailOnOffRadio").buttonset()});$("#tailOnOffRadio input[type=radio]").change(function () {"Off" == this.value? (document.getElementById("tailBox").disabled =! 0, $("#tailBox").val("0:00"), tailLengthBU = tailLength, tailLength = 1E10): (document.getElementById("tailBox").disabled =! 1, tailLength = tailLengthBU, updateTailBox());toggleTailButtons();trevent.setTailLength(tailLength);redrawMap()});$(function () {$("#showDifferenceRadio").buttonset()});$("#showDifferenceRadio input[type=radio]").change(function () {"dion" == this.value? ($(".btnOffsetReset").show(), isdiffvisible =! 0, updatedifference()): ($(".btnOffsetReset").hide(), isdiffvisible =! 1)});$(function () {var a = $("#mindiffspinner").spinner({min: 0,max: 1E5,change: function (a, d) {mindiff = $("#mindiffspinner").val();updatedifference()},spin: function (a, d) {mindiff = d.value;updatedifference()}}),d = $("#maxdiffspinner").spinner({min: 0,max: 1E5,change: function (a, d) {maxdiff = $("#maxdiffspinner").val();updatedifference()},spin: function (a, d) {maxdiff = d.value;updatedifference()}});a.spinner("value", 0);d.spinner("value", 10)});$(function () {$("#lapselspinner").spinner({min: 1,max: 1E3,change: function (a, d) {splitlapval = $("#lapselspinner").val();updateSplits()},spin: function (a, d) {splitlapval = d.value;updateSplits()}}).spinner("value", 1)});$(function () {$("#lap1selspinner").spinner({min: 1,max: 1E3,change: function (a, d) {splitlap1val = $("#lap1selspinner").val()},spin: function (a, d) {splitlap1val = d.value}}).spinner("value", 1)});$(function () {$("#lap2selspinner").spinner({min: 1,max: 1E3,change: function (a, d) {splitlap2val = $("#lap2selspinner").val()},spin: function (a, d) {splitlap2val = d.value}}).spinner("value", 1)});function toggleTailButtons() {$(".tailContHolder").toggle()}function addClickFunction(a) {$("#" + a).click(function () {$("#" + this.id + "Area").slideToggle("fast", "linear", function () {});$(this).hasClass("btnSetting")? $(this).addClass("btnSettingOpen").removeClass("btnSetting"): $(this).addClass("btnSetting").removeClass("btnSettingOpen")})}$("#exAll").click(function () {$(".setAreaID").each(function () {$(this).show("slide", {direction: "up"}, 400, function () {});$(".btnSetting").addClass("btnSettingOpen").removeClass("btnSetting")})});$("#colAll").click(function () {$(".setAreaID").each(function () {$(this).hide("slide", {direction: "up"}, 400, function () {});$(".btnSettingOpen").addClass("btnSetting").removeClass("btnSettingOpen")})});$("#helpBtn, #helpboxclose").click(function () {$("#helpBox").toggle(0, function () {})});var colo = "";$("#colorboxclose").click(function () {$("#colorBox").toggle(0, function () {})});function hexc(a) {a = a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);delete a[0];for (var d = 1; 3 >= d; ++ d) a[d] = parseInt(a[d]).toString(16),1 == a[d].length && (a[d] = "0" + a[d]);colo = a.join("")}$(function () {$("#unitRadios").buttonset()});$("#unitRadios input[type=radio]").change(function () {"kmh" == this.value? speedunit = 1: "minkm" == this.value? speedunit = 2: "knot" == this.value && (speedunit = 3);trevent.updatenamelist(speedunit, "desktop" != appMode)});$("#chooseSpointselect").change(function () {checkandhidelaps();updateSplits();updateSplitIgnore()});$("#deleteSpointbutton").button().on("click", function () {trevent.removesplitpoint($("#chooseSpointselect").val(), splitlgroup);$("#splitlinesettings").slideToggle("fast", "linear", function () {});$("#splitsettingscb").button("option", "icons", {primary: "ui-icon-carat-1-s"});$("#chooseSpointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseSpointselect option:last").attr("selected", "selected");$("#chooseS1pointselect ").html(trevent.getsplitpointlist(!1, !0));$("#chooseS1pointselect option:first").attr("selected", "selected");$("#chooseS2pointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseS2pointselect option:last").attr("selected", "selected");checkandhidelaps();1 > $("#chooseSpointselect option").length? $("#splitsettingscb").button("option", "disabled", !0): updateSplitIgnore();updateSplits()});function checkandhidelaps() {null != trevent && (trevent.isline($("#chooseSpointselect").val())? $("#lapselspan").show(): $("#lapselspan").hide())}function updateSplits() {if (null != trevent) {var a = 1 * splitlapval;$("#splitlist").html(trevent.calcsplitpointtimes($("#chooseSpointselect").val(), mapHeight, "start" == $("input[name=radio2]:checked").val(), "diff" == $("input[name=radio3]:checked").val(), "let" == $("input[name=radio4]:checked").val(), "checked" == $("input[name=radio5]:checked").val(), a - 1))}}function updateRog() {$("#roglist").html(trevent.calcrog())}function enablerog() {$("#setMenuTabs").tabs("enable", 4)}function calcsectortimes() {if (null != trevent) {var a = 1 * splitlap1val,d = 1 * splitlap2val,g = new Date;$("#sectorlist").html(trevent.calcsectortimes($("#chooseS1pointselect").val() - 1, $("#chooseS2pointselect").val(), a - 1, d - 1, mapHeight, "diff" == $("input[name=radio3]:checked").val(), "let" == $("input[name=radio4]:checked").val(), "checked" == $("input[name=radio5]:checked").val()));console.log("sector took " + (new Date - g) + " ms");$(".sectornamebase").click(function () {if ($(this).hasClass("hlsectorname")) $(this).addClass("sectorname").removeClass("hlsectorname"),trevent.sectorhl = -1; else {$(".hlsectorname").addClass("sectorname").removeClass("hlsectorname");$(this).addClass("hlsectorname").removeClass("sectorname");var a = Number($(this).attr("id").substring(4));trevent.sectorhl = a}map.closePopup();redrawMap()});map.closePopup();trevent.reorderPaths(map);redrawMap()}}function updateSplitIgnore() {var a = trevent.getsplitsettingRT($("#chooseSpointselect").val());-1 == a? $("#igRTlabel").text("(not set)"): $("#igRTlabel").text(a.replace("T", " ").replace(".000Z", ""));a = trevent.getsplitsettingTFS($("#chooseSpointselect").val());-1 == a? $("#igTFSlabel").text("(not set)"): $("#igTFSlabel").text(a)}$(function () {$("#splitsettingscb").button({icons: {primary: "ui-icon-carat-1-s"},text: !1,disabled: !0}).click(function (a) {$("#splitlinesettings").slideToggle("fast", "linear", function () {});this.checked? $(this).button("option", "icons", {primary: "ui-icon-carat-1-s"}): $(this).button("option", "icons", {primary: "ui-icon-carat-1-n"})})});$(function () {$("#showHideLinesRadio").buttonset()});$("#showHideLinesRadio input[type=radio]").change(function () {null != trevent && trevent.showhidelines("show" == this.value, splitlgroup)});$(function () {$("#timeToUseRadio").buttonset()});$("#timeToUseRadio input[type=radio]").change(function () {console.log(this.value)});$(function () {$("#showDiffTimeRadio").buttonset()});$("#showDiffTimeRadio input[type=radio]").change(function () {console.log(this.value)});$(function () {$("#showLetNamesRadio").buttonset()});$("#showLetNamesRadio input[type=radio]").change(function () {console.log(this.value)});$(function () {$("#showAllCheckRadio").buttonset()});$("#showAllCheckRadio input[type=radio]").change(function () {console.log(this.value)});$("#decFontSize").button({icons: {primary: "ui-icon-minusthick"},text: !1}).click(function (a) {$("#fontSizeSpan").button("option", "label", 1 * $("#fontSizeSpan").button("option", "label") - 1);a = $("#fontSizeSpan").button("option", "label");$("#splitlist").css({fontSize: a});$("#sectorlist").css({fontSize: a})});$("#incFontSize").button({icons: {primary: "ui-icon-plusthick"},text: !1}).click(function (a) {$("#fontSizeSpan").button("option", "label", 1 * $("#fontSizeSpan").button("option", "label") + 1);a = $("#fontSizeSpan").button("option", "label");$("#splitlist").css({fontSize: a});$("#sectorlist").css({fontSize: a})});$("#fontSizeSpan").button({disabled: !0});$(function () {$("#fontSizeButtons").buttonset()});$(function () {function a(a) {m.text(a).addClass("ui-state-highlight");setTimeout(function () {m.removeClass("ui-state-highlight", 1500)}, 500)}function d(b, d, e) {if (d.test(b.val())) return !0;b.addClass("ui-state-error");a(e);return !1}function g() {var a = !0;r.removeClass("ui-state-error");q.prop("checked") && (a = a && d(p, f, "YYYY-MM-DD HH:MM:SS"));h.prop("checked") && (a = a && d(e, b, "HHH:MM:SS"));a && (trevent.setsplitsettingTFS($("#chooseSpointselect").val(), h.prop("checked")? e.val(): -1), trevent.setsplitsettingRT($("#chooseSpointselect").val(), q.prop("checked")? p.val(): -1), updateSplitIgnore(), updateSplits(), t.dialog("close"));return a}var f = /^(\d\d\d\d-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01]) (0[0-9]|1[0-9]|2[0-4]):([0-5][0-9]):([0-5][0-9]))$/,b = /^(\d\d\d|\d\d|\d):([0-5][0-9]):([0-5][0-9])$/,p = $("#ignoreRT"),e = $("#ignoreTFS"),q = $("#ignoreRTcb"),h = $("#ignoreTFScb"),r = $([]).add(p).add(e),m = $(".validateTips");q.change(function () {q.prop("checked")? p.prop("disabled", !1): p.prop("disabled", !0)});h.change(function () {h.prop("checked")? e.prop("disabled", !1): e.prop("disabled", !0)});var t = $("#ignore-dialog-form").dialog({autoOpen: !1,height: "auto",width: 160,modal: !0,dialogClass: "ignoredialog",position: {my: "center top",at: "center bottom",of: "#ignorebutton"},buttons: {OK: g,Cancel: function () {w[0].reset();r.removeClass("ui-state-error");t.dialog("close")}},open: function () {var a = trevent.getsplitsettingRT($("#chooseSpointselect").val());-1 == a? (q.prop("checked", !1), p.prop("disabled", !0), p.val(trevent.splitdefaultrt)): (q.prop("checked", !0), p.prop("disabled", !1), p.val(a.replace("T", " ").replace(".000Z", "")));a = trevent.getsplitsettingTFS($("#chooseSpointselect").val());-1 == a? (h.prop("checked", !1), e.prop("disabled", !0), e.val("00:00:00")): (h.prop("checked", !0), e.prop("disabled", !1), e.val(a))},close: function () {w[0].reset();r.removeClass("ui-state-error")}});var w = t.find("form").on("submit", function (a) {a.preventDefault();g()});$("#ignorebutton").button().on("click", function () {t.dialog("open")})});$(function () {function a() {"New split line" == nsdialog.dialog("option", "title")? (map.removeLayer(splitlinecandidate), map.removeLayer(splitlinecandidate2), savesplitline(), splitlinecandidate2 = splitlinecandidate = null): (map.removeLayer(splitcandidate.marker), savesplitpoint(), splitcandidate = null);nsdialog.dialog("close");return !0}nsdialog = $("#newpoint-dialog-form").dialog({autoOpen: !1,height: "auto",width: 240,modal: !0,dialogClass: "ignoredialog",position: {my: "center center",at: "center center",of: window},buttons: {OK: a,Cancel: function () {nsdialog.dialog("close")}},close: function () {"New split line" == nsdialog.dialog("option", "title")? null != splitlinecandidate && (map.removeLayer(splitlinecandidate), map.removeLayer(splitlinecandidate2), splitlinecandidate2 = splitlinecandidate = null): null != splitcandidate && (map.removeLayer(splitcandidate.marker), splitcandidate = null);d[0].reset()},open: function () {"New split line" == nsdialog.dialog("option", "title")? $("#newsplitradiusdiv").hide(): $("#newsplitradiusdiv").show()}});var d = nsdialog.find("form").on("submit", function (d) {d.preventDefault();a()});$("#newsplitradiusselect").change(function () {splitcandidate.radiusmeters = $("#newsplitradiusselect").val();prevsplitpointradius = splitcandidate.radiusmeters;var a = trevent.getmperpixel(),d = map.containerPointToLatLng(L.point(0, 0)),b = map.containerPointToLatLng(L.point(0, 100));splitcandidate.marker.options.icon.setsize(2 * splitcandidate.radiusmeters / (a / (0trevent.mapsystem? 100 / (111319.9 * (d.lat - b.lat)): Math.pow(1E4 / (Math.pow(d.lat - b.lat, 2) + Math.pow(d.lng - b.lng, 2)), .5))))})});$("#diffFirstselect").change(function () {diffcomp1 = $("#diffFirstselect").val();diffcomp1nro = $("#diffFirstselect option:selected").index();updatedifference()});$("#diffBehindselect").change(function () {diffcomp2 = $("#diffBehindselect").val();diffcomp2nro = $("#diffBehindselect option:selected").index();updatedifference()});document.getElementById("tailBox").defaultValue = "1:00";window.onload = function () {var a = document.getElementById("speed-select"),d = document.getElementById("speed-selectMob");a = [a, d];d = "1 2 3 5 7 10 15 20 30 50 120 300 600 1200".split(" ");for (var g = d.length, f = 0; 2 > f; f++) for (var b = 0; bg; b++) {var p = document.createElement("option");p.text = p.value = d[b];5 == b && (p.selected = "true");a[f].add(p, 0)}};function holdit(a, d, g, f) {var b = 0,p = null,e = function () {b++;(1 == b || 4 == b || 5b) && d();p = window.setTimeout(e, 100)};a.onmousedown = function () {b = 0;e()};a.onmouseup = function () {window.clearTimeout(p);b = 0;replayspeed = $("#speed-select").val();continueReplaying && (replaying =! 0, continueReplaying =! 1, replaystartrealtime = new Date, replaystartracetime = trevent.timetodraw, myReplayAnimationReq = requestAnimationFrame(replaytimer))};a.onmouseout = function () {window.clearTimeout(p);b = 0;replayspeed = $("#speed-select").val();continueReplaying && (replaying =! 0, continueReplaying =! 1, replaystartrealtime = new Date, replaystartracetime = trevent.timetodraw, myReplayAnimationReq = requestAnimationFrame(replaytimer))}}holdit(document.getElementById("a1l"), function () {windTime(-1)}, fSpeed, multiplier);holdit(document.getElementById("a2l"), function () {windTime(-10)}, fSpeed, multiplier);holdit(document.getElementById("a3l"), function () {windTime(-60)}, fSpeed, multiplier);holdit(document.getElementById("a4l"), function () {windTime(-600)}, fSpeed, multiplier);holdit(document.getElementById("a1r"), function () {windTime(1)}, fSpeed, multiplier);holdit(document.getElementById("a2r"), function () {windTime(10)}, fSpeed, multiplier);holdit(document.getElementById("a3r"), function () {windTime(60)}, fSpeed, multiplier);holdit(document.getElementById("a4r"), function () {windTime(600)}, fSpeed, multiplier);$("#ma1l").click(function () {windTime(-10)});$("#ma2l").click(function () {windTime(-60)});$("#ma1r").click(function () {windTime(10)});$("#ma2r").click(function () {windTime(60)});function windTime(a) {maxPT = $("#timeSlider").slider("option", "max");minPT = $("#timeSlider").slider("option", "min");replaying && (replaying =! 1, continueReplaying =! 0);var d = trevent.timetodraw + a;d > maxPT && (d = maxPT);0 > a && dminPT && (d = minPT);null != trevent && d <= maxPT && d >= minPT && (trevent.setTimeToDraw(d) && (redrawMap(), trevent.updatenamelist(speedunit, "desktop" != appMode)), $("#timeSlider").slider("option", "value", d), updateTime())}function uiLiveReplay(a, d) {a? (d && $("#liveStatus").addClass("liveMode").removeClass("onlyReplay"), $("#text").html('<span class="boldertext">LIVE</span>&nbsp;&nbsp;<span class="smallertext">REPLAY</span>'), $("#ball").css("background-color", "green"), $("#player").hide(), $("#btnShowPlayer").hide(), $("#map, #menu, #settingsMenu").css("height", "100%"), d && $("#liveStatus").show()): (d && $("#liveStatus").hide(), "desktop" == appMode? ($("#map, #menu, #settingsMenu").css("height", divHeights[1]), $("#player").show()): ($("#btnShowPlayer").show(), $("#btnShowPlayer").hasClass("hidePlayer") && ($("#player").show(), $("#map").css("height", divHeights[0]))));map.invalidateSize(!1);null != canvasoverlay && canvasoverlay.redraw()}function initTooltip() {$(document).tooltip({items: "[owntitle]",content: function () {return $("#selCompName").is(":visible")? "": $(this).attr("owntitle")},position: {my: "desktop" == appMode? "left top": "right top",at: "desktop" == appMode? "left+204 top": "left+2304 top",collision: "flipfit"},show: {delay: 500}})}function drawingOnCanvas(a, d) {null != trevent.overlay && trevent.overlay.draw(a, d)}function detectIE() {var a = window.navigator.userAgent,d = a.indexOf("MSIE ");if (0d) return parseInt(a.substring(d + 5, a.indexOf(".", d)), 10);if (0a.indexOf("Trident/")) return d = a.indexOf("rv:"),parseInt(a.substring(d + 3, a.indexOf(".", d)), 10);d = a.indexOf("Edge/");return 0d? parseInt(a.substring(d + 5, a.indexOf(".", d)), 10): !1}$(document).ready(function () {hideallmenus && ($("#statusBox").hide(), $("#btnShowMenu").hide(), $("#btnShowSetMenu").hide(), $("#menu").hide());inIframe() || $("#newtaba").hide();var a = !1,d = 1;iswp = !1;(navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/iPad/i)) && !navigator.userAgent.match(/IEMobile/i) && (a =! 0);navigator.userAgent.match(/ARM/) && navigator.userAgent.match(/Touch/) && navigator.userAgent.match(/Trident/) && (iswp =! 0);(a || iswp) && $.ajax({type: "get",url: testEventPath + "data.php?map=1&factor=1" + (iswp? "&wp=1": "") + (issessioned? "&GpsSeurantaSessionID=" + sessionid: ""),async: !1,cache: !1,contentType: "application/text; charset=ISO-8859-1",error: function () {},success: function (a, b, g) {iniwidth = g.getResponseHeader("X-GPS-Server-Mapwidth");iniheight = g.getResponseHeader("X-GPS-Server-Mapheight");iniwidth || (iniwidth = 0);iniheight || (iniheight = 0);d = a}});a || initTooltip();var g = .1 == d;g && (d = 1);$("#rallySet").hide();$("#gpxuploadSet").hide();trevent = new Event(testEventPath, d, forceMapSystem);trevent.mapsystemset = function (a, b, p, e, q, h, r) {mapsystem = a;wgscenterpoint = {x: b,y: p};0 == mapsystem? drawLeafletMap(g || 1d? testEventPath + "data.php?map=1" + (iswp? "&wp=1": "") + (issessioned? "&GpsSeurantaSessionID=" + sessionid: ""): testEventPath + "map" + (issessioned? "?GpsSeurantaSessionID=" + sessionid: ""),iniwidth,iniheight,function (a) {spinner.stop()}): (setMapSystem(a, wgscenterpoint, q, h, r), e && (canvasoverlay = L.canvasOverlay().drawing(drawingOnCanvas, 1 == a).addTo(map)), null != osmOverlay && osmOverlay.setOpacity(.7), $("#mapOpacitySlider").slider("value", 70), $("#showMO").html("Map opacity: 70 %"))};trevent.enablerallymode = function () {console.log("RALLY!");$("#rallySet").show();trevent.setRallymode(!0)};trevent.enablegpxuploadmode = function () {console.log("GPX!");$("#gpxlink").attr("href", "https://www.tulospalvelu.fi/gpxlogin/?eventID=" + eventId);$("#gpxuploadSet").show()};trevent.load_init();trevent.createnamelist = function (a, b) {timeshowdate = b;! iswp && detectIE() && $("#competitorCont").height(15E3);timeshowdate && $("#playDate").show();updatescalebar();0trevent.numberoflogos && initializelogos(trevent.numberoflogos);for (var d =[], e =[], f =[], g =[], r = 0; ra.length; r++) d.push(a[r].letters),f.push(0),e.push(0),g.push(0),$("#competitorCont").append("<div id=compID" + r + " class=competitor> <div class=compSelect> <div class=checkboxFour> <input type=checkbox name=competitor class=compCb id=c" + r + " value=id" + r + "> <label for=c" + r + "></label> </div> </div> <div class=compNameHolder><div id=" + r + ' class=compName owntitle="' + a[r].name + "<br><b>" + a[r].letters + "</b>" + ("" == a[r].additionaldata? "": "<br>" + a[r].additionaldata) + '">' + a[r].name + "</div></div> <div class=compLet id=compLetters" + r + ">" + a[r].letters + "</div> <div id=compDI" + r + " class=compData><div class=cst id=cst" + r + ">" + a[r].starttimestring + "</div> " + (0 > a[r].currentspeed? "?": Number(a[r].currentspeed).toFixed(0)) + "&#8199;km/h " + Number(a[r].currentdistance / 1E3).toFixed(2) + "&#8199;km " + a[r].status + '</div><div id="compMenu' + r + '" class="cMenu"></div></div>'),$("#compMenu" + r).html(' <span id="selCompName">' + a[r].letters + '</span><br><span id="cen' + r + '" class="btnCompCenter">Center</span> <span id="ac' + r + '" class="btnAutoCompCenter">Autocenter OFF</span> <br><span id="h' + r + '" class="btnCompHighLight"  title="CTRL+Click Name">Highlight OFF</span> <span id="fr' + r + '" class="btnCompFullRoute">Full route OFF</span> <br><span id="ccol' + r + '" class="showColor">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span id="seluntil' + r + '" class="btnSelUntil">Check above</span> '),$("#ccol" + r).css("background-color", a[r].color),$("#c" + r).change(function () {var a = $(this).attr("id").replace(/^\D+/g, "");1 == $(this).prop("checked")? $(this).prop("checked", !0): $(this).prop("checked", !1);trevent.toggleCheck(a, map, ismapvisible);eventIsLive && updatelivefromstarttime();splitsVisible && updateSplits();redrawMap()});trevent.updatenamelist(speedunit, "desktop" != appMode);$(".compName").click(function (a) {if (a.ctrlKey) a = Number($(this).attr("id")),0 == e[a]? ($("#h" + a).addClass("btnCompHighLightOn").removeClass("btnCompHighLight").html("Highlight ON"), e[a] = 1, $("#" + a).css({"font-weight": "bold"})): ($("#h" + a).addClass("btnCompHighLight").removeClass("btnCompHighLightOn").html("Highlight OFF"), e[a] = 0, $("#" + a).css({"font-weight": "normal"})),trevent.toggleHighlight(a, map, ismapvisible),redrawMap(),splitsVisible && updateSplits(); else {a = "#" + $(this).attr("id");$(this).attr("id");a = $(a).position();var b = $("#competitorCont").height();$(document).height();a = "desktop" == appMode? b + 60 -(a.top - 1): b + 35 -(a.top - 1);$(".compSettingsCont").height();b = 50 $("#compID" + $(this).attr("id")).height();null != compMenuVisible && hideCompMenu();if (! b) {$("#compID" + $(this).attr("id")).height($("#compID" + $(this).attr("id")).height() + ("desktop" == appMode? 70: 90));$("#compMenu" + $(this).attr("id")).show();compMenuVisible = $("#compMenu" + $(this).attr("id"));var d = $("#compID" + $(this).attr("id")).height();ad && $("#competitorCont").scrollTop($("#competitorCont").scrollTop() + (d - a))}compSettingsWindowVisible = ! b}});$(".btnAutoCompCenter, .btnAutoCompCenterOn").click(function () {var a = $(this).attr("id").replace(/^\D+/g, "");0 == g[a]? (setAll(g, 0), g[a] = 1, $(".btnAutoCompCenterOn").addClass("btnAutoCompCenter").removeClass("btnAutoCompCenterOn").html("Autocenter OFF"), $(this).addClass("btnAutoCompCenterOn").removeClass("btnAutoCompCenter").html("Autocenter ON"), $(".compName").css({"font-style": "normal"}), $("#" + a).css({"font-style": "italic"})): (g[a] = 0, $(this).addClass("btnAutoCompCenter").removeClass("btnAutoCompCenterOn").html("Autocenter OFF"), $("#" + a).css({"font-style": "normal"}));trevent.toggleAutocenter(a)});$(".btnCompFullRoute, .btnCompFullRouteOn").click(function () {var a = $(this).attr("id").replace(/^\D+/g, "");0 == f[a]? (f[a] = 1, $(this).addClass("btnCompFullRouteOn").removeClass("btnCompFullRoute").html("Full route ON"), $("#" + a).css({"text-decoration": "underline"})): (f[a] = 0, $(this).addClass("btnCompFullRoute").removeClass("btnCompFullRouteOn").html("Full route OFF"), $("#" + a).css({"text-decoration": "none"}));trevent.toggleFullroute(a);redrawMap()});$(".btnCompHighLight, .btnCompHighLightOn").click(function () {var a = $(this).attr("id").replace(/^\D+/g, "");0 == e[a]? (e[a] = 1, $(this).addClass("btnCompHighLightOn").removeClass("btnCompHighLight").html("Highlight ON"), $("#" + a).css({"font-weight": "bold"})): (e[a] = 0, $(this).addClass("btnCompHighLight").removeClass("btnCompHighLightOn").html("Highlight OFF"), $("#" + a).css({"font-weight": "normal"}));trevent.toggleHighlight(a, map, ismapvisible);splitsVisible && updateSplits()});$(".btnCompCenter").click(function () {"mobile" == appMode && ($("#menuBtnContainerMobile").hide(), $("#menu").hide(), $("#statusBox").show(), playerStatus(), $("#menuBtnContainerMobile").removeClass("showMobileMenu"), $("#btnShowMenu").addClass("showMenu").removeClass("hideMenu"), ismapvisible =! 0, mapbecamevisible());var a = $(this).attr("id").replace(/^\D+/g, "");trevent.centercompetitor(mapHeight, a)});$(".btnSelUntil").click(function () {var a = $(this).attr("id").replace(/^\D+/g, "");$("#competitorCont input:checkbox").prop("checked", !0);for (var b = 0; b <= a; b++) console.log("#c" + b),$("#c" + b).prop("checked", !1);trevent.checkUntil(a, map, ismapvisible);eventIsLive && updatelivefromstarttime();splitsVisible && updateSplits()});r = 0;$(".checkboxFour label").each(function () {$(this).css("background-color", a[r].color);compColArray.push(a[r].color);r += 1});$(".competitor").click(function () {isCompSelected = !0;$(".competitorSelected").each(function () {$(this).addClass("competitor").removeClass("competitorSelected")});$(this).addClass("competitorSelected").removeClass("competitor");var b = $(this).attr("id").replace(/^\D+/g, ""),d = a[b].getOffsetString();d = d.replace(/\+/g, "");$("#offBox").val(d);"" == compFullName && ($(".offsetContHolder").show(), $("#resetOff").show());compFullName = $("#" + b).text();compOffId = b;$(".showSelOffName").text(compFullName);$(".showSelOffID").text(compOffId)});$(".showColor").click(function () {pickCompIdForColor = $(this).attr("id").replace(/^\D+/g, "");var a = $(this).css("background-color");hexc(a);$("#compID" + pickCompIdForColor).find(".checkboxFour label").css("background-color", "#" + colo);$("#picker").colpickSetColor(colo, !0);$("#colorBox").toggle(0, function () {})});for (r = 0; ra.length; r++) a[r].marker.addTo(map),a[r].path.addTo(map);d = "";for (r = 0; ra.length; r++) d += "<option>" + a[r].name + "</option>";$("#diffFirstselect ").html(d);$("#diffBehindselect ").html(d);0a.length && ($("#diffFirstselect option:eq(0)").prop("selected", !0), diffcomp1 = $("#diffFirstselect").val(), diffcomp1nro = 0);1a.length && ($("#diffBehindselect option:eq(1)").prop("selected", !0), diffcomp2 = $("#diffBehindselect").val(), diffcomp2nro = 1)};trevent.data_added = function (a) {a || (updateTime(), spinner2.stop(), setTimeDifference(), hideLoadingBox(), trevent.addbuoys(map), appIsReady =! 0, null != canvasoverlay && canvasoverlay.redraw());var b = trevent.getReplayMinTime(),d = trevent.getReplayMaxTime();db && (d = b);$("#timeSlider").slider("option", "max", d);$("#timeSlider").slider("option", "min", b);maxPT = $("#timeSlider").slider("option", "max");minPT = $("#timeSlider").slider("option", "min");a || ($("#timeSlider").slider("option", "value", b), eventIsLive && (myLiveAnimationReq = requestAnimationFrame(livetimer)));replaymode && ! replaying && (redrawMap(), trevent.updatenamelist(speedunit, "desktop" != appMode));splitsVisible && updateSplits()};trevent.setLive = function (a, b) {livestartlocaltime = a.getTime() / 1E3;livestartrealtime = b;eventIsLive = !0;replaymode = !1;uiLiveReplay(eventIsLive, !0);map.contextmenu.setDisabled(2, !0)};trevent.showLoading = showLoadingBox;trevent.updateLoading = updateLoadingBox;trevent.hideLoading = hideLoadingBox;trevent.updatecompinfo = function (a, b) {$("#compDI" + a).html(b)};trevent.updateroglist = updateRog;trevent.enablerog = enablerog;trevent.setdefaulttail = updateTailBox2;$("#sectorroutescb").prop("checked", !1);$("#sectorcolorcb").prop("checked", !1);$("#sectorcolorcb").prop("disabled", !0);trevent.initialiseMarkersizes($("#markerSizeSlider").slider("option", "value"), $("#markerLetSlider").slider("option", "value"), $("#lineWidthSlider").slider("option", "value"), $("#lineOpacitySlider").slider("option", "value") / 100)});function setoneclickmassstart(a, d) {if (replaymode) {var g = d;0 == trevent.mapsystem && (g = mapHeight - d);g = trevent.setoneclickmassstart(a, g);replaying = !1;1E20 > g && (trevent.setTimeToDraw(g), $("#timeSlider").slider("option", "value", g), updateTime(), redrawMap(), trevent.updatenamelist(speedunit, "desktop" != appMode), updateOffsetStuff());g = $(".showSelOffID").text();"" != g && (g = g.replace(/^\D+/g, ""), g = trevent.tracks[g].getOffsetString(), g = g.replace(/\+/g, ""), $("#offBox").val(g))}}function zoomstarted() {iszooming = !0}function updatescalebar() {if (null != trevent) {iszooming = !1;var a = trevent.getmperpixel(),d = map.containerPointToLatLng(L.point(0, 0)),g = map.containerPointToLatLng(L.point(0, 100));a /= 0trevent.mapsystem? 100 / (111319.9 * (d.lat - g.lat)): Math.pow(1E4 / (Math.pow(d.lat - g.lat, 2) + Math.pow(d.lng - g.lng, 2)), .5);d = 0;g = 45 * a;for (i = 0; 100 > i; i ++) {var f = Math.pow(10, i);if (1 * f > g) {d = 1 * f;break}if (2 * f > g) {d = 2 * f;break}if (3 * f > g) {d = 3 * f;break}if (5 * f > g) {d = 5 * f;break}}if (0d) {f = 1 * d / a;g = Math.round(f);f = Math.round((100 - f - 4) / 2);var b = d + " m";999d && (b = d / 1E3 + " km");$("#scaleline").css("width", g + "px");$("#scaleline").css("left", f + "px");$("#scaleline").text(b)}null != trevent && trevent.resizesplitpoints(a);null != splitcandidate && splitcandidate.marker.options.icon.setsize(2 * splitcandidate.radiusmeters / a)}}function showLoadingBox() {$("#loadingBox").html("loading data...");$("#loadingBox").show(0, function () {})}function hideLoadingBox() {$("#loadingBox").hide(0, function () {})}function updateLoadingBox(a) {$("#loadingBox").html(a)}function initializelogos(a) {for (i = 1; i a + 1; i ++) logos.push(new Logo(testEventPath + "logo" + i + (issessioned? "?GpsSeurantaSessionID=" + sessionid: ""))),console.log(testEventPath + "logo" + i);setTimeout("changelogo(true)", 5E3)}function changelogo(a) {"desktop" == appMode && logotoshowlogos.length && 0logos[logotoshow].logowidth? ($(".leaflet-bottom.leaflet-right").html('<img src="' + logos[logotoshow].url + '">'), $(".leaflet-bottom.leaflet-right").css("margin-bottom", "0px"), $(".leaflet-bottom.leaflet-right").css("line-height", "0")): ($(".leaflet-bottom.leaflet-right").html('<div class="leaflet-control-attribution leaflet-control"><a href="http://leafletjs.com" >Leaflet</a> |\ufffd' + attributionText + "</div>"), $(".leaflet-bottom.leaflet-right").css("margin-right", "0px"), $(".leaflet-bottom.leaflet-right").css("line-height", "1.5"));logotoshow++;logotoshow > logos.length && (logotoshow = 0);a && setTimeout("changelogo(true)", 15E3)}function setAll(a, d) {var g,f = a.length;for (g = 0; gf; ++ g) a[g] = d}function Logo(a) {this.logoheight = this.logowidth = 0;this.logo = new Image;this.url = a;var d = this;d.logo.onload = function () {d.logowidth = d.logo.width;d.logoheight = d.logo.height};this.logo.src = a}function mapbecamevisible() {null != trevent && (trevent.updatemarkers(map), redrawMap())}function markcmenupoint(a) {contextmenumarker.setLatLng(a);contextmenumarker.addTo(map)}function hidecmenupoint() {map.removeLayer(contextmenumarker)}function startsplitline(a) {null == splitlinecandidate? (splitlinecandidate =( new L.polyline([a, a], {contextmenu: !0,clickable: !1,pointerEvents: "none",color: "red",weight: 10,opacity: .4})).addTo(map), splitlinecandidate2 =( new L.polyline([a, a], {contextmenu: !0,clickable: !1,pointerEvents: "none",color: "black",weight: 2,opacity: 1})).addTo(map)): (splitlinecandidate.setLatLngs([a, a]), splitlinecandidate2.setLatLngs([a, a]));isdrawingsline = !0}function endsplitline(a) {splitlinecandidate.setLatLngs([splitlinecandidate.getLatLngs()[0],a]);splitlinecandidate2.setLatLngs([splitlinecandidate.getLatLngs()[0],a]);isdrawingsline = !1;$("#newsplitname").val(trevent.nextsplitid);$("#newsplitorderselect").html(trevent.getsplitpointlist(!0, !1));$("#newsplitorderselect option:last").attr("selected", "selected");nsdialog.dialog("option", "title", "New split line");nsdialog.dialog("open");$("#newpointsubmit").focus()}function addsplitpoint(a) {if (null != trevent) {var d = trevent.getmperpixel(),g = map.containerPointToLatLng(L.point(0, 0)),f = map.containerPointToLatLng(L.point(0, 100));d /= 0trevent.mapsystem? 100 / (111319.9 * (g.lat - f.lat)): Math.pow(1E4 / (Math.pow(g.lat - f.lat, 2) + Math.pow(g.lng - f.lng, 2)), .5);null != splitcandidate && (map.removeLayer(splitcandidate.marker), splitcandidate = null);splitcandidate = new splitline;splitcandidate.x1 = a.lng;splitcandidate.y1 = a.lat;splitcandidate.radiusmeters = prevsplitpointradius;splitcandidate.ispoint = !0;splitcandidate.id = trevent.nextsplitid;splitcandidate.marker = (new L.Marker(a, {contextmenu: !0,clickable: !1,zIndexOffset: 1E6,icon: new L.NumberedDivIcon2({color: "purple",blackshadow: !1,number: splitcandidate.id,size: 2 *splitcandidate.radiusmeters / d,lsize: 14})})).addTo(map);$("#newsplitname").val(splitcandidate.id);$("#newsplitradiusselect").val(prevsplitpointradius);$("#newsplitorderselect").html(trevent.getsplitpointlist(!0, !1));$("#newsplitorderselect option:last").attr("selected", "selected");nsdialog.dialog("option", "title", "New split point");nsdialog.dialog("open");$("#newpointsubmit").focus()}}function savesplitpoint() {var a = trevent.getmperpixel(),d = map.containerPointToLatLng(L.point(0, 0)),g = map.containerPointToLatLng(L.point(0, 100));a /= 0trevent.mapsystem? 100 / (111319.9 * (d.lat - g.lat)): Math.pow(1E4 / (Math.pow(d.lat - g.lat, 2) + Math.pow(d.lng - g.lng, 2)), .5);trevent.addsplitpoint(L.latLng(splitcandidate.y1, splitcandidate.x1), splitcandidate.radiusmeters, splitlgroup, a, $("#newsplitname").val(), $("#newsplitorderselect").val());$("#chooseSpointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseSpointselect option:last").attr("selected", "selected");$("#chooseS1pointselect ").html(trevent.getsplitpointlist(!1, !0));$("#chooseS1pointselect option:first").attr("selected", "selected");$("#chooseS2pointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseS2pointselect option:last").attr("selected", "selected");checkandhidelaps();updateSplitIgnore();$("#splitsettingscb").button("option", "disabled", !1);splitsVisible && updateSplits()}function definepredefsplitpoints() {var a = trevent.getmperpixel(),d = map.containerPointToLatLng(L.point(0, 0)),g = map.containerPointToLatLng(L.point(0, 100));a /= 0trevent.mapsystem? 100 / (111319.9 * (d.lat - g.lat)): Math.pow(1E4 / (Math.pow(d.lat - g.lat, 2) + Math.pow(d.lng - g.lng, 2)), .5);for (i67 = 0; i67 trevent.predefc.length; i67 ++) trevent.addsplitpoint(L.latLng(mapHeight - trevent.predefc[i67].y, trevent.predefc[i67].x), trevent.predefcradius, splitlgroup, a, i67 + 1 + "", trevent.splitlines.length);$("#chooseSpointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseSpointselect option:last").attr("selected", "selected");$("#chooseS1pointselect ").html(trevent.getsplitpointlist(!1, !0));$("#chooseS1pointselect option:first").attr("selected", "selected");$("#chooseS2pointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseS2pointselect option:last").attr("selected", "selected");checkandhidelaps();updateSplitIgnore();$("#splitsettingscb").button("option", "disabled", !1);splitsVisible && updateSplits()}function savesplitline() {trevent.addsplitline(splitlinecandidate, splitlgroup, $("#newsplitname").val(), $("#newsplitorderselect").val());$("#chooseSpointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseSpointselect option:last").attr("selected", "selected");$("#chooseS1pointselect ").html(trevent.getsplitpointlist(!1, !0));$("#chooseS1pointselect option:first").attr("selected", "selected");$("#chooseS2pointselect ").html(trevent.getsplitpointlist(!1, !1));$("#chooseS2pointselect option:last").attr("selected", "selected");checkandhidelaps();$("#splitsettingscb").button("option", "disabled", !1);updateSplitIgnore();splitsVisible && updateSplits()}function inIframe() {try {return window.self !== window.top} catch (a) {return !0}}$(function () {$("#setMenuTabs").tabs({activate: function (a, d) {1 == $("#setMenuTabs").tabs("option", "active")? (splitsVisible =! 0, updateSplits()): splitsVisible = !1},disabled: [4]})});function Piste(a, d) {this.x = a;this.y = d}function gsacourse(a, d) {this.maxdeltam = 9E4;this.reallength = this.scaledlength = 0;this.maxhe = -999999999;this.minhe = 999999999;this.profilepoints = [];this.segments = [];this.segmentids = [];this.segmentstarts = [];this.fullcourse = [];this.cal = d;this.speed = 5.6;this.timelimitforestimates = 999999999;this.metersperpixel = 1;this.useestimateddistances = !1;this.debug = !0;this.getdistance = getdistance;this.getsimplecoursedistance = getsimplecoursedistance;var g = a.split("\n");this.debug && console.log(g.length + "rows");for (i = 0; i < g.length; i ++) {var f = g[i].split(":");if ("DISTANCE" == f[0]) this.scaledlength = f[1]; else if ("SEGMENTS" == f[0]) for (f = f[1].split("|"), i2 = 0; i2 f.length; i2 ++) this.segmentids.push(f[i2]); else "SPEED" == f[0]? this.speed = f[1]: "MAXDELTA" == f[0]? (f = f[1], this.maxdeltam = f * f): "TIMELIMIT" == f[0]? this.timelimitforestimates = f[1]: "ESTDIST" == f[0]? this.useestimateddistances = !0: 0 === g[i].lastIndexOf("[", 0)? (f = g[i].substring(1, g[i].length - 1), f = new gsacoursesegment(f, this.cal), this.segments.push(f)): 0 this.segments.length && this.segments[this.segments.length - 1].addpoint(g[i])}for (i = this.reallength = 0; i this.segmentids.length; i ++) for (j = 0; j this.segments.length; j ++) if (this.segmentids[i] == this.segments[j].id) {this.reallength += this.segments[j].truelength;break}g = 0;f = this.scaledlength / this.reallength;for (j = 0; j this.segments.length; j ++) this.segments[j].scaleall(f);for (i = 0; i this.segmentids.length; i ++) for (this.segmentstarts.push(g), j = 0; j this.segments.length; j ++) if (this.segmentids[i] == this.segments[j].id) {g += this.segments[j].scaledlength;for (k = 0; k this.segments[j].points.length; k ++) (0 < k || 0 == i) && this.fullcourse.push({x: this.segments[j].points[k].mapx,y: this.segments[j].points[k].mapy,z: this.segments[j].points[k].height,d: this.segmentstarts[i] + this.segments[j].points[k].scaleddistance}),this.profilepoints.push(new Piste(this.segmentstarts[i] + this.segments[j].points[k].scaleddistance, this.segments[j].points[k].height)),this.segments[j].points[k].height > this.maxhe && (this.maxhe = this.segments[j].points[k].height),this.segments[j].points[k].height this.minhe && (this.minhe = this.segments[j].points[k].height);break}this.debug && (console.log("m " + this.reallength), console.log("p " + this.fullcourse.length))}function getsimplecoursedistance(a, d, g, f, b, p, e, q, h) {var r = f;0 > r && (r = 0);for (r > this.fullcourse.length - 1 && (r = this.fullcourse.length - 1); 0r && this.fullcourse[r].d > g - 100;) r--;var m = f;0 > m && (m = 0);m > this.fullcourse.length - 1 && (m = this.fullcourse.length - 1);for (f = g + 10 * (b - p) * this.speed; m this.fullcourse.length - 2 && this.fullcourse[m].d f;) m++;var t = -1;f = -1;for (k11 = r; k11 m; k11 ++) {r = this.fullcourse[k11].x;var w = this.fullcourse[k11].y,v = this.fullcourse[k11 + 1].x - r,x = this.fullcourse[k11 + 1].y - w,z = 0;if (0 != v || 0 != x) z = ((a - r) * v + (d - w) * x) / (v * v + x * x);1z && (z = 1);0 > z && (z = 0);dist = Math.pow(a - (r + z * v), 2) + Math.pow(d - (w + z * x), 2);if (-1 == t || t > dist) t = dist,f = this.fullcourse[k11].d + z * (this.fullcourse[k11 + 1].d - this.fullcourse[k11].d)}a = !1;d = -1;g this.scaledlength && f > this.scaledlength - 1 && e > .3 * this.scaledlength && (a =! 0, 0q && (d = p + (this.scaledlength - g) / (q / 3.6)), -1 == d || d > b) && (d = b);"t611" == h && console.log(b + " " + f);return {d: f, f: a, ft: d}}function getdistance(a, d, g, f, b, p, e, q, h, r) {q = 9999999999;f = -1;g = this.maxdeltam / (this.metersperpixel * this.metersperpixel);for (i6 = 0; i6 this.segments.length; i6 ++) r = this.segments[i6].getnearestdisttopoint(a, d),r q && (q = r, f = i6);a = b - p * this.speed;if (60h && a > h * this.speed * 10 || 60.1 > h && a > h * this.speed * 20) a = h * this.speed;for (j = 0; j this.segmentstarts.length; j ++) for (k = 0; k this.segments.length; k ++) if (this.segmentids[j] == this.segments[k].id) {d = this.segmentstarts[j] + this.segments[k].nearestdist;p = Math.abs(d - (this.useestimateddistances? h * this.speed: e) / this.reallength * this.scaledlength);h > this.timelimitforestimates && (p = Math.abs(d - a));p this.segments[k].totaldistancedelta && (this.segments[k].totaldistanceehdokas = d, this.segments[k].totaldistancedelta = p, this.segments[k].predictiondiff = Math.abs(a - d), d b && (this.segments[k].predictiondiff *= 2), this.segments[k].firstorlast && 1E-6d && d this.scaledlength - 1E-5 && (this.segments[k].predictiondiff = 10 * Math.abs(a - d)));break}b = this.segments[f].totaldistanceehdokas;e = this.segments[f].predictiondiff;for (k = 0; k this.segments.length; k ++) this.segments[k].deltafromsegment g && this.segments[k].predictiondiff e && (b = this.segments[k].totaldistanceehdokas, e = this.segments[k].predictiondiff);if (500e) for (g *= 4, k = 0; k this.segments.length; k ++) this.segments[k].deltafromsegment g && this.segments[k].predictiondiff e && (b = this.segments[k].totaldistanceehdokas, e = this.segments[k].predictiondiff);e = 999999999;if (60h && b > h * this.speed * 10 || 60.1 > h && b > h * this.speed * 50) for (k = 0; k this.segments.length; k ++) (60h && this.segments[k].totaldistanceehdokas < h * this.speed * 10 || 60.1 > h && this.segments[k].totaldistanceehdokas h * this.speed * 50) && this.segments[k].predictiondiff e && (b = this.segments[k].totaldistanceehdokas, e = this.segments[k].predictiondiff);return b}function gsacoursewaypoint() {this.mapy = this.mapx = this.scaleddistance = this.truedistance = this.height = this.lat = this.lon = 0}function gsacoursesegment(a, d) {this.scaledlength = this.truelength = 0;this.id = a;this.calibration = d;this.points = [];this.nearestdist = 0;this.firstorlast = !1;this.totaldistanceehdokas = this.deltayfornearest = this.deltaxfornearest = 0;this.predictiondiff = this.deltafromsegment = this.totaldistancedelta = 999999999;this.addpoint = addcoursepoint;this.scaleall = scaleall;this.getnearestdisttopoint = getnearestdisttopoint}function addcoursepoint(a) {var d = a.split("|");if (2d.length) {a = new gsacoursewaypoint;a.lon = d[0] / 1E5;a.lat = d[1] / 1E5;a.height = d[2];a.mapx = this.calibration.getmapx(a.lon, a.lat);a.mapy = this.calibration.getmapy(a.lon, a.lat);d = this.points.length;if (0d) {var g = this.calibration.GetDistance2(this.points[d - 1].lon, this.points[d - 1].lat, a.lon, a.lat);a.truedistance = this.points[d - 1].truedistance + g;a.scaleddistance = a.truedistance}this.points[d] = a;this.truelength = this.points[d].truedistance}}function scaleall(a) {for (i = 0; i this.points.length; i ++) this.points[i].scaleddistance = this.points[i].truedistance * a;this.scaledlength = this.truelength * a}function getnearestdisttopoint(a, d) {this.firstorlast = !1;var g = -1;this.totaldistanceehdokas = 0;this.predictiondiff = this.totaldistancedelta = 999999999;var f = -99999999;if (1 this.points.length) {for (n = 1; n this.points.length; n ++) {var b = this.points[n - 1].mapx;var p = this.points[n - 1].mapy,e = this.points[n].mapx - b,q = this.points[n].mapy - p,h = 0;if (0 != e || 0 != q) h = ((a - b) * e + (d - p) * q) / (e * e + q * q);1h && (h = 1);0 > h && (h = 0);b = Math.pow(a - (b + h * e), 2) + Math.pow(d - (p + h * q), 2);if (-1 == g || g > b) g = b,f = this.points[n - 1].scaleddistance + h * (this.points[n].scaleddistance - this.points[n - 1].scaleddistance),this.deltaxfornearest = this.points[n].mapx - this.points[n - 1].mapx,this.deltayfornearest = this.points[n].mapy - this.points[n - 1].mapy}this.nearestdist = f;this.deltafromsegment = g;if (1E-6 > this.nearestdist || this.nearestdist > this.scaledlength - 1E-6) this.firstorlast = !0;return g}this.nearestdist = 0;return 999999999};